"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.longestBacktickSequence = longestBacktickSequence;
exports.parseEvent = parseEvent;
exports.parsePlainTextMessage = parsePlainTextMessage;

var _event = require("matrix-js-sdk/src/@types/event");

var _HtmlUtils = require("../HtmlUtils");

var _Permalinks = require("../utils/permalinks/Permalinks");

var _parts = require("./parts");

var _SdkConfig = _interopRequireDefault(require("../SdkConfig"));

var _colour = require("../utils/colour");

var _Reply = require("../utils/Reply");

/*
Copyright 2019 New Vector Ltd
Copyright 2019, 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const LIST_TYPES = ["UL", "OL", "LI"]; // Escapes all markup in the given text

function escape(text) {
  return text.replace(/[\\*_[\]`<]|^>/g, match => `\\${match}`);
} // Finds the length of the longest backtick sequence in the given text, used for
// escaping backticks in code blocks


function longestBacktickSequence(text) {
  let length = 0;
  let currentLength = 0;

  for (const c of text) {
    if (c === "`") {
      currentLength++;
    } else {
      length = Math.max(length, currentLength);
      currentLength = 0;
    }
  }

  return Math.max(length, currentLength);
}

function isListChild(n) {
  return LIST_TYPES.includes(n.parentNode?.nodeName);
}

function parseAtRoomMentions(text, pc, opts) {
  const ATROOM = "@room";
  const parts = [];
  text.split(ATROOM).forEach((textPart, i, arr) => {
    if (textPart.length) {
      parts.push(...pc.plainWithEmoji(opts.shouldEscape ? escape(textPart) : textPart));
    } // it's safe to never append @room after the last textPart
    // as split will report an empty string at the end if
    // `text` ended in @room.


    const isLast = i === arr.length - 1;

    if (!isLast) {
      parts.push(pc.atRoomPill(ATROOM));
    }
  });
  return parts;
}

function parseLink(n, pc, opts) {
  const {
    href
  } = n;
  const resourceId = (0, _Permalinks.getPrimaryPermalinkEntity)(href); // The room/user ID

  switch (resourceId?.[0]) {
    case "@":
      return [pc.userPill(n.textContent, resourceId)];

    case "#":
      return [pc.roomPill(resourceId)];
  }

  const children = Array.from(n.childNodes);

  if (href === n.textContent && children.every(c => c.nodeType === Node.TEXT_NODE)) {
    return parseAtRoomMentions(n.textContent, pc, opts);
  } else {
    return [pc.plain("["), ...parseChildren(n, pc, opts), pc.plain(`](${href})`)];
  }
}

function parseImage(n, pc, opts) {
  const {
    alt,
    src
  } = n;
  return pc.plainWithEmoji(`![${escape(alt)}](${src})`);
}

function parseCodeBlock(n, pc, opts) {
  let language = "";

  if (n.firstChild?.nodeName === "CODE") {
    for (const className of n.firstChild.classList) {
      if (className.startsWith("language-") && !className.startsWith("language-_")) {
        language = className.slice("language-".length);
        break;
      }
    }
  }

  const text = n.textContent.replace(/\n$/, ""); // Escape backticks by using even more backticks for the fence if necessary

  const fence = "`".repeat(Math.max(3, longestBacktickSequence(text) + 1));
  const parts = [...pc.plainWithEmoji(fence + language), pc.newline()];
  text.split("\n").forEach(line => {
    parts.push(...pc.plainWithEmoji(line));
    parts.push(pc.newline());
  });
  parts.push(pc.plain(fence));
  return parts;
}

function parseHeader(n, pc, opts) {
  const depth = parseInt(n.nodeName.slice(1), 10);
  const prefix = pc.plain("#".repeat(depth) + " ");
  return [prefix, ...parseChildren(n, pc, opts)];
}

function checkIgnored(n) {
  if (n.nodeType === Node.TEXT_NODE) {
    // Element adds \n text nodes in a lot of places,
    // which should be ignored
    return n.nodeValue === "\n";
  } else if (n.nodeType === Node.ELEMENT_NODE) {
    return n.nodeName === "MX-REPLY";
  }

  return true;
}

function prefixLines(parts, prefix, pc) {
  parts.unshift(pc.plain(prefix));

  for (let i = 0; i < parts.length; i++) {
    if (parts[i].type === _parts.Type.Newline) {
      parts.splice(i + 1, 0, pc.plain(prefix));
      i += 1;
    }
  }
}

function parseChildren(n, pc, opts, mkListItem) {
  let prev;
  return Array.from(n.childNodes).flatMap(c => {
    const parsed = parseNode(c, pc, opts, mkListItem);

    if (parsed.length && prev && ((0, _HtmlUtils.checkBlockNode)(prev) || (0, _HtmlUtils.checkBlockNode)(c))) {
      if (isListChild(c)) {
        // Use tighter spacing within lists
        parsed.unshift(pc.newline());
      } else {
        parsed.unshift(pc.newline(), pc.newline());
      }
    }

    if (parsed.length) prev = c;
    return parsed;
  });
}

function parseNode(n, pc, opts, mkListItem) {
  if (checkIgnored(n)) return [];

  switch (n.nodeType) {
    case Node.TEXT_NODE:
      return parseAtRoomMentions(n.nodeValue, pc, opts);

    case Node.ELEMENT_NODE:
      switch (n.nodeName) {
        case "H1":
        case "H2":
        case "H3":
        case "H4":
        case "H5":
        case "H6":
          return parseHeader(n, pc, opts);

        case "A":
          return parseLink(n, pc, opts);

        case "IMG":
          return parseImage(n, pc, opts);

        case "BR":
          return [pc.newline()];

        case "HR":
          return [pc.plain("---")];

        case "EM":
          return [pc.plain("_"), ...parseChildren(n, pc, opts), pc.plain("_")];

        case "STRONG":
          return [pc.plain("**"), ...parseChildren(n, pc, opts), pc.plain("**")];

        case "DEL":
          return [pc.plain("<del>"), ...parseChildren(n, pc, opts), pc.plain("</del>")];

        case "SUB":
          return [pc.plain("<sub>"), ...parseChildren(n, pc, opts), pc.plain("</sub>")];

        case "SUP":
          return [pc.plain("<sup>"), ...parseChildren(n, pc, opts), pc.plain("</sup>")];

        case "U":
          return [pc.plain("<u>"), ...parseChildren(n, pc, opts), pc.plain("</u>")];

        case "PRE":
          return parseCodeBlock(n, pc, opts);

        case "CODE":
          {
            // Escape backticks by using multiple backticks for the fence if necessary
            const fence = "`".repeat(longestBacktickSequence(n.textContent) + 1);
            return pc.plainWithEmoji(`${fence}${n.textContent}${fence}`);
          }

        case "BLOCKQUOTE":
          {
            const parts = parseChildren(n, pc, opts);
            prefixLines(parts, "> ", pc);
            return parts;
          }

        case "LI":
          return mkListItem?.(n) ?? parseChildren(n, pc, opts);

        case "UL":
          {
            const parts = parseChildren(n, pc, opts, li => [pc.plain("- "), ...parseChildren(li, pc, opts)]);

            if (isListChild(n)) {
              prefixLines(parts, "    ", pc);
            }

            return parts;
          }

        case "OL":
          {
            let counter = n.start ?? 1;
            const parts = parseChildren(n, pc, opts, li => {
              const parts = [pc.plain(`${counter}. `), ...parseChildren(li, pc, opts)];
              counter++;
              return parts;
            });

            if (isListChild(n)) {
              prefixLines(parts, "    ", pc);
            }

            return parts;
          }

        case "DIV":
        case "SPAN":
          // Math nodes are translated back into delimited latex strings
          if (n.hasAttribute("data-mx-maths")) {
            const delims = _SdkConfig.default.get().latex_maths_delims;

            const delimLeft = n.nodeName === "SPAN" ? delims?.inline?.left ?? "\\(" : delims?.display?.left ?? "\\[";
            const delimRight = n.nodeName === "SPAN" ? delims?.inline?.right ?? "\\)" : delims?.display?.right ?? "\\]";
            const tex = n.getAttribute("data-mx-maths");
            return pc.plainWithEmoji(`${delimLeft}${tex}${delimRight}`);
          }

      }

  }

  return parseChildren(n, pc, opts);
}

function parseHtmlMessage(html, pc, opts) {
  // no nodes from parsing here should be inserted in the document,
  // as scripts in event handlers, etc would be executed then.
  // we're only taking text, so that is fine
  const parts = parseNode(new DOMParser().parseFromString(html, "text/html").body, pc, opts);

  if (opts.isQuotedMessage) {
    prefixLines(parts, "> ", pc);
  }

  return parts;
}

function parsePlainTextMessage(body, pc, opts) {
  const lines = body.split(/\r\n|\r|\n/g); // split on any new-line combination not just \n, collapses \r\n

  return lines.reduce((parts, line, i) => {
    if (opts.isQuotedMessage) {
      parts.push(pc.plain("> "));
    }

    parts.push(...parseAtRoomMentions(line, pc, opts));
    const isLast = i === lines.length - 1;

    if (!isLast) {
      parts.push(pc.newline());
    }

    return parts;
  }, []);
}

function parseEvent(event, pc) {
  let opts = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {
    shouldEscape: true
  };
  const content = event.getContent();
  let parts;
  const isEmote = content.msgtype === _event.MsgType.Emote;
  let isRainbow = false;

  if (content.format === "org.matrix.custom.html") {
    parts = parseHtmlMessage(content.formatted_body || "", pc, opts);

    if (content.body && content.formatted_body && (0, _colour.textToHtmlRainbow)(content.body) === content.formatted_body) {
      isRainbow = true;
    }
  } else {
    let body = content.body || "";

    if (event.replyEventId) {
      body = (0, _Reply.stripPlainReply)(body);
    }

    parts = parsePlainTextMessage(body, pc, opts);
  }

  if (isEmote && isRainbow) {
    parts.unshift(pc.plain("/rainbowme "));
  } else if (isRainbow) {
    parts.unshift(pc.plain("/rainbow "));
  } else if (isEmote) {
    parts.unshift(pc.plain("/me "));
  }

  return parts;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJMSVNUX1RZUEVTIiwiZXNjYXBlIiwidGV4dCIsInJlcGxhY2UiLCJtYXRjaCIsImxvbmdlc3RCYWNrdGlja1NlcXVlbmNlIiwibGVuZ3RoIiwiY3VycmVudExlbmd0aCIsImMiLCJNYXRoIiwibWF4IiwiaXNMaXN0Q2hpbGQiLCJuIiwiaW5jbHVkZXMiLCJwYXJlbnROb2RlIiwibm9kZU5hbWUiLCJwYXJzZUF0Um9vbU1lbnRpb25zIiwicGMiLCJvcHRzIiwiQVRST09NIiwicGFydHMiLCJzcGxpdCIsImZvckVhY2giLCJ0ZXh0UGFydCIsImkiLCJhcnIiLCJwdXNoIiwicGxhaW5XaXRoRW1vamkiLCJzaG91bGRFc2NhcGUiLCJpc0xhc3QiLCJhdFJvb21QaWxsIiwicGFyc2VMaW5rIiwiaHJlZiIsInJlc291cmNlSWQiLCJnZXRQcmltYXJ5UGVybWFsaW5rRW50aXR5IiwidXNlclBpbGwiLCJ0ZXh0Q29udGVudCIsInJvb21QaWxsIiwiY2hpbGRyZW4iLCJBcnJheSIsImZyb20iLCJjaGlsZE5vZGVzIiwiZXZlcnkiLCJub2RlVHlwZSIsIk5vZGUiLCJURVhUX05PREUiLCJwbGFpbiIsInBhcnNlQ2hpbGRyZW4iLCJwYXJzZUltYWdlIiwiYWx0Iiwic3JjIiwicGFyc2VDb2RlQmxvY2siLCJsYW5ndWFnZSIsImZpcnN0Q2hpbGQiLCJjbGFzc05hbWUiLCJjbGFzc0xpc3QiLCJzdGFydHNXaXRoIiwic2xpY2UiLCJmZW5jZSIsInJlcGVhdCIsIm5ld2xpbmUiLCJsaW5lIiwicGFyc2VIZWFkZXIiLCJkZXB0aCIsInBhcnNlSW50IiwicHJlZml4IiwiY2hlY2tJZ25vcmVkIiwibm9kZVZhbHVlIiwiRUxFTUVOVF9OT0RFIiwicHJlZml4TGluZXMiLCJ1bnNoaWZ0IiwidHlwZSIsIlR5cGUiLCJOZXdsaW5lIiwic3BsaWNlIiwibWtMaXN0SXRlbSIsInByZXYiLCJmbGF0TWFwIiwicGFyc2VkIiwicGFyc2VOb2RlIiwiY2hlY2tCbG9ja05vZGUiLCJsaSIsImNvdW50ZXIiLCJzdGFydCIsImhhc0F0dHJpYnV0ZSIsImRlbGltcyIsIlNka0NvbmZpZyIsImdldCIsImxhdGV4X21hdGhzX2RlbGltcyIsImRlbGltTGVmdCIsImlubGluZSIsImxlZnQiLCJkaXNwbGF5IiwiZGVsaW1SaWdodCIsInJpZ2h0IiwidGV4IiwiZ2V0QXR0cmlidXRlIiwicGFyc2VIdG1sTWVzc2FnZSIsImh0bWwiLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJib2R5IiwiaXNRdW90ZWRNZXNzYWdlIiwicGFyc2VQbGFpblRleHRNZXNzYWdlIiwibGluZXMiLCJyZWR1Y2UiLCJwYXJzZUV2ZW50IiwiZXZlbnQiLCJjb250ZW50IiwiZ2V0Q29udGVudCIsImlzRW1vdGUiLCJtc2d0eXBlIiwiTXNnVHlwZSIsIkVtb3RlIiwiaXNSYWluYm93IiwiZm9ybWF0IiwiZm9ybWF0dGVkX2JvZHkiLCJ0ZXh0VG9IdG1sUmFpbmJvdyIsInJlcGx5RXZlbnRJZCIsInN0cmlwUGxhaW5SZXBseSJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lZGl0b3IvZGVzZXJpYWxpemUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAxOSwgMjAyMCBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCB7IE1hdHJpeEV2ZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9ldmVudFwiO1xuaW1wb3J0IHsgTXNnVHlwZSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9AdHlwZXMvZXZlbnRcIjtcblxuaW1wb3J0IHsgY2hlY2tCbG9ja05vZGUgfSBmcm9tIFwiLi4vSHRtbFV0aWxzXCI7XG5pbXBvcnQgeyBnZXRQcmltYXJ5UGVybWFsaW5rRW50aXR5IH0gZnJvbSBcIi4uL3V0aWxzL3Blcm1hbGlua3MvUGVybWFsaW5rc1wiO1xuaW1wb3J0IHsgUGFydCwgUGFydENyZWF0b3IsIFR5cGUgfSBmcm9tIFwiLi9wYXJ0c1wiO1xuaW1wb3J0IFNka0NvbmZpZyBmcm9tIFwiLi4vU2RrQ29uZmlnXCI7XG5pbXBvcnQgeyB0ZXh0VG9IdG1sUmFpbmJvdyB9IGZyb20gXCIuLi91dGlscy9jb2xvdXJcIjtcbmltcG9ydCB7IHN0cmlwUGxhaW5SZXBseSB9IGZyb20gXCIuLi91dGlscy9SZXBseVwiO1xuXG5jb25zdCBMSVNUX1RZUEVTID0gW1wiVUxcIiwgXCJPTFwiLCBcIkxJXCJdO1xuXG4vLyBFc2NhcGVzIGFsbCBtYXJrdXAgaW4gdGhlIGdpdmVuIHRleHRcbmZ1bmN0aW9uIGVzY2FwZSh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoL1tcXFxcKl9bXFxdYDxdfF4+L2csIG1hdGNoID0+IGBcXFxcJHttYXRjaH1gKTtcbn1cblxuLy8gRmluZHMgdGhlIGxlbmd0aCBvZiB0aGUgbG9uZ2VzdCBiYWNrdGljayBzZXF1ZW5jZSBpbiB0aGUgZ2l2ZW4gdGV4dCwgdXNlZCBmb3Jcbi8vIGVzY2FwaW5nIGJhY2t0aWNrcyBpbiBjb2RlIGJsb2Nrc1xuZXhwb3J0IGZ1bmN0aW9uIGxvbmdlc3RCYWNrdGlja1NlcXVlbmNlKHRleHQ6IHN0cmluZyk6IG51bWJlciB7XG4gICAgbGV0IGxlbmd0aCA9IDA7XG4gICAgbGV0IGN1cnJlbnRMZW5ndGggPSAwO1xuXG4gICAgZm9yIChjb25zdCBjIG9mIHRleHQpIHtcbiAgICAgICAgaWYgKGMgPT09IFwiYFwiKSB7XG4gICAgICAgICAgICBjdXJyZW50TGVuZ3RoKys7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZW5ndGggPSBNYXRoLm1heChsZW5ndGgsIGN1cnJlbnRMZW5ndGgpO1xuICAgICAgICAgICAgY3VycmVudExlbmd0aCA9IDA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gTWF0aC5tYXgobGVuZ3RoLCBjdXJyZW50TGVuZ3RoKTtcbn1cblxuZnVuY3Rpb24gaXNMaXN0Q2hpbGQobjogTm9kZSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBMSVNUX1RZUEVTLmluY2x1ZGVzKG4ucGFyZW50Tm9kZT8ubm9kZU5hbWUpO1xufVxuXG5mdW5jdGlvbiBwYXJzZUF0Um9vbU1lbnRpb25zKHRleHQ6IHN0cmluZywgcGM6IFBhcnRDcmVhdG9yLCBvcHRzOiBJUGFyc2VPcHRpb25zKTogUGFydFtdIHtcbiAgICBjb25zdCBBVFJPT00gPSBcIkByb29tXCI7XG4gICAgY29uc3QgcGFydHM6IFBhcnRbXSA9IFtdO1xuICAgIHRleHQuc3BsaXQoQVRST09NKS5mb3JFYWNoKCh0ZXh0UGFydCwgaSwgYXJyKSA9PiB7XG4gICAgICAgIGlmICh0ZXh0UGFydC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHBhcnRzLnB1c2goLi4ucGMucGxhaW5XaXRoRW1vamkob3B0cy5zaG91bGRFc2NhcGUgPyBlc2NhcGUodGV4dFBhcnQpIDogdGV4dFBhcnQpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBpdCdzIHNhZmUgdG8gbmV2ZXIgYXBwZW5kIEByb29tIGFmdGVyIHRoZSBsYXN0IHRleHRQYXJ0XG4gICAgICAgIC8vIGFzIHNwbGl0IHdpbGwgcmVwb3J0IGFuIGVtcHR5IHN0cmluZyBhdCB0aGUgZW5kIGlmXG4gICAgICAgIC8vIGB0ZXh0YCBlbmRlZCBpbiBAcm9vbS5cbiAgICAgICAgY29uc3QgaXNMYXN0ID0gaSA9PT0gYXJyLmxlbmd0aCAtIDE7XG4gICAgICAgIGlmICghaXNMYXN0KSB7XG4gICAgICAgICAgICBwYXJ0cy5wdXNoKHBjLmF0Um9vbVBpbGwoQVRST09NKSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcGFydHM7XG59XG5cbmZ1bmN0aW9uIHBhcnNlTGluayhuOiBOb2RlLCBwYzogUGFydENyZWF0b3IsIG9wdHM6IElQYXJzZU9wdGlvbnMpOiBQYXJ0W10ge1xuICAgIGNvbnN0IHsgaHJlZiB9ID0gbiBhcyBIVE1MQW5jaG9yRWxlbWVudDtcbiAgICBjb25zdCByZXNvdXJjZUlkID0gZ2V0UHJpbWFyeVBlcm1hbGlua0VudGl0eShocmVmKTsgLy8gVGhlIHJvb20vdXNlciBJRFxuXG4gICAgc3dpdGNoIChyZXNvdXJjZUlkPy5bMF0pIHtcbiAgICAgICAgY2FzZSBcIkBcIjogcmV0dXJuIFtwYy51c2VyUGlsbChuLnRleHRDb250ZW50LCByZXNvdXJjZUlkKV07XG4gICAgICAgIGNhc2UgXCIjXCI6IHJldHVybiBbcGMucm9vbVBpbGwocmVzb3VyY2VJZCldO1xuICAgIH1cblxuICAgIGNvbnN0IGNoaWxkcmVuID0gQXJyYXkuZnJvbShuLmNoaWxkTm9kZXMpO1xuICAgIGlmIChocmVmID09PSBuLnRleHRDb250ZW50ICYmIGNoaWxkcmVuLmV2ZXJ5KGMgPT4gYy5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUpKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUF0Um9vbU1lbnRpb25zKG4udGV4dENvbnRlbnQsIHBjLCBvcHRzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gW3BjLnBsYWluKFwiW1wiKSwgLi4ucGFyc2VDaGlsZHJlbihuLCBwYywgb3B0cyksIHBjLnBsYWluKGBdKCR7aHJlZn0pYCldO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gcGFyc2VJbWFnZShuOiBOb2RlLCBwYzogUGFydENyZWF0b3IsIG9wdHM6IElQYXJzZU9wdGlvbnMpOiBQYXJ0W10ge1xuICAgIGNvbnN0IHsgYWx0LCBzcmMgfSA9IG4gYXMgSFRNTEltYWdlRWxlbWVudDtcbiAgICByZXR1cm4gcGMucGxhaW5XaXRoRW1vamkoYCFbJHtlc2NhcGUoYWx0KX1dKCR7c3JjfSlgKTtcbn1cblxuZnVuY3Rpb24gcGFyc2VDb2RlQmxvY2sobjogTm9kZSwgcGM6IFBhcnRDcmVhdG9yLCBvcHRzOiBJUGFyc2VPcHRpb25zKTogUGFydFtdIHtcbiAgICBsZXQgbGFuZ3VhZ2UgPSBcIlwiO1xuICAgIGlmIChuLmZpcnN0Q2hpbGQ/Lm5vZGVOYW1lID09PSBcIkNPREVcIikge1xuICAgICAgICBmb3IgKGNvbnN0IGNsYXNzTmFtZSBvZiAobi5maXJzdENoaWxkIGFzIEhUTUxFbGVtZW50KS5jbGFzc0xpc3QpIHtcbiAgICAgICAgICAgIGlmIChjbGFzc05hbWUuc3RhcnRzV2l0aChcImxhbmd1YWdlLVwiKSAmJiAhY2xhc3NOYW1lLnN0YXJ0c1dpdGgoXCJsYW5ndWFnZS1fXCIpKSB7XG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2UgPSBjbGFzc05hbWUuc2xpY2UoXCJsYW5ndWFnZS1cIi5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgdGV4dCA9IG4udGV4dENvbnRlbnQucmVwbGFjZSgvXFxuJC8sIFwiXCIpO1xuICAgIC8vIEVzY2FwZSBiYWNrdGlja3MgYnkgdXNpbmcgZXZlbiBtb3JlIGJhY2t0aWNrcyBmb3IgdGhlIGZlbmNlIGlmIG5lY2Vzc2FyeVxuICAgIGNvbnN0IGZlbmNlID0gXCJgXCIucmVwZWF0KE1hdGgubWF4KDMsIGxvbmdlc3RCYWNrdGlja1NlcXVlbmNlKHRleHQpICsgMSkpO1xuICAgIGNvbnN0IHBhcnRzOiBQYXJ0W10gPSBbLi4ucGMucGxhaW5XaXRoRW1vamkoZmVuY2UgKyBsYW5ndWFnZSksIHBjLm5ld2xpbmUoKV07XG5cbiAgICB0ZXh0LnNwbGl0KFwiXFxuXCIpLmZvckVhY2gobGluZSA9PiB7XG4gICAgICAgIHBhcnRzLnB1c2goLi4ucGMucGxhaW5XaXRoRW1vamkobGluZSkpO1xuICAgICAgICBwYXJ0cy5wdXNoKHBjLm5ld2xpbmUoKSk7XG4gICAgfSk7XG5cbiAgICBwYXJ0cy5wdXNoKHBjLnBsYWluKGZlbmNlKSk7XG4gICAgcmV0dXJuIHBhcnRzO1xufVxuXG5mdW5jdGlvbiBwYXJzZUhlYWRlcihuOiBOb2RlLCBwYzogUGFydENyZWF0b3IsIG9wdHM6IElQYXJzZU9wdGlvbnMpOiBQYXJ0W10ge1xuICAgIGNvbnN0IGRlcHRoID0gcGFyc2VJbnQobi5ub2RlTmFtZS5zbGljZSgxKSwgMTApO1xuICAgIGNvbnN0IHByZWZpeCA9IHBjLnBsYWluKFwiI1wiLnJlcGVhdChkZXB0aCkgKyBcIiBcIik7XG4gICAgcmV0dXJuIFtwcmVmaXgsIC4uLnBhcnNlQ2hpbGRyZW4obiwgcGMsIG9wdHMpXTtcbn1cblxuZnVuY3Rpb24gY2hlY2tJZ25vcmVkKG4pIHtcbiAgICBpZiAobi5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUpIHtcbiAgICAgICAgLy8gRWxlbWVudCBhZGRzIFxcbiB0ZXh0IG5vZGVzIGluIGEgbG90IG9mIHBsYWNlcyxcbiAgICAgICAgLy8gd2hpY2ggc2hvdWxkIGJlIGlnbm9yZWRcbiAgICAgICAgcmV0dXJuIG4ubm9kZVZhbHVlID09PSBcIlxcblwiO1xuICAgIH0gZWxzZSBpZiAobi5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREUpIHtcbiAgICAgICAgcmV0dXJuIG4ubm9kZU5hbWUgPT09IFwiTVgtUkVQTFlcIjtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIHByZWZpeExpbmVzKHBhcnRzOiBQYXJ0W10sIHByZWZpeDogc3RyaW5nLCBwYzogUGFydENyZWF0b3IpIHtcbiAgICBwYXJ0cy51bnNoaWZ0KHBjLnBsYWluKHByZWZpeCkpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHBhcnRzW2ldLnR5cGUgPT09IFR5cGUuTmV3bGluZSkge1xuICAgICAgICAgICAgcGFydHMuc3BsaWNlKGkgKyAxLCAwLCBwYy5wbGFpbihwcmVmaXgpKTtcbiAgICAgICAgICAgIGkgKz0gMTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gcGFyc2VDaGlsZHJlbihuOiBOb2RlLCBwYzogUGFydENyZWF0b3IsIG9wdHM6IElQYXJzZU9wdGlvbnMsIG1rTGlzdEl0ZW0/OiAobGk6IE5vZGUpID0+IFBhcnRbXSk6IFBhcnRbXSB7XG4gICAgbGV0IHByZXY7XG4gICAgcmV0dXJuIEFycmF5LmZyb20obi5jaGlsZE5vZGVzKS5mbGF0TWFwKGMgPT4ge1xuICAgICAgICBjb25zdCBwYXJzZWQgPSBwYXJzZU5vZGUoYywgcGMsIG9wdHMsIG1rTGlzdEl0ZW0pO1xuICAgICAgICBpZiAocGFyc2VkLmxlbmd0aCAmJiBwcmV2ICYmIChjaGVja0Jsb2NrTm9kZShwcmV2KSB8fCBjaGVja0Jsb2NrTm9kZShjKSkpIHtcbiAgICAgICAgICAgIGlmIChpc0xpc3RDaGlsZChjKSkge1xuICAgICAgICAgICAgICAgIC8vIFVzZSB0aWdodGVyIHNwYWNpbmcgd2l0aGluIGxpc3RzXG4gICAgICAgICAgICAgICAgcGFyc2VkLnVuc2hpZnQocGMubmV3bGluZSgpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyc2VkLnVuc2hpZnQocGMubmV3bGluZSgpLCBwYy5uZXdsaW5lKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJzZWQubGVuZ3RoKSBwcmV2ID0gYztcbiAgICAgICAgcmV0dXJuIHBhcnNlZDtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gcGFyc2VOb2RlKG46IE5vZGUsIHBjOiBQYXJ0Q3JlYXRvciwgb3B0czogSVBhcnNlT3B0aW9ucywgbWtMaXN0SXRlbT86IChsaTogTm9kZSkgPT4gUGFydFtdKTogUGFydFtdIHtcbiAgICBpZiAoY2hlY2tJZ25vcmVkKG4pKSByZXR1cm4gW107XG5cbiAgICBzd2l0Y2ggKG4ubm9kZVR5cGUpIHtcbiAgICAgICAgY2FzZSBOb2RlLlRFWFRfTk9ERTpcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUF0Um9vbU1lbnRpb25zKG4ubm9kZVZhbHVlLCBwYywgb3B0cyk7XG4gICAgICAgIGNhc2UgTm9kZS5FTEVNRU5UX05PREU6XG4gICAgICAgICAgICBzd2l0Y2ggKG4ubm9kZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiSDFcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiSDJcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiSDNcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiSDRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiSDVcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiSDZcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSGVhZGVyKG4sIHBjLCBvcHRzKTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiQVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VMaW5rKG4sIHBjLCBvcHRzKTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiSU1HXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUltYWdlKG4sIHBjLCBvcHRzKTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiQlJcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtwYy5uZXdsaW5lKCldO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJIUlwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3BjLnBsYWluKFwiLS0tXCIpXTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiRU1cIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtwYy5wbGFpbihcIl9cIiksIC4uLnBhcnNlQ2hpbGRyZW4obiwgcGMsIG9wdHMpLCBwYy5wbGFpbihcIl9cIildO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJTVFJPTkdcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtwYy5wbGFpbihcIioqXCIpLCAuLi5wYXJzZUNoaWxkcmVuKG4sIHBjLCBvcHRzKSwgcGMucGxhaW4oXCIqKlwiKV07XG4gICAgICAgICAgICAgICAgY2FzZSBcIkRFTFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3BjLnBsYWluKFwiPGRlbD5cIiksIC4uLnBhcnNlQ2hpbGRyZW4obiwgcGMsIG9wdHMpLCBwYy5wbGFpbihcIjwvZGVsPlwiKV07XG4gICAgICAgICAgICAgICAgY2FzZSBcIlNVQlwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3BjLnBsYWluKFwiPHN1Yj5cIiksIC4uLnBhcnNlQ2hpbGRyZW4obiwgcGMsIG9wdHMpLCBwYy5wbGFpbihcIjwvc3ViPlwiKV07XG4gICAgICAgICAgICAgICAgY2FzZSBcIlNVUFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3BjLnBsYWluKFwiPHN1cD5cIiksIC4uLnBhcnNlQ2hpbGRyZW4obiwgcGMsIG9wdHMpLCBwYy5wbGFpbihcIjwvc3VwPlwiKV07XG4gICAgICAgICAgICAgICAgY2FzZSBcIlVcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtwYy5wbGFpbihcIjx1PlwiKSwgLi4ucGFyc2VDaGlsZHJlbihuLCBwYywgb3B0cyksIHBjLnBsYWluKFwiPC91PlwiKV07XG4gICAgICAgICAgICAgICAgY2FzZSBcIlBSRVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VDb2RlQmxvY2sobiwgcGMsIG9wdHMpO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJDT0RFXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRXNjYXBlIGJhY2t0aWNrcyBieSB1c2luZyBtdWx0aXBsZSBiYWNrdGlja3MgZm9yIHRoZSBmZW5jZSBpZiBuZWNlc3NhcnlcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmVuY2UgPSBcImBcIi5yZXBlYXQobG9uZ2VzdEJhY2t0aWNrU2VxdWVuY2Uobi50ZXh0Q29udGVudCkgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBjLnBsYWluV2l0aEVtb2ppKGAke2ZlbmNlfSR7bi50ZXh0Q29udGVudH0ke2ZlbmNlfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIFwiQkxPQ0tRVU9URVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gcGFyc2VDaGlsZHJlbihuLCBwYywgb3B0cyk7XG4gICAgICAgICAgICAgICAgICAgIHByZWZpeExpbmVzKHBhcnRzLCBcIj4gXCIsIHBjKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnRzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIFwiTElcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1rTGlzdEl0ZW0/LihuKSA/PyBwYXJzZUNoaWxkcmVuKG4sIHBjLCBvcHRzKTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiVUxcIjoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IHBhcnNlQ2hpbGRyZW4obiwgcGMsIG9wdHMsIGxpID0+IFtwYy5wbGFpbihcIi0gXCIpLCAuLi5wYXJzZUNoaWxkcmVuKGxpLCBwYywgb3B0cyldKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTGlzdENoaWxkKG4pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXhMaW5lcyhwYXJ0cywgXCIgICAgXCIsIHBjKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFydHM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgXCJPTFwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBjb3VudGVyID0gKG4gYXMgSFRNTE9MaXN0RWxlbWVudCkuc3RhcnQgPz8gMTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBwYXJzZUNoaWxkcmVuKG4sIHBjLCBvcHRzLCBsaSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IFtwYy5wbGFpbihgJHtjb3VudGVyfS4gYCksIC4uLnBhcnNlQ2hpbGRyZW4obGksIHBjLCBvcHRzKV07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVyKys7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFydHM7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNMaXN0Q2hpbGQobikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZWZpeExpbmVzKHBhcnRzLCBcIiAgICBcIiwgcGMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJ0cztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBcIkRJVlwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJTUEFOXCI6XG4gICAgICAgICAgICAgICAgICAgIC8vIE1hdGggbm9kZXMgYXJlIHRyYW5zbGF0ZWQgYmFjayBpbnRvIGRlbGltaXRlZCBsYXRleCBzdHJpbmdzXG4gICAgICAgICAgICAgICAgICAgIGlmICgobiBhcyBFbGVtZW50KS5oYXNBdHRyaWJ1dGUoXCJkYXRhLW14LW1hdGhzXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWxpbXMgPSBTZGtDb25maWcuZ2V0KCkubGF0ZXhfbWF0aHNfZGVsaW1zO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVsaW1MZWZ0ID0gKG4ubm9kZU5hbWUgPT09IFwiU1BBTlwiKSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsaW1zPy5pbmxpbmU/LmxlZnQgPz8gXCJcXFxcKFwiIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxpbXM/LmRpc3BsYXk/LmxlZnQgPz8gXCJcXFxcW1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVsaW1SaWdodCA9IChuLm5vZGVOYW1lID09PSBcIlNQQU5cIikgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGltcz8uaW5saW5lPy5yaWdodCA/PyBcIlxcXFwpXCIgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGltcz8uZGlzcGxheT8ucmlnaHQgPz8gXCJcXFxcXVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4ID0gKG4gYXMgRWxlbWVudCkuZ2V0QXR0cmlidXRlKFwiZGF0YS1teC1tYXRoc1wiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBjLnBsYWluV2l0aEVtb2ppKGAke2RlbGltTGVmdH0ke3RleH0ke2RlbGltUmlnaHR9YCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcGFyc2VDaGlsZHJlbihuLCBwYywgb3B0cyk7XG59XG5cbmludGVyZmFjZSBJUGFyc2VPcHRpb25zIHtcbiAgICBpc1F1b3RlZE1lc3NhZ2U/OiBib29sZWFuO1xuICAgIHNob3VsZEVzY2FwZT86IGJvb2xlYW47XG59XG5cbmZ1bmN0aW9uIHBhcnNlSHRtbE1lc3NhZ2UoaHRtbDogc3RyaW5nLCBwYzogUGFydENyZWF0b3IsIG9wdHM6IElQYXJzZU9wdGlvbnMpOiBQYXJ0W10ge1xuICAgIC8vIG5vIG5vZGVzIGZyb20gcGFyc2luZyBoZXJlIHNob3VsZCBiZSBpbnNlcnRlZCBpbiB0aGUgZG9jdW1lbnQsXG4gICAgLy8gYXMgc2NyaXB0cyBpbiBldmVudCBoYW5kbGVycywgZXRjIHdvdWxkIGJlIGV4ZWN1dGVkIHRoZW4uXG4gICAgLy8gd2UncmUgb25seSB0YWtpbmcgdGV4dCwgc28gdGhhdCBpcyBmaW5lXG4gICAgY29uc3QgcGFydHMgPSBwYXJzZU5vZGUobmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhodG1sLCBcInRleHQvaHRtbFwiKS5ib2R5LCBwYywgb3B0cyk7XG4gICAgaWYgKG9wdHMuaXNRdW90ZWRNZXNzYWdlKSB7XG4gICAgICAgIHByZWZpeExpbmVzKHBhcnRzLCBcIj4gXCIsIHBjKTtcbiAgICB9XG4gICAgcmV0dXJuIHBhcnRzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VQbGFpblRleHRNZXNzYWdlKFxuICAgIGJvZHk6IHN0cmluZyxcbiAgICBwYzogUGFydENyZWF0b3IsXG4gICAgb3B0czogSVBhcnNlT3B0aW9ucyxcbik6IFBhcnRbXSB7XG4gICAgY29uc3QgbGluZXMgPSBib2R5LnNwbGl0KC9cXHJcXG58XFxyfFxcbi9nKTsgLy8gc3BsaXQgb24gYW55IG5ldy1saW5lIGNvbWJpbmF0aW9uIG5vdCBqdXN0IFxcbiwgY29sbGFwc2VzIFxcclxcblxuICAgIHJldHVybiBsaW5lcy5yZWR1Y2UoKHBhcnRzLCBsaW5lLCBpKSA9PiB7XG4gICAgICAgIGlmIChvcHRzLmlzUXVvdGVkTWVzc2FnZSkge1xuICAgICAgICAgICAgcGFydHMucHVzaChwYy5wbGFpbihcIj4gXCIpKTtcbiAgICAgICAgfVxuICAgICAgICBwYXJ0cy5wdXNoKC4uLnBhcnNlQXRSb29tTWVudGlvbnMobGluZSwgcGMsIG9wdHMpKTtcbiAgICAgICAgY29uc3QgaXNMYXN0ID0gaSA9PT0gbGluZXMubGVuZ3RoIC0gMTtcbiAgICAgICAgaWYgKCFpc0xhc3QpIHtcbiAgICAgICAgICAgIHBhcnRzLnB1c2gocGMubmV3bGluZSgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFydHM7XG4gICAgfSwgW10gYXMgUGFydFtdKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlRXZlbnQoZXZlbnQ6IE1hdHJpeEV2ZW50LCBwYzogUGFydENyZWF0b3IsIG9wdHM6IElQYXJzZU9wdGlvbnMgPSB7IHNob3VsZEVzY2FwZTogdHJ1ZSB9KSB7XG4gICAgY29uc3QgY29udGVudCA9IGV2ZW50LmdldENvbnRlbnQoKTtcbiAgICBsZXQgcGFydHM6IFBhcnRbXTtcbiAgICBjb25zdCBpc0Vtb3RlID0gY29udGVudC5tc2d0eXBlID09PSBNc2dUeXBlLkVtb3RlO1xuICAgIGxldCBpc1JhaW5ib3cgPSBmYWxzZTtcblxuICAgIGlmIChjb250ZW50LmZvcm1hdCA9PT0gXCJvcmcubWF0cml4LmN1c3RvbS5odG1sXCIpIHtcbiAgICAgICAgcGFydHMgPSBwYXJzZUh0bWxNZXNzYWdlKGNvbnRlbnQuZm9ybWF0dGVkX2JvZHkgfHwgXCJcIiwgcGMsIG9wdHMpO1xuICAgICAgICBpZiAoY29udGVudC5ib2R5ICYmIGNvbnRlbnQuZm9ybWF0dGVkX2JvZHkgJiYgdGV4dFRvSHRtbFJhaW5ib3coY29udGVudC5ib2R5KSA9PT0gY29udGVudC5mb3JtYXR0ZWRfYm9keSkge1xuICAgICAgICAgICAgaXNSYWluYm93ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBib2R5ID0gY29udGVudC5ib2R5IHx8IFwiXCI7XG4gICAgICAgIGlmIChldmVudC5yZXBseUV2ZW50SWQpIHtcbiAgICAgICAgICAgIGJvZHkgPSBzdHJpcFBsYWluUmVwbHkoYm9keSk7XG4gICAgICAgIH1cbiAgICAgICAgcGFydHMgPSBwYXJzZVBsYWluVGV4dE1lc3NhZ2UoYm9keSwgcGMsIG9wdHMpO1xuICAgIH1cblxuICAgIGlmIChpc0Vtb3RlICYmIGlzUmFpbmJvdykge1xuICAgICAgICBwYXJ0cy51bnNoaWZ0KHBjLnBsYWluKFwiL3JhaW5ib3dtZSBcIikpO1xuICAgIH0gZWxzZSBpZiAoaXNSYWluYm93KSB7XG4gICAgICAgIHBhcnRzLnVuc2hpZnQocGMucGxhaW4oXCIvcmFpbmJvdyBcIikpO1xuICAgIH0gZWxzZSBpZiAoaXNFbW90ZSkge1xuICAgICAgICBwYXJ0cy51bnNoaWZ0KHBjLnBsYWluKFwiL21lIFwiKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhcnRzO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWtCQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUF6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFZQSxNQUFNQSxVQUFVLEdBQUcsQ0FBQyxJQUFELEVBQU8sSUFBUCxFQUFhLElBQWIsQ0FBbkIsQyxDQUVBOztBQUNBLFNBQVNDLE1BQVQsQ0FBZ0JDLElBQWhCLEVBQXNDO0VBQ2xDLE9BQU9BLElBQUksQ0FBQ0MsT0FBTCxDQUFhLGlCQUFiLEVBQWdDQyxLQUFLLElBQUssS0FBSUEsS0FBTSxFQUFwRCxDQUFQO0FBQ0gsQyxDQUVEO0FBQ0E7OztBQUNPLFNBQVNDLHVCQUFULENBQWlDSCxJQUFqQyxFQUF1RDtFQUMxRCxJQUFJSSxNQUFNLEdBQUcsQ0FBYjtFQUNBLElBQUlDLGFBQWEsR0FBRyxDQUFwQjs7RUFFQSxLQUFLLE1BQU1DLENBQVgsSUFBZ0JOLElBQWhCLEVBQXNCO0lBQ2xCLElBQUlNLENBQUMsS0FBSyxHQUFWLEVBQWU7TUFDWEQsYUFBYTtJQUNoQixDQUZELE1BRU87TUFDSEQsTUFBTSxHQUFHRyxJQUFJ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
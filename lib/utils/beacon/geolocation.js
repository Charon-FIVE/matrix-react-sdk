"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.watchPosition = exports.mapGeolocationPositionToTimedGeo = exports.mapGeolocationError = exports.getGeoUri = exports.getCurrentPosition = exports.genericPositionFromGeolocation = exports.GeolocationError = void 0;

var _logger = require("matrix-js-sdk/src/logger");

/*
Copyright 2022 The Matrix.org Foundation C.I.C

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
// map GeolocationPositionError codes
// https://developer.mozilla.org/en-US/docs/Web/API/GeolocationPositionError
let GeolocationError;
exports.GeolocationError = GeolocationError;

(function (GeolocationError) {
  GeolocationError["Unavailable"] = "Unavailable";
  GeolocationError["PermissionDenied"] = "PermissionDenied";
  GeolocationError["PositionUnavailable"] = "PositionUnavailable";
  GeolocationError["Timeout"] = "Timeout";
  GeolocationError["Default"] = "Default";
})(GeolocationError || (exports.GeolocationError = GeolocationError = {}));

const GeolocationOptions = {
  timeout: 10000,
  maximumAge: 60000
};

const isGeolocationPositionError = error => typeof error === 'object' && !!error['PERMISSION_DENIED'];
/**
 * Maps GeolocationPositionError to our GeolocationError enum
 */


const mapGeolocationError = error => {
  _logger.logger.error('Geolocation failed', error?.message ?? error);

  if (isGeolocationPositionError(error)) {
    switch (error?.code) {
      case error.PERMISSION_DENIED:
        return GeolocationError.PermissionDenied;

      case error.POSITION_UNAVAILABLE:
        return GeolocationError.PositionUnavailable;

      case error.TIMEOUT:
        return GeolocationError.Timeout;

      default:
        return GeolocationError.Default;
    }
  } else if (error.message === GeolocationError.Unavailable) {
    return GeolocationError.Unavailable;
  } else {
    return GeolocationError.Default;
  }
};

exports.mapGeolocationError = mapGeolocationError;

const getGeolocation = () => {
  if (!navigator.geolocation) {
    throw new Error(GeolocationError.Unavailable);
  }

  return navigator.geolocation;
};

const genericPositionFromGeolocation = geoPosition => {
  const {
    latitude,
    longitude,
    altitude,
    accuracy
  } = geoPosition.coords;
  return {
    // safari reports geolocation timestamps as Apple Cocoa Core Data timestamp
    // or ms since 1/1/2001 instead of the regular epoch
    // they also use local time, not utc
    // to simplify, just use Date.now()
    timestamp: Date.now(),
    latitude,
    longitude,
    altitude,
    accuracy
  };
};

exports.genericPositionFromGeolocation = genericPositionFromGeolocation;

const getGeoUri = position => {
  const lat = position.latitude;
  const lon = position.longitude;
  const alt = Number.isFinite(position.altitude) ? `,${position.altitude}` : "";
  const acc = Number.isFinite(position.accuracy) ? `;u=${position.accuracy}` : "";
  return `geo:${lat},${lon}${alt}${acc}`;
};

exports.getGeoUri = getGeoUri;

const mapGeolocationPositionToTimedGeo = position => {
  const genericPosition = genericPositionFromGeolocation(position);
  return {
    timestamp: genericPosition.timestamp,
    geoUri: getGeoUri(genericPosition)
  };
};
/**
 * Gets current position, returns a promise
 * @returns Promise<GeolocationPosition>
 */


exports.mapGeolocationPositionToTimedGeo = mapGeolocationPositionToTimedGeo;

const getCurrentPosition = async () => {
  try {
    const position = await new Promise((resolve, reject) => {
      getGeolocation().getCurrentPosition(resolve, reject, GeolocationOptions);
    });
    return position;
  } catch (error) {
    throw new Error(mapGeolocationError(error));
  }
};

exports.getCurrentPosition = getCurrentPosition;

const watchPosition = (onWatchPosition, onWatchPositionError) => {
  try {
    const onError = error => onWatchPositionError(mapGeolocationError(error));

    const watchId = getGeolocation().watchPosition(onWatchPosition, onError, GeolocationOptions);

    const clearWatch = () => {
      getGeolocation().clearWatch(watchId);
    };

    return clearWatch;
  } catch (error) {
    throw new Error(mapGeolocationError(error));
  }
};

exports.watchPosition = watchPosition;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHZW9sb2NhdGlvbkVycm9yIiwiR2VvbG9jYXRpb25PcHRpb25zIiwidGltZW91dCIsIm1heGltdW1BZ2UiLCJpc0dlb2xvY2F0aW9uUG9zaXRpb25FcnJvciIsImVycm9yIiwibWFwR2VvbG9jYXRpb25FcnJvciIsImxvZ2dlciIsIm1lc3NhZ2UiLCJjb2RlIiwiUEVSTUlTU0lPTl9ERU5JRUQiLCJQZXJtaXNzaW9uRGVuaWVkIiwiUE9TSVRJT05fVU5BVkFJTEFCTEUiLCJQb3NpdGlvblVuYXZhaWxhYmxlIiwiVElNRU9VVCIsIlRpbWVvdXQiLCJEZWZhdWx0IiwiVW5hdmFpbGFibGUiLCJnZXRHZW9sb2NhdGlvbiIsIm5hdmlnYXRvciIsImdlb2xvY2F0aW9uIiwiRXJyb3IiLCJnZW5lcmljUG9zaXRpb25Gcm9tR2VvbG9jYXRpb24iLCJnZW9Qb3NpdGlvbiIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwiYWx0aXR1ZGUiLCJhY2N1cmFjeSIsImNvb3JkcyIsInRpbWVzdGFtcCIsIkRhdGUiLCJub3ciLCJnZXRHZW9VcmkiLCJwb3NpdGlvbiIsImxhdCIsImxvbiIsImFsdCIsIk51bWJlciIsImlzRmluaXRlIiwiYWNjIiwibWFwR2VvbG9jYXRpb25Qb3NpdGlvblRvVGltZWRHZW8iLCJnZW5lcmljUG9zaXRpb24iLCJnZW9VcmkiLCJnZXRDdXJyZW50UG9zaXRpb24iLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIndhdGNoUG9zaXRpb24iLCJvbldhdGNoUG9zaXRpb24iLCJvbldhdGNoUG9zaXRpb25FcnJvciIsIm9uRXJyb3IiLCJ3YXRjaElkIiwiY2xlYXJXYXRjaCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9iZWFjb24vZ2VvbG9jYXRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIyIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkNcblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbG9nZ2VyXCI7XG5cbi8vIG1hcCBHZW9sb2NhdGlvblBvc2l0aW9uRXJyb3IgY29kZXNcbi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9HZW9sb2NhdGlvblBvc2l0aW9uRXJyb3JcbmV4cG9ydCBlbnVtIEdlb2xvY2F0aW9uRXJyb3Ige1xuICAgIC8vIG5vIG5hdmlnYXRvci5nZW9sb2NhdGlvblxuICAgIFVuYXZhaWxhYmxlID0gJ1VuYXZhaWxhYmxlJyxcbiAgICAvLyBUaGUgYWNxdWlzaXRpb24gb2YgdGhlIGdlb2xvY2F0aW9uIGluZm9ybWF0aW9uIGZhaWxlZCBiZWNhdXNlIHRoZSBwYWdlIGRpZG4ndCBoYXZlIHRoZSBwZXJtaXNzaW9uIHRvIGRvIGl0LlxuICAgIFBlcm1pc3Npb25EZW5pZWQgPSAnUGVybWlzc2lvbkRlbmllZCcsXG4gICAgLy8gVGhlIGFjcXVpc2l0aW9uIG9mIHRoZSBnZW9sb2NhdGlvbiBmYWlsZWQgYmVjYXVzZSBhdCBsZWFzdCBvbmUgaW50ZXJuYWwgc291cmNlIG9mIHBvc2l0aW9uIHJldHVybmVkIGFuIGludGVybmFsIGVycm9yLlxuICAgIFBvc2l0aW9uVW5hdmFpbGFibGUgPSAnUG9zaXRpb25VbmF2YWlsYWJsZScsXG4gICAgLy8gVGhlIHRpbWUgYWxsb3dlZCB0byBhY3F1aXJlIHRoZSBnZW9sb2NhdGlvbiB3YXMgcmVhY2hlZCBiZWZvcmUgdGhlIGluZm9ybWF0aW9uIHdhcyBvYnRhaW5lZC5cbiAgICBUaW1lb3V0ID0gJ1RpbWVvdXQnLFxuICAgIC8vIG90aGVyIHVuZXhwZWN0ZWQgZmFpbHVyZVxuICAgIERlZmF1bHQgPSAnRGVmYXVsdCdcbn1cblxuY29uc3QgR2VvbG9jYXRpb25PcHRpb25zID0ge1xuICAgIHRpbWVvdXQ6IDEwMDAwLFxuICAgIG1heGltdW1BZ2U6IDYwMDAwLFxufTtcblxuY29uc3QgaXNHZW9sb2NhdGlvblBvc2l0aW9uRXJyb3IgPSAoZXJyb3I6IHVua25vd24pOiBlcnJvciBpcyBHZW9sb2NhdGlvblBvc2l0aW9uRXJyb3IgPT5cbiAgICB0eXBlb2YgZXJyb3IgPT09ICdvYmplY3QnICYmICEhZXJyb3JbJ1BFUk1JU1NJT05fREVOSUVEJ107XG4vKipcbiAqIE1hcHMgR2VvbG9jYXRpb25Qb3NpdGlvbkVycm9yIHRvIG91ciBHZW9sb2NhdGlvbkVycm9yIGVudW1cbiAqL1xuZXhwb3J0IGNvbnN0IG1hcEdlb2xvY2F0aW9uRXJyb3IgPSAoZXJyb3I6IEdlb2xvY2F0aW9uUG9zaXRpb25FcnJvciB8IEVycm9yKTogR2VvbG9jYXRpb25FcnJvciA9PiB7XG4gICAgbG9nZ2VyLmVycm9yKCdHZW9sb2NhdGlvbiBmYWlsZWQnLCBlcnJvcj8ubWVzc2FnZSA/PyBlcnJvcik7XG5cbiAgICBpZiAoaXNHZW9sb2NhdGlvblBvc2l0aW9uRXJyb3IoZXJyb3IpKSB7XG4gICAgICAgIHN3aXRjaCAoZXJyb3I/LmNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgZXJyb3IuUEVSTUlTU0lPTl9ERU5JRUQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIEdlb2xvY2F0aW9uRXJyb3IuUGVybWlzc2lvbkRlbmllZDtcbiAgICAgICAgICAgIGNhc2UgZXJyb3IuUE9TSVRJT05fVU5BVkFJTEFCTEU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIEdlb2xvY2F0aW9uRXJyb3IuUG9zaXRpb25VbmF2YWlsYWJsZTtcbiAgICAgICAgICAgIGNhc2UgZXJyb3IuVElNRU9VVDpcbiAgICAgICAgICAgICAgICByZXR1cm4gR2VvbG9jYXRpb25FcnJvci5UaW1lb3V0O1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gR2VvbG9jYXRpb25FcnJvci5EZWZhdWx0O1xuICAgICAgICB9XG4gICAgfSBlbHNlIGlmIChlcnJvci5tZXNzYWdlID09PSBHZW9sb2NhdGlvbkVycm9yLlVuYXZhaWxhYmxlKSB7XG4gICAgICAgIHJldHVybiBHZW9sb2NhdGlvbkVycm9yLlVuYXZhaWxhYmxlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBHZW9sb2NhdGlvbkVycm9yLkRlZmF1bHQ7XG4gICAgfVxufTtcblxuY29uc3QgZ2V0R2VvbG9jYXRpb24gPSAoKTogR2VvbG9jYXRpb24gPT4ge1xuICAgIGlmICghbmF2aWdhdG9yLmdlb2xvY2F0aW9uKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihHZW9sb2NhdGlvbkVycm9yLlVuYXZhaWxhYmxlKTtcbiAgICB9XG4gICAgcmV0dXJuIG5hdmlnYXRvci5nZW9sb2NhdGlvbjtcbn07XG5cbmV4cG9ydCB0eXBlIEdlbmVyaWNQb3NpdGlvbiA9IHtcbiAgICBsYXRpdHVkZTogbnVtYmVyO1xuICAgIGxvbmdpdHVkZTogbnVtYmVyO1xuICAgIGFsdGl0dWRlPzogbnVtYmVyO1xuICAgIGFjY3VyYWN5PzogbnVtYmVyO1xuICAgIHRpbWVzdGFtcDogbnVtYmVyO1xufTtcblxuZXhwb3J0IHR5cGUgVGltZWRHZW9VcmkgPSB7XG4gICAgZ2VvVXJpOiBzdHJpbmc7XG4gICAgdGltZXN0YW1wOiBudW1iZXI7XG59O1xuXG5leHBvcnQgY29uc3QgZ2VuZXJpY1Bvc2l0aW9uRnJvbUdlb2xvY2F0aW9uID0gKGdlb1Bvc2l0aW9uOiBHZW9sb2NhdGlvblBvc2l0aW9uKTogR2VuZXJpY1Bvc2l0aW9uID0+IHtcbiAgICBjb25zdCB7XG4gICAgICAgIGxhdGl0dWRlLCBsb25naXR1ZGUsIGFsdGl0dWRlLCBhY2N1cmFjeSxcbiAgICB9ID0gZ2VvUG9zaXRpb24uY29vcmRzO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgLy8gc2FmYXJpIHJlcG9ydHMgZ2VvbG9jYXRpb24gdGltZXN0YW1wcyBhcyBBcHBsZSBDb2NvYSBDb3JlIERhdGEgdGltZXN0YW1wXG4gICAgICAgIC8vIG9yIG1zIHNpbmNlIDEvMS8yMDAxIGluc3RlYWQgb2YgdGhlIHJlZ3VsYXIgZXBvY2hcbiAgICAgICAgLy8gdGhleSBhbHNvIHVzZSBsb2NhbCB0aW1lLCBub3QgdXRjXG4gICAgICAgIC8vIHRvIHNpbXBsaWZ5LCBqdXN0IHVzZSBEYXRlLm5vdygpXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgbGF0aXR1ZGUsIGxvbmdpdHVkZSwgYWx0aXR1ZGUsIGFjY3VyYWN5LFxuICAgIH07XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0R2VvVXJpID0gKHBvc2l0aW9uOiBHZW5lcmljUG9zaXRpb24pOiBzdHJpbmcgPT4ge1xuICAgIGNvbnN0IGxhdCA9IHBvc2l0aW9uLmxhdGl0dWRlO1xuICAgIGNvbnN0IGxvbiA9IHBvc2l0aW9uLmxvbmdpdHVkZTtcbiAgICBjb25zdCBhbHQgPSAoXG4gICAgICAgIE51bWJlci5pc0Zpbml0ZShwb3NpdGlvbi5hbHRpdHVkZSlcbiAgICAgICAgICAgID8gYCwke3Bvc2l0aW9uLmFsdGl0dWRlfWBcbiAgICAgICAgICAgIDogXCJcIlxuICAgICk7XG4gICAgY29uc3QgYWNjID0gKFxuICAgICAgICBOdW1iZXIuaXNGaW5pdGUocG9zaXRpb24uYWNjdXJhY3kpXG4gICAgICAgICAgICA/IGA7dT0ke3Bvc2l0aW9uLmFjY3VyYWN5fWBcbiAgICAgICAgICAgIDogXCJcIlxuICAgICk7XG4gICAgcmV0dXJuIGBnZW86JHtsYXR9LCR7bG9ufSR7YWx0fSR7YWNjfWA7XG59O1xuXG5leHBvcnQgY29uc3QgbWFwR2VvbG9jYXRpb25Qb3NpdGlvblRvVGltZWRHZW8gPSAocG9zaXRpb246IEdlb2xvY2F0aW9uUG9zaXRpb24pOiBUaW1lZEdlb1VyaSA9PiB7XG4gICAgY29uc3QgZ2VuZXJpY1Bvc2l0aW9uID0gZ2VuZXJpY1Bvc2l0aW9uRnJvbUdlb2xvY2F0aW9uKHBvc2l0aW9uKTtcbiAgICByZXR1cm4geyB0aW1lc3RhbXA6IGdlbmVyaWNQb3NpdGlvbi50aW1lc3RhbXAsIGdlb1VyaTogZ2V0R2VvVXJpKGdlbmVyaWNQb3NpdGlvbikgfTtcbn07XG5cbi8qKlxuICogR2V0cyBjdXJyZW50IHBvc2l0aW9uLCByZXR1cm5zIGEgcHJvbWlzZVxuICogQHJldHVybnMgUHJvbWlzZTxHZW9sb2NhdGlvblBvc2l0aW9uPlxuICovXG5leHBvcnQgY29uc3QgZ2V0Q3VycmVudFBvc2l0aW9uID0gYXN5bmMgKCk6IFByb21pc2U8R2VvbG9jYXRpb25Qb3NpdGlvbj4gPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmU6IFBvc2l0aW9uQ2FsbGJhY2ssIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgZ2V0R2VvbG9jYXRpb24oKS5nZXRDdXJyZW50UG9zaXRpb24ocmVzb2x2ZSwgcmVqZWN0LCBHZW9sb2NhdGlvbk9wdGlvbnMpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihtYXBHZW9sb2NhdGlvbkVycm9yKGVycm9yKSk7XG4gICAgfVxufTtcblxuZXhwb3J0IHR5cGUgQ2xlYXJXYXRjaENhbGxiYWNrID0gKCkgPT4gdm9pZDtcbmV4cG9ydCBjb25zdCB3YXRjaFBvc2l0aW9uID0gKFxuICAgIG9uV2F0Y2hQb3NpdGlvbjogUG9zaXRpb25DYWxsYmFjayxcbiAgICBvbldhdGNoUG9zaXRpb25FcnJvcjogKGVycm9yOiBHZW9sb2NhdGlvbkVycm9yKSA9PiB2b2lkLFxuKTogQ2xlYXJXYXRjaENhbGxiYWNrID0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBvbkVycm9yID0gKGVycm9yKSA9PiBvbldhdGNoUG9zaXRpb25FcnJvcihtYXBHZW9sb2NhdGlvbkVycm9yKGVycm9yKSk7XG4gICAgICAgIGNvbnN0IHdhdGNoSWQgPSBnZXRHZW9sb2NhdGlvbigpLndhdGNoUG9zaXRpb24ob25XYXRjaFBvc2l0aW9uLCBvbkVycm9yLCBHZW9sb2NhdGlvbk9wdGlvbnMpO1xuICAgICAgICBjb25zdCBjbGVhcldhdGNoID0gKCkgPT4ge1xuICAgICAgICAgICAgZ2V0R2VvbG9jYXRpb24oKS5jbGVhcldhdGNoKHdhdGNoSWQpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY2xlYXJXYXRjaDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWFwR2VvbG9jYXRpb25FcnJvcihlcnJvcikpO1xuICAgIH1cbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFnQkE7O0FBaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7SUFDWUEsZ0I7OztXQUFBQSxnQjtFQUFBQSxnQjtFQUFBQSxnQjtFQUFBQSxnQjtFQUFBQSxnQjtF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
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MediaEventHelper = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _event = require("matrix-js-sdk/src/@types/event");

var _logger = require("matrix-js-sdk/src/logger");

var _LazyValue = require("./LazyValue");

var _Media = require("../customisations/Media");

var _DecryptFile = require("./DecryptFile");

/*
Copyright 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
// TODO: We should consider caching the blobs. https://github.com/vector-im/element-web/issues/17192
class MediaEventHelper {
  // Either an HTTP or Object URL (when encrypted) to the media.
  // Either the raw or decrypted (when encrypted) contents of the file.
  constructor(event) {
    this.event = event;
    (0, _defineProperty2.default)(this, "sourceUrl", void 0);
    (0, _defineProperty2.default)(this, "thumbnailUrl", void 0);
    (0, _defineProperty2.default)(this, "sourceBlob", void 0);
    (0, _defineProperty2.default)(this, "thumbnailBlob", void 0);
    (0, _defineProperty2.default)(this, "media", void 0);
    (0, _defineProperty2.default)(this, "prepareSourceUrl", async () => {
      if (this.media.isEncrypted) {
        const blob = await this.sourceBlob.value;
        return URL.createObjectURL(blob);
      } else {
        return this.media.srcHttp;
      }
    });
    (0, _defineProperty2.default)(this, "prepareThumbnailUrl", async () => {
      if (this.media.isEncrypted) {
        const blob = await this.thumbnailBlob.value;
        if (blob === null) return null;
        return URL.createObjectURL(blob);
      } else {
        return this.media.thumbnailHttp;
      }
    });
    (0, _defineProperty2.default)(this, "fetchSource", () => {
      if (this.media.isEncrypted) {
        const content = this.event.getContent();
        return (0, _DecryptFile.decryptFile)(content.file, content.info);
      }

      return this.media.downloadSource().then(r => r.blob());
    });
    (0, _defineProperty2.default)(this, "fetchThumbnail", () => {
      if (!this.media.hasThumbnail) return Promise.resolve(null);

      if (this.media.isEncrypted) {
        const content = this.event.getContent();

        if (content.info?.thumbnail_file) {
          return (0, _DecryptFile.decryptFile)(content.info.thumbnail_file, content.info.thumbnail_info);
        } else {
          // "Should never happen"
          _logger.logger.warn("Media claims to have thumbnail and is encrypted, but no thumbnail_file found");

          return Promise.resolve(null);
        }
      }

      return fetch(this.media.thumbnailHttp).then(r => r.blob());
    });
    this.sourceUrl = new _LazyValue.LazyValue(this.prepareSourceUrl);
    this.thumbnailUrl = new _LazyValue.LazyValue(this.prepareThumbnailUrl);
    this.sourceBlob = new _LazyValue.LazyValue(this.fetchSource);
    this.thumbnailBlob = new _LazyValue.LazyValue(this.fetchThumbnail);
    this.media = (0, _Media.mediaFromContent)(this.event.getContent());
  }

  get fileName() {
    return this.event.getContent().filename || this.event.getContent().body || "download";
  }

  destroy() {
    if (this.media.isEncrypted) {
      if (this.sourceUrl.present) URL.revokeObjectURL(this.sourceUrl.cachedValue);
      if (this.thumbnailUrl.present) URL.revokeObjectURL(this.thumbnailUrl.cachedValue);
    }
  }

  static isEligible(event) {
    if (!event) return false;
    if (event.isRedacted()) return false;
    if (event.getType() === _event.EventType.Sticker) return true;
    if (event.getType() !== _event.EventType.RoomMessage) return false;
    const content = event.getContent();
    const mediaMsgTypes = [_event.MsgType.Video, _event.MsgType.Audio, _event.MsgType.Image, _event.MsgType.File];
    if (mediaMsgTypes.includes(content.msgtype)) return true;
    if (typeof content.url === 'string') return true; // Finally, it's probably not media

    return false;
  }

}

exports.MediaEventHelper = MediaEventHelper;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNZWRpYUV2ZW50SGVscGVyIiwiY29uc3RydWN0b3IiLCJldmVudCIsIm1lZGlhIiwiaXNFbmNyeXB0ZWQiLCJibG9iIiwic291cmNlQmxvYiIsInZhbHVlIiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwic3JjSHR0cCIsInRodW1ibmFpbEJsb2IiLCJ0aHVtYm5haWxIdHRwIiwiY29udGVudCIsImdldENvbnRlbnQiLCJkZWNyeXB0RmlsZSIsImZpbGUiLCJpbmZvIiwiZG93bmxvYWRTb3VyY2UiLCJ0aGVuIiwiciIsImhhc1RodW1ibmFpbCIsIlByb21pc2UiLCJyZXNvbHZlIiwidGh1bWJuYWlsX2ZpbGUiLCJ0aHVtYm5haWxfaW5mbyIsImxvZ2dlciIsIndhcm4iLCJmZXRjaCIsInNvdXJjZVVybCIsIkxhenlWYWx1ZSIsInByZXBhcmVTb3VyY2VVcmwiLCJ0aHVtYm5haWxVcmwiLCJwcmVwYXJlVGh1bWJuYWlsVXJsIiwiZmV0Y2hTb3VyY2UiLCJmZXRjaFRodW1ibmFpbCIsIm1lZGlhRnJvbUNvbnRlbnQiLCJmaWxlTmFtZSIsImZpbGVuYW1lIiwiYm9keSIsImRlc3Ryb3kiLCJwcmVzZW50IiwicmV2b2tlT2JqZWN0VVJMIiwiY2FjaGVkVmFsdWUiLCJpc0VsaWdpYmxlIiwiaXNSZWRhY3RlZCIsImdldFR5cGUiLCJFdmVudFR5cGUiLCJTdGlja2VyIiwiUm9vbU1lc3NhZ2UiLCJtZWRpYU1zZ1R5cGVzIiwiTXNnVHlwZSIsIlZpZGVvIiwiQXVkaW8iLCJJbWFnZSIsIkZpbGUiLCJpbmNsdWRlcyIsIm1zZ3R5cGUiLCJ1cmwiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbHMvTWVkaWFFdmVudEhlbHBlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgeyBNYXRyaXhFdmVudCB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tYXRyaXhcIjtcbmltcG9ydCB7IEV2ZW50VHlwZSwgTXNnVHlwZSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9AdHlwZXMvZXZlbnRcIjtcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9sb2dnZXJcIjtcblxuaW1wb3J0IHsgTGF6eVZhbHVlIH0gZnJvbSBcIi4vTGF6eVZhbHVlXCI7XG5pbXBvcnQgeyBNZWRpYSwgbWVkaWFGcm9tQ29udGVudCB9IGZyb20gXCIuLi9jdXN0b21pc2F0aW9ucy9NZWRpYVwiO1xuaW1wb3J0IHsgZGVjcnlwdEZpbGUgfSBmcm9tIFwiLi9EZWNyeXB0RmlsZVwiO1xuaW1wb3J0IHsgSU1lZGlhRXZlbnRDb250ZW50IH0gZnJvbSBcIi4uL2N1c3RvbWlzYXRpb25zL21vZGVscy9JTWVkaWFFdmVudENvbnRlbnRcIjtcbmltcG9ydCB7IElEZXN0cm95YWJsZSB9IGZyb20gXCIuL0lEZXN0cm95YWJsZVwiO1xuXG4vLyBUT0RPOiBXZSBzaG91bGQgY29uc2lkZXIgY2FjaGluZyB0aGUgYmxvYnMuIGh0dHBzOi8vZ2l0aHViLmNvbS92ZWN0b3ItaW0vZWxlbWVudC13ZWIvaXNzdWVzLzE3MTkyXG5cbmV4cG9ydCBjbGFzcyBNZWRpYUV2ZW50SGVscGVyIGltcGxlbWVudHMgSURlc3Ryb3lhYmxlIHtcbiAgICAvLyBFaXRoZXIgYW4gSFRUUCBvciBPYmplY3QgVVJMICh3aGVuIGVuY3J5cHRlZCkgdG8gdGhlIG1lZGlhLlxuICAgIHB1YmxpYyByZWFkb25seSBzb3VyY2VVcmw6IExhenlWYWx1ZTxzdHJpbmc+O1xuICAgIHB1YmxpYyByZWFkb25seSB0aHVtYm5haWxVcmw6IExhenlWYWx1ZTxzdHJpbmc+O1xuXG4gICAgLy8gRWl0aGVyIHRoZSByYXcgb3IgZGVjcnlwdGVkICh3aGVuIGVuY3J5cHRlZCkgY29udGVudHMgb2YgdGhlIGZpbGUuXG4gICAgcHVibGljIHJlYWRvbmx5IHNvdXJjZUJsb2I6IExhenlWYWx1ZTxCbG9iPjtcbiAgICBwdWJsaWMgcmVhZG9ubHkgdGh1bWJuYWlsQmxvYjogTGF6eVZhbHVlPEJsb2I+O1xuXG4gICAgcHVibGljIHJlYWRvbmx5IG1lZGlhOiBNZWRpYTtcblxuICAgIHB1YmxpYyBjb25zdHJ1Y3Rvcihwcml2YXRlIGV2ZW50OiBNYXRyaXhFdmVudCkge1xuICAgICAgICB0aGlzLnNvdXJjZVVybCA9IG5ldyBMYXp5VmFsdWUodGhpcy5wcmVwYXJlU291cmNlVXJsKTtcbiAgICAgICAgdGhpcy50aHVtYm5haWxVcmwgPSBuZXcgTGF6eVZhbHVlKHRoaXMucHJlcGFyZVRodW1ibmFpbFVybCk7XG4gICAgICAgIHRoaXMuc291cmNlQmxvYiA9IG5ldyBMYXp5VmFsdWUodGhpcy5mZXRjaFNvdXJjZSk7XG4gICAgICAgIHRoaXMudGh1bWJuYWlsQmxvYiA9IG5ldyBMYXp5VmFsdWUodGhpcy5mZXRjaFRodW1ibmFpbCk7XG5cbiAgICAgICAgdGhpcy5tZWRpYSA9IG1lZGlhRnJvbUNvbnRlbnQodGhpcy5ldmVudC5nZXRDb250ZW50KCkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgZmlsZU5hbWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXZlbnQuZ2V0Q29udGVudDxJTWVkaWFFdmVudENvbnRlbnQ+KCkuZmlsZW5hbWVcbiAgICAgICAgICAgIHx8IHRoaXMuZXZlbnQuZ2V0Q29udGVudDxJTWVkaWFFdmVudENvbnRlbnQ+KCkuYm9keVxuICAgICAgICAgICAgfHwgXCJkb3dubG9hZFwiO1xuICAgIH1cblxuICAgIHB1YmxpYyBkZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy5tZWRpYS5pc0VuY3J5cHRlZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc291cmNlVXJsLnByZXNlbnQpIFVSTC5yZXZva2VPYmplY3RVUkwodGhpcy5zb3VyY2VVcmwuY2FjaGVkVmFsdWUpO1xuICAgICAgICAgICAgaWYgKHRoaXMudGh1bWJuYWlsVXJsLnByZXNlbnQpIFVSTC5yZXZva2VPYmplY3RVUkwodGhpcy50aHVtYm5haWxVcmwuY2FjaGVkVmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwcmVwYXJlU291cmNlVXJsID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5tZWRpYS5pc0VuY3J5cHRlZCkge1xuICAgICAgICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IHRoaXMuc291cmNlQmxvYi52YWx1ZTtcbiAgICAgICAgICAgIHJldHVybiBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWVkaWEuc3JjSHR0cDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIHByZXBhcmVUaHVtYm5haWxVcmwgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLm1lZGlhLmlzRW5jcnlwdGVkKSB7XG4gICAgICAgICAgICBjb25zdCBibG9iID0gYXdhaXQgdGhpcy50aHVtYm5haWxCbG9iLnZhbHVlO1xuICAgICAgICAgICAgaWYgKGJsb2IgPT09IG51bGwpIHJldHVybiBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tZWRpYS50aHVtYm5haWxIdHRwO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgZmV0Y2hTb3VyY2UgPSAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLm1lZGlhLmlzRW5jcnlwdGVkKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gdGhpcy5ldmVudC5nZXRDb250ZW50PElNZWRpYUV2ZW50Q29udGVudD4oKTtcbiAgICAgICAgICAgIHJldHVybiBkZWNyeXB0RmlsZShjb250ZW50LmZpbGUsIGNvbnRlbnQuaW5mbyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubWVkaWEuZG93bmxvYWRTb3VyY2UoKS50aGVuKHIgPT4gci5ibG9iKCkpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIGZldGNoVGh1bWJuYWlsID0gKCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMubWVkaWEuaGFzVGh1bWJuYWlsKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuXG4gICAgICAgIGlmICh0aGlzLm1lZGlhLmlzRW5jcnlwdGVkKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gdGhpcy5ldmVudC5nZXRDb250ZW50PElNZWRpYUV2ZW50Q29udGVudD4oKTtcbiAgICAgICAgICAgIGlmIChjb250ZW50LmluZm8/LnRodW1ibmFpbF9maWxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlY3J5cHRGaWxlKGNvbnRlbnQuaW5mby50aHVtYm5haWxfZmlsZSwgY29udGVudC5pbmZvLnRodW1ibmFpbF9pbmZvKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gXCJTaG91bGQgbmV2ZXIgaGFwcGVuXCJcbiAgICAgICAgICAgICAgICBsb2dnZXIud2FybihcIk1lZGlhIGNsYWltcyB0byBoYXZlIHRodW1ibmFpbCBhbmQgaXMgZW5jcnlwdGVkLCBidXQgbm8gdGh1bWJuYWlsX2ZpbGUgZm91bmRcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmZXRjaCh0aGlzLm1lZGlhLnRodW1ibmFpbEh0dHApLnRoZW4ociA9PiByLmJsb2IoKSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBzdGF0aWMgaXNFbGlnaWJsZShldmVudDogTWF0cml4RXZlbnQpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKCFldmVudCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoZXZlbnQuaXNSZWRhY3RlZCgpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmIChldmVudC5nZXRUeXBlKCkgPT09IEV2ZW50VHlwZS5TdGlja2VyKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKGV2ZW50LmdldFR5cGUoKSAhPT0gRXZlbnRUeXBlLlJvb21NZXNzYWdlKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgY29udGVudCA9IGV2ZW50LmdldENvbnRlbnQoKTtcbiAgICAgICAgY29uc3QgbWVkaWFNc2dUeXBlczogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICBNc2dUeXBlLlZpZGVvLFxuICAgICAgICAgICAgTXNnVHlwZS5BdWRpbyxcbiAgICAgICAgICAgIE1zZ1R5cGUuSW1hZ2UsXG4gICAgICAgICAgICBNc2dUeXBlLkZpbGUsXG4gICAgICAgIF07XG4gICAgICAgIGlmIChtZWRpYU1zZ1R5cGVzLmluY2x1ZGVzKGNvbnRlbnQubXNndHlwZSkpIHJldHVybiB0cnVlO1xuICAgICAgICBpZiAodHlwZW9mKGNvbnRlbnQudXJsKSA9PT0gJ3N0cmluZycpIHJldHVybiB0cnVlO1xuXG4gICAgICAgIC8vIEZpbmFsbHksIGl0J3MgcHJvYmFibHkgbm90IG1lZGlhXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBaUJBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQXRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFZQTtBQUVPLE1BQU1BLGdCQUFOLENBQStDO0VBQ2xEO0VBSUE7RUFNT0MsV0FBVyxDQUFTQyxLQUFULEVBQTZCO0lBQUEsS0FBcEJBLEtBQW9CLEdBQXBCQSxLQUFvQjtJQUFBO0lBQUE7SUFBQTtJQUFBO0lBQUE7SUFBQSx3REFzQnBCLFlBQVk7TUFDbkMsSUFBSSxLQUFLQyxLQUFMLENBQVdDLFdBQWYsRUFBNEI7UUFDeEIsTUFBTUMsSUFBSSxHQUFHLE1BQU0sS0FBS0MsVUFBTCxDQUFnQkMsS0FBbkM7UUFDQSxPQUFPQyxHQUFHLENBQUNDLGVBQUosQ0FBb0JKLElBQXBCLENBQVA7TUFDSCxDQUhELE1BR087UUFDSCxPQUFPLEtBQUtGLEtBQUwsQ0FBV08sT0FBbEI7TUFDSDtJQUNKLENBN0I4QztJQUFBLDJEQStCakIsWUFBWTtNQUN0QyxJQUFJLEtBQUtQLEtBQUwsQ0FBV0MsV0FBZixFQUE0QjtRQUN4QixNQUFNQyxJQUFJLEdBQUcsTUFBTSxLQUFLTSxhQUFMLENBQW1CSixLQUF0QztRQUNBLElBQUlGLElBQUksS0FBSyxJQUFiLEVBQW1CLE9BQU8sSUFBUDtRQUNuQixPQUFPRyxHQUFHLENBQUNDLGVBQUosQ0FBb0JKLElBQXBCLENBQVA7TUFDSCxDQUpELE1BSU87UUFDSCxPQUFPLEtBQUtGLEtBQUwsQ0FBV1MsYUFBbEI7TUFDSDtJ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
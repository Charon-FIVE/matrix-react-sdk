"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _event = require("matrix-js-sdk/src/@types/event");

var _logger = require("matrix-js-sdk/src/logger");

var _Exporter = _interopRequireDefault(require("./Exporter"));

var _DateUtils = require("../../DateUtils");

var _languageHandler = require("../../languageHandler");

var _EventTileFactory = require("../../events/EventTileFactory");

/*
Copyright 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class JSONExporter extends _Exporter.default {
  constructor(room, exportType, exportOptions, setProgressText) {
    super(room, exportType, exportOptions, setProgressText);
    (0, _defineProperty2.default)(this, "totalSize", 0);
    (0, _defineProperty2.default)(this, "messages", []);
  }

  createJSONString() {
    const exportDate = (0, _DateUtils.formatFullDateNoDayNoTime)(new Date());
    const creator = this.room.currentState.getStateEvents(_event.EventType.RoomCreate, "")?.getSender();
    const creatorName = this.room?.getMember(creator)?.rawDisplayName || creator;
    const topic = this.room.currentState.getStateEvents(_event.EventType.RoomTopic, "")?.getContent()?.topic || "";
    const exporter = this.client.getUserId();
    const exporterName = this.room?.getMember(exporter)?.rawDisplayName || exporter;
    const jsonObject = {
      room_name: this.room.name,
      room_creator: creatorName,
      topic,
      export_date: exportDate,
      exported_by: exporterName,
      messages: this.messages
    };
    return JSON.stringify(jsonObject, null, 2);
  }

  async getJSONString(mxEv) {
    if (this.exportOptions.attachmentsIncluded && this.isAttachment(mxEv)) {
      try {
        const blob = await this.getMediaBlob(mxEv);

        if (this.totalSize + blob.size < this.exportOptions.maxSize) {
          this.totalSize += blob.size;
          const filePath = this.getFilePath(mxEv);

          if (this.totalSize == this.exportOptions.maxSize) {
            this.exportOptions.attachmentsIncluded = false;
          }

          this.addFile(filePath, blob);
        }
      } catch (err) {
        _logger.logger.log("Error fetching file: " + err);
      }
    }

    const jsonEvent = mxEv.toJSON();
    const clearEvent = mxEv.isEncrypted() ? jsonEvent.decrypted : jsonEvent;
    return clearEvent;
  }

  async createOutput(events) {
    for (let i = 0; i < events.length; i++) {
      const event = events[i];
      this.updateProgress((0, _languageHandler._t)("Processing event %(number)s out of %(total)s", {
        number: i + 1,
        total: events.length
      }), false, true);
      if (this.cancelled) return this.cleanUp();
      if (!(0, _EventTileFactory.haveRendererForEvent)(event, false)) continue;
      this.messages.push(await this.getJSONString(event));
    }

    return this.createJSONString();
  }

  async export() {
    _logger.logger.info("Starting export process...");

    _logger.logger.info("Fetching events...");

    const fetchStart = performance.now();
    const res = await this.getRequiredEvents();
    const fetchEnd = performance.now();

    _logger.logger.log(`Fetched ${res.length} events in ${(fetchEnd - fetchStart) / 1000}s`);

    _logger.logger.info("Creating output...");

    const text = await this.createOutput(res);

    if (this.files.length) {
      this.addFile("export.json", new Blob([text]));
      await this.downloadZIP();
    } else {
      const fileName = `matrix-export-${(0, _DateUtils.formatFullDateNoDay)(new Date())}.json`;
      this.downloadPlainText(fileName, text);
    }

    const exportEnd = performance.now();

    if (this.cancelled) {
      _logger.logger.info("Export cancelled successfully");
    } else {
      _logger.logger.info("Export successful!");

      _logger.logger.log(`Exported ${res.length} events in ${(exportEnd - fetchStart) / 1000} seconds`);
    }

    this.cleanUp();
  }

}

exports.default = JSONExporter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJKU09ORXhwb3J0ZXIiLCJFeHBvcnRlciIsImNvbnN0cnVjdG9yIiwicm9vbSIsImV4cG9ydFR5cGUiLCJleHBvcnRPcHRpb25zIiwic2V0UHJvZ3Jlc3NUZXh0IiwiY3JlYXRlSlNPTlN0cmluZyIsImV4cG9ydERhdGUiLCJmb3JtYXRGdWxsRGF0ZU5vRGF5Tm9UaW1lIiwiRGF0ZSIsImNyZWF0b3IiLCJjdXJyZW50U3RhdGUiLCJnZXRTdGF0ZUV2ZW50cyIsIkV2ZW50VHlwZSIsIlJvb21DcmVhdGUiLCJnZXRTZW5kZXIiLCJjcmVhdG9yTmFtZSIsImdldE1lbWJlciIsInJhd0Rpc3BsYXlOYW1lIiwidG9waWMiLCJSb29tVG9waWMiLCJnZXRDb250ZW50IiwiZXhwb3J0ZXIiLCJjbGllbnQiLCJnZXRVc2VySWQiLCJleHBvcnRlck5hbWUiLCJqc29uT2JqZWN0Iiwicm9vbV9uYW1lIiwibmFtZSIsInJvb21fY3JlYXRvciIsImV4cG9ydF9kYXRlIiwiZXhwb3J0ZWRfYnkiLCJtZXNzYWdlcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRKU09OU3RyaW5nIiwibXhFdiIsImF0dGFjaG1lbnRzSW5jbHVkZWQiLCJpc0F0dGFjaG1lbnQiLCJibG9iIiwiZ2V0TWVkaWFCbG9iIiwidG90YWxTaXplIiwic2l6ZSIsIm1heFNpemUiLCJmaWxlUGF0aCIsImdldEZpbGVQYXRoIiwiYWRkRmlsZSIsImVyciIsImxvZ2dlciIsImxvZyIsImpzb25FdmVudCIsInRvSlNPTiIsImNsZWFyRXZlbnQiLCJpc0VuY3J5cHRlZCIsImRlY3J5cHRlZCIsImNyZWF0ZU91dHB1dCIsImV2ZW50cyIsImkiLCJsZW5ndGgiLCJldmVudCIsInVwZGF0ZVByb2dyZXNzIiwiX3QiLCJudW1iZXIiLCJ0b3RhbCIsImNhbmNlbGxlZCIsImNsZWFuVXAiLCJoYXZlUmVuZGVyZXJGb3JFdmVudCIsInB1c2giLCJleHBvcnQiLCJpbmZvIiwiZmV0Y2hTdGFydCIsInBlcmZvcm1hbmNlIiwibm93IiwicmVzIiwiZ2V0UmVxdWlyZWRFdmVudHMiLCJmZXRjaEVuZCIsInRleHQiLCJmaWxlcyIsIkJsb2IiLCJkb3dubG9hZFpJUCIsImZpbGVOYW1lIiwiZm9ybWF0RnVsbERhdGVOb0RheSIsImRvd25sb2FkUGxhaW5UZXh0IiwiZXhwb3J0RW5kIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3V0aWxzL2V4cG9ydFV0aWxzL0pTT05FeHBvcnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IHsgUm9vbSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvcm9vbVwiO1xuaW1wb3J0IHsgTWF0cml4RXZlbnQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL2V2ZW50XCI7XG5pbXBvcnQgeyBFdmVudFR5cGUgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvQHR5cGVzL2V2ZW50XCI7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbG9nZ2VyXCI7XG5cbmltcG9ydCBFeHBvcnRlciBmcm9tIFwiLi9FeHBvcnRlclwiO1xuaW1wb3J0IHsgZm9ybWF0RnVsbERhdGVOb0RheSwgZm9ybWF0RnVsbERhdGVOb0RheU5vVGltZSB9IGZyb20gXCIuLi8uLi9EYXRlVXRpbHNcIjtcbmltcG9ydCB7IEV4cG9ydFR5cGUsIElFeHBvcnRPcHRpb25zIH0gZnJvbSBcIi4vZXhwb3J0VXRpbHNcIjtcbmltcG9ydCB7IF90IH0gZnJvbSBcIi4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IHsgaGF2ZVJlbmRlcmVyRm9yRXZlbnQgfSBmcm9tIFwiLi4vLi4vZXZlbnRzL0V2ZW50VGlsZUZhY3RvcnlcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSlNPTkV4cG9ydGVyIGV4dGVuZHMgRXhwb3J0ZXIge1xuICAgIHByb3RlY3RlZCB0b3RhbFNpemUgPSAwO1xuICAgIHByb3RlY3RlZCBtZXNzYWdlczogUmVjb3JkPHN0cmluZywgYW55PltdID0gW107XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcm9vbTogUm9vbSxcbiAgICAgICAgZXhwb3J0VHlwZTogRXhwb3J0VHlwZSxcbiAgICAgICAgZXhwb3J0T3B0aW9uczogSUV4cG9ydE9wdGlvbnMsXG4gICAgICAgIHNldFByb2dyZXNzVGV4dDogUmVhY3QuRGlzcGF0Y2g8UmVhY3QuU2V0U3RhdGVBY3Rpb248c3RyaW5nPj4sXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKHJvb20sIGV4cG9ydFR5cGUsIGV4cG9ydE9wdGlvbnMsIHNldFByb2dyZXNzVGV4dCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGNyZWF0ZUpTT05TdHJpbmcoKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgZXhwb3J0RGF0ZSA9IGZvcm1hdEZ1bGxEYXRlTm9EYXlOb1RpbWUobmV3IERhdGUoKSk7XG4gICAgICAgIGNvbnN0IGNyZWF0b3IgPSB0aGlzLnJvb20uY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKEV2ZW50VHlwZS5Sb29tQ3JlYXRlLCBcIlwiKT8uZ2V0U2VuZGVyKCk7XG4gICAgICAgIGNvbnN0IGNyZWF0b3JOYW1lID0gdGhpcy5yb29tPy5nZXRNZW1iZXIoY3JlYXRvcik/LnJhd0Rpc3BsYXlOYW1lIHx8IGNyZWF0b3I7XG4gICAgICAgIGNvbnN0IHRvcGljID0gdGhpcy5yb29tLmN1cnJlbnRTdGF0ZS5nZXRTdGF0ZUV2ZW50cyhFdmVudFR5cGUuUm9vbVRvcGljLCBcIlwiKT8uZ2V0Q29udGVudCgpPy50b3BpYyB8fCBcIlwiO1xuICAgICAgICBjb25zdCBleHBvcnRlciA9IHRoaXMuY2xpZW50LmdldFVzZXJJZCgpO1xuICAgICAgICBjb25zdCBleHBvcnRlck5hbWUgPSB0aGlzLnJvb20/LmdldE1lbWJlcihleHBvcnRlcik/LnJhd0Rpc3BsYXlOYW1lIHx8IGV4cG9ydGVyO1xuICAgICAgICBjb25zdCBqc29uT2JqZWN0ID0ge1xuICAgICAgICAgICAgcm9vbV9uYW1lOiB0aGlzLnJvb20ubmFtZSxcbiAgICAgICAgICAgIHJvb21fY3JlYXRvcjogY3JlYXRvck5hbWUsXG4gICAgICAgICAgICB0b3BpYyxcbiAgICAgICAgICAgIGV4cG9ydF9kYXRlOiBleHBvcnREYXRlLFxuICAgICAgICAgICAgZXhwb3J0ZWRfYnk6IGV4cG9ydGVyTmFtZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiB0aGlzLm1lc3NhZ2VzLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoanNvbk9iamVjdCwgbnVsbCwgMik7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFzeW5jIGdldEpTT05TdHJpbmcobXhFdjogTWF0cml4RXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuZXhwb3J0T3B0aW9ucy5hdHRhY2htZW50c0luY2x1ZGVkICYmIHRoaXMuaXNBdHRhY2htZW50KG14RXYpKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCB0aGlzLmdldE1lZGlhQmxvYihteEV2KTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50b3RhbFNpemUgKyBibG9iLnNpemUgPCB0aGlzLmV4cG9ydE9wdGlvbnMubWF4U2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsU2l6ZSArPSBibG9iLnNpemU7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gdGhpcy5nZXRGaWxlUGF0aChteEV2KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudG90YWxTaXplID09IHRoaXMuZXhwb3J0T3B0aW9ucy5tYXhTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cG9ydE9wdGlvbnMuYXR0YWNobWVudHNJbmNsdWRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRmlsZShmaWxlUGF0aCwgYmxvYik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhcIkVycm9yIGZldGNoaW5nIGZpbGU6IFwiICsgZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBqc29uRXZlbnQ6IGFueSA9IG14RXYudG9KU09OKCk7XG4gICAgICAgIGNvbnN0IGNsZWFyRXZlbnQgPSBteEV2LmlzRW5jcnlwdGVkKCkgPyBqc29uRXZlbnQuZGVjcnlwdGVkIDoganNvbkV2ZW50O1xuICAgICAgICByZXR1cm4gY2xlYXJFdmVudDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYXN5bmMgY3JlYXRlT3V0cHV0KGV2ZW50czogTWF0cml4RXZlbnRbXSkge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBldmVudHNbaV07XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzKF90KFwiUHJvY2Vzc2luZyBldmVudCAlKG51bWJlcilzIG91dCBvZiAlKHRvdGFsKXNcIiwge1xuICAgICAgICAgICAgICAgIG51bWJlcjogaSArIDEsXG4gICAgICAgICAgICAgICAgdG90YWw6IGV2ZW50cy5sZW5ndGgsXG4gICAgICAgICAgICB9KSwgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgaWYgKHRoaXMuY2FuY2VsbGVkKSByZXR1cm4gdGhpcy5jbGVhblVwKCk7XG4gICAgICAgICAgICBpZiAoIWhhdmVSZW5kZXJlckZvckV2ZW50KGV2ZW50LCBmYWxzZSkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlcy5wdXNoKGF3YWl0IHRoaXMuZ2V0SlNPTlN0cmluZyhldmVudCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUpTT05TdHJpbmcoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZXhwb3J0KCkge1xuICAgICAgICBsb2dnZXIuaW5mbyhcIlN0YXJ0aW5nIGV4cG9ydCBwcm9jZXNzLi4uXCIpO1xuICAgICAgICBsb2dnZXIuaW5mbyhcIkZldGNoaW5nIGV2ZW50cy4uLlwiKTtcblxuICAgICAgICBjb25zdCBmZXRjaFN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0UmVxdWlyZWRFdmVudHMoKTtcbiAgICAgICAgY29uc3QgZmV0Y2hFbmQgPSBwZXJmb3JtYW5jZS5ub3coKTtcblxuICAgICAgICBsb2dnZXIubG9nKGBGZXRjaGVkICR7cmVzLmxlbmd0aH0gZXZlbnRzIGluICR7KGZldGNoRW5kIC0gZmV0Y2hTdGFydCkvMTAwMH1zYCk7XG5cbiAgICAgICAgbG9nZ2VyLmluZm8oXCJDcmVhdGluZyBvdXRwdXQuLi5cIik7XG4gICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCB0aGlzLmNyZWF0ZU91dHB1dChyZXMpO1xuXG4gICAgICAgIGlmICh0aGlzLmZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5hZGRGaWxlKFwiZXhwb3J0Lmpzb25cIiwgbmV3IEJsb2IoW3RleHRdKSk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmRvd25sb2FkWklQKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IGBtYXRyaXgtZXhwb3J0LSR7Zm9ybWF0RnVsbERhdGVOb0RheShuZXcgRGF0ZSgpKX0uanNvbmA7XG4gICAgICAgICAgICB0aGlzLmRvd25sb2FkUGxhaW5UZXh0KGZpbGVOYW1lLCB0ZXh0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGV4cG9ydEVuZCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXG4gICAgICAgIGlmICh0aGlzLmNhbmNlbGxlZCkge1xuICAgICAgICAgICAgbG9nZ2VyLmluZm8oXCJFeHBvcnQgY2FuY2VsbGVkIHN1Y2Nlc3NmdWxseVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKFwiRXhwb3J0IHN1Y2Nlc3NmdWwhXCIpO1xuICAgICAgICAgICAgbG9nZ2VyLmxvZyhgRXhwb3J0ZWQgJHtyZXMubGVuZ3RofSBldmVudHMgaW4gJHsoZXhwb3J0RW5kIC0gZmV0Y2hTdGFydCkvMTAwMH0gc2Vjb25kc2ApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jbGVhblVwKCk7XG4gICAgfVxufVxuXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBa0JBOztBQUNBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOztBQXpCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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
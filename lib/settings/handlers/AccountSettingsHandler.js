"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _client = require("matrix-js-sdk/src/client");

var _utils = require("matrix-js-sdk/src/utils");

var _MatrixClientBackedSettingsHandler = _interopRequireDefault(require("./MatrixClientBackedSettingsHandler"));

var _objects = require("../../utils/objects");

var _SettingLevel = require("../SettingLevel");

/*
Copyright 2017 Travis Ralston
Copyright 2019, 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const BREADCRUMBS_LEGACY_EVENT_TYPE = "im.vector.riot.breadcrumb_rooms";
const BREADCRUMBS_EVENT_TYPE = "im.vector.setting.breadcrumbs";
const BREADCRUMBS_EVENT_TYPES = [BREADCRUMBS_LEGACY_EVENT_TYPE, BREADCRUMBS_EVENT_TYPE];
const RECENT_EMOJI_EVENT_TYPE = "io.element.recent_emoji";
const INTEG_PROVISIONING_EVENT_TYPE = "im.vector.setting.integration_provisioning";
const ANALYTICS_EVENT_TYPE = "im.vector.analytics";
const DEFAULT_SETTINGS_EVENT_TYPE = "im.vector.web.settings";
/**
 * Gets and sets settings at the "account" level for the current user.
 * This handler does not make use of the roomId parameter.
 */

class AccountSettingsHandler extends _MatrixClientBackedSettingsHandler.default {
  constructor(watchers) {
    super();
    this.watchers = watchers;
    (0, _defineProperty2.default)(this, "onAccountData", (event, prevEvent) => {
      if (event.getType() === "org.matrix.preview_urls") {
        let val = event.getContent()['disable'];

        if (typeof val !== "boolean") {
          val = null;
        } else {
          val = !val;
        }

        this.watchers.notifyUpdate("urlPreviewsEnabled", null, _SettingLevel.SettingLevel.ACCOUNT, val);
      } else if (event.getType() === DEFAULT_SETTINGS_EVENT_TYPE || event.getType() === ANALYTICS_EVENT_TYPE) {
        // Figure out what changed and fire those updates
        const prevContent = prevEvent?.getContent() ?? {};
        const changedSettings = (0, _objects.objectKeyChanges)(prevContent, event.getContent());

        for (const settingName of changedSettings) {
          const val = event.getContent()[settingName];
          this.watchers.notifyUpdate(settingName, null, _SettingLevel.SettingLevel.ACCOUNT, val);
        }
      } else if (BREADCRUMBS_EVENT_TYPES.includes(event.getType())) {
        this.notifyBreadcrumbsUpdate(event);
      } else if (event.getType() === INTEG_PROVISIONING_EVENT_TYPE) {
        const val = event.getContent()['enabled'];
        this.watchers.notifyUpdate("integrationProvisioning", null, _SettingLevel.SettingLevel.ACCOUNT, val);
      } else if (event.getType() === RECENT_EMOJI_EVENT_TYPE) {
        const val = event.getContent()['enabled'];
        this.watchers.notifyUpdate("recent_emoji", null, _SettingLevel.SettingLevel.ACCOUNT, val);
      }
    });
  }

  get level() {
    return _SettingLevel.SettingLevel.ACCOUNT;
  }

  initMatrixClient(oldClient, newClient) {
    oldClient?.removeListener(_client.ClientEvent.AccountData, this.onAccountData);
    newClient.on(_client.ClientEvent.AccountData, this.onAccountData);
  }

  getValue(settingName, roomId) {
    // Special case URL previews
    if (settingName === "urlPreviewsEnabled") {
      const content = this.getSettings("org.matrix.preview_urls") || {}; // Check to make sure that we actually got a boolean

      if (typeof content['disable'] !== "boolean") return null;
      return !content['disable'];
    } // Special case for breadcrumbs


    if (settingName === "breadcrumb_rooms") {
      let content = this.getSettings(BREADCRUMBS_EVENT_TYPE);

      if (!content || !content['recent_rooms']) {
        content = this.getSettings(BREADCRUMBS_LEGACY_EVENT_TYPE); // This is a bit of a hack, but it makes things slightly easier

        if (content) content['recent_rooms'] = content['rooms'];
      }

      return content && content['recent_rooms'] ? content['recent_rooms'] : [];
    } // Special case recent emoji


    if (settingName === "recent_emoji") {
      const content = this.getSettings(RECENT_EMOJI_EVENT_TYPE);
      return content ? content["recent_emoji"] : null;
    } // Special case integration manager provisioning


    if (settingName === "integrationProvisioning") {
      const content = this.getSettings(INTEG_PROVISIONING_EVENT_TYPE);
      return content ? content['enabled'] : null;
    }

    if (settingName === "pseudonymousAnalyticsOptIn") {
      const content = this.getSettings(ANALYTICS_EVENT_TYPE) || {}; // Check to make sure that we actually got a boolean

      if (typeof content[settingName] !== "boolean") return null;
      return content[settingName];
    }

    if (settingName === "MessageComposerInput.insertTrailingColon") {
      const content = this.getSettings() || {};
      const value = content[settingName];

      if (value === null || value === undefined) {
        // Write true as it is the default. This will give us the option
        // of making this opt-in in the future, without affecting old
        // users
        this.setValue(settingName, roomId, true);
        return true;
      }

      return value;
    }

    const settings = this.getSettings() || {};
    let preferredValue = settings[settingName];

    if (preferredValue === null || preferredValue === undefined) {
      // Honour the old setting on read only
      if (settingName === "hideAvatarChanges" || settingName === "hideDisplaynameChanges") {
        preferredValue = settings["hideAvatarDisplaynameChanges"];
      }
    }

    return preferredValue;
  } // helper function to set account data then await it being echoed back


  async setAccountData(eventType, field, value, legacyEventType) {
    let content = this.getSettings(eventType);

    if (legacyEventType && !content?.[field]) {
      content = this.getSettings(legacyEventType);
    }

    if (!content) {
      content = {};
    }

    content[field] = value; // Attach a deferred *before* setting the account data to ensure we catch any requests
    // which race between different lines.

    const deferred = (0, _utils.defer)();

    const handler = event => {
      if (event.getType() !== eventType || event.getContent()[field] !== value) return;
      this.client.off(_client.ClientEvent.AccountData, handler);
      deferred.resolve();
    };

    this.client.on(_client.ClientEvent.AccountData, handler);
    await this.client.setAccountData(eventType, content);
    await deferred.promise;
  }

  setValue(settingName, roomId, newValue) {
    switch (settingName) {
      // Special case URL previews
      case "urlPreviewsEnabled":
        return this.setAccountData("org.matrix.preview_urls", "disable", !newValue);
      // Special case for breadcrumbs

      case "breadcrumb_rooms":
        return this.setAccountData(BREADCRUMBS_EVENT_TYPE, "recent_rooms", newValue, BREADCRUMBS_LEGACY_EVENT_TYPE);
      // Special case recent emoji

      case "recent_emoji":
        return this.setAccountData(RECENT_EMOJI_EVENT_TYPE, "recent_emoji", newValue);
      // Special case integration manager provisioning

      case "integrationProvisioning":
        return this.setAccountData(INTEG_PROVISIONING_EVENT_TYPE, "enabled", newValue);
      // Special case analytics

      case "pseudonymousAnalyticsOptIn":
        return this.setAccountData(ANALYTICS_EVENT_TYPE, "pseudonymousAnalyticsOptIn", newValue);

      default:
        return this.setAccountData(DEFAULT_SETTINGS_EVENT_TYPE, settingName, newValue);
    }
  }

  canSetValue(settingName, roomId) {
    return true; // It's their account, so they should be able to
  }

  isSupported() {
    return this.client && !this.client.isGuest();
  }

  getSettings() {
    let eventType = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "im.vector.web.settings";
    // TODO: [TS] Types on return
    if (!this.client) return null;
    const event = this.client.getAccountData(eventType);
    if (!event || !event.getContent()) return null;
    return (0, _objects.objectClone)(event.getContent()); // clone to prevent mutation
  }

  notifyBreadcrumbsUpdate(event) {
    let val = [];

    if (event.getType() === BREADCRUMBS_LEGACY_EVENT_TYPE) {
      // This seems fishy - try and get the event for the new rooms
      const newType = this.getSettings(BREADCRUMBS_EVENT_TYPE);
      if (newType) val = newType['recent_rooms'];else val = event.getContent()['rooms'];
    } else if (event.getType() === BREADCRUMBS_EVENT_TYPE) {
      val = event.getContent()['recent_rooms'];
    } else {
      return; // for sanity, not because we expect to be here.
    }

    this.watchers.notifyUpdate("breadcrumb_rooms", null, _SettingLevel.SettingLevel.ACCOUNT, val || []);
  }

}

exports.default = AccountSettingsHandler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCUkVBRENSVU1CU19MRUdBQ1lfRVZFTlRfVFlQRSIsIkJSRUFEQ1JVTUJTX0VWRU5UX1RZUEUiLCJCUkVBRENSVU1CU19FVkVOVF9UWVBFUyIsIlJFQ0VOVF9FTU9KSV9FVkVOVF9UWVBFIiwiSU5URUdfUFJPVklTSU9OSU5HX0VWRU5UX1RZUEUiLCJBTkFMWVRJQ1NfRVZFTlRfVFlQRSIsIkRFRkFVTFRfU0VUVElOR1NfRVZFTlRfVFlQRSIsIkFjY291bnRTZXR0aW5nc0hhbmRsZXIiLCJNYXRyaXhDbGllbnRCYWNrZWRTZXR0aW5nc0hhbmRsZXIiLCJjb25zdHJ1Y3RvciIsIndhdGNoZXJzIiwiZXZlbnQiLCJwcmV2RXZlbnQiLCJnZXRUeXBlIiwidmFsIiwiZ2V0Q29udGVudCIsIm5vdGlmeVVwZGF0ZSIsIlNldHRpbmdMZXZlbCIsIkFDQ09VTlQiLCJwcmV2Q29udGVudCIsImNoYW5nZWRTZXR0aW5ncyIsIm9iamVjdEtleUNoYW5nZXMiLCJzZXR0aW5nTmFtZSIsImluY2x1ZGVzIiwibm90aWZ5QnJlYWRjcnVtYnNVcGRhdGUiLCJsZXZlbCIsImluaXRNYXRyaXhDbGllbnQiLCJvbGRDbGllbnQiLCJuZXdDbGllbnQiLCJyZW1vdmVMaXN0ZW5lciIsIkNsaWVudEV2ZW50IiwiQWNjb3VudERhdGEiLCJvbkFjY291bnREYXRhIiwib24iLCJnZXRWYWx1ZSIsInJvb21JZCIsImNvbnRlbnQiLCJnZXRTZXR0aW5ncyIsInZhbHVlIiwidW5kZWZpbmVkIiwic2V0VmFsdWUiLCJzZXR0aW5ncyIsInByZWZlcnJlZFZhbHVlIiwic2V0QWNjb3VudERhdGEiLCJldmVudFR5cGUiLCJmaWVsZCIsImxlZ2FjeUV2ZW50VHlwZSIsImRlZmVycmVkIiwiZGVmZXIiLCJoYW5kbGVyIiwiY2xpZW50Iiwib2ZmIiwicmVzb2x2ZSIsInByb21pc2UiLCJuZXdWYWx1ZSIsImNhblNldFZhbHVlIiwiaXNTdXBwb3J0ZWQiLCJpc0d1ZXN0IiwiZ2V0QWNjb3VudERhdGEiLCJvYmplY3RDbG9uZSIsIm5ld1R5cGUiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2V0dGluZ3MvaGFuZGxlcnMvQWNjb3VudFNldHRpbmdzSGFuZGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTcgVHJhdmlzIFJhbHN0b25cbkNvcHlyaWdodCAyMDE5LCAyMDIwIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IHsgQ2xpZW50RXZlbnQsIE1hdHJpeENsaWVudCB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9jbGllbnRcIjtcbmltcG9ydCB7IE1hdHJpeEV2ZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9ldmVudFwiO1xuaW1wb3J0IHsgZGVmZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvdXRpbHNcIjtcblxuaW1wb3J0IE1hdHJpeENsaWVudEJhY2tlZFNldHRpbmdzSGFuZGxlciBmcm9tIFwiLi9NYXRyaXhDbGllbnRCYWNrZWRTZXR0aW5nc0hhbmRsZXJcIjtcbmltcG9ydCB7IG9iamVjdENsb25lLCBvYmplY3RLZXlDaGFuZ2VzIH0gZnJvbSBcIi4uLy4uL3V0aWxzL29iamVjdHNcIjtcbmltcG9ydCB7IFNldHRpbmdMZXZlbCB9IGZyb20gXCIuLi9TZXR0aW5nTGV2ZWxcIjtcbmltcG9ydCB7IFdhdGNoTWFuYWdlciB9IGZyb20gXCIuLi9XYXRjaE1hbmFnZXJcIjtcblxuY29uc3QgQlJFQURDUlVNQlNfTEVHQUNZX0VWRU5UX1RZUEUgPSBcImltLnZlY3Rvci5yaW90LmJyZWFkY3J1bWJfcm9vbXNcIjtcbmNvbnN0IEJSRUFEQ1JVTUJTX0VWRU5UX1RZUEUgPSBcImltLnZlY3Rvci5zZXR0aW5nLmJyZWFkY3J1bWJzXCI7XG5jb25zdCBCUkVBRENSVU1CU19FVkVOVF9UWVBFUyA9IFtCUkVBRENSVU1CU19MRUdBQ1lfRVZFTlRfVFlQRSwgQlJFQURDUlVNQlNfRVZFTlRfVFlQRV07XG5jb25zdCBSRUNFTlRfRU1PSklfRVZFTlRfVFlQRSA9IFwiaW8uZWxlbWVudC5yZWNlbnRfZW1vamlcIjtcbmNvbnN0IElOVEVHX1BST1ZJU0lPTklOR19FVkVOVF9UWVBFID0gXCJpbS52ZWN0b3Iuc2V0dGluZy5pbnRlZ3JhdGlvbl9wcm92aXNpb25pbmdcIjtcbmNvbnN0IEFOQUxZVElDU19FVkVOVF9UWVBFID0gXCJpbS52ZWN0b3IuYW5hbHl0aWNzXCI7XG5jb25zdCBERUZBVUxUX1NFVFRJTkdTX0VWRU5UX1RZUEUgPSBcImltLnZlY3Rvci53ZWIuc2V0dGluZ3NcIjtcblxuLyoqXG4gKiBHZXRzIGFuZCBzZXRzIHNldHRpbmdzIGF0IHRoZSBcImFjY291bnRcIiBsZXZlbCBmb3IgdGhlIGN1cnJlbnQgdXNlci5cbiAqIFRoaXMgaGFuZGxlciBkb2VzIG5vdCBtYWtlIHVzZSBvZiB0aGUgcm9vbUlkIHBhcmFtZXRlci5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQWNjb3VudFNldHRpbmdzSGFuZGxlciBleHRlbmRzIE1hdHJpeENsaWVudEJhY2tlZFNldHRpbmdzSGFuZGxlciB7XG4gICAgY29uc3RydWN0b3IocHVibGljIHJlYWRvbmx5IHdhdGNoZXJzOiBXYXRjaE1hbmFnZXIpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IGxldmVsKCk6IFNldHRpbmdMZXZlbCB7XG4gICAgICAgIHJldHVybiBTZXR0aW5nTGV2ZWwuQUNDT1VOVDtcbiAgICB9XG5cbiAgICBwdWJsaWMgaW5pdE1hdHJpeENsaWVudChvbGRDbGllbnQ6IE1hdHJpeENsaWVudCwgbmV3Q2xpZW50OiBNYXRyaXhDbGllbnQpIHtcbiAgICAgICAgb2xkQ2xpZW50Py5yZW1vdmVMaXN0ZW5lcihDbGllbnRFdmVudC5BY2NvdW50RGF0YSwgdGhpcy5vbkFjY291bnREYXRhKTtcbiAgICAgICAgbmV3Q2xpZW50Lm9uKENsaWVudEV2ZW50LkFjY291bnREYXRhLCB0aGlzLm9uQWNjb3VudERhdGEpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25BY2NvdW50RGF0YSA9IChldmVudDogTWF0cml4RXZlbnQsIHByZXZFdmVudDogTWF0cml4RXZlbnQpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LmdldFR5cGUoKSA9PT0gXCJvcmcubWF0cml4LnByZXZpZXdfdXJsc1wiKSB7XG4gICAgICAgICAgICBsZXQgdmFsID0gZXZlbnQuZ2V0Q29udGVudCgpWydkaXNhYmxlJ107XG4gICAgICAgICAgICBpZiAodHlwZW9mKHZhbCkgIT09IFwiYm9vbGVhblwiKSB7XG4gICAgICAgICAgICAgICAgdmFsID0gbnVsbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsID0gIXZhbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy53YXRjaGVycy5ub3RpZnlVcGRhdGUoXCJ1cmxQcmV2aWV3c0VuYWJsZWRcIiwgbnVsbCwgU2V0dGluZ0xldmVsLkFDQ09VTlQsIHZhbCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuZ2V0VHlwZSgpID09PSBERUZBVUxUX1NFVFRJTkdTX0VWRU5UX1RZUEUgfHwgZXZlbnQuZ2V0VHlwZSgpID09PSBBTkFMWVRJQ1NfRVZFTlRfVFlQRSkge1xuICAgICAgICAgICAgLy8gRmlndXJlIG91dCB3aGF0IGNoYW5nZWQgYW5kIGZpcmUgdGhvc2UgdXBkYXRlc1xuICAgICAgICAgICAgY29uc3QgcHJldkNvbnRlbnQgPSBwcmV2RXZlbnQ/LmdldENvbnRlbnQoKSA/PyB7fTtcbiAgICAgICAgICAgIGNvbnN0IGNoYW5nZWRTZXR0aW5ncyA9IG9iamVjdEtleUNoYW5nZXM8UmVjb3JkPHN0cmluZywgYW55Pj4ocHJldkNvbnRlbnQsIGV2ZW50LmdldENvbnRlbnQoKSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHNldHRpbmdOYW1lIG9mIGNoYW5nZWRTZXR0aW5ncykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IGV2ZW50LmdldENvbnRlbnQoKVtzZXR0aW5nTmFtZV07XG4gICAgICAgICAgICAgICAgdGhpcy53YXRjaGVycy5ub3RpZnlVcGRhdGUoc2V0dGluZ05hbWUsIG51bGwsIFNldHRpbmdMZXZlbC5BQ0NPVU5ULCB2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKEJSRUFEQ1JVTUJTX0VWRU5UX1RZUEVTLmluY2x1ZGVzKGV2ZW50LmdldFR5cGUoKSkpIHtcbiAgICAgICAgICAgIHRoaXMubm90aWZ5QnJlYWRjcnVtYnNVcGRhdGUoZXZlbnQpO1xuICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmdldFR5cGUoKSA9PT0gSU5URUdfUFJPVklTSU9OSU5HX0VWRU5UX1RZUEUpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbCA9IGV2ZW50LmdldENvbnRlbnQoKVsnZW5hYmxlZCddO1xuICAgICAgICAgICAgdGhpcy53YXRjaGVycy5ub3RpZnlVcGRhdGUoXCJpbnRlZ3JhdGlvblByb3Zpc2lvbmluZ1wiLCBudWxsLCBTZXR0aW5nTGV2ZWwuQUNDT1VOVCwgdmFsKTtcbiAgICAgICAgfSBlbHNlIGlmIChldmVudC5nZXRUeXBlKCkgPT09IFJFQ0VOVF9FTU9KSV9FVkVOVF9UWVBFKSB7XG4gICAgICAgICAgICBjb25zdCB2YWwgPSBldmVudC5nZXRDb250ZW50KClbJ2VuYWJsZWQnXTtcbiAgICAgICAgICAgIHRoaXMud2F0Y2hlcnMubm90aWZ5VXBkYXRlKFwicmVjZW50X2Vtb2ppXCIsIG51bGwsIFNldHRpbmdMZXZlbC5BQ0NPVU5ULCB2YWwpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHB1YmxpYyBnZXRWYWx1ZShzZXR0aW5nTmFtZTogc3RyaW5nLCByb29tSWQ6IHN0cmluZyk6IGFueSB7XG4gICAgICAgIC8vIFNwZWNpYWwgY2FzZSBVUkwgcHJldmlld3NcbiAgICAgICAgaWYgKHNldHRpbmdOYW1lID09PSBcInVybFByZXZpZXdzRW5hYmxlZFwiKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gdGhpcy5nZXRTZXR0aW5ncyhcIm9yZy5tYXRyaXgucHJldmlld191cmxzXCIpIHx8IHt9O1xuXG4gICAgICAgICAgICAvLyBDaGVjayB0byBtYWtlIHN1cmUgdGhhdCB3ZSBhY3R1YWxseSBnb3QgYSBib29sZWFuXG4gICAgICAgICAgICBpZiAodHlwZW9mKGNvbnRlbnRbJ2Rpc2FibGUnXSkgIT09IFwiYm9vbGVhblwiKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIHJldHVybiAhY29udGVudFsnZGlzYWJsZSddO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlIGZvciBicmVhZGNydW1ic1xuICAgICAgICBpZiAoc2V0dGluZ05hbWUgPT09IFwiYnJlYWRjcnVtYl9yb29tc1wiKSB7XG4gICAgICAgICAgICBsZXQgY29udGVudCA9IHRoaXMuZ2V0U2V0dGluZ3MoQlJFQURDUlVNQlNfRVZFTlRfVFlQRSk7XG4gICAgICAgICAgICBpZiAoIWNvbnRlbnQgfHwgIWNvbnRlbnRbJ3JlY2VudF9yb29tcyddKSB7XG4gICAgICAgICAgICAgICAgY29udGVudCA9IHRoaXMuZ2V0U2V0dGluZ3MoQlJFQURDUlVNQlNfTEVHQUNZX0VWRU5UX1RZUEUpO1xuXG4gICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIGJpdCBvZiBhIGhhY2ssIGJ1dCBpdCBtYWtlcyB0aGluZ3Mgc2xpZ2h0bHkgZWFzaWVyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQpIGNvbnRlbnRbJ3JlY2VudF9yb29tcyddID0gY29udGVudFsncm9vbXMnXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQgJiYgY29udGVudFsncmVjZW50X3Jvb21zJ10gPyBjb250ZW50WydyZWNlbnRfcm9vbXMnXSA6IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlIHJlY2VudCBlbW9qaVxuICAgICAgICBpZiAoc2V0dGluZ05hbWUgPT09IFwicmVjZW50X2Vtb2ppXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLmdldFNldHRpbmdzKFJFQ0VOVF9FTU9KSV9FVkVOVF9UWVBFKTtcbiAgICAgICAgICAgIHJldHVybiBjb250ZW50ID8gY29udGVudFtcInJlY2VudF9lbW9qaVwiXSA6IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTcGVjaWFsIGNhc2UgaW50ZWdyYXRpb24gbWFuYWdlciBwcm92aXNpb25pbmdcbiAgICAgICAgaWYgKHNldHRpbmdOYW1lID09PSBcImludGVncmF0aW9uUHJvdmlzaW9uaW5nXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLmdldFNldHRpbmdzKElOVEVHX1BST1ZJU0lPTklOR19FVkVOVF9UWVBFKTtcbiAgICAgICAgICAgIHJldHVybiBjb250ZW50ID8gY29udGVudFsnZW5hYmxlZCddIDogbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzZXR0aW5nTmFtZSA9PT0gXCJwc2V1ZG9ueW1vdXNBbmFseXRpY3NPcHRJblwiKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gdGhpcy5nZXRTZXR0aW5ncyhBTkFMWVRJQ1NfRVZFTlRfVFlQRSkgfHwge307XG4gICAgICAgICAgICAvLyBDaGVjayB0byBtYWtlIHN1cmUgdGhhdCB3ZSBhY3R1YWxseSBnb3QgYSBib29sZWFuXG4gICAgICAgICAgICBpZiAodHlwZW9mKGNvbnRlbnRbc2V0dGluZ05hbWVdKSAhPT0gXCJib29sZWFuXCIpIHJldHVybiBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnRbc2V0dGluZ05hbWVdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNldHRpbmdOYW1lID09PSBcIk1lc3NhZ2VDb21wb3NlcklucHV0Lmluc2VydFRyYWlsaW5nQ29sb25cIikge1xuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IHRoaXMuZ2V0U2V0dGluZ3MoKSB8fCB7fTtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gY29udGVudFtzZXR0aW5nTmFtZV07XG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIC8vIFdyaXRlIHRydWUgYXMgaXQgaXMgdGhlIGRlZmF1bHQuIFRoaXMgd2lsbCBnaXZlIHVzIHRoZSBvcHRpb25cbiAgICAgICAgICAgICAgICAvLyBvZiBtYWtpbmcgdGhpcyBvcHQtaW4gaW4gdGhlIGZ1dHVyZSwgd2l0aG91dCBhZmZlY3Rpbmcgb2xkXG4gICAgICAgICAgICAgICAgLy8gdXNlcnNcbiAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlKHNldHRpbmdOYW1lLCByb29tSWQsIHRydWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLmdldFNldHRpbmdzKCkgfHwge307XG4gICAgICAgIGxldCBwcmVmZXJyZWRWYWx1ZSA9IHNldHRpbmdzW3NldHRpbmdOYW1lXTtcblxuICAgICAgICBpZiAocHJlZmVycmVkVmFsdWUgPT09IG51bGwgfHwgcHJlZmVycmVkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gSG9ub3VyIHRoZSBvbGQgc2V0dGluZyBvbiByZWFkIG9ubHlcbiAgICAgICAgICAgIGlmIChzZXR0aW5nTmFtZSA9PT0gXCJoaWRlQXZhdGFyQ2hhbmdlc1wiIHx8IHNldHRpbmdOYW1lID09PSBcImhpZGVEaXNwbGF5bmFtZUNoYW5nZXNcIikge1xuICAgICAgICAgICAgICAgIHByZWZlcnJlZFZhbHVlID0gc2V0dGluZ3NbXCJoaWRlQXZhdGFyRGlzcGxheW5hbWVDaGFuZ2VzXCJdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHByZWZlcnJlZFZhbHVlO1xuICAgIH1cblxuICAgIC8vIGhlbHBlciBmdW5jdGlvbiB0byBzZXQgYWNjb3VudCBkYXRhIHRoZW4gYXdhaXQgaXQgYmVpbmcgZWNob2VkIGJhY2tcbiAgICBwcml2YXRlIGFzeW5jIHNldEFjY291bnREYXRhKFxuICAgICAgICBldmVudFR5cGU6IHN0cmluZyxcbiAgICAgICAgZmllbGQ6IHN0cmluZyxcbiAgICAgICAgdmFsdWU6IGFueSxcbiAgICAgICAgbGVnYWN5RXZlbnRUeXBlPzogc3RyaW5nLFxuICAgICk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBsZXQgY29udGVudCA9IHRoaXMuZ2V0U2V0dGluZ3MoZXZlbnRUeXBlKTtcbiAgICAgICAgaWYgKGxlZ2FjeUV2ZW50VHlwZSAmJiAhY29udGVudD8uW2ZpZWxkXSkge1xuICAgICAgICAgICAgY29udGVudCA9IHRoaXMuZ2V0U2V0dGluZ3MobGVnYWN5RXZlbnRUeXBlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY29udGVudCkge1xuICAgICAgICAgICAgY29udGVudCA9IHt9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29udGVudFtmaWVsZF0gPSB2YWx1ZTtcblxuICAgICAgICAvLyBBdHRhY2ggYSBkZWZlcnJlZCAqYmVmb3JlKiBzZXR0aW5nIHRoZSBhY2NvdW50IGRhdGEgdG8gZW5zdXJlIHdlIGNhdGNoIGFueSByZXF1ZXN0c1xuICAgICAgICAvLyB3aGljaCByYWNlIGJldHdlZW4gZGlmZmVyZW50IGxpbmVzLlxuICAgICAgICBjb25zdCBkZWZlcnJlZCA9IGRlZmVyPHZvaWQ+KCk7XG4gICAgICAgIGNvbnN0IGhhbmRsZXIgPSAoZXZlbnQ6IE1hdHJpeEV2ZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXZlbnQuZ2V0VHlwZSgpICE9PSBldmVudFR5cGUgfHwgZXZlbnQuZ2V0Q29udGVudCgpW2ZpZWxkXSAhPT0gdmFsdWUpIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMuY2xpZW50Lm9mZihDbGllbnRFdmVudC5BY2NvdW50RGF0YSwgaGFuZGxlcik7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2xpZW50Lm9uKENsaWVudEV2ZW50LkFjY291bnREYXRhLCBoYW5kbGVyKTtcblxuICAgICAgICBhd2FpdCB0aGlzLmNsaWVudC5zZXRBY2NvdW50RGF0YShldmVudFR5cGUsIGNvbnRlbnQpO1xuXG4gICAgICAgIGF3YWl0IGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgcHVibGljIHNldFZhbHVlKHNldHRpbmdOYW1lOiBzdHJpbmcsIHJvb21JZDogc3RyaW5nLCBuZXdWYWx1ZTogYW55KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHN3aXRjaCAoc2V0dGluZ05hbWUpIHtcbiAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBVUkwgcHJldmlld3NcbiAgICAgICAgICAgIGNhc2UgXCJ1cmxQcmV2aWV3c0VuYWJsZWRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXRBY2NvdW50RGF0YShcIm9yZy5tYXRyaXgucHJldmlld191cmxzXCIsIFwiZGlzYWJsZVwiLCAhbmV3VmFsdWUpO1xuXG4gICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UgZm9yIGJyZWFkY3J1bWJzXG4gICAgICAgICAgICBjYXNlIFwiYnJlYWRjcnVtYl9yb29tc1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldEFjY291bnREYXRhKFxuICAgICAgICAgICAgICAgICAgICBCUkVBRENSVU1CU19FVkVOVF9UWVBFLFxuICAgICAgICAgICAgICAgICAgICBcInJlY2VudF9yb29tc1wiLFxuICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgQlJFQURDUlVNQlNfTEVHQUNZX0VWRU5UX1RZUEUsXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy8gU3BlY2lhbCBjYXNlIHJlY2VudCBlbW9qaVxuICAgICAgICAgICAgY2FzZSBcInJlY2VudF9lbW9qaVwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldEFjY291bnREYXRhKFJFQ0VOVF9FTU9KSV9FVkVOVF9UWVBFLCBcInJlY2VudF9lbW9qaVwiLCBuZXdWYWx1ZSk7XG5cbiAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBpbnRlZ3JhdGlvbiBtYW5hZ2VyIHByb3Zpc2lvbmluZ1xuICAgICAgICAgICAgY2FzZSBcImludGVncmF0aW9uUHJvdmlzaW9uaW5nXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2V0QWNjb3VudERhdGEoSU5URUdfUFJPVklTSU9OSU5HX0VWRU5UX1RZUEUsIFwiZW5hYmxlZFwiLCBuZXdWYWx1ZSk7XG5cbiAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBhbmFseXRpY3NcbiAgICAgICAgICAgIGNhc2UgXCJwc2V1ZG9ueW1vdXNBbmFseXRpY3NPcHRJblwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldEFjY291bnREYXRhKEFOQUxZVElDU19FVkVOVF9UWVBFLCBcInBzZXVkb255bW91c0FuYWx5dGljc09wdEluXCIsIG5ld1ZhbHVlKTtcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXRBY2NvdW50RGF0YShERUZBVUxUX1NFVFRJTkdTX0VWRU5UX1RZUEUsIHNldHRpbmdOYW1lLCBuZXdWYWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgY2FuU2V0VmFsdWUoc2V0dGluZ05hbWU6IHN0cmluZywgcm9vbUlkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRydWU7IC8vIEl0J3MgdGhlaXIgYWNjb3VudCwgc28gdGhleSBzaG91bGQgYmUgYWJsZSB0b1xuICAgIH1cblxuICAgIHB1YmxpYyBpc1N1cHBvcnRlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50ICYmICF0aGlzLmNsaWVudC5pc0d1ZXN0KCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRTZXR0aW5ncyhldmVudFR5cGUgPSBcImltLnZlY3Rvci53ZWIuc2V0dGluZ3NcIik6IGFueSB7IC8vIFRPRE86IFtUU10gVHlwZXMgb24gcmV0dXJuXG4gICAgICAgIGlmICghdGhpcy5jbGllbnQpIHJldHVybiBudWxsO1xuXG4gICAgICAgIGNvbnN0IGV2ZW50ID0gdGhpcy5jbGllbnQuZ2V0QWNjb3VudERhdGEoZXZlbnRUeXBlKTtcbiAgICAgICAgaWYgKCFldmVudCB8fCAhZXZlbnQuZ2V0Q29udGVudCgpKSByZXR1cm4gbnVsbDtcbiAgICAgICAgcmV0dXJuIG9iamVjdENsb25lKGV2ZW50LmdldENvbnRlbnQoKSk7IC8vIGNsb25lIHRvIHByZXZlbnQgbXV0YXRpb25cbiAgICB9XG5cbiAgICBwcml2YXRlIG5vdGlmeUJyZWFkY3J1bWJzVXBkYXRlKGV2ZW50OiBNYXRyaXhFdmVudCkge1xuICAgICAgICBsZXQgdmFsID0gW107XG4gICAgICAgIGlmIChldmVudC5nZXRUeXBlKCkgPT09IEJSRUFEQ1JVTUJTX0xFR0FDWV9FVkVOVF9UWVBFKSB7XG4gICAgICAgICAgICAvLyBUaGlzIHNlZW1zIGZpc2h5IC0gdHJ5IGFuZCBnZXQgdGhlIGV2ZW50IGZvciB0aGUgbmV3IHJvb21zXG4gICAgICAgICAgICBjb25zdCBuZXdUeXBlID0gdGhpcy5nZXRTZXR0aW5ncyhCUkVBRENSVU1CU19FVkVOVF9UWVBFKTtcbiAgICAgICAgICAgIGlmIChuZXdUeXBlKSB2YWwgPSBuZXdUeXBlWydyZWNlbnRfcm9vbXMnXTtcbiAgICAgICAgICAgIGVsc2UgdmFsID0gZXZlbnQuZ2V0Q29udGVudCgpWydyb29tcyddO1xuICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmdldFR5cGUoKSA9PT0gQlJFQURDUlVNQlNfRVZFTlRfVFlQRSkge1xuICAgICAgICAgICAgdmFsID0gZXZlbnQuZ2V0Q29udGVudCgpWydyZWNlbnRfcm9vbXMnXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybjsgLy8gZm9yIHNhbml0eSwgbm90IGJlY2F1c2Ugd2UgZXhwZWN0IHRvIGJlIGhlcmUuXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy53YXRjaGVycy5ub3RpZnlVcGRhdGUoXCJicmVhZGNydW1iX3Jvb21zXCIsIG51bGwsIFNldHRpbmdMZXZlbC5BQ0NPVU5ULCB2YWwgfHwgW10pO1xuICAgIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpQkE7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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
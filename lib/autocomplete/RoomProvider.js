"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _lodash = require("lodash");

var _languageHandler = require("../languageHandler");

var _AutocompleteProvider = _interopRequireDefault(require("./AutocompleteProvider"));

var _MatrixClientPeg = require("../MatrixClientPeg");

var _QueryMatcher = _interopRequireDefault(require("./QueryMatcher"));

var _Components = require("./Components");

var _Permalinks = require("../utils/permalinks/Permalinks");

var _RoomAvatar = _interopRequireDefault(require("../components/views/avatars/RoomAvatar"));

/*
Copyright 2016 Aviral Dasgupta
Copyright 2018 Michael Telatynski <7t3chguy@gmail.com>
Copyright 2017, 2018, 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const ROOM_REGEX = /\B#\S*/g; // Prefer canonical aliases over non-canonical ones

function canonicalScore(displayedAlias, room) {
  return displayedAlias === room.getCanonicalAlias() ? 0 : 1;
}

function matcherObject(room, displayedAlias) {
  let matchName = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "";
  return {
    room,
    matchName,
    displayedAlias
  };
}

class RoomProvider extends _AutocompleteProvider.default {
  constructor(room, renderingType) {
    super({
      commandRegex: ROOM_REGEX,
      renderingType
    });
    (0, _defineProperty2.default)(this, "matcher", void 0);
    this.matcher = new _QueryMatcher.default([], {
      keys: ['displayedAlias', 'matchName']
    });
  }

  getRooms() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get(); // filter out spaces here as they get their own autocomplete provider


    return cli.getVisibleRooms().filter(r => !r.isSpaceRoom());
  }

  async getCompletions(query, selection) {
    let force = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    let limit = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : -1;
    let completions = [];
    const {
      command,
      range
    } = this.getCurrentCommand(query, selection, force);

    if (command) {
      // the only reason we need to do this is because Fuse only matches on properties
      let matcherObjects = this.getRooms().reduce((aliases, room) => {
        if (room.getCanonicalAlias()) {
          aliases = aliases.concat(matcherObject(room, room.getCanonicalAlias(), room.name));
        }

        if (room.getAltAliases().length) {
          const altAliases = room.getAltAliases().map(alias => matcherObject(room, alias));
          aliases = aliases.concat(altAliases);
        }

        return aliases;
      }, []); // Filter out any matches where the user will have also autocompleted new rooms

      matcherObjects = matcherObjects.filter(r => {
        const tombstone = r.room.currentState.getStateEvents("m.room.tombstone", "");

        if (tombstone && tombstone.getContent() && tombstone.getContent()['replacement_room']) {
          const hasReplacementRoom = matcherObjects.some(r2 => r2.room.roomId === tombstone.getContent()['replacement_room']);
          return !hasReplacementRoom;
        }

        return true;
      });
      this.matcher.setObjects(matcherObjects);
      const matchedString = command[0];
      completions = this.matcher.match(matchedString, limit);
      completions = (0, _lodash.sortBy)(completions, [c => canonicalScore(c.displayedAlias, c.room), c => c.displayedAlias.length]);
      completions = (0, _lodash.uniqBy)(completions, match => match.room);
      completions = completions.map(room => {
        return {
          completion: room.displayedAlias,
          completionId: room.room.roomId,
          type: "room",
          suffix: ' ',
          href: (0, _Permalinks.makeRoomPermalink)(room.displayedAlias),
          component: /*#__PURE__*/_react.default.createElement(_Components.PillCompletion, {
            title: room.room.name,
            description: room.displayedAlias
          }, /*#__PURE__*/_react.default.createElement(_RoomAvatar.default, {
            width: 24,
            height: 24,
            room: room.room
          })),
          range
        };
      }).filter(completion => !!completion.completion && completion.completion.length > 0);
    }

    return completions;
  }

  getName() {
    return (0, _languageHandler._t)('Rooms');
  }

  renderCompletions(completions) {
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Autocomplete_Completion_container_pill mx_Autocomplete_Completion_container_truncate",
      role: "presentation",
      "aria-label": (0, _languageHandler._t)("Room Autocomplete")
    }, completions);
  }

}

exports.default = RoomProvider;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJST09NX1JFR0VYIiwiY2Fub25pY2FsU2NvcmUiLCJkaXNwbGF5ZWRBbGlhcyIsInJvb20iLCJnZXRDYW5vbmljYWxBbGlhcyIsIm1hdGNoZXJPYmplY3QiLCJtYXRjaE5hbWUiLCJSb29tUHJvdmlkZXIiLCJBdXRvY29tcGxldGVQcm92aWRlciIsImNvbnN0cnVjdG9yIiwicmVuZGVyaW5nVHlwZSIsImNvbW1hbmRSZWdleCIsIm1hdGNoZXIiLCJRdWVyeU1hdGNoZXIiLCJrZXlzIiwiZ2V0Um9vbXMiLCJjbGkiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJnZXRWaXNpYmxlUm9vbXMiLCJmaWx0ZXIiLCJyIiwiaXNTcGFjZVJvb20iLCJnZXRDb21wbGV0aW9ucyIsInF1ZXJ5Iiwic2VsZWN0aW9uIiwiZm9yY2UiLCJsaW1pdCIsImNvbXBsZXRpb25zIiwiY29tbWFuZCIsInJhbmdlIiwiZ2V0Q3VycmVudENvbW1hbmQiLCJtYXRjaGVyT2JqZWN0cyIsInJlZHVjZSIsImFsaWFzZXMiLCJjb25jYXQiLCJuYW1lIiwiZ2V0QWx0QWxpYXNlcyIsImxlbmd0aCIsImFsdEFsaWFzZXMiLCJtYXAiLCJhbGlhcyIsInRvbWJzdG9uZSIsImN1cnJlbnRTdGF0ZSIsImdldFN0YXRlRXZlbnRzIiwiZ2V0Q29udGVudCIsImhhc1JlcGxhY2VtZW50Um9vbSIsInNvbWUiLCJyMiIsInJvb21JZCIsInNldE9iamVjdHMiLCJtYXRjaGVkU3RyaW5nIiwibWF0Y2giLCJzb3J0QnkiLCJjIiwidW5pcUJ5IiwiY29tcGxldGlvbiIsImNvbXBsZXRpb25JZCIsInR5cGUiLCJzdWZmaXgiLCJocmVmIiwibWFrZVJvb21QZXJtYWxpbmsiLCJjb21wb25lbnQiLCJnZXROYW1lIiwiX3QiLCJyZW5kZXJDb21wbGV0aW9ucyJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hdXRvY29tcGxldGUvUm9vbVByb3ZpZGVyLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTYgQXZpcmFsIERhc2d1cHRhXG5Db3B5cmlnaHQgMjAxOCBNaWNoYWVsIFRlbGF0eW5za2kgPDd0M2NoZ3V5QGdtYWlsLmNvbT5cbkNvcHlyaWdodCAyMDE3LCAyMDE4LCAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgc29ydEJ5LCB1bmlxQnkgfSBmcm9tIFwibG9kYXNoXCI7XG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tXCI7XG5cbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCBBdXRvY29tcGxldGVQcm92aWRlciBmcm9tICcuL0F1dG9jb21wbGV0ZVByb3ZpZGVyJztcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gJy4uL01hdHJpeENsaWVudFBlZyc7XG5pbXBvcnQgUXVlcnlNYXRjaGVyIGZyb20gJy4vUXVlcnlNYXRjaGVyJztcbmltcG9ydCB7IFBpbGxDb21wbGV0aW9uIH0gZnJvbSAnLi9Db21wb25lbnRzJztcbmltcG9ydCB7IG1ha2VSb29tUGVybWFsaW5rIH0gZnJvbSBcIi4uL3V0aWxzL3Blcm1hbGlua3MvUGVybWFsaW5rc1wiO1xuaW1wb3J0IHsgSUNvbXBsZXRpb24sIElTZWxlY3Rpb25SYW5nZSB9IGZyb20gXCIuL0F1dG9jb21wbGV0ZXJcIjtcbmltcG9ydCBSb29tQXZhdGFyIGZyb20gJy4uL2NvbXBvbmVudHMvdmlld3MvYXZhdGFycy9Sb29tQXZhdGFyJztcbmltcG9ydCB7IFRpbWVsaW5lUmVuZGVyaW5nVHlwZSB9IGZyb20gXCIuLi9jb250ZXh0cy9Sb29tQ29udGV4dFwiO1xuXG5jb25zdCBST09NX1JFR0VYID0gL1xcQiNcXFMqL2c7XG5cbi8vIFByZWZlciBjYW5vbmljYWwgYWxpYXNlcyBvdmVyIG5vbi1jYW5vbmljYWwgb25lc1xuZnVuY3Rpb24gY2Fub25pY2FsU2NvcmUoZGlzcGxheWVkQWxpYXM6IHN0cmluZywgcm9vbTogUm9vbSk6IG51bWJlciB7XG4gICAgcmV0dXJuIGRpc3BsYXllZEFsaWFzID09PSByb29tLmdldENhbm9uaWNhbEFsaWFzKCkgPyAwIDogMTtcbn1cblxuZnVuY3Rpb24gbWF0Y2hlck9iamVjdChyb29tOiBSb29tLCBkaXNwbGF5ZWRBbGlhczogc3RyaW5nLCBtYXRjaE5hbWUgPSBcIlwiKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcm9vbSxcbiAgICAgICAgbWF0Y2hOYW1lLFxuICAgICAgICBkaXNwbGF5ZWRBbGlhcyxcbiAgICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSb29tUHJvdmlkZXIgZXh0ZW5kcyBBdXRvY29tcGxldGVQcm92aWRlciB7XG4gICAgcHJvdGVjdGVkIG1hdGNoZXI6IFF1ZXJ5TWF0Y2hlcjxSb29tPjtcblxuICAgIGNvbnN0cnVjdG9yKHJvb206IFJvb20sIHJlbmRlcmluZ1R5cGU/OiBUaW1lbGluZVJlbmRlcmluZ1R5cGUpIHtcbiAgICAgICAgc3VwZXIoeyBjb21tYW5kUmVnZXg6IFJPT01fUkVHRVgsIHJlbmRlcmluZ1R5cGUgfSk7XG4gICAgICAgIHRoaXMubWF0Y2hlciA9IG5ldyBRdWVyeU1hdGNoZXIoW10sIHtcbiAgICAgICAgICAgIGtleXM6IFsnZGlzcGxheWVkQWxpYXMnLCAnbWF0Y2hOYW1lJ10sXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXRSb29tcygpIHtcbiAgICAgICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuXG4gICAgICAgIC8vIGZpbHRlciBvdXQgc3BhY2VzIGhlcmUgYXMgdGhleSBnZXQgdGhlaXIgb3duIGF1dG9jb21wbGV0ZSBwcm92aWRlclxuICAgICAgICByZXR1cm4gY2xpLmdldFZpc2libGVSb29tcygpLmZpbHRlcihyID0+ICFyLmlzU3BhY2VSb29tKCkpO1xuICAgIH1cblxuICAgIGFzeW5jIGdldENvbXBsZXRpb25zKFxuICAgICAgICBxdWVyeTogc3RyaW5nLFxuICAgICAgICBzZWxlY3Rpb246IElTZWxlY3Rpb25SYW5nZSxcbiAgICAgICAgZm9yY2UgPSBmYWxzZSxcbiAgICAgICAgbGltaXQgPSAtMSxcbiAgICApOiBQcm9taXNlPElDb21wbGV0aW9uW10+IHtcbiAgICAgICAgbGV0IGNvbXBsZXRpb25zID0gW107XG4gICAgICAgIGNvbnN0IHsgY29tbWFuZCwgcmFuZ2UgfSA9IHRoaXMuZ2V0Q3VycmVudENvbW1hbmQocXVlcnksIHNlbGVjdGlvbiwgZm9yY2UpO1xuICAgICAgICBpZiAoY29tbWFuZCkge1xuICAgICAgICAgICAgLy8gdGhlIG9ubHkgcmVhc29uIHdlIG5lZWQgdG8gZG8gdGhpcyBpcyBiZWNhdXNlIEZ1c2Ugb25seSBtYXRjaGVzIG9uIHByb3BlcnRpZXNcbiAgICAgICAgICAgIGxldCBtYXRjaGVyT2JqZWN0cyA9IHRoaXMuZ2V0Um9vbXMoKS5yZWR1Y2UoKGFsaWFzZXMsIHJvb20pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocm9vbS5nZXRDYW5vbmljYWxBbGlhcygpKSB7XG4gICAgICAgICAgICAgICAgICAgIGFsaWFzZXMgPSBhbGlhc2VzLmNvbmNhdChtYXRjaGVyT2JqZWN0KHJvb20sIHJvb20uZ2V0Q2Fub25pY2FsQWxpYXMoKSwgcm9vbS5uYW1lKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyb29tLmdldEFsdEFsaWFzZXMoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWx0QWxpYXNlcyA9IHJvb20uZ2V0QWx0QWxpYXNlcygpLm1hcChhbGlhcyA9PiBtYXRjaGVyT2JqZWN0KHJvb20sIGFsaWFzKSk7XG4gICAgICAgICAgICAgICAgICAgIGFsaWFzZXMgPSBhbGlhc2VzLmNvbmNhdChhbHRBbGlhc2VzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFsaWFzZXM7XG4gICAgICAgICAgICB9LCBbXSk7XG4gICAgICAgICAgICAvLyBGaWx0ZXIgb3V0IGFueSBtYXRjaGVzIHdoZXJlIHRoZSB1c2VyIHdpbGwgaGF2ZSBhbHNvIGF1dG9jb21wbGV0ZWQgbmV3IHJvb21zXG4gICAgICAgICAgICBtYXRjaGVyT2JqZWN0cyA9IG1hdGNoZXJPYmplY3RzLmZpbHRlcigocikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRvbWJzdG9uZSA9IHIucm9vbS5jdXJyZW50U3RhdGUuZ2V0U3RhdGVFdmVudHMoXCJtLnJvb20udG9tYnN0b25lXCIsIFwiXCIpO1xuICAgICAgICAgICAgICAgIGlmICh0b21ic3RvbmUgJiYgdG9tYnN0b25lLmdldENvbnRlbnQoKSAmJiB0b21ic3RvbmUuZ2V0Q29udGVudCgpWydyZXBsYWNlbWVudF9yb29tJ10pIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzUmVwbGFjZW1lbnRSb29tID0gbWF0Y2hlck9iamVjdHMuc29tZShcbiAgICAgICAgICAgICAgICAgICAgICAgIChyMikgPT4gcjIucm9vbS5yb29tSWQgPT09IHRvbWJzdG9uZS5nZXRDb250ZW50KClbJ3JlcGxhY2VtZW50X3Jvb20nXSxcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFoYXNSZXBsYWNlbWVudFJvb207XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMubWF0Y2hlci5zZXRPYmplY3RzKG1hdGNoZXJPYmplY3RzKTtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoZWRTdHJpbmcgPSBjb21tYW5kWzBdO1xuICAgICAgICAgICAgY29tcGxldGlvbnMgPSB0aGlzLm1hdGNoZXIubWF0Y2gobWF0Y2hlZFN0cmluZywgbGltaXQpO1xuICAgICAgICAgICAgY29tcGxldGlvbnMgPSBzb3J0QnkoY29tcGxldGlvbnMsIFtcbiAgICAgICAgICAgICAgICAoYykgPT4gY2Fub25pY2FsU2NvcmUoYy5kaXNwbGF5ZWRBbGlhcywgYy5yb29tKSxcbiAgICAgICAgICAgICAgICAoYykgPT4gYy5kaXNwbGF5ZWRBbGlhcy5sZW5ndGgsXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIGNvbXBsZXRpb25zID0gdW5pcUJ5KGNvbXBsZXRpb25zLCAobWF0Y2gpID0+IG1hdGNoLnJvb20pO1xuICAgICAgICAgICAgY29tcGxldGlvbnMgPSBjb21wbGV0aW9ucy5tYXAoKHJvb20pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBjb21wbGV0aW9uOiByb29tLmRpc3BsYXllZEFsaWFzLFxuICAgICAgICAgICAgICAgICAgICBjb21wbGV0aW9uSWQ6IHJvb20ucm9vbS5yb29tSWQsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwicm9vbVwiLFxuICAgICAgICAgICAgICAgICAgICBzdWZmaXg6ICcgJyxcbiAgICAgICAgICAgICAgICAgICAgaHJlZjogbWFrZVJvb21QZXJtYWxpbmsocm9vbS5kaXNwbGF5ZWRBbGlhcyksXG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudDogKFxuICAgICAgICAgICAgICAgICAgICAgICAgPFBpbGxDb21wbGV0aW9uIHRpdGxlPXtyb29tLnJvb20ubmFtZX0gZGVzY3JpcHRpb249e3Jvb20uZGlzcGxheWVkQWxpYXN9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxSb29tQXZhdGFyIHdpZHRoPXsyNH0gaGVpZ2h0PXsyNH0gcm9vbT17cm9vbS5yb29tfSAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9QaWxsQ29tcGxldGlvbj5cbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2UsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pLmZpbHRlcigoY29tcGxldGlvbikgPT4gISFjb21wbGV0aW9uLmNvbXBsZXRpb24gJiYgY29tcGxldGlvbi5jb21wbGV0aW9uLmxlbmd0aCA+IDApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb21wbGV0aW9ucztcbiAgICB9XG5cbiAgICBnZXROYW1lKCkge1xuICAgICAgICByZXR1cm4gX3QoJ1Jvb21zJyk7XG4gICAgfVxuXG4gICAgcmVuZGVyQ29tcGxldGlvbnMoY29tcGxldGlvbnM6IFJlYWN0LlJlYWN0Tm9kZVtdKTogUmVhY3QuUmVhY3ROb2RlIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9BdXRvY29tcGxldGVfQ29tcGxldGlvbl9jb250YWluZXJfcGlsbCBteF9BdXRvY29tcGxldGVfQ29tcGxldGlvbl9jb250YWluZXJfdHJ1bmNhdGVcIlxuICAgICAgICAgICAgICAgIHJvbGU9XCJwcmVzZW50YXRpb25cIlxuICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e190KFwiUm9vbSBBdXRvY29tcGxldGVcIil9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgeyBjb21wbGV0aW9ucyB9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBa0JBOztBQUNBOztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQTdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBZ0JBLE1BQU1BLFVBQVUsR0FBRyxTQUFuQixDLENBRUE7O0FBQ0EsU0FBU0MsY0FBVCxDQUF3QkMsY0FBeEIsRUFBZ0RDLElBQWhELEVBQW9FO0VBQ2hFLE9BQU9ELGNBQWMsS0FBS0MsSUFBSSxDQUFDQyxpQkFBTCxFQUFuQixHQUE4QyxDQUE5QyxHQUFrRCxDQUF6RDtBQUNIOztBQUVELFNBQVNDLGFBQVQsQ0FBdUJGLElBQXZCLEVBQW1DRCxjQUFuQyxFQUEyRTtFQUFBLElBQWhCSSxTQUFnQix1RUFBSixFQUFJO0VBQ3ZFLE9BQU87SUFDSEgsSUFERztJQUVIRyxTQUZHO0lBR0hKO0VBSEcsQ0FBUDtBQUtIOztBQUVjLE1BQU1LLFlBQU4sU0FBMkJDLDZCQUEzQixDQUFnRDtFQUczREMsV0FBVyxDQUFDTixJQUFELEVBQWFPLGFBQWIsRUFBb0Q7SUFDM0QsTUFBTTtNQUFFQyxZQUFZLEVBQUVYLFVBQWhCO01BQTRCVTtJQUE1QixDQUFOO0lBRDJEO0lBRTNELEtBQUtFLE9BQUwsR0FBZSxJQUFJQyxxQkFBSixDQUFpQixFQUFqQixFQUFxQjtNQUNoQ0MsSUFBSSxFQUFFLENBQUMs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
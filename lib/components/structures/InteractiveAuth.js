"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ERROR_USER_CANCELLED = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _interactiveAuth = require("matrix-js-sdk/src/interactive-auth");

var _react = _interopRequireWildcard(require("react"));

var _logger = require("matrix-js-sdk/src/logger");

var _InteractiveAuthEntryComponents = _interopRequireDefault(require("../views/auth/InteractiveAuthEntryComponents"));

var _Spinner = _interopRequireDefault(require("../views/elements/Spinner"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2017 - 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const ERROR_USER_CANCELLED = new Error("User cancelled auth session");
exports.ERROR_USER_CANCELLED = ERROR_USER_CANCELLED;

class InteractiveAuthComponent extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "authLogic", void 0);
    (0, _defineProperty2.default)(this, "intervalId", null);
    (0, _defineProperty2.default)(this, "stageComponent", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "unmounted", false);
    (0, _defineProperty2.default)(this, "requestEmailToken", async (email, secret, attempt, session) => {
      this.setState({
        busy: true
      });

      try {
        return await this.props.requestEmailToken(email, secret, attempt, session);
      } finally {
        this.setState({
          busy: false
        });
      }
    });
    (0, _defineProperty2.default)(this, "authStateUpdated", (stageType, stageState) => {
      const oldStage = this.state.authStage;
      this.setState({
        busy: false,
        authStage: stageType,
        stageState: stageState,
        errorText: stageState.error,
        errorCode: stageState.errcode
      }, () => {
        if (oldStage !== stageType) {
          this.setFocus();
        } else if (!stageState.error) {
          this.stageComponent.current?.attemptFailed?.();
        }
      });
    });
    (0, _defineProperty2.default)(this, "requestCallback", (auth, background) => {
      // This wrapper just exists because the js-sdk passes a second
      // 'busy' param for backwards compat. This throws the tests off
      // so discard it here.
      return this.props.makeRequest(auth);
    });
    (0, _defineProperty2.default)(this, "onBusyChanged", busy => {
      // if we've started doing stuff, reset the error messages
      if (busy) {
        this.setState({
          busy: true,
          errorText: null,
          errorCode: null
        });
      } // The JS SDK eagerly reports itself as "not busy" right after any
      // immediate work has completed, but that's not really what we want at
      // the UI layer, so we ignore this signal and show a spinner until
      // there's a new screen to show the user. This is implemented by setting
      // `busy: false` in `authStateUpdated`.
      // See also https://github.com/vector-im/element-web/issues/12546

    });
    (0, _defineProperty2.default)(this, "submitAuthDict", authData => {
      this.authLogic.submitAuthDict(authData);
    });
    (0, _defineProperty2.default)(this, "onPhaseChange", newPhase => {
      this.props.onStagePhaseChange?.(this.state.authStage, newPhase || 0);
    });
    (0, _defineProperty2.default)(this, "onStageCancel", () => {
      this.props.onAuthFinished(false, ERROR_USER_CANCELLED);
    });
    (0, _defineProperty2.default)(this, "onAuthStageFailed", e => {
      this.props.onAuthFinished(false, e);
    });
    (0, _defineProperty2.default)(this, "setEmailSid", sid => {
      this.authLogic.setEmailSid(sid);
    });
    this.state = {
      authStage: null,
      busy: false,
      errorText: null,
      errorCode: null,
      submitButtonEnabled: false
    };
    this.authLogic = new _interactiveAuth.InteractiveAuth({
      authData: this.props.authData,
      doRequest: this.requestCallback,
      busyChanged: this.onBusyChanged,
      inputs: this.props.inputs,
      stateUpdated: this.authStateUpdated,
      matrixClient: this.props.matrixClient,
      sessionId: this.props.sessionId,
      clientSecret: this.props.clientSecret,
      emailSid: this.props.emailSid,
      requestEmailToken: this.requestEmailToken
    });

    if (this.props.poll) {
      this.intervalId = setInterval(() => {
        this.authLogic.poll();
      }, 2000);
    }
  } // TODO: [REACT-WARNING] Replace component with real class, use constructor for refs


  UNSAFE_componentWillMount() {
    // eslint-disable-line @typescript-eslint/naming-convention, camelcase
    this.authLogic.attemptAuth().then(result => {
      const extra = {
        emailSid: this.authLogic.getEmailSid(),
        clientSecret: this.authLogic.getClientSecret()
      };
      this.props.onAuthFinished(true, result, extra);
    }).catch(error => {
      this.props.onAuthFinished(false, error);

      _logger.logger.error("Error during user-interactive auth:", error);

      if (this.unmounted) {
        return;
      }

      const msg = error.message || error.toString();
      this.setState({
        errorText: msg,
        errorCode: error.errcode
      });
    });
  }

  componentWillUnmount() {
    this.unmounted = true;

    if (this.intervalId !== null) {
      clearInterval(this.intervalId);
    }
  }

  setFocus() {
    this.stageComponent.current?.focus?.();
  }

  render() {
    const stage = this.state.authStage;

    if (!stage) {
      if (this.state.busy) {
        return /*#__PURE__*/_react.default.createElement(_Spinner.default, null);
      } else {
        return null;
      }
    }

    const StageComponent = (0, _InteractiveAuthEntryComponents.default)(stage);
    return /*#__PURE__*/_react.default.createElement(StageComponent, {
      ref: this.stageComponent,
      loginType: stage,
      matrixClient: this.props.matrixClient,
      authSessionId: this.authLogic.getSessionId(),
      clientSecret: this.authLogic.getClientSecret(),
      stageParams: this.authLogic.getStageParams(stage),
      submitAuthDict: this.submitAuthDict,
      errorText: this.state.errorText,
      errorCode: this.state.errorCode,
      busy: this.state.busy,
      inputs: this.props.inputs,
      stageState: this.state.stageState,
      fail: this.onAuthStageFailed,
      setEmailSid: this.setEmailSid,
      showContinue: !this.props.continueIsManaged,
      onPhaseChange: this.onPhaseChange,
      requestEmailToken: this.authLogic.requestEmailToken,
      continueText: this.props.continueText,
      continueKind: this.props.continueKind,
      onCancel: this.onStageCancel
    });
  }

}

exports.default = InteractiveAuthComponent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFUlJPUl9VU0VSX0NBTkNFTExFRCIsIkVycm9yIiwiSW50ZXJhY3RpdmVBdXRoQ29tcG9uZW50IiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiY3JlYXRlUmVmIiwiZW1haWwiLCJzZWNyZXQiLCJhdHRlbXB0Iiwic2Vzc2lvbiIsInNldFN0YXRlIiwiYnVzeSIsInJlcXVlc3RFbWFpbFRva2VuIiwic3RhZ2VUeXBlIiwic3RhZ2VTdGF0ZSIsIm9sZFN0YWdlIiwic3RhdGUiLCJhdXRoU3RhZ2UiLCJlcnJvclRleHQiLCJlcnJvciIsImVycm9yQ29kZSIsImVycmNvZGUiLCJzZXRGb2N1cyIsInN0YWdlQ29tcG9uZW50IiwiY3VycmVudCIsImF0dGVtcHRGYWlsZWQiLCJhdXRoIiwiYmFja2dyb3VuZCIsIm1ha2VSZXF1ZXN0IiwiYXV0aERhdGEiLCJhdXRoTG9naWMiLCJzdWJtaXRBdXRoRGljdCIsIm5ld1BoYXNlIiwib25TdGFnZVBoYXNlQ2hhbmdlIiwib25BdXRoRmluaXNoZWQiLCJlIiwic2lkIiwic2V0RW1haWxTaWQiLCJzdWJtaXRCdXR0b25FbmFibGVkIiwiSW50ZXJhY3RpdmVBdXRoIiwiZG9SZXF1ZXN0IiwicmVxdWVzdENhbGxiYWNrIiwiYnVzeUNoYW5nZWQiLCJvbkJ1c3lDaGFuZ2VkIiwiaW5wdXRzIiwic3RhdGVVcGRhdGVkIiwiYXV0aFN0YXRlVXBkYXRlZCIsIm1hdHJpeENsaWVudCIsInNlc3Npb25JZCIsImNsaWVudFNlY3JldCIsImVtYWlsU2lkIiwicG9sbCIsImludGVydmFsSWQiLCJzZXRJbnRlcnZhbCIsIlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQiLCJhdHRlbXB0QXV0aCIsInRoZW4iLCJyZXN1bHQiLCJleHRyYSIsImdldEVtYWlsU2lkIiwiZ2V0Q2xpZW50U2VjcmV0IiwiY2F0Y2giLCJsb2dnZXIiLCJ1bm1vdW50ZWQiLCJtc2ciLCJtZXNzYWdlIiwidG9TdHJpbmciLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImNsZWFySW50ZXJ2YWwiLCJmb2N1cyIsInJlbmRlciIsInN0YWdlIiwiU3RhZ2VDb21wb25lbnQiLCJnZXRFbnRyeUNvbXBvbmVudEZvckxvZ2luVHlwZSIsImdldFNlc3Npb25JZCIsImdldFN0YWdlUGFyYW1zIiwib25BdXRoU3RhZ2VGYWlsZWQiLCJjb250aW51ZUlzTWFuYWdlZCIsIm9uUGhhc2VDaGFuZ2UiLCJjb250aW51ZVRleHQiLCJjb250aW51ZUtpbmQiLCJvblN0YWdlQ2FuY2VsIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvc3RydWN0dXJlcy9JbnRlcmFjdGl2ZUF1dGgudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxNyAtIDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQge1xuICAgIEF1dGhUeXBlLFxuICAgIElBdXRoRGF0YSxcbiAgICBJQXV0aERpY3QsXG4gICAgSUlucHV0cyxcbiAgICBJbnRlcmFjdGl2ZUF1dGgsXG4gICAgSVN0YWdlU3RhdHVzLFxufSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvaW50ZXJhY3RpdmUtYXV0aFwiO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2NsaWVudFwiO1xuaW1wb3J0IFJlYWN0LCB7IGNyZWF0ZVJlZiB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9sb2dnZXJcIjtcblxuaW1wb3J0IGdldEVudHJ5Q29tcG9uZW50Rm9yTG9naW5UeXBlLCB7IElTdGFnZUNvbXBvbmVudCB9IGZyb20gJy4uL3ZpZXdzL2F1dGgvSW50ZXJhY3RpdmVBdXRoRW50cnlDb21wb25lbnRzJztcbmltcG9ydCBTcGlubmVyIGZyb20gXCIuLi92aWV3cy9lbGVtZW50cy9TcGlubmVyXCI7XG5cbmV4cG9ydCBjb25zdCBFUlJPUl9VU0VSX0NBTkNFTExFRCA9IG5ldyBFcnJvcihcIlVzZXIgY2FuY2VsbGVkIGF1dGggc2Vzc2lvblwiKTtcblxudHlwZSBJbnRlcmFjdGl2ZUF1dGhDYWxsYmFja1N1Y2Nlc3MgPSAoXG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgICByZXNwb25zZTogSUF1dGhEYXRhLFxuICAgIGV4dHJhPzogeyBlbWFpbFNpZD86IHN0cmluZywgY2xpZW50U2VjcmV0Pzogc3RyaW5nIH1cbikgPT4gdm9pZDtcbnR5cGUgSW50ZXJhY3RpdmVBdXRoQ2FsbGJhY2tGYWlsdXJlID0gKFxuICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgIHJlc3BvbnNlOiBJQXV0aERhdGEgfCBFcnJvcixcbikgPT4gdm9pZDtcbmV4cG9ydCB0eXBlIEludGVyYWN0aXZlQXV0aENhbGxiYWNrID0gSW50ZXJhY3RpdmVBdXRoQ2FsbGJhY2tTdWNjZXNzICYgSW50ZXJhY3RpdmVBdXRoQ2FsbGJhY2tGYWlsdXJlO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICAvLyBtYXRyaXggY2xpZW50IHRvIHVzZSBmb3IgVUkgYXV0aCByZXF1ZXN0c1xuICAgIG1hdHJpeENsaWVudDogTWF0cml4Q2xpZW50O1xuICAgIC8vIHJlc3BvbnNlIGZyb20gaW5pdGlhbCByZXF1ZXN0LiBJZiBub3Qgc3VwcGxpZWQsIHdpbGwgZG8gYSByZXF1ZXN0IG9uIG1vdW50LlxuICAgIGF1dGhEYXRhPzogSUF1dGhEYXRhO1xuICAgIC8vIElucHV0cyBwcm92aWRlZCBieSB0aGUgdXNlciB0byB0aGUgYXV0aCBwcm9jZXNzXG4gICAgLy8gYW5kIHVzZWQgYnkgdmFyaW91cyBzdGFnZXMuIEFzIHBhc3NlZCB0byBqcy1zZGtcbiAgICAvLyBpbnRlcmFjdGl2ZS1hdXRoXG4gICAgaW5wdXRzPzogSUlucHV0cztcbiAgICBzZXNzaW9uSWQ/OiBzdHJpbmc7XG4gICAgY2xpZW50U2VjcmV0Pzogc3RyaW5nO1xuICAgIGVtYWlsU2lkPzogc3RyaW5nO1xuICAgIC8vIElmIHRydWUsIHBvbGwgdG8gc2VlIGlmIHRoZSBhdXRoIGZsb3cgaGFzIGJlZW4gY29tcGxldGVkIG91dC1vZi1iYW5kXG4gICAgcG9sbD86IGJvb2xlYW47XG4gICAgLy8gSWYgdHJ1ZSwgY29tcG9uZW50cyB3aWxsIGJlIHRvbGQgdGhhdCB0aGUgJ0NvbnRpbnVlJyBidXR0b25cbiAgICAvLyBpcyBtYW5hZ2VkIGJ5IHNvbWUgb3RoZXIgcGFydHkgYW5kIHNob3VsZCBub3QgYmUgbWFuYWdlZCBieVxuICAgIC8vIHRoZSBjb21wb25lbnQgaXRzZWxmLlxuICAgIGNvbnRpbnVlSXNNYW5hZ2VkPzogYm9vbGVhbjtcbiAgICAvLyBjb250aW51ZVRleHQgYW5kIGNvbnRpbnVlS2luZCBhcmUgcGFzc2VkIHN0cmFpZ2h0IHRocm91Z2ggdG8gdGhlIEF1dGhFbnRyeUNvbXBvbmVudC5cbiAgICBjb250aW51ZVRleHQ/OiBzdHJpbmc7XG4gICAgY29udGludWVLaW5kPzogc3RyaW5nO1xuICAgIC8vIGNhbGxiYWNrXG4gICAgbWFrZVJlcXVlc3QoYXV0aDogSUF1dGhEYXRhKTogUHJvbWlzZTxJQXV0aERhdGE+O1xuICAgIC8vIGNhbGxiYWNrIGNhbGxlZCB3aGVuIHRoZSBhdXRoIHByb2Nlc3MgaGFzIGZpbmlzaGVkLFxuICAgIC8vIHN1Y2Nlc3NmdWxseSBvciB1bnN1Y2Nlc3NmdWxseS5cbiAgICAvLyBAcGFyYW0ge2Jvb2xlYW59IHN0YXR1cyBUcnVlIGlmIHRoZSBvcGVyYXRpb24gcmVxdWlyaW5nXG4gICAgLy8gICAgIGF1dGggd2FzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHksIGZhbHNlIGlmIGNhbmNlbGVkLlxuICAgIC8vIEBwYXJhbSB7b2JqZWN0fSByZXN1bHQgVGhlIHJlc3VsdCBvZiB0aGUgYXV0aGVudGljYXRlZCBjYWxsXG4gICAgLy8gICAgIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSB0aGUgZXJyb3Igb2JqZWN0LlxuICAgIC8vIEBwYXJhbSB7b2JqZWN0fSBleHRyYSBBZGRpdGlvbmFsIGluZm9ybWF0aW9uIGFib3V0IHRoZSBVSSBBdXRoXG4gICAgLy8gICAgIHByb2Nlc3M6XG4gICAgLy8gICAgICAqIGVtYWlsU2lkIHtzdHJpbmd9IElmIGVtYWlsIGF1dGggd2FzIHBlcmZvcm1lZCwgdGhlIHNpZCBvZlxuICAgIC8vICAgICAgICAgICAgdGhlIGF1dGggc2Vzc2lvbi5cbiAgICAvLyAgICAgICogY2xpZW50U2VjcmV0IHtzdHJpbmd9IFRoZSBjbGllbnQgc2VjcmV0IHVzZWQgaW4gYXV0aFxuICAgIC8vICAgICAgICAgICAgc2Vzc2lvbnMgd2l0aCB0aGUgSUQgc2VydmVyLlxuICAgIG9uQXV0aEZpbmlzaGVkOiBJbnRlcmFjdGl2ZUF1dGhDYWxsYmFjaztcbiAgICAvLyBBcyBqcy1zZGsgaW50ZXJhY3RpdmUtYXV0aFxuICAgIHJlcXVlc3RFbWFpbFRva2VuPyhlbWFpbDogc3RyaW5nLCBzZWNyZXQ6IHN0cmluZywgYXR0ZW1wdDogbnVtYmVyLCBzZXNzaW9uOiBzdHJpbmcpOiBQcm9taXNlPHsgc2lkOiBzdHJpbmcgfT47XG4gICAgLy8gQ2FsbGVkIHdoZW4gdGhlIHN0YWdlIGNoYW5nZXMsIG9yIHRoZSBzdGFnZSdzIHBoYXNlIGNoYW5nZXMuIEZpcnN0XG4gICAgLy8gYXJndW1lbnQgaXMgdGhlIHN0YWdlLCBzZWNvbmQgaXMgdGhlIHBoYXNlLiBTb21lIHN0YWdlcyBkbyBub3QgaGF2ZVxuICAgIC8vIHBoYXNlcyBhbmQgd2lsbCBiZSBjb3VudGVkIGFzIDAgKG51bWVyaWMpLlxuICAgIG9uU3RhZ2VQaGFzZUNoYW5nZT8oc3RhZ2U6IHN0cmluZywgcGhhc2U6IHN0cmluZyB8IG51bWJlcik6IHZvaWQ7XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIGF1dGhTdGFnZT86IEF1dGhUeXBlO1xuICAgIHN0YWdlU3RhdGU/OiBJU3RhZ2VTdGF0dXM7XG4gICAgYnVzeTogYm9vbGVhbjtcbiAgICBlcnJvclRleHQ/OiBzdHJpbmc7XG4gICAgZXJyb3JDb2RlPzogc3RyaW5nO1xuICAgIHN1Ym1pdEJ1dHRvbkVuYWJsZWQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEludGVyYWN0aXZlQXV0aENvbXBvbmVudCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgYXV0aExvZ2ljOiBJbnRlcmFjdGl2ZUF1dGg7XG4gICAgcHJpdmF0ZSByZWFkb25seSBpbnRlcnZhbElkOiBudW1iZXIgPSBudWxsO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgc3RhZ2VDb21wb25lbnQgPSBjcmVhdGVSZWY8SVN0YWdlQ29tcG9uZW50PigpO1xuXG4gICAgcHJpdmF0ZSB1bm1vdW50ZWQgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgYXV0aFN0YWdlOiBudWxsLFxuICAgICAgICAgICAgYnVzeTogZmFsc2UsXG4gICAgICAgICAgICBlcnJvclRleHQ6IG51bGwsXG4gICAgICAgICAgICBlcnJvckNvZGU6IG51bGwsXG4gICAgICAgICAgICBzdWJtaXRCdXR0b25FbmFibGVkOiBmYWxzZSxcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmF1dGhMb2dpYyA9IG5ldyBJbnRlcmFjdGl2ZUF1dGgoe1xuICAgICAgICAgICAgYXV0aERhdGE6IHRoaXMucHJvcHMuYXV0aERhdGEsXG4gICAgICAgICAgICBkb1JlcXVlc3Q6IHRoaXMucmVxdWVzdENhbGxiYWNrLFxuICAgICAgICAgICAgYnVzeUNoYW5nZWQ6IHRoaXMub25CdXN5Q2hhbmdlZCxcbiAgICAgICAgICAgIGlucHV0czogdGhpcy5wcm9wcy5pbnB1dHMsXG4gICAgICAgICAgICBzdGF0ZVVwZGF0ZWQ6IHRoaXMuYXV0aFN0YXRlVXBkYXRlZCxcbiAgICAgICAgICAgIG1hdHJpeENsaWVudDogdGhpcy5wcm9wcy5tYXRyaXhDbGllbnQsXG4gICAgICAgICAgICBzZXNzaW9uSWQ6IHRoaXMucHJvcHMuc2Vzc2lvbklkLFxuICAgICAgICAgICAgY2xpZW50U2VjcmV0OiB0aGlzLnByb3BzLmNsaWVudFNlY3JldCxcbiAgICAgICAgICAgIGVtYWlsU2lkOiB0aGlzLnByb3BzLmVtYWlsU2lkLFxuICAgICAgICAgICAgcmVxdWVzdEVtYWlsVG9rZW46IHRoaXMucmVxdWVzdEVtYWlsVG9rZW4sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLnBvbGwpIHtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmF1dGhMb2dpYy5wb2xsKCk7XG4gICAgICAgICAgICB9LCAyMDAwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFRPRE86IFtSRUFDVC1XQVJOSU5HXSBSZXBsYWNlIGNvbXBvbmVudCB3aXRoIHJlYWwgY2xhc3MsIHVzZSBjb25zdHJ1Y3RvciBmb3IgcmVmc1xuICAgIFVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25hbWluZy1jb252ZW50aW9uLCBjYW1lbGNhc2VcbiAgICAgICAgdGhpcy5hdXRoTG9naWMuYXR0ZW1wdEF1dGgoKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4dHJhID0ge1xuICAgICAgICAgICAgICAgIGVtYWlsU2lkOiB0aGlzLmF1dGhMb2dpYy5nZXRFbWFpbFNpZCgpLFxuICAgICAgICAgICAgICAgIGNsaWVudFNlY3JldDogdGhpcy5hdXRoTG9naWMuZ2V0Q2xpZW50U2VjcmV0KCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkF1dGhGaW5pc2hlZCh0cnVlLCByZXN1bHQsIGV4dHJhKTtcbiAgICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLm9uQXV0aEZpbmlzaGVkKGZhbHNlLCBlcnJvcik7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoXCJFcnJvciBkdXJpbmcgdXNlci1pbnRlcmFjdGl2ZSBhdXRoOlwiLCBlcnJvcik7XG4gICAgICAgICAgICBpZiAodGhpcy51bm1vdW50ZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IG1zZyA9IGVycm9yLm1lc3NhZ2UgfHwgZXJyb3IudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGVycm9yVGV4dDogbXNnLFxuICAgICAgICAgICAgICAgIGVycm9yQ29kZTogZXJyb3IuZXJyY29kZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgdGhpcy51bm1vdW50ZWQgPSB0cnVlO1xuXG4gICAgICAgIGlmICh0aGlzLmludGVydmFsSWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbElkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgcmVxdWVzdEVtYWlsVG9rZW4gPSBhc3luYyAoXG4gICAgICAgIGVtYWlsOiBzdHJpbmcsXG4gICAgICAgIHNlY3JldDogc3RyaW5nLFxuICAgICAgICBhdHRlbXB0OiBudW1iZXIsXG4gICAgICAgIHNlc3Npb246IHN0cmluZyxcbiAgICApOiBQcm9taXNlPHtzaWQ6IHN0cmluZ30+ID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBidXN5OiB0cnVlLFxuICAgICAgICB9KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnByb3BzLnJlcXVlc3RFbWFpbFRva2VuKGVtYWlsLCBzZWNyZXQsIGF0dGVtcHQsIHNlc3Npb24pO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgYnVzeTogZmFsc2UsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIGF1dGhTdGF0ZVVwZGF0ZWQgPSAoc3RhZ2VUeXBlOiBBdXRoVHlwZSwgc3RhZ2VTdGF0ZTogSVN0YWdlU3RhdHVzKTogdm9pZCA9PiB7XG4gICAgICAgIGNvbnN0IG9sZFN0YWdlID0gdGhpcy5zdGF0ZS5hdXRoU3RhZ2U7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgYnVzeTogZmFsc2UsXG4gICAgICAgICAgICBhdXRoU3RhZ2U6IHN0YWdlVHlwZSxcbiAgICAgICAgICAgIHN0YWdlU3RhdGU6IHN0YWdlU3RhdGUsXG4gICAgICAgICAgICBlcnJvclRleHQ6IHN0YWdlU3RhdGUuZXJyb3IsXG4gICAgICAgICAgICBlcnJvckNvZGU6IHN0YWdlU3RhdGUuZXJyY29kZSxcbiAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKG9sZFN0YWdlICE9PSBzdGFnZVR5cGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZvY3VzKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFzdGFnZVN0YXRlLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZUNvbXBvbmVudC5jdXJyZW50Py5hdHRlbXB0RmFpbGVkPy4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgcmVxdWVzdENhbGxiYWNrID0gKGF1dGg6IElBdXRoRGF0YSwgYmFja2dyb3VuZDogYm9vbGVhbik6IFByb21pc2U8SUF1dGhEYXRhPiA9PiB7XG4gICAgICAgIC8vIFRoaXMgd3JhcHBlciBqdXN0IGV4aXN0cyBiZWNhdXNlIHRoZSBqcy1zZGsgcGFzc2VzIGEgc2Vjb25kXG4gICAgICAgIC8vICdidXN5JyBwYXJhbSBmb3IgYmFja3dhcmRzIGNvbXBhdC4gVGhpcyB0aHJvd3MgdGhlIHRlc3RzIG9mZlxuICAgICAgICAvLyBzbyBkaXNjYXJkIGl0IGhlcmUuXG4gICAgICAgIHJldHVybiB0aGlzLnByb3BzLm1ha2VSZXF1ZXN0KGF1dGgpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQnVzeUNoYW5nZWQgPSAoYnVzeTogYm9vbGVhbik6IHZvaWQgPT4ge1xuICAgICAgICAvLyBpZiB3ZSd2ZSBzdGFydGVkIGRvaW5nIHN0dWZmLCByZXNldCB0aGUgZXJyb3IgbWVzc2FnZXNcbiAgICAgICAgaWYgKGJ1c3kpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGJ1c3k6IHRydWUsXG4gICAgICAgICAgICAgICAgZXJyb3JUZXh0OiBudWxsLFxuICAgICAgICAgICAgICAgIGVycm9yQ29kZTogbnVsbCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZSBKUyBTREsgZWFnZXJseSByZXBvcnRzIGl0c2VsZiBhcyBcIm5vdCBidXN5XCIgcmlnaHQgYWZ0ZXIgYW55XG4gICAgICAgIC8vIGltbWVkaWF0ZSB3b3JrIGhhcyBjb21wbGV0ZWQsIGJ1dCB0aGF0J3Mgbm90IHJlYWxseSB3aGF0IHdlIHdhbnQgYXRcbiAgICAgICAgLy8gdGhlIFVJIGxheWVyLCBzbyB3ZSBpZ25vcmUgdGhpcyBzaWduYWwgYW5kIHNob3cgYSBzcGlubmVyIHVudGlsXG4gICAgICAgIC8vIHRoZXJlJ3MgYSBuZXcgc2NyZWVuIHRvIHNob3cgdGhlIHVzZXIuIFRoaXMgaXMgaW1wbGVtZW50ZWQgYnkgc2V0dGluZ1xuICAgICAgICAvLyBgYnVzeTogZmFsc2VgIGluIGBhdXRoU3RhdGVVcGRhdGVkYC5cbiAgICAgICAgLy8gU2VlIGFsc28gaHR0cHM6Ly9naXRodWIuY29tL3ZlY3Rvci1pbS9lbGVtZW50LXdlYi9pc3N1ZXMvMTI1NDZcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBzZXRGb2N1cygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGFnZUNvbXBvbmVudC5jdXJyZW50Py5mb2N1cz8uKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdWJtaXRBdXRoRGljdCA9IChhdXRoRGF0YTogSUF1dGhEaWN0KTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuYXV0aExvZ2ljLnN1Ym1pdEF1dGhEaWN0KGF1dGhEYXRhKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblBoYXNlQ2hhbmdlID0gKG5ld1BoYXNlOiBudW1iZXIpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5wcm9wcy5vblN0YWdlUGhhc2VDaGFuZ2U/Lih0aGlzLnN0YXRlLmF1dGhTdGFnZSwgbmV3UGhhc2UgfHwgMCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25TdGFnZUNhbmNlbCA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkF1dGhGaW5pc2hlZChmYWxzZSwgRVJST1JfVVNFUl9DQU5DRUxMRUQpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQXV0aFN0YWdlRmFpbGVkID0gKGU6IEVycm9yKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMucHJvcHMub25BdXRoRmluaXNoZWQoZmFsc2UsIGUpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHNldEVtYWlsU2lkID0gKHNpZDogc3RyaW5nKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuYXV0aExvZ2ljLnNldEVtYWlsU2lkKHNpZCk7XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3Qgc3RhZ2UgPSB0aGlzLnN0YXRlLmF1dGhTdGFnZTtcbiAgICAgICAgaWYgKCFzdGFnZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuYnVzeSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA8U3Bpbm5lciAvPjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBTdGFnZUNvbXBvbmVudCA9IGdldEVudHJ5Q29tcG9uZW50Rm9yTG9naW5UeXBlKHN0YWdlKTtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxTdGFnZUNvbXBvbmVudFxuICAgICAgICAgICAgICAgIHJlZj17dGhpcy5zdGFnZUNvbXBvbmVudCBhcyBhbnl9XG4gICAgICAgICAgICAgICAgbG9naW5UeXBlPXtzdGFnZX1cbiAgICAgICAgICAgICAgICBtYXRyaXhDbGllbnQ9e3RoaXMucHJvcHMubWF0cml4Q2xpZW50fVxuICAgICAgICAgICAgICAgIGF1dGhTZXNzaW9uSWQ9e3RoaXMuYXV0aExvZ2ljLmdldFNlc3Npb25JZCgpfVxuICAgICAgICAgICAgICAgIGNsaWVudFNlY3JldD17dGhpcy5hdXRoTG9naWMuZ2V0Q2xpZW50U2VjcmV0KCl9XG4gICAgICAgICAgICAgICAgc3RhZ2VQYXJhbXM9e3RoaXMuYXV0aExvZ2ljLmdldFN0YWdlUGFyYW1zKHN0YWdlKX1cbiAgICAgICAgICAgICAgICBzdWJtaXRBdXRoRGljdD17dGhpcy5zdWJtaXRBdXRoRGljdH1cbiAgICAgICAgICAgICAgICBlcnJvclRleHQ9e3RoaXMuc3RhdGUuZXJyb3JUZXh0fVxuICAgICAgICAgICAgICAgIGVycm9yQ29kZT17dGhpcy5zdGF0ZS5lcnJvckNvZGV9XG4gICAgICAgICAgICAgICAgYnVzeT17dGhpcy5zdGF0ZS5idXN5fVxuICAgICAgICAgICAgICAgIGlucHV0cz17dGhpcy5wcm9wcy5pbnB1dHN9XG4gICAgICAgICAgICAgICAgc3RhZ2VTdGF0ZT17dGhpcy5zdGF0ZS5zdGFnZVN0YXRlfVxuICAgICAgICAgICAgICAgIGZhaWw9e3RoaXMub25BdXRoU3RhZ2VGYWlsZWR9XG4gICAgICAgICAgICAgICAgc2V0RW1haWxTaWQ9e3RoaXMuc2V0RW1haWxTaWR9XG4gICAgICAgICAgICAgICAgc2hvd0NvbnRpbnVlPXshdGhpcy5wcm9wcy5jb250aW51ZUlzTWFuYWdlZH1cbiAgICAgICAgICAgICAgICBvblBoYXNlQ2hhbmdlPXt0aGlzLm9uUGhhc2VDaGFuZ2V9XG4gICAgICAgICAgICAgICAgcmVxdWVzdEVtYWlsVG9rZW49e3RoaXMuYXV0aExvZ2ljLnJlcXVlc3RFbWFpbFRva2VufVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlVGV4dD17dGhpcy5wcm9wcy5jb250aW51ZVRleHR9XG4gICAgICAgICAgICAgICAgY29udGludWVLaW5kPXt0aGlzLnByb3BzLmNvbnRpbnVlS2luZH1cbiAgICAgICAgICAgICAgICBvbkNhbmNlbD17dGhpcy5vblN0YWdlQ2FuY2VsfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXSwi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
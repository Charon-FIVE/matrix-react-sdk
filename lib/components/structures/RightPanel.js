"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _roomState = require("matrix-js-sdk/src/models/room-state");

var _roomMember = require("matrix-js-sdk/src/models/room-member");

var _lodash = require("lodash");

var _dispatcher = _interopRequireDefault(require("../../dispatcher/dispatcher"));

var _RightPanelStorePhases = require("../../stores/right-panel/RightPanelStorePhases");

var _RightPanelStore = _interopRequireDefault(require("../../stores/right-panel/RightPanelStore"));

var _MatrixClientContext = _interopRequireDefault(require("../../contexts/MatrixClientContext"));

var _RoomSummaryCard = _interopRequireDefault(require("../views/right_panel/RoomSummaryCard"));

var _WidgetCard = _interopRequireDefault(require("../views/right_panel/WidgetCard"));

var _SettingsStore = _interopRequireDefault(require("../../settings/SettingsStore"));

var _MemberList = _interopRequireDefault(require("../views/rooms/MemberList"));

var _UserInfo = _interopRequireDefault(require("../views/right_panel/UserInfo"));

var _ThirdPartyMemberInfo = _interopRequireDefault(require("../views/rooms/ThirdPartyMemberInfo"));

var _FilePanel = _interopRequireDefault(require("./FilePanel"));

var _ThreadView = _interopRequireDefault(require("./ThreadView"));

var _ThreadPanel = _interopRequireDefault(require("./ThreadPanel"));

var _NotificationPanel = _interopRequireDefault(require("./NotificationPanel"));

var _PinnedMessagesCard = _interopRequireDefault(require("../views/right_panel/PinnedMessagesCard"));

var _TimelineCard = _interopRequireDefault(require("../views/right_panel/TimelineCard"));

var _AsyncStore = require("../../stores/AsyncStore");

var _actions = require("../../dispatcher/actions");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

class RightPanel extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    (0, _defineProperty2.default)(this, "context", void 0);
    (0, _defineProperty2.default)(this, "delayedUpdate", (0, _lodash.throttle)(() => {
      this.forceUpdate();
    }, 500, {
      leading: true,
      trailing: true
    }));
    (0, _defineProperty2.default)(this, "onRoomStateMember", (ev, state, member) => {
      if (!this.props.room || member.roomId !== this.props.room.roomId) {
        return;
      } // redraw the badge on the membership list


      if (this.state.phase === _RightPanelStorePhases.RightPanelPhases.RoomMemberList && member.roomId === this.props.room.roomId) {
        this.delayedUpdate();
      } else if (this.state.phase === _RightPanelStorePhases.RightPanelPhases.RoomMemberInfo && member.roomId === this.props.room.roomId && member.userId === this.state.cardState.member.userId) {
        // refresh the member info (e.g. new power level)
        this.delayedUpdate();
      }
    });
    (0, _defineProperty2.default)(this, "onRightPanelStoreUpdate", () => {
      this.setState(_objectSpread({}, RightPanel.getDerivedStateFromProps(this.props)));
    });
    (0, _defineProperty2.default)(this, "onClose", () => {
      // XXX: There are three different ways of 'closing' this panel depending on what state
      // things are in... this knows far more than it should do about the state of the rest
      // of the app and is generally a bit silly.
      if (this.props.overwriteCard?.state?.member) {
        // If we have a user prop then we're displaying a user from the 'user' page type
        // in LoggedInView, so need to change the page type to close the panel (we switch
        // to the home page which is not obviously the correct thing to do, but I'm not sure
        // anything else is - we could hide the close button altogether?)
        _dispatcher.default.dispatch({
          action: _actions.Action.ViewHomePage
        });
      } else if (this.state.phase === _RightPanelStorePhases.RightPanelPhases.EncryptionPanel && this.state.cardState.verificationRequest?.pending) {
        // When the user clicks close on the encryption panel cancel the pending request first if any
        this.state.cardState.verificationRequest.cancel();
      } else {
        _RightPanelStore.default.instance.togglePanel(this.props.room?.roomId);
      }
    });
    (0, _defineProperty2.default)(this, "onSearchQueryChanged", searchQuery => {
      this.setState({
        searchQuery
      });
    });
    this.state = {
      searchQuery: ""
    };
  }

  componentDidMount() {
    this.context.on(_roomState.RoomStateEvent.Members, this.onRoomStateMember);

    _RightPanelStore.default.instance.on(_AsyncStore.UPDATE_EVENT, this.onRightPanelStoreUpdate);
  }

  componentWillUnmount() {
    this.context?.removeListener(_roomState.RoomStateEvent.Members, this.onRoomStateMember);

    _RightPanelStore.default.instance.off(_AsyncStore.UPDATE_EVENT, this.onRightPanelStoreUpdate);
  }

  static getDerivedStateFromProps(props) {
    let currentCard;

    if (props.room) {
      currentCard = _RightPanelStore.default.instance.currentCardForRoom(props.room.roomId);
    }

    return {
      cardState: currentCard?.state,
      phase: currentCard?.phase
    };
  }

  render() {
    let card = /*#__PURE__*/_react.default.createElement("div", null);

    const roomId = this.props.room?.roomId;
    const phase = this.props.overwriteCard?.phase ?? this.state.phase;
    const cardState = this.props.overwriteCard?.state ?? this.state.cardState;

    switch (phase) {
      case _RightPanelStorePhases.RightPanelPhases.RoomMemberList:
        if (roomId) {
          card = /*#__PURE__*/_react.default.createElement(_MemberList.default, {
            roomId: roomId,
            key: roomId,
            onClose: this.onClose,
            searchQuery: this.state.searchQuery,
            onSearchQueryChanged: this.onSearchQueryChanged
          });
        }

        break;

      case _RightPanelStorePhases.RightPanelPhases.SpaceMemberList:
        card = /*#__PURE__*/_react.default.createElement(_MemberList.default, {
          roomId: cardState.spaceId ? cardState.spaceId : roomId,
          key: cardState.spaceId ? cardState.spaceId : roomId,
          onClose: this.onClose,
          searchQuery: this.state.searchQuery,
          onSearchQueryChanged: this.onSearchQueryChanged
        });
        break;

      case _RightPanelStorePhases.RightPanelPhases.RoomMemberInfo:
      case _RightPanelStorePhases.RightPanelPhases.SpaceMemberInfo:
      case _RightPanelStorePhases.RightPanelPhases.EncryptionPanel:
        {
          const roomMember = cardState.member instanceof _roomMember.RoomMember ? cardState.member : undefined;
          card = /*#__PURE__*/_react.default.createElement(_UserInfo.default, {
            user: cardState.member,
            room: this.context.getRoom(roomMember?.roomId) ?? this.props.room,
            key: roomId || cardState.member.userId,
            onClose: this.onClose,
            phase: phase,
            verificationRequest: cardState.verificationRequest,
            verificationRequestPromise: cardState.verificationRequestPromise
          });
          break;
        }

      case _RightPanelStorePhases.RightPanelPhases.Room3pidMemberInfo:
      case _RightPanelStorePhases.RightPanelPhases.Space3pidMemberInfo:
        card = /*#__PURE__*/_react.default.createElement(_ThirdPartyMemberInfo.default, {
          event: cardState.memberInfoEvent,
          key: roomId
        });
        break;

      case _RightPanelStorePhases.RightPanelPhases.NotificationPanel:
        card = /*#__PURE__*/_react.default.createElement(_NotificationPanel.default, {
          onClose: this.onClose
        });
        break;

      case _RightPanelStorePhases.RightPanelPhases.PinnedMessages:
        if (_SettingsStore.default.getValue("feature_pinning")) {
          card = /*#__PURE__*/_react.default.createElement(_PinnedMessagesCard.default, {
            room: this.props.room,
            onClose: this.onClose,
            permalinkCreator: this.props.permalinkCreator
          });
        }

        break;

      case _RightPanelStorePhases.RightPanelPhases.Timeline:
        card = /*#__PURE__*/_react.default.createElement(_TimelineCard.default, {
          classNames: "mx_ThreadPanel mx_TimelineCard",
          room: this.props.room,
          timelineSet: this.props.room.getUnfilteredTimelineSet(),
          resizeNotifier: this.props.resizeNotifier,
          onClose: this.onClose,
          permalinkCreator: this.props.permalinkCreator,
          e2eStatus: this.props.e2eStatus
        });
        break;

      case _RightPanelStorePhases.RightPanelPhases.FilePanel:
        card = /*#__PURE__*/_react.default.createElement(_FilePanel.default, {
          roomId: roomId,
          resizeNotifier: this.props.resizeNotifier,
          onClose: this.onClose
        });
        break;

      case _RightPanelStorePhases.RightPanelPhases.ThreadView:
        card = /*#__PURE__*/_react.default.createElement(_ThreadView.default, {
          room: this.props.room,
          resizeNotifier: this.props.resizeNotifier,
          onClose: this.onClose,
          mxEvent: cardState.threadHeadEvent,
          initialEvent: cardState.initialEvent,
          isInitialEventHighlighted: cardState.isInitialEventHighlighted,
          initialEventScrollIntoView: cardState.initialEventScrollIntoView,
          permalinkCreator: this.props.permalinkCreator,
          e2eStatus: this.props.e2eStatus
        });
        break;

      case _RightPanelStorePhases.RightPanelPhases.ThreadPanel:
        card = /*#__PURE__*/_react.default.createElement(_ThreadPanel.default, {
          roomId: roomId,
          resizeNotifier: this.props.resizeNotifier,
          onClose: this.onClose,
          permalinkCreator: this.props.permalinkCreator
        });
        break;

      case _RightPanelStorePhases.RightPanelPhases.RoomSummary:
        card = /*#__PURE__*/_react.default.createElement(_RoomSummaryCard.default, {
          room: this.props.room,
          onClose: this.onClose
        });
        break;

      case _RightPanelStorePhases.RightPanelPhases.Widget:
        card = /*#__PURE__*/_react.default.createElement(_WidgetCard.default, {
          room: this.props.room,
          widgetId: cardState.widgetId,
          onClose: this.onClose
        });
        break;
    }

    return /*#__PURE__*/_react.default.createElement("aside", {
      className: "mx_RightPanel dark-panel",
      id: "mx_RightPanel"
    }, card);
  }

}

exports.default = RightPanel;
(0, _defineProperty2.default)(RightPanel, "contextType", _MatrixClientContext.default);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSaWdodFBhbmVsIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiY29udGV4dCIsInRocm90dGxlIiwiZm9yY2VVcGRhdGUiLCJsZWFkaW5nIiwidHJhaWxpbmciLCJldiIsInN0YXRlIiwibWVtYmVyIiwicm9vbSIsInJvb21JZCIsInBoYXNlIiwiUmlnaHRQYW5lbFBoYXNlcyIsIlJvb21NZW1iZXJMaXN0IiwiZGVsYXllZFVwZGF0ZSIsIlJvb21NZW1iZXJJbmZvIiwidXNlcklkIiwiY2FyZFN0YXRlIiwic2V0U3RhdGUiLCJnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMiLCJvdmVyd3JpdGVDYXJkIiwiZGlzIiwiZGlzcGF0Y2giLCJhY3Rpb24iLCJBY3Rpb24iLCJWaWV3SG9tZVBhZ2UiLCJFbmNyeXB0aW9uUGFuZWwiLCJ2ZXJpZmljYXRpb25SZXF1ZXN0IiwicGVuZGluZyIsImNhbmNlbCIsIlJpZ2h0UGFuZWxTdG9yZSIsImluc3RhbmNlIiwidG9nZ2xlUGFuZWwiLCJzZWFyY2hRdWVyeSIsImNvbXBvbmVudERpZE1vdW50Iiwib24iLCJSb29tU3RhdGVFdmVudCIsIk1lbWJlcnMiLCJvblJvb21TdGF0ZU1lbWJlciIsIlVQREFURV9FVkVOVCIsIm9uUmlnaHRQYW5lbFN0b3JlVXBkYXRlIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJyZW1vdmVMaXN0ZW5lciIsIm9mZiIsImN1cnJlbnRDYXJkIiwiY3VycmVudENhcmRGb3JSb29tIiwicmVuZGVyIiwiY2FyZCIsIm9uQ2xvc2UiLCJvblNlYXJjaFF1ZXJ5Q2hhbmdlZCIsIlNwYWNlTWVtYmVyTGlzdCIsInNwYWNlSWQiLCJTcGFjZU1lbWJlckluZm8iLCJyb29tTWVtYmVyIiwiUm9vbU1lbWJlciIsInVuZGVmaW5lZCIsImdldFJvb20iLCJ2ZXJpZmljYXRpb25SZXF1ZXN0UHJvbWlzZSIsIlJvb20zcGlkTWVtYmVySW5mbyIsIlNwYWNlM3BpZE1lbWJlckluZm8iLCJtZW1iZXJJbmZvRXZlbnQiLCJOb3RpZmljYXRpb25QYW5lbCIsIlBpbm5lZE1lc3NhZ2VzIiwiU2V0dGluZ3NTdG9yZSIsImdldFZhbHVlIiwicGVybWFsaW5rQ3JlYXRvciIsIlRpbWVsaW5lIiwiZ2V0VW5maWx0ZXJlZFRpbWVsaW5lU2V0IiwicmVzaXplTm90aWZpZXIiLCJlMmVTdGF0dXMiLCJGaWxlUGFuZWwiLCJUaHJlYWRWaWV3IiwidGhyZWFkSGVhZEV2ZW50IiwiaW5pdGlhbEV2ZW50IiwiaXNJbml0aWFsRXZlbnRIaWdobGlnaHRlZCIsImluaXRpYWxFdmVudFNjcm9sbEludG9WaWV3IiwiVGhyZWFkUGFuZWwiLCJSb29tU3VtbWFyeSIsIldpZGdldCIsIndpZGdldElkIiwiTWF0cml4Q2xpZW50Q29udGV4dCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3N0cnVjdHVyZXMvUmlnaHRQYW5lbC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IE1pY2hhZWwgVGVsYXR5bnNraSA8N3QzY2hndXlAZ21haWwuY29tPlxuQ29weXJpZ2h0IDIwMTUgLSAyMDIyIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IFJvb20gfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb21cIjtcbmltcG9ydCB7IFJvb21TdGF0ZSwgUm9vbVN0YXRlRXZlbnQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb20tc3RhdGVcIjtcbmltcG9ydCB7IFJvb21NZW1iZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb20tbWVtYmVyXCI7XG5pbXBvcnQgeyBNYXRyaXhFdmVudCB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvZXZlbnRcIjtcbmltcG9ydCB7IHRocm90dGxlIH0gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0IGRpcyBmcm9tICcuLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXInO1xuaW1wb3J0IHsgUmlnaHRQYW5lbFBoYXNlcyB9IGZyb20gJy4uLy4uL3N0b3Jlcy9yaWdodC1wYW5lbC9SaWdodFBhbmVsU3RvcmVQaGFzZXMnO1xuaW1wb3J0IFJpZ2h0UGFuZWxTdG9yZSBmcm9tIFwiLi4vLi4vc3RvcmVzL3JpZ2h0LXBhbmVsL1JpZ2h0UGFuZWxTdG9yZVwiO1xuaW1wb3J0IE1hdHJpeENsaWVudENvbnRleHQgZnJvbSBcIi4uLy4uL2NvbnRleHRzL01hdHJpeENsaWVudENvbnRleHRcIjtcbmltcG9ydCBSb29tU3VtbWFyeUNhcmQgZnJvbSBcIi4uL3ZpZXdzL3JpZ2h0X3BhbmVsL1Jvb21TdW1tYXJ5Q2FyZFwiO1xuaW1wb3J0IFdpZGdldENhcmQgZnJvbSBcIi4uL3ZpZXdzL3JpZ2h0X3BhbmVsL1dpZGdldENhcmRcIjtcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gXCIuLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5pbXBvcnQgTWVtYmVyTGlzdCBmcm9tIFwiLi4vdmlld3Mvcm9vbXMvTWVtYmVyTGlzdFwiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi92aWV3cy9yaWdodF9wYW5lbC9Vc2VySW5mb1wiO1xuaW1wb3J0IFRoaXJkUGFydHlNZW1iZXJJbmZvIGZyb20gXCIuLi92aWV3cy9yb29tcy9UaGlyZFBhcnR5TWVtYmVySW5mb1wiO1xuaW1wb3J0IEZpbGVQYW5lbCBmcm9tIFwiLi9GaWxlUGFuZWxcIjtcbmltcG9ydCBUaHJlYWRWaWV3IGZyb20gXCIuL1RocmVhZFZpZXdcIjtcbmltcG9ydCBUaHJlYWRQYW5lbCBmcm9tIFwiLi9UaHJlYWRQYW5lbFwiO1xuaW1wb3J0IE5vdGlmaWNhdGlvblBhbmVsIGZyb20gXCIuL05vdGlmaWNhdGlvblBhbmVsXCI7XG5pbXBvcnQgUmVzaXplTm90aWZpZXIgZnJvbSBcIi4uLy4uL3V0aWxzL1Jlc2l6ZU5vdGlmaWVyXCI7XG5pbXBvcnQgUGlubmVkTWVzc2FnZXNDYXJkIGZyb20gXCIuLi92aWV3cy9yaWdodF9wYW5lbC9QaW5uZWRNZXNzYWdlc0NhcmRcIjtcbmltcG9ydCB7IFJvb21QZXJtYWxpbmtDcmVhdG9yIH0gZnJvbSAnLi4vLi4vdXRpbHMvcGVybWFsaW5rcy9QZXJtYWxpbmtzJztcbmltcG9ydCB7IEUyRVN0YXR1cyB9IGZyb20gJy4uLy4uL3V0aWxzL1NoaWVsZFV0aWxzJztcbmltcG9ydCBUaW1lbGluZUNhcmQgZnJvbSAnLi4vdmlld3MvcmlnaHRfcGFuZWwvVGltZWxpbmVDYXJkJztcbmltcG9ydCB7IFVQREFURV9FVkVOVCB9IGZyb20gJy4uLy4uL3N0b3Jlcy9Bc3luY1N0b3JlJztcbmltcG9ydCB7IElSaWdodFBhbmVsQ2FyZCwgSVJpZ2h0UGFuZWxDYXJkU3RhdGUgfSBmcm9tICcuLi8uLi9zdG9yZXMvcmlnaHQtcGFuZWwvUmlnaHRQYW5lbFN0b3JlSVBhbmVsU3RhdGUnO1xuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSAnLi4vLi4vZGlzcGF0Y2hlci9hY3Rpb25zJztcblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgcm9vbT86IFJvb207IC8vIGlmIHNob3dpbmcgcGFuZWxzIGZvciBhIGdpdmVuIHJvb20sIHRoaXMgaXMgc2V0XG4gICAgb3ZlcndyaXRlQ2FyZD86IElSaWdodFBhbmVsQ2FyZDsgLy8gdXNlZCB0byBkaXNwbGF5IGEgY3VzdG9tIGNhcmQgYW5kIGlnbm9yaW5nIHRoZSBSaWdodFBhbmVsU3RvcmUgKHVzZWQgZm9yIFVzZXJWaWV3KVxuICAgIHJlc2l6ZU5vdGlmaWVyOiBSZXNpemVOb3RpZmllcjtcbiAgICBwZXJtYWxpbmtDcmVhdG9yPzogUm9vbVBlcm1hbGlua0NyZWF0b3I7XG4gICAgZTJlU3RhdHVzPzogRTJFU3RhdHVzO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBwaGFzZT86IFJpZ2h0UGFuZWxQaGFzZXM7XG4gICAgc2VhcmNoUXVlcnk6IHN0cmluZztcbiAgICBjYXJkU3RhdGU/OiBJUmlnaHRQYW5lbENhcmRTdGF0ZTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmlnaHRQYW5lbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHN0YXRpYyBjb250ZXh0VHlwZSA9IE1hdHJpeENsaWVudENvbnRleHQ7XG4gICAgcHVibGljIGNvbnRleHQhOiBSZWFjdC5Db250ZXh0VHlwZTx0eXBlb2YgTWF0cml4Q2xpZW50Q29udGV4dD47XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wcywgY29udGV4dCkge1xuICAgICAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHNlYXJjaFF1ZXJ5OiBcIlwiLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGVsYXllZFVwZGF0ZSA9IHRocm90dGxlKCgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xuICAgIH0sIDUwMCwgeyBsZWFkaW5nOiB0cnVlLCB0cmFpbGluZzogdHJ1ZSB9KTtcblxuICAgIHB1YmxpYyBjb21wb25lbnREaWRNb3VudCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jb250ZXh0Lm9uKFJvb21TdGF0ZUV2ZW50Lk1lbWJlcnMsIHRoaXMub25Sb29tU3RhdGVNZW1iZXIpO1xuICAgICAgICBSaWdodFBhbmVsU3RvcmUuaW5zdGFuY2Uub24oVVBEQVRFX0VWRU5ULCB0aGlzLm9uUmlnaHRQYW5lbFN0b3JlVXBkYXRlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50V2lsbFVubW91bnQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY29udGV4dD8ucmVtb3ZlTGlzdGVuZXIoUm9vbVN0YXRlRXZlbnQuTWVtYmVycywgdGhpcy5vblJvb21TdGF0ZU1lbWJlcik7XG4gICAgICAgIFJpZ2h0UGFuZWxTdG9yZS5pbnN0YW5jZS5vZmYoVVBEQVRFX0VWRU5ULCB0aGlzLm9uUmlnaHRQYW5lbFN0b3JlVXBkYXRlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhwcm9wczogSVByb3BzKTogUGFydGlhbDxJU3RhdGU+IHtcbiAgICAgICAgbGV0IGN1cnJlbnRDYXJkOiBJUmlnaHRQYW5lbENhcmQ7XG4gICAgICAgIGlmIChwcm9wcy5yb29tKSB7XG4gICAgICAgICAgICBjdXJyZW50Q2FyZCA9IFJpZ2h0UGFuZWxTdG9yZS5pbnN0YW5jZS5jdXJyZW50Q2FyZEZvclJvb20ocHJvcHMucm9vbS5yb29tSWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNhcmRTdGF0ZTogY3VycmVudENhcmQ/LnN0YXRlLFxuICAgICAgICAgICAgcGhhc2U6IGN1cnJlbnRDYXJkPy5waGFzZSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uUm9vbVN0YXRlTWVtYmVyID0gKGV2OiBNYXRyaXhFdmVudCwgc3RhdGU6IFJvb21TdGF0ZSwgbWVtYmVyOiBSb29tTWVtYmVyKSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5wcm9wcy5yb29tIHx8IG1lbWJlci5yb29tSWQgIT09IHRoaXMucHJvcHMucm9vbS5yb29tSWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyByZWRyYXcgdGhlIGJhZGdlIG9uIHRoZSBtZW1iZXJzaGlwIGxpc3RcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUucGhhc2UgPT09IFJpZ2h0UGFuZWxQaGFzZXMuUm9vbU1lbWJlckxpc3QgJiYgbWVtYmVyLnJvb21JZCA9PT0gdGhpcy5wcm9wcy5yb29tLnJvb21JZCkge1xuICAgICAgICAgICAgdGhpcy5kZWxheWVkVXBkYXRlKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnBoYXNlID09PSBSaWdodFBhbmVsUGhhc2VzLlJvb21NZW1iZXJJbmZvICYmIG1lbWJlci5yb29tSWQgPT09IHRoaXMucHJvcHMucm9vbS5yb29tSWQgJiZcbiAgICAgICAgICAgIG1lbWJlci51c2VySWQgPT09IHRoaXMuc3RhdGUuY2FyZFN0YXRlLm1lbWJlci51c2VySWRcbiAgICAgICAgKSB7XG4gICAgICAgICAgICAvLyByZWZyZXNoIHRoZSBtZW1iZXIgaW5mbyAoZS5nLiBuZXcgcG93ZXIgbGV2ZWwpXG4gICAgICAgICAgICB0aGlzLmRlbGF5ZWRVcGRhdGUoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUmlnaHRQYW5lbFN0b3JlVXBkYXRlID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgLi4uUmlnaHRQYW5lbC5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHModGhpcy5wcm9wcykgYXMgSVN0YXRlIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQ2xvc2UgPSAoKSA9PiB7XG4gICAgICAgIC8vIFhYWDogVGhlcmUgYXJlIHRocmVlIGRpZmZlcmVudCB3YXlzIG9mICdjbG9zaW5nJyB0aGlzIHBhbmVsIGRlcGVuZGluZyBvbiB3aGF0IHN0YXRlXG4gICAgICAgIC8vIHRoaW5ncyBhcmUgaW4uLi4gdGhpcyBrbm93cyBmYXIgbW9yZSB0aGFuIGl0IHNob3VsZCBkbyBhYm91dCB0aGUgc3RhdGUgb2YgdGhlIHJlc3RcbiAgICAgICAgLy8gb2YgdGhlIGFwcCBhbmQgaXMgZ2VuZXJhbGx5IGEgYml0IHNpbGx5LlxuICAgICAgICBpZiAodGhpcy5wcm9wcy5vdmVyd3JpdGVDYXJkPy5zdGF0ZT8ubWVtYmVyKSB7XG4gICAgICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgdXNlciBwcm9wIHRoZW4gd2UncmUgZGlzcGxheWluZyBhIHVzZXIgZnJvbSB0aGUgJ3VzZXInIHBhZ2UgdHlwZVxuICAgICAgICAgICAgLy8gaW4gTG9nZ2VkSW5WaWV3LCBzbyBuZWVkIHRvIGNoYW5nZSB0aGUgcGFnZSB0eXBlIHRvIGNsb3NlIHRoZSBwYW5lbCAod2Ugc3dpdGNoXG4gICAgICAgICAgICAvLyB0byB0aGUgaG9tZSBwYWdlIHdoaWNoIGlzIG5vdCBvYnZpb3VzbHkgdGhlIGNvcnJlY3QgdGhpbmcgdG8gZG8sIGJ1dCBJJ20gbm90IHN1cmVcbiAgICAgICAgICAgIC8vIGFueXRoaW5nIGVsc2UgaXMgLSB3ZSBjb3VsZCBoaWRlIHRoZSBjbG9zZSBidXR0b24gYWx0b2dldGhlcj8pXG4gICAgICAgICAgICBkaXMuZGlzcGF0Y2goe1xuICAgICAgICAgICAgICAgIGFjdGlvbjogQWN0aW9uLlZpZXdIb21lUGFnZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5waGFzZSA9PT0gUmlnaHRQYW5lbFBoYXNlcy5FbmNyeXB0aW9uUGFuZWwgJiZcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuY2FyZFN0YXRlLnZlcmlmaWNhdGlvblJlcXVlc3Q/LnBlbmRpbmdcbiAgICAgICAgKSB7XG4gICAgICAgICAgICAvLyBXaGVuIHRoZSB1c2VyIGNsaWNrcyBjbG9zZSBvbiB0aGUgZW5jcnlwdGlvbiBwYW5lbCBjYW5jZWwgdGhlIHBlbmRpbmcgcmVxdWVzdCBmaXJzdCBpZiBhbnlcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuY2FyZFN0YXRlLnZlcmlmaWNhdGlvblJlcXVlc3QuY2FuY2VsKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBSaWdodFBhbmVsU3RvcmUuaW5zdGFuY2UudG9nZ2xlUGFuZWwodGhpcy5wcm9wcy5yb29tPy5yb29tSWQpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25TZWFyY2hRdWVyeUNoYW5nZWQgPSAoc2VhcmNoUXVlcnk6IHN0cmluZyk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2VhcmNoUXVlcnkgfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyByZW5kZXIoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICBsZXQgY2FyZCA9IDxkaXYgLz47XG4gICAgICAgIGNvbnN0IHJvb21JZCA9IHRoaXMucHJvcHMucm9vbT8ucm9vbUlkO1xuICAgICAgICBjb25zdCBwaGFzZSA9IHRoaXMucHJvcHMub3ZlcndyaXRlQ2FyZD8ucGhhc2UgPz8gdGhpcy5zdGF0ZS5waGFzZTtcbiAgICAgICAgY29uc3QgY2FyZFN0YXRlID0gdGhpcy5wcm9wcy5vdmVyd3JpdGVDYXJkPy5zdGF0ZSA/PyB0aGlzLnN0YXRlLmNhcmRTdGF0ZTtcbiAgICAgICAgc3dpdGNoIChwaGFzZSkge1xuICAgICAgICAgICAgY2FzZSBSaWdodFBhbmVsUGhhc2VzLlJvb21NZW1iZXJMaXN0OlxuICAgICAgICAgICAgICAgIGlmIChyb29tSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FyZCA9IDxNZW1iZXJMaXN0XG4gICAgICAgICAgICAgICAgICAgICAgICByb29tSWQ9e3Jvb21JZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGtleT17cm9vbUlkfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZT17dGhpcy5vbkNsb3NlfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoUXVlcnk9e3RoaXMuc3RhdGUuc2VhcmNoUXVlcnl9XG4gICAgICAgICAgICAgICAgICAgICAgICBvblNlYXJjaFF1ZXJ5Q2hhbmdlZD17dGhpcy5vblNlYXJjaFF1ZXJ5Q2hhbmdlZH1cbiAgICAgICAgICAgICAgICAgICAgLz47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBSaWdodFBhbmVsUGhhc2VzLlNwYWNlTWVtYmVyTGlzdDpcbiAgICAgICAgICAgICAgICBjYXJkID0gPE1lbWJlckxpc3RcbiAgICAgICAgICAgICAgICAgICAgcm9vbUlkPXtjYXJkU3RhdGUuc3BhY2VJZCA/IGNhcmRTdGF0ZS5zcGFjZUlkIDogcm9vbUlkfVxuICAgICAgICAgICAgICAgICAgICBrZXk9e2NhcmRTdGF0ZS5zcGFjZUlkID8gY2FyZFN0YXRlLnNwYWNlSWQgOiByb29tSWR9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U9e3RoaXMub25DbG9zZX1cbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoUXVlcnk9e3RoaXMuc3RhdGUuc2VhcmNoUXVlcnl9XG4gICAgICAgICAgICAgICAgICAgIG9uU2VhcmNoUXVlcnlDaGFuZ2VkPXt0aGlzLm9uU2VhcmNoUXVlcnlDaGFuZ2VkfVxuICAgICAgICAgICAgICAgIC8+O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFJpZ2h0UGFuZWxQaGFzZXMuUm9vbU1lbWJlckluZm86XG4gICAgICAgICAgICBjYXNlIFJpZ2h0UGFuZWxQaGFzZXMuU3BhY2VNZW1iZXJJbmZvOlxuICAgICAgICAgICAgY2FzZSBSaWdodFBhbmVsUGhhc2VzLkVuY3J5cHRpb25QYW5lbDoge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvb21NZW1iZXIgPSBjYXJkU3RhdGUubWVtYmVyIGluc3RhbmNlb2YgUm9vbU1lbWJlclxuICAgICAgICAgICAgICAgICAgICA/IGNhcmRTdGF0ZS5tZW1iZXJcbiAgICAgICAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgY2FyZCA9IDxVc2VySW5mb1xuICAgICAgICAgICAgICAgICAgICB1c2VyPXtjYXJkU3RhdGUubWVtYmVyfVxuICAgICAgICAgICAgICAgICAgICByb29tPXt0aGlzLmNvbnRleHQuZ2V0Um9vbShyb29tTWVtYmVyPy5yb29tSWQpID8/IHRoaXMucHJvcHMucm9vbX1cbiAgICAgICAgICAgICAgICAgICAga2V5PXtyb29tSWQgfHwgY2FyZFN0YXRlLm1lbWJlci51c2VySWR9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U9e3RoaXMub25DbG9zZX1cbiAgICAgICAgICAgICAgICAgICAgcGhhc2U9e3BoYXNlfVxuICAgICAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25SZXF1ZXN0PXtjYXJkU3RhdGUudmVyaWZpY2F0aW9uUmVxdWVzdH1cbiAgICAgICAgICAgICAgICAgICAgdmVyaWZpY2F0aW9uUmVxdWVzdFByb21pc2U9e2NhcmRTdGF0ZS52ZXJpZmljYXRpb25SZXF1ZXN0UHJvbWlzZX1cbiAgICAgICAgICAgICAgICAvPjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgUmlnaHRQYW5lbFBoYXNlcy5Sb29tM3BpZE1lbWJlckluZm86XG4gICAgICAgICAgICBjYXNlIFJpZ2h0UGFuZWxQaGFzZXMuU3BhY2UzcGlkTWVtYmVySW5mbzpcbiAgICAgICAgICAgICAgICBjYXJkID0gPFRoaXJkUGFydHlNZW1iZXJJbmZvIGV2ZW50PXtjYXJkU3RhdGUubWVtYmVySW5mb0V2ZW50fSBrZXk9e3Jvb21JZH0gLz47XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgUmlnaHRQYW5lbFBoYXNlcy5Ob3RpZmljYXRpb25QYW5lbDpcbiAgICAgICAgICAgICAgICBjYXJkID0gPE5vdGlmaWNhdGlvblBhbmVsIG9uQ2xvc2U9e3RoaXMub25DbG9zZX0gLz47XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgUmlnaHRQYW5lbFBoYXNlcy5QaW5uZWRNZXNzYWdlczpcbiAgICAgICAgICAgICAgICBpZiAoU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcImZlYXR1cmVfcGlubmluZ1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBjYXJkID0gPFBpbm5lZE1lc3NhZ2VzQ2FyZFxuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbT17dGhpcy5wcm9wcy5yb29tfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZT17dGhpcy5vbkNsb3NlfVxuICAgICAgICAgICAgICAgICAgICAgICAgcGVybWFsaW5rQ3JlYXRvcj17dGhpcy5wcm9wcy5wZXJtYWxpbmtDcmVhdG9yfVxuICAgICAgICAgICAgICAgICAgICAvPjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFJpZ2h0UGFuZWxQaGFzZXMuVGltZWxpbmU6XG4gICAgICAgICAgICAgICAgY2FyZCA9IDxUaW1lbGluZUNhcmRcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lcz1cIm14X1RocmVhZFBhbmVsIG14X1RpbWVsaW5lQ2FyZFwiXG4gICAgICAgICAgICAgICAgICAgIHJvb209e3RoaXMucHJvcHMucm9vbX1cbiAgICAgICAgICAgICAgICAgICAgdGltZWxpbmVTZXQ9e3RoaXMucHJvcHMucm9vbS5nZXRVbmZpbHRlcmVkVGltZWxpbmVTZXQoKX1cbiAgICAgICAgICAgICAgICAgICAgcmVzaXplTm90aWZpZXI9e3RoaXMucHJvcHMucmVzaXplTm90aWZpZXJ9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U9e3RoaXMub25DbG9zZX1cbiAgICAgICAgICAgICAgICAgICAgcGVybWFsaW5rQ3JlYXRvcj17dGhpcy5wcm9wcy5wZXJtYWxpbmtDcmVhdG9yfVxuICAgICAgICAgICAgICAgICAgICBlMmVTdGF0dXM9e3RoaXMucHJvcHMuZTJlU3RhdHVzfVxuICAgICAgICAgICAgICAgIC8+O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBSaWdodFBhbmVsUGhhc2VzLkZpbGVQYW5lbDpcbiAgICAgICAgICAgICAgICBjYXJkID0gPEZpbGVQYW5lbCByb29tSWQ9e3Jvb21JZH0gcmVzaXplTm90aWZpZXI9e3RoaXMucHJvcHMucmVzaXplTm90aWZpZXJ9IG9uQ2xvc2U9e3RoaXMub25DbG9zZX0gLz47XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgUmlnaHRQYW5lbFBoYXNlcy5UaHJlYWRWaWV3OlxuICAgICAgICAgICAgICAgIGNhcmQgPSA8VGhyZWFkVmlld1xuICAgICAgICAgICAgICAgICAgICByb29tPXt0aGlzLnByb3BzLnJvb219XG4gICAgICAgICAgICAgICAgICAgIHJlc2l6ZU5vdGlmaWVyPXt0aGlzLnByb3BzLnJlc2l6ZU5vdGlmaWVyfVxuICAgICAgICAgICAgICAgICAgICBvbkNsb3NlPXt0aGlzLm9uQ2xvc2V9XG4gICAgICAgICAgICAgICAgICAgIG14RXZlbnQ9e2NhcmRTdGF0ZS50aHJlYWRIZWFkRXZlbnR9XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxFdmVudD17Y2FyZFN0YXRlLmluaXRpYWxFdmVudH1cbiAgICAgICAgICAgICAgICAgICAgaXNJbml0aWFsRXZlbnRIaWdobGlnaHRlZD17Y2FyZFN0YXRlLmlzSW5pdGlhbEV2ZW50SGlnaGxpZ2h0ZWR9XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxFdmVudFNjcm9sbEludG9WaWV3PXtjYXJkU3RhdGUuaW5pdGlhbEV2ZW50U2Nyb2xsSW50b1ZpZXd9XG4gICAgICAgICAgICAgICAgICAgIHBlcm1hbGlua0NyZWF0b3I9e3RoaXMucHJvcHMucGVybWFsaW5rQ3JlYXRvcn1cbiAgICAgICAgICAgICAgICAgICAgZTJlU3RhdHVzPXt0aGlzLnByb3BzLmUyZVN0YXR1c31cbiAgICAgICAgICAgICAgICAvPjtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBSaWdodFBhbmVsUGhhc2VzLlRocmVhZFBhbmVsOlxuICAgICAgICAgICAgICAgIGNhcmQgPSA8VGhyZWFkUGFuZWxcbiAgICAgICAgICAgICAgICAgICAgcm9vbUlkPXtyb29tSWR9XG4gICAgICAgICAgICAgICAgICAgIHJlc2l6ZU5vdGlmaWVyPXt0aGlzLnByb3BzLnJlc2l6ZU5vdGlmaWVyfVxuICAgICAgICAgICAgICAgICAgICBvbkNsb3NlPXt0aGlzLm9uQ2xvc2V9XG4gICAgICAgICAgICAgICAgICAgIHBlcm1hbGlua0NyZWF0b3I9e3RoaXMucHJvcHMucGVybWFsaW5rQ3JlYXRvcn1cbiAgICAgICAgICAgICAgICAvPjtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBSaWdodFBhbmVsUGhhc2VzLlJvb21TdW1tYXJ5OlxuICAgICAgICAgICAgICAgIGNhcmQgPSA8Um9vbVN1bW1hcnlDYXJkIHJvb209e3RoaXMucHJvcHMucm9vbX0gb25DbG9zZT17dGhpcy5vbkNsb3NlfSAvPjtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBSaWdodFBhbmVsUGhhc2VzLldpZGdldDpcbiAgICAgICAgICAgICAgICBjYXJkID0gPFdpZGdldENhcmRcbiAgICAgICAgICAgICAgICAgICAgcm9vbT17dGhpcy5wcm9wcy5yb29tfVxuICAgICAgICAgICAgICAgICAgICB3aWRnZXRJZD17Y2FyZFN0YXRlLndpZGdldElkfVxuICAgICAgICAgICAgICAgICAgICBvbkNsb3NlPXt0aGlzLm9uQ2xvc2V9XG4gICAgICAgICAgICAgICAgLz47XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGFzaWRlIGNsYXNzTmFtZT1cIm14X1JpZ2h0UGFuZWwgZGFyay1wYW5lbFwiIGlkPVwibXhfUmlnaHRQYW5lbFwiPlxuICAgICAgICAgICAgICAgIHsgY2FyZCB9XG4gICAgICAgICAgICA8L2FzaWRlPlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpQkE7O0FBRUE7O0FBQ0E7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBR0E7O0FBQ0E7O0FBRUE7Ozs7OztBQWdCZSxNQUFNQSxVQUFOLFNBQXlCQyxjQUFBLENBQU1DLFNBQS9CLENBQXlEO0VBSXBFQyxXQUFXLENBQUNDLEtBQUQsRUFBUUMsT0FBUixFQUFpQjtJQUN4QixNQUFNRCxLQUFOLEVBQWFDLE9BQWI7SUFEd0I7SUFBQSxxREFRSyxJQUFBQyxnQkFBQSxFQUFTLE1BQVk7TUFDbEQsS0FBS0MsV0FBTDtJQUNILENBRmdDLEVBRTlCLEdBRjhCLEVBRXpCO01BQUVDLE9BQU8sRUFBRSxJQUFYO01BQWlCQyxRQUFRLEVBQUU7SUFBM0IsQ0FGeUIsQ0FSTDtJQUFBLHlEQWtDQSxDQUFDQyxFQUFELEVBQWtCQyxLQUFsQixFQUFvQ0MsTUFBcEMsS0FBMkQ7TUFDbkYsSUFBSSxDQUFDLEtBQUtSLEtBQUwsQ0FBV1MsSUFBWixJQUFvQkQsTUFBTSxDQUFDRSxNQUFQLEtBQWtCLEtBQUtWLEtBQUwsQ0FBV1MsSUFBWCxDQUFnQkMsTUFBMUQs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
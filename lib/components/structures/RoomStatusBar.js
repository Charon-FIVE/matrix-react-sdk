"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
exports.getUnsentMessages = getUnsentMessages;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _event = require("matrix-js-sdk/src/models/event");

var _languageHandler = require("../../languageHandler");

var _Resend = _interopRequireDefault(require("../../Resend"));

var _dispatcher = _interopRequireDefault(require("../../dispatcher/dispatcher"));

var _ErrorUtils = require("../../utils/ErrorUtils");

var _actions = require("../../dispatcher/actions");

var _StaticNotificationState = require("../../stores/notifications/StaticNotificationState");

var _AccessibleButton = _interopRequireDefault(require("../views/elements/AccessibleButton"));

var _InlineSpinner = _interopRequireDefault(require("../views/elements/InlineSpinner"));

var _MatrixClientContext = _interopRequireDefault(require("../../contexts/MatrixClientContext"));

var _RoomStatusBarUnsentMessages = require("./RoomStatusBarUnsentMessages");

/*
Copyright 2015-2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const STATUS_BAR_HIDDEN = 0;
const STATUS_BAR_EXPANDED = 1;
const STATUS_BAR_EXPANDED_LARGE = 2;

function getUnsentMessages(room) {
  if (!room) {
    return [];
  }

  return room.getPendingEvents().filter(function (ev) {
    return ev.status === _event.EventStatus.NOT_SENT;
  });
}

class RoomStatusBar extends _react.default.PureComponent {
  constructor(props, context) {
    super(props, context);
    (0, _defineProperty2.default)(this, "unmounted", false);
    (0, _defineProperty2.default)(this, "onSyncStateChange", (state, prevState, data) => {
      if (state === "SYNCING" && prevState === "SYNCING") {
        return;
      }

      if (this.unmounted) return;
      this.setState({
        syncState: state,
        syncStateData: data
      });
    });
    (0, _defineProperty2.default)(this, "onResendAllClick", () => {
      _Resend.default.resendUnsentEvents(this.props.room).then(() => {
        this.setState({
          isResending: false
        });
      });

      this.setState({
        isResending: true
      });

      _dispatcher.default.fire(_actions.Action.FocusSendMessageComposer);
    });
    (0, _defineProperty2.default)(this, "onCancelAllClick", () => {
      _Resend.default.cancelUnsentEvents(this.props.room);

      _dispatcher.default.fire(_actions.Action.FocusSendMessageComposer);
    });
    (0, _defineProperty2.default)(this, "onRoomLocalEchoUpdated", (ev, room) => {
      if (room.roomId !== this.props.room.roomId) return;
      const messages = getUnsentMessages(this.props.room);
      this.setState({
        unsentMessages: messages,
        isResending: messages.length > 0 && this.state.isResending
      });
    });
    this.state = {
      syncState: this.context.getSyncState(),
      syncStateData: this.context.getSyncStateData(),
      unsentMessages: getUnsentMessages(this.props.room),
      isResending: false
    };
  }

  componentDidMount() {
    const client = this.context;
    client.on("sync", this.onSyncStateChange);
    client.on("Room.localEchoUpdated", this.onRoomLocalEchoUpdated);
    this.checkSize();
  }

  componentDidUpdate() {
    this.checkSize();
  }

  componentWillUnmount() {
    this.unmounted = true; // we may have entirely lost our client as we're logging out before clicking login on the guest bar...

    const client = this.context;

    if (client) {
      client.removeListener("sync", this.onSyncStateChange);
      client.removeListener("Room.localEchoUpdated", this.onRoomLocalEchoUpdated);
    }
  }

  // Check whether current size is greater than 0, if yes call props.onVisible
  checkSize() {
    if (this.getSize()) {
      if (this.props.onVisible) this.props.onVisible();
    } else {
      if (this.props.onHidden) this.props.onHidden();
    }
  } // We don't need the actual height - just whether it is likely to have
  // changed - so we use '0' to indicate normal size, and other values to
  // indicate other sizes.


  getSize() {
    if (this.shouldShowConnectionError()) {
      return STATUS_BAR_EXPANDED;
    } else if (this.state.unsentMessages.length > 0 || this.state.isResending) {
      return STATUS_BAR_EXPANDED_LARGE;
    }

    return STATUS_BAR_HIDDEN;
  }

  shouldShowConnectionError() {
    // no conn bar trumps the "some not sent" msg since you can't resend without
    // a connection!
    // There's one situation in which we don't show this 'no connection' bar, and that's
    // if it's a resource limit exceeded error: those are shown in the top bar.
    const errorIsMauError = Boolean(this.state.syncStateData && this.state.syncStateData.error && this.state.syncStateData.error.name === 'M_RESOURCE_LIMIT_EXCEEDED');
    return this.state.syncState === "ERROR" && !errorIsMauError;
  }

  getUnsentMessageContent() {
    const unsentMessages = this.state.unsentMessages;
    let title;
    let consentError = null;
    let resourceLimitError = null;

    for (const m of unsentMessages) {
      if (m.error && m.error.errcode === 'M_CONSENT_NOT_GIVEN') {
        consentError = m.error;
        break;
      } else if (m.error && m.error.errcode === 'M_RESOURCE_LIMIT_EXCEEDED') {
        resourceLimitError = m.error;
        break;
      }
    }

    if (consentError) {
      title = (0, _languageHandler._t)("You can't send any messages until you review and agree to " + "<consentLink>our terms and conditions</consentLink>.", {}, {
        'consentLink': sub => /*#__PURE__*/_react.default.createElement("a", {
          href: consentError.data && consentError.data.consent_uri,
          target: "_blank"
        }, sub)
      });
    } else if (resourceLimitError) {
      title = (0, _ErrorUtils.messageForResourceLimitError)(resourceLimitError.data.limit_type, resourceLimitError.data.admin_contact, {
        'monthly_active_user': (0, _languageHandler._td)("Your message wasn't sent because this homeserver has hit its Monthly Active User Limit. " + "Please <a>contact your service administrator</a> to continue using the service."),
        'hs_disabled': (0, _languageHandler._td)("Your message wasn't sent because this homeserver has been blocked by its administrator. " + "Please <a>contact your service administrator</a> to continue using the service."),
        '': (0, _languageHandler._td)("Your message wasn't sent because this homeserver has exceeded a resource limit. " + "Please <a>contact your service administrator</a> to continue using the service.")
      });
    } else {
      title = (0, _languageHandler._t)('Some of your messages have not been sent');
    }

    let buttonRow = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.onCancelAllClick,
      className: "mx_RoomStatusBar_unsentCancelAllBtn"
    }, (0, _languageHandler._t)("Delete all")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.onResendAllClick,
      className: "mx_RoomStatusBar_unsentRetry"
    }, (0, _languageHandler._t)("Retry all")));

    if (this.state.isResending) {
      buttonRow = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_InlineSpinner.default, {
        w: 20,
        h: 20
      }), /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("Sending")));
    }

    return /*#__PURE__*/_react.default.createElement(_RoomStatusBarUnsentMessages.RoomStatusBarUnsentMessages, {
      title: title,
      description: (0, _languageHandler._t)("You can select all or individual messages to retry or delete"),
      notificationState: _StaticNotificationState.StaticNotificationState.RED_EXCLAMATION,
      buttons: buttonRow
    });
  }

  render() {
    if (this.shouldShowConnectionError()) {
      return /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_RoomStatusBar"
      }, /*#__PURE__*/_react.default.createElement("div", {
        role: "alert"
      }, /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_RoomStatusBar_connectionLostBar"
      }, /*#__PURE__*/_react.default.createElement("img", {
        src: require("../../../res/img/feather-customised/warning-triangle.svg").default,
        width: "24",
        height: "24",
        title: "/!\\ ",
        alt: "/!\\ "
      }), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_RoomStatusBar_connectionLostBar_title"
      }, (0, _languageHandler._t)('Connectivity to the server has been lost.')), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_RoomStatusBar_connectionLostBar_desc"
      }, (0, _languageHandler._t)('Sent messages will be stored until your connection has returned.'))))));
    }

    if (this.state.unsentMessages.length > 0 || this.state.isResending) {
      return this.getUnsentMessageContent();
    }

    return null;
  }

}

exports.default = RoomStatusBar;
(0, _defineProperty2.default)(RoomStatusBar, "contextType", _MatrixClientContext.default);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTVEFUVVNfQkFSX0hJRERFTiIsIlNUQVRVU19CQVJfRVhQQU5ERUQiLCJTVEFUVVNfQkFSX0VYUEFOREVEX0xBUkdFIiwiZ2V0VW5zZW50TWVzc2FnZXMiLCJyb29tIiwiZ2V0UGVuZGluZ0V2ZW50cyIsImZpbHRlciIsImV2Iiwic3RhdHVzIiwiRXZlbnRTdGF0dXMiLCJOT1RfU0VOVCIsIlJvb21TdGF0dXNCYXIiLCJSZWFjdCIsIlB1cmVDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiY29udGV4dCIsInN0YXRlIiwicHJldlN0YXRlIiwiZGF0YSIsInVubW91bnRlZCIsInNldFN0YXRlIiwic3luY1N0YXRlIiwic3luY1N0YXRlRGF0YSIsIlJlc2VuZCIsInJlc2VuZFVuc2VudEV2ZW50cyIsInRoZW4iLCJpc1Jlc2VuZGluZyIsImRpcyIsImZpcmUiLCJBY3Rpb24iLCJGb2N1c1NlbmRNZXNzYWdlQ29tcG9zZXIiLCJjYW5jZWxVbnNlbnRFdmVudHMiLCJyb29tSWQiLCJtZXNzYWdlcyIsInVuc2VudE1lc3NhZ2VzIiwibGVuZ3RoIiwiZ2V0U3luY1N0YXRlIiwiZ2V0U3luY1N0YXRlRGF0YSIsImNvbXBvbmVudERpZE1vdW50IiwiY2xpZW50Iiwib24iLCJvblN5bmNTdGF0ZUNoYW5nZSIsIm9uUm9vbUxvY2FsRWNob1VwZGF0ZWQiLCJjaGVja1NpemUiLCJjb21wb25lbnREaWRVcGRhdGUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInJlbW92ZUxpc3RlbmVyIiwiZ2V0U2l6ZSIsIm9uVmlzaWJsZSIsIm9uSGlkZGVuIiwic2hvdWxkU2hvd0Nvbm5lY3Rpb25FcnJvciIsImVycm9ySXNNYXVFcnJvciIsIkJvb2xlYW4iLCJlcnJvciIsIm5hbWUiLCJnZXRVbnNlbnRNZXNzYWdlQ29udGVudCIsInRpdGxlIiwiY29uc2VudEVycm9yIiwicmVzb3VyY2VMaW1pdEVycm9yIiwibSIsImVycmNvZGUiLCJfdCIsInN1YiIsImNvbnNlbnRfdXJpIiwibWVzc2FnZUZvclJlc291cmNlTGltaXRFcnJvciIsImxpbWl0X3R5cGUiLCJhZG1pbl9jb250YWN0IiwiX3RkIiwiYnV0dG9uUm93Iiwib25DYW5jZWxBbGxDbGljayIsIm9uUmVzZW5kQWxsQ2xpY2siLCJTdGF0aWNOb3RpZmljYXRpb25TdGF0ZSIsIlJFRF9FWENMQU1BVElPTiIsInJlbmRlciIsInJlcXVpcmUiLCJkZWZhdWx0IiwiTWF0cml4Q2xpZW50Q29udGV4dCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3N0cnVjdHVyZXMvUm9vbVN0YXR1c0Jhci50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE1LTIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgRXZlbnRTdGF0dXMsIE1hdHJpeEV2ZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9ldmVudFwiO1xuaW1wb3J0IHsgU3luY1N0YXRlLCBJU3luY1N0YXRlRGF0YSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9zeW5jXCI7XG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tXCI7XG5cbmltcG9ydCB7IF90LCBfdGQgfSBmcm9tICcuLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IFJlc2VuZCBmcm9tICcuLi8uLi9SZXNlbmQnO1xuaW1wb3J0IGRpcyBmcm9tICcuLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXInO1xuaW1wb3J0IHsgbWVzc2FnZUZvclJlc291cmNlTGltaXRFcnJvciB9IGZyb20gJy4uLy4uL3V0aWxzL0Vycm9yVXRpbHMnO1xuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSBcIi4uLy4uL2Rpc3BhdGNoZXIvYWN0aW9uc1wiO1xuaW1wb3J0IHsgU3RhdGljTm90aWZpY2F0aW9uU3RhdGUgfSBmcm9tIFwiLi4vLi4vc3RvcmVzL25vdGlmaWNhdGlvbnMvU3RhdGljTm90aWZpY2F0aW9uU3RhdGVcIjtcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gXCIuLi92aWV3cy9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uXCI7XG5pbXBvcnQgSW5saW5lU3Bpbm5lciBmcm9tIFwiLi4vdmlld3MvZWxlbWVudHMvSW5saW5lU3Bpbm5lclwiO1xuaW1wb3J0IE1hdHJpeENsaWVudENvbnRleHQgZnJvbSBcIi4uLy4uL2NvbnRleHRzL01hdHJpeENsaWVudENvbnRleHRcIjtcbmltcG9ydCB7IFJvb21TdGF0dXNCYXJVbnNlbnRNZXNzYWdlcyB9IGZyb20gJy4vUm9vbVN0YXR1c0JhclVuc2VudE1lc3NhZ2VzJztcblxuY29uc3QgU1RBVFVTX0JBUl9ISURERU4gPSAwO1xuY29uc3QgU1RBVFVTX0JBUl9FWFBBTkRFRCA9IDE7XG5jb25zdCBTVEFUVVNfQkFSX0VYUEFOREVEX0xBUkdFID0gMjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFVuc2VudE1lc3NhZ2VzKHJvb206IFJvb20pOiBNYXRyaXhFdmVudFtdIHtcbiAgICBpZiAoIXJvb20pIHsgcmV0dXJuIFtdOyB9XG4gICAgcmV0dXJuIHJvb20uZ2V0UGVuZGluZ0V2ZW50cygpLmZpbHRlcihmdW5jdGlvbihldikge1xuICAgICAgICByZXR1cm4gZXYuc3RhdHVzID09PSBFdmVudFN0YXR1cy5OT1RfU0VOVDtcbiAgICB9KTtcbn1cblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgLy8gdGhlIHJvb20gdGhpcyBzdGF0dXNiYXIgaXMgcmVwcmVzZW50aW5nLlxuICAgIHJvb206IFJvb207XG5cbiAgICAvLyB0cnVlIGlmIHRoZSByb29tIGlzIGJlaW5nIHBlZWtlZCBhdC4gVGhpcyBhZmZlY3RzIGNvbXBvbmVudHMgdGhhdCBzaG91bGRuJ3RcbiAgICAvLyBsb2dpY2FsbHkgYmUgc2hvd24gd2hlbiBwZWVraW5nLCBzdWNoIGFzIGEgcHJvbXB0IHRvIGludml0ZSBwZW9wbGUgdG8gYSByb29tLlxuICAgIGlzUGVla2luZz86IGJvb2xlYW47XG4gICAgLy8gY2FsbGJhY2sgZm9yIHdoZW4gdGhlIHVzZXIgY2xpY2tzIG9uIHRoZSAncmVzZW5kIGFsbCcgYnV0dG9uIGluIHRoZVxuICAgIC8vICd1bnNlbnQgbWVzc2FnZXMnIGJhclxuICAgIG9uUmVzZW5kQWxsQ2xpY2s/OiAoKSA9PiB2b2lkO1xuXG4gICAgLy8gY2FsbGJhY2sgZm9yIHdoZW4gdGhlIHVzZXIgY2xpY2tzIG9uIHRoZSAnY2FuY2VsIGFsbCcgYnV0dG9uIGluIHRoZVxuICAgIC8vICd1bnNlbnQgbWVzc2FnZXMnIGJhclxuICAgIG9uQ2FuY2VsQWxsQ2xpY2s/OiAoKSA9PiB2b2lkO1xuXG4gICAgLy8gY2FsbGJhY2sgZm9yIHdoZW4gdGhlIHVzZXIgY2xpY2tzIG9uIHRoZSAnaW52aXRlIG90aGVycycgYnV0dG9uIGluIHRoZVxuICAgIC8vICd5b3UgYXJlIGFsb25lJyBiYXJcbiAgICBvbkludml0ZUNsaWNrPzogKCkgPT4gdm9pZDtcblxuICAgIC8vIGNhbGxiYWNrIGZvciB3aGVuIHdlIGRvIHNvbWV0aGluZyB0aGF0IGNoYW5nZXMgdGhlIHNpemUgb2YgdGhlXG4gICAgLy8gc3RhdHVzIGJhci4gVGhpcyBpcyB1c2VkIHRvIHRyaWdnZXIgYSByZS1sYXlvdXQgaW4gdGhlIHBhcmVudFxuICAgIC8vIGNvbXBvbmVudC5cbiAgICBvblJlc2l6ZT86ICgpID0+IHZvaWQ7XG5cbiAgICAvLyBjYWxsYmFjayBmb3Igd2hlbiB0aGUgc3RhdHVzIGJhciBjYW4gYmUgaGlkZGVuIGZyb20gdmlldywgYXMgaXQgaXNcbiAgICAvLyBub3QgZGlzcGxheWluZyBhbnl0aGluZ1xuICAgIG9uSGlkZGVuPzogKCkgPT4gdm9pZDtcblxuICAgIC8vIGNhbGxiYWNrIGZvciB3aGVuIHRoZSBzdGF0dXMgYmFyIGlzIGRpc3BsYXlpbmcgc29tZXRoaW5nIGFuZCBzaG91bGRcbiAgICAvLyBiZSB2aXNpYmxlXG4gICAgb25WaXNpYmxlPzogKCkgPT4gdm9pZDtcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgc3luY1N0YXRlOiBTeW5jU3RhdGU7XG4gICAgc3luY1N0YXRlRGF0YTogSVN5bmNTdGF0ZURhdGE7XG4gICAgdW5zZW50TWVzc2FnZXM6IE1hdHJpeEV2ZW50W107XG4gICAgaXNSZXNlbmRpbmc6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJvb21TdGF0dXNCYXIgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSB1bm1vdW50ZWQgPSBmYWxzZTtcbiAgICBwdWJsaWMgc3RhdGljIGNvbnRleHRUeXBlID0gTWF0cml4Q2xpZW50Q29udGV4dDtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMsIGNvbnRleHQ6IHR5cGVvZiBNYXRyaXhDbGllbnRDb250ZXh0KSB7XG4gICAgICAgIHN1cGVyKHByb3BzLCBjb250ZXh0KTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgc3luY1N0YXRlOiB0aGlzLmNvbnRleHQuZ2V0U3luY1N0YXRlKCksXG4gICAgICAgICAgICBzeW5jU3RhdGVEYXRhOiB0aGlzLmNvbnRleHQuZ2V0U3luY1N0YXRlRGF0YSgpLFxuICAgICAgICAgICAgdW5zZW50TWVzc2FnZXM6IGdldFVuc2VudE1lc3NhZ2VzKHRoaXMucHJvcHMucm9vbSksXG4gICAgICAgICAgICBpc1Jlc2VuZGluZzogZmFsc2UsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xuICAgICAgICBjb25zdCBjbGllbnQgPSB0aGlzLmNvbnRleHQ7XG4gICAgICAgIGNsaWVudC5vbihcInN5bmNcIiwgdGhpcy5vblN5bmNTdGF0ZUNoYW5nZSk7XG4gICAgICAgIGNsaWVudC5vbihcIlJvb20ubG9jYWxFY2hvVXBkYXRlZFwiLCB0aGlzLm9uUm9vbUxvY2FsRWNob1VwZGF0ZWQpO1xuXG4gICAgICAgIHRoaXMuY2hlY2tTaXplKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudERpZFVwZGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jaGVja1NpemUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50V2lsbFVubW91bnQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMudW5tb3VudGVkID0gdHJ1ZTtcbiAgICAgICAgLy8gd2UgbWF5IGhhdmUgZW50aXJlbHkgbG9zdCBvdXIgY2xpZW50IGFzIHdlJ3JlIGxvZ2dpbmcgb3V0IGJlZm9yZSBjbGlja2luZyBsb2dpbiBvbiB0aGUgZ3Vlc3QgYmFyLi4uXG4gICAgICAgIGNvbnN0IGNsaWVudCA9IHRoaXMuY29udGV4dDtcbiAgICAgICAgaWYgKGNsaWVudCkge1xuICAgICAgICAgICAgY2xpZW50LnJlbW92ZUxpc3RlbmVyKFwic3luY1wiLCB0aGlzLm9uU3luY1N0YXRlQ2hhbmdlKTtcbiAgICAgICAgICAgIGNsaWVudC5yZW1vdmVMaXN0ZW5lcihcIlJvb20ubG9jYWxFY2hvVXBkYXRlZFwiLCB0aGlzLm9uUm9vbUxvY2FsRWNob1VwZGF0ZWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblN5bmNTdGF0ZUNoYW5nZSA9IChzdGF0ZTogU3luY1N0YXRlLCBwcmV2U3RhdGU6IFN5bmNTdGF0ZSwgZGF0YTogSVN5bmNTdGF0ZURhdGEpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKHN0YXRlID09PSBcIlNZTkNJTkdcIiAmJiBwcmV2U3RhdGUgPT09IFwiU1lOQ0lOR1wiKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudW5tb3VudGVkKSByZXR1cm47XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc3luY1N0YXRlOiBzdGF0ZSxcbiAgICAgICAgICAgIHN5bmNTdGF0ZURhdGE6IGRhdGEsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUmVzZW5kQWxsQ2xpY2sgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIFJlc2VuZC5yZXNlbmRVbnNlbnRFdmVudHModGhpcy5wcm9wcy5yb29tKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpc1Jlc2VuZGluZzogZmFsc2UgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgaXNSZXNlbmRpbmc6IHRydWUgfSk7XG4gICAgICAgIGRpcy5maXJlKEFjdGlvbi5Gb2N1c1NlbmRNZXNzYWdlQ29tcG9zZXIpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQ2FuY2VsQWxsQ2xpY2sgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIFJlc2VuZC5jYW5jZWxVbnNlbnRFdmVudHModGhpcy5wcm9wcy5yb29tKTtcbiAgICAgICAgZGlzLmZpcmUoQWN0aW9uLkZvY3VzU2VuZE1lc3NhZ2VDb21wb3Nlcik7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Sb29tTG9jYWxFY2hvVXBkYXRlZCA9IChldjogTWF0cml4RXZlbnQsIHJvb206IFJvb20pID0+IHtcbiAgICAgICAgaWYgKHJvb20ucm9vbUlkICE9PSB0aGlzLnByb3BzLnJvb20ucm9vbUlkKSByZXR1cm47XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gZ2V0VW5zZW50TWVzc2FnZXModGhpcy5wcm9wcy5yb29tKTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICB1bnNlbnRNZXNzYWdlczogbWVzc2FnZXMsXG4gICAgICAgICAgICBpc1Jlc2VuZGluZzogbWVzc2FnZXMubGVuZ3RoID4gMCAmJiB0aGlzLnN0YXRlLmlzUmVzZW5kaW5nLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLy8gQ2hlY2sgd2hldGhlciBjdXJyZW50IHNpemUgaXMgZ3JlYXRlciB0aGFuIDAsIGlmIHllcyBjYWxsIHByb3BzLm9uVmlzaWJsZVxuICAgIHByaXZhdGUgY2hlY2tTaXplKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5nZXRTaXplKCkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLm9uVmlzaWJsZSkgdGhpcy5wcm9wcy5vblZpc2libGUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLm9uSGlkZGVuKSB0aGlzLnByb3BzLm9uSGlkZGVuKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBXZSBkb24ndCBuZWVkIHRoZSBhY3R1YWwgaGVpZ2h0IC0ganVzdCB3aGV0aGVyIGl0IGlzIGxpa2VseSB0byBoYXZlXG4gICAgLy8gY2hhbmdlZCAtIHNvIHdlIHVzZSAnMCcgdG8gaW5kaWNhdGUgbm9ybWFsIHNpemUsIGFuZCBvdGhlciB2YWx1ZXMgdG9cbiAgICAvLyBpbmRpY2F0ZSBvdGhlciBzaXplcy5cbiAgICBwcml2YXRlIGdldFNpemUoKTogbnVtYmVyIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkU2hvd0Nvbm5lY3Rpb25FcnJvcigpKSB7XG4gICAgICAgICAgICByZXR1cm4gU1RBVFVTX0JBUl9FWFBBTkRFRDtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLnVuc2VudE1lc3NhZ2VzLmxlbmd0aCA+IDAgfHwgdGhpcy5zdGF0ZS5pc1Jlc2VuZGluZykge1xuICAgICAgICAgICAgcmV0dXJuIFNUQVRVU19CQVJfRVhQQU5ERURfTEFSR0U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFNUQVRVU19CQVJfSElEREVOO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2hvdWxkU2hvd0Nvbm5lY3Rpb25FcnJvcigpOiBib29sZWFuIHtcbiAgICAgICAgLy8gbm8gY29ubiBiYXIgdHJ1bXBzIHRoZSBcInNvbWUgbm90IHNlbnRcIiBtc2cgc2luY2UgeW91IGNhbid0IHJlc2VuZCB3aXRob3V0XG4gICAgICAgIC8vIGEgY29ubmVjdGlvbiFcbiAgICAgICAgLy8gVGhlcmUncyBvbmUgc2l0dWF0aW9uIGluIHdoaWNoIHdlIGRvbid0IHNob3cgdGhpcyAnbm8gY29ubmVjdGlvbicgYmFyLCBhbmQgdGhhdCdzXG4gICAgICAgIC8vIGlmIGl0J3MgYSByZXNvdXJjZSBsaW1pdCBleGNlZWRlZCBlcnJvcjogdGhvc2UgYXJlIHNob3duIGluIHRoZSB0b3AgYmFyLlxuICAgICAgICBjb25zdCBlcnJvcklzTWF1RXJyb3IgPSBCb29sZWFuKFxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5zeW5jU3RhdGVEYXRhICYmXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnN5bmNTdGF0ZURhdGEuZXJyb3IgJiZcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuc3luY1N0YXRlRGF0YS5lcnJvci5uYW1lID09PSAnTV9SRVNPVVJDRV9MSU1JVF9FWENFRURFRCcsXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnN5bmNTdGF0ZSA9PT0gXCJFUlJPUlwiICYmICFlcnJvcklzTWF1RXJyb3I7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRVbnNlbnRNZXNzYWdlQ29udGVudCgpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGNvbnN0IHVuc2VudE1lc3NhZ2VzID0gdGhpcy5zdGF0ZS51bnNlbnRNZXNzYWdlcztcblxuICAgICAgICBsZXQgdGl0bGU7XG5cbiAgICAgICAgbGV0IGNvbnNlbnRFcnJvciA9IG51bGw7XG4gICAgICAgIGxldCByZXNvdXJjZUxpbWl0RXJyb3IgPSBudWxsO1xuICAgICAgICBmb3IgKGNvbnN0IG0gb2YgdW5zZW50TWVzc2FnZXMpIHtcbiAgICAgICAgICAgIGlmIChtLmVycm9yICYmIG0uZXJyb3IuZXJyY29kZSA9PT0gJ01fQ09OU0VOVF9OT1RfR0lWRU4nKSB7XG4gICAgICAgICAgICAgICAgY29uc2VudEVycm9yID0gbS5lcnJvcjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobS5lcnJvciAmJiBtLmVycm9yLmVycmNvZGUgPT09ICdNX1JFU09VUkNFX0xJTUlUX0VYQ0VFREVEJykge1xuICAgICAgICAgICAgICAgIHJlc291cmNlTGltaXRFcnJvciA9IG0uZXJyb3I7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnNlbnRFcnJvcikge1xuICAgICAgICAgICAgdGl0bGUgPSBfdChcbiAgICAgICAgICAgICAgICBcIllvdSBjYW4ndCBzZW5kIGFueSBtZXNzYWdlcyB1bnRpbCB5b3UgcmV2aWV3IGFuZCBhZ3JlZSB0byBcIiArXG4gICAgICAgICAgICAgICAgXCI8Y29uc2VudExpbms+b3VyIHRlcm1zIGFuZCBjb25kaXRpb25zPC9jb25zZW50TGluaz4uXCIsXG4gICAgICAgICAgICAgICAge30sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAnY29uc2VudExpbmsnOiAoc3ViKSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj17Y29uc2VudEVycm9yLmRhdGEgJiYgY29uc2VudEVycm9yLmRhdGEuY29uc2VudF91cml9IHRhcmdldD1cIl9ibGFua1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgc3ViIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSBpZiAocmVzb3VyY2VMaW1pdEVycm9yKSB7XG4gICAgICAgICAgICB0aXRsZSA9IG1lc3NhZ2VGb3JSZXNvdXJjZUxpbWl0RXJyb3IoXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VMaW1pdEVycm9yLmRhdGEubGltaXRfdHlwZSxcbiAgICAgICAgICAgICAgICByZXNvdXJjZUxpbWl0RXJyb3IuZGF0YS5hZG1pbl9jb250YWN0LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgJ21vbnRobHlfYWN0aXZlX3VzZXInOiBfdGQoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIllvdXIgbWVzc2FnZSB3YXNuJ3Qgc2VudCBiZWNhdXNlIHRoaXMgaG9tZXNlcnZlciBoYXMgaGl0IGl0cyBNb250aGx5IEFjdGl2ZSBVc2VyIExpbWl0LiBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICBcIlBsZWFzZSA8YT5jb250YWN0IHlvdXIgc2VydmljZSBhZG1pbmlzdHJhdG9yPC9hPiB0byBjb250aW51ZSB1c2luZyB0aGUgc2VydmljZS5cIixcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgJ2hzX2Rpc2FibGVkJzogX3RkKFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJZb3VyIG1lc3NhZ2Ugd2Fzbid0IHNlbnQgYmVjYXVzZSB0aGlzIGhvbWVzZXJ2ZXIgaGFzIGJlZW4gYmxvY2tlZCBieSBpdHMgYWRtaW5pc3RyYXRvci4gXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJQbGVhc2UgPGE+Y29udGFjdCB5b3VyIHNlcnZpY2UgYWRtaW5pc3RyYXRvcjwvYT4gdG8gY29udGludWUgdXNpbmcgdGhlIHNlcnZpY2UuXCIsXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICcnOiBfdGQoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIllvdXIgbWVzc2FnZSB3YXNuJ3Qgc2VudCBiZWNhdXNlIHRoaXMgaG9tZXNlcnZlciBoYXMgZXhjZWVkZWQgYSByZXNvdXJjZSBsaW1pdC4gXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJQbGVhc2UgPGE+Y29udGFjdCB5b3VyIHNlcnZpY2UgYWRtaW5pc3RyYXRvcjwvYT4gdG8gY29udGludWUgdXNpbmcgdGhlIHNlcnZpY2UuXCIsXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aXRsZSA9IF90KCdTb21lIG9mIHlvdXIgbWVzc2FnZXMgaGF2ZSBub3QgYmVlbiBzZW50Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgYnV0dG9uUm93ID0gPD5cbiAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIG9uQ2xpY2s9e3RoaXMub25DYW5jZWxBbGxDbGlja30gY2xhc3NOYW1lPVwibXhfUm9vbVN0YXR1c0Jhcl91bnNlbnRDYW5jZWxBbGxCdG5cIj5cbiAgICAgICAgICAgICAgICB7IF90KFwiRGVsZXRlIGFsbFwiKSB9XG4gICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBvbkNsaWNrPXt0aGlzLm9uUmVzZW5kQWxsQ2xpY2t9IGNsYXNzTmFtZT1cIm14X1Jvb21TdGF0dXNCYXJfdW5zZW50UmV0cnlcIj5cbiAgICAgICAgICAgICAgICB7IF90KFwiUmV0cnkgYWxsXCIpIH1cbiAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgPC8+O1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5pc1Jlc2VuZGluZykge1xuICAgICAgICAgICAgYnV0dG9uUm93ID0gPD5cbiAgICAgICAgICAgICAgICA8SW5saW5lU3Bpbm5lciB3PXsyMH0gaD17MjB9IC8+XG4gICAgICAgICAgICAgICAgeyAvKiBzcGFuIGZvciBjc3MgKi8gfVxuICAgICAgICAgICAgICAgIDxzcGFuPnsgX3QoXCJTZW5kaW5nXCIpIH08L3NwYW4+XG4gICAgICAgICAgICA8Lz47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gPFJvb21TdGF0dXNCYXJVbnNlbnRNZXNzYWdlc1xuICAgICAgICAgICAgdGl0bGU9e3RpdGxlfVxuICAgICAgICAgICAgZGVzY3JpcHRpb249e190KFwiWW91IGNhbiBzZWxlY3QgYWxsIG9yIGluZGl2aWR1YWwgbWVzc2FnZXMgdG8gcmV0cnkgb3IgZGVsZXRlXCIpfVxuICAgICAgICAgICAgbm90aWZpY2F0aW9uU3RhdGU9e1N0YXRpY05vdGlmaWNhdGlvblN0YXRlLlJFRF9FWENMQU1BVElPTn1cbiAgICAgICAgICAgIGJ1dHRvbnM9e2J1dHRvblJvd31cbiAgICAgICAgLz47XG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlcigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGlmICh0aGlzLnNob3VsZFNob3dDb25uZWN0aW9uRXJyb3IoKSkge1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1Jvb21TdGF0dXNCYXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiByb2xlPVwiYWxlcnRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUm9vbVN0YXR1c0Jhcl9jb25uZWN0aW9uTG9zdEJhclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbWdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjPXtyZXF1aXJlKFwiLi4vLi4vLi4vcmVzL2ltZy9mZWF0aGVyLWN1c3RvbWlzZWQvd2FybmluZy10cmlhbmdsZS5zdmdcIikuZGVmYXVsdH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg9XCIyNFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodD1cIjI0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU9XCIvIVxcIFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdD1cIi8hXFwgXCIgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1Jvb21TdGF0dXNCYXJfY29ubmVjdGlvbkxvc3RCYXJfdGl0bGVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoJ0Nvbm5lY3Rpdml0eSB0byB0aGUgc2VydmVyIGhhcyBiZWVuIGxvc3QuJykgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Sb29tU3RhdHVzQmFyX2Nvbm5lY3Rpb25Mb3N0QmFyX2Rlc2NcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoJ1NlbnQgbWVzc2FnZXMgd2lsbCBiZSBzdG9yZWQgdW50aWwgeW91ciBjb25uZWN0aW9uIGhhcyByZXR1cm5lZC4nKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnVuc2VudE1lc3NhZ2VzLmxlbmd0aCA+IDAgfHwgdGhpcy5zdGF0ZS5pc1Jlc2VuZGluZykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VW5zZW50TWVzc2FnZUNvbnRlbnQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBZ0JBOztBQUNBOztBQUlBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQTlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFrQkEsTUFBTUEsaUJBQWlCLEdBQUcsQ0FBMUI7QUFDQSxNQUFNQyxtQkFBbUIsR0FBRyxDQUE1QjtBQUNBLE1BQU1DLHlCQUF5QixHQUFHLENBQWxDOztBQUVPLFNBQVNDLGlCQUFULENBQTJCQyxJQUEzQixFQUFzRDtFQUN6RCxJQUFJLENBQUNBLElBQUwsRUFBVztJQUFFLE9BQU8sRUFBUDtFQUFZOztFQUN6QixPQUFPQSxJQUFJLENBQUNDLGdCQUFMLEdBQXdCQyxNQUF4QixDQUErQixVQUFTQyxFQUFULEVBQWE7SUFDL0MsT0FBT0EsRUFBRSxDQUFDQyxNQUFILEtBQWNDLGtCQUFBLENBQVlDLFFBQWpDO0VBQ0gsQ0FGTSxDQUFQO0FBR0g7O0FBMENjLE1BQU1DLGFBQU4sU0FBNEJDLGNBQUEsQ0FBTUMsYUFBbEMsQ0FBZ0U7RUFJM0VDLFdBQVcsQ0FBQ0MsS0FBRCxFQUFnQkMsT0FBaEIsRUFB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
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _room = require("matrix-js-sdk/src/models/room");

var _user = require("matrix-js-sdk/src/models/user");

var _event = require("matrix-js-sdk/src/@types/event");

var _partials = require("matrix-js-sdk/src/@types/partials");

var _NamespacedValue = require("matrix-js-sdk/src/NamespacedValue");

var _RoomAvatar = _interopRequireDefault(require("./RoomAvatar"));

var _NotificationBadge = _interopRequireDefault(require("../rooms/NotificationBadge"));

var _RoomNotificationStateStore = require("../../../stores/notifications/RoomNotificationStateStore");

var _presence = require("../../../utils/presence");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _languageHandler = require("../../../languageHandler");

var _TextWithTooltip = _interopRequireDefault(require("../elements/TextWithTooltip"));

var _DMRoomMap = _interopRequireDefault(require("../../../utils/DMRoomMap"));

/*
Copyright 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const BUSY_PRESENCE_NAME = new _NamespacedValue.UnstableValue("busy", "org.matrix.msc3026.busy");
var Icon;

(function (Icon) {
  Icon["None"] = "NONE";
  Icon["Globe"] = "GLOBE";
  Icon["PresenceOnline"] = "ONLINE";
  Icon["PresenceAway"] = "AWAY";
  Icon["PresenceOffline"] = "OFFLINE";
  Icon["PresenceBusy"] = "BUSY";
})(Icon || (Icon = {}));

function tooltipText(variant) {
  switch (variant) {
    case Icon.Globe:
      return (0, _languageHandler._t)("This room is public");

    case Icon.PresenceOnline:
      return (0, _languageHandler._t)("Online");

    case Icon.PresenceAway:
      return (0, _languageHandler._t)("Away");

    case Icon.PresenceOffline:
      return (0, _languageHandler._t)("Offline");

    case Icon.PresenceBusy:
      return (0, _languageHandler._t)("Busy");
  }
}

class DecoratedRoomAvatar extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "_dmUser", void 0);
    (0, _defineProperty2.default)(this, "isUnmounted", false);
    (0, _defineProperty2.default)(this, "isWatchingTimeline", false);
    (0, _defineProperty2.default)(this, "onRoomTimeline", (ev, room) => {
      if (this.isUnmounted) return;
      if (this.props.room.roomId !== room?.roomId) return;

      if (ev.getType() === _event.EventType.RoomJoinRules || ev.getType() === _event.EventType.RoomMember) {
        const newIcon = this.calculateIcon();

        if (newIcon !== this.state.icon) {
          this.setState({
            icon: newIcon
          });
        }
      }
    });
    (0, _defineProperty2.default)(this, "onPresenceUpdate", () => {
      if (this.isUnmounted) return;
      const newIcon = this.getPresenceIcon();
      if (newIcon !== this.state.icon) this.setState({
        icon: newIcon
      });
    });
    this.state = {
      notificationState: _RoomNotificationStateStore.RoomNotificationStateStore.instance.getRoomState(this.props.room),
      icon: this.calculateIcon()
    };
  }

  componentWillUnmount() {
    this.isUnmounted = true;
    if (this.isWatchingTimeline) this.props.room.off(_room.RoomEvent.Timeline, this.onRoomTimeline);
    this.dmUser = null; // clear listeners, if any
  }

  get isPublicRoom() {
    const joinRules = this.props.room.currentState.getStateEvents(_event.EventType.RoomJoinRules, "");
    const joinRule = joinRules && joinRules.getContent().join_rule;
    return joinRule === _partials.JoinRule.Public;
  }

  get dmUser() {
    return this._dmUser;
  }

  set dmUser(val) {
    const oldUser = this._dmUser;
    this._dmUser = val;

    if (oldUser && oldUser !== this._dmUser) {
      oldUser.off(_user.UserEvent.CurrentlyActive, this.onPresenceUpdate);
      oldUser.off(_user.UserEvent.Presence, this.onPresenceUpdate);
    }

    if (this._dmUser && oldUser !== this._dmUser) {
      this._dmUser.on(_user.UserEvent.CurrentlyActive, this.onPresenceUpdate);

      this._dmUser.on(_user.UserEvent.Presence, this.onPresenceUpdate);
    }
  }

  getPresenceIcon() {
    if (!this.dmUser) return Icon.None;
    let icon = Icon.None;
    const isOnline = this.dmUser.currentlyActive || this.dmUser.presence === 'online';

    if (BUSY_PRESENCE_NAME.matches(this.dmUser.presence)) {
      icon = Icon.PresenceBusy;
    } else if (isOnline) {
      icon = Icon.PresenceOnline;
    } else if (this.dmUser.presence === 'offline') {
      icon = Icon.PresenceOffline;
    } else if (this.dmUser.presence === 'unavailable') {
      icon = Icon.PresenceAway;
    }

    return icon;
  }

  calculateIcon() {
    let icon = Icon.None; // We look at the DMRoomMap and not the tag here so that we don't exclude DMs in Favourites

    const otherUserId = _DMRoomMap.default.shared().getUserIdForRoomId(this.props.room.roomId);

    if (otherUserId && this.props.room.getJoinedMemberCount() === 2) {
      // Track presence, if available
      if ((0, _presence.isPresenceEnabled)()) {
        if (otherUserId) {
          this.dmUser = _MatrixClientPeg.MatrixClientPeg.get().getUser(otherUserId);
          icon = this.getPresenceIcon();
        }
      }
    } else {
      // Track publicity
      icon = this.isPublicRoom ? Icon.Globe : Icon.None;

      if (!this.isWatchingTimeline) {
        this.props.room.on(_room.RoomEvent.Timeline, this.onRoomTimeline);
        this.isWatchingTimeline = true;
      }
    }

    return icon;
  }

  render() {
    let badge;

    if (this.props.displayBadge) {
      badge = /*#__PURE__*/_react.default.createElement(_NotificationBadge.default, {
        notification: this.state.notificationState,
        forceCount: this.props.forceCount,
        roomId: this.props.room.roomId
      });
    }

    let icon;

    if (this.state.icon !== Icon.None) {
      icon = /*#__PURE__*/_react.default.createElement(_TextWithTooltip.default, {
        tooltip: tooltipText(this.state.icon),
        tooltipProps: this.props.tooltipProps,
        class: `mx_DecoratedRoomAvatar_icon mx_DecoratedRoomAvatar_icon_${this.state.icon.toLowerCase()}`
      });
    }

    const classes = (0, _classnames.default)("mx_DecoratedRoomAvatar", {
      mx_DecoratedRoomAvatar_cutout: icon
    });
    return /*#__PURE__*/_react.default.createElement("div", {
      className: classes
    }, /*#__PURE__*/_react.default.createElement(_RoomAvatar.default, {
      room: this.props.room,
      width: this.props.avatarSize,
      height: this.props.avatarSize,
      oobData: this.props.oobData,
      viewAvatarOnClick: this.props.viewAvatarOnClick
    }), icon, badge);
  }

}

exports.default = DecoratedRoomAvatar;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCVVNZX1BSRVNFTkNFX05BTUUiLCJVbnN0YWJsZVZhbHVlIiwiSWNvbiIsInRvb2x0aXBUZXh0IiwidmFyaWFudCIsIkdsb2JlIiwiX3QiLCJQcmVzZW5jZU9ubGluZSIsIlByZXNlbmNlQXdheSIsIlByZXNlbmNlT2ZmbGluZSIsIlByZXNlbmNlQnVzeSIsIkRlY29yYXRlZFJvb21BdmF0YXIiLCJSZWFjdCIsIlB1cmVDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiZXYiLCJyb29tIiwiaXNVbm1vdW50ZWQiLCJyb29tSWQiLCJnZXRUeXBlIiwiRXZlbnRUeXBlIiwiUm9vbUpvaW5SdWxlcyIsIlJvb21NZW1iZXIiLCJuZXdJY29uIiwiY2FsY3VsYXRlSWNvbiIsInN0YXRlIiwiaWNvbiIsInNldFN0YXRlIiwiZ2V0UHJlc2VuY2VJY29uIiwibm90aWZpY2F0aW9uU3RhdGUiLCJSb29tTm90aWZpY2F0aW9uU3RhdGVTdG9yZSIsImluc3RhbmNlIiwiZ2V0Um9vbVN0YXRlIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJpc1dhdGNoaW5nVGltZWxpbmUiLCJvZmYiLCJSb29tRXZlbnQiLCJUaW1lbGluZSIsIm9uUm9vbVRpbWVsaW5lIiwiZG1Vc2VyIiwiaXNQdWJsaWNSb29tIiwiam9pblJ1bGVzIiwiY3VycmVudFN0YXRlIiwiZ2V0U3RhdGVFdmVudHMiLCJqb2luUnVsZSIsImdldENvbnRlbnQiLCJqb2luX3J1bGUiLCJKb2luUnVsZSIsIlB1YmxpYyIsIl9kbVVzZXIiLCJ2YWwiLCJvbGRVc2VyIiwiVXNlckV2ZW50IiwiQ3VycmVudGx5QWN0aXZlIiwib25QcmVzZW5jZVVwZGF0ZSIsIlByZXNlbmNlIiwib24iLCJOb25lIiwiaXNPbmxpbmUiLCJjdXJyZW50bHlBY3RpdmUiLCJwcmVzZW5jZSIsIm1hdGNoZXMiLCJvdGhlclVzZXJJZCIsIkRNUm9vbU1hcCIsInNoYXJlZCIsImdldFVzZXJJZEZvclJvb21JZCIsImdldEpvaW5lZE1lbWJlckNvdW50IiwiaXNQcmVzZW5jZUVuYWJsZWQiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJnZXRVc2VyIiwicmVuZGVyIiwiYmFkZ2UiLCJkaXNwbGF5QmFkZ2UiLCJmb3JjZUNvdW50IiwidG9vbHRpcFByb3BzIiwidG9Mb3dlckNhc2UiLCJjbGFzc2VzIiwiY2xhc3NOYW1lcyIsIm14X0RlY29yYXRlZFJvb21BdmF0YXJfY3V0b3V0IiwiYXZhdGFyU2l6ZSIsIm9vYkRhdGEiLCJ2aWV3QXZhdGFyT25DbGljayJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2F2YXRhcnMvRGVjb3JhdGVkUm9vbUF2YXRhci50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIwIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSBcImNsYXNzbmFtZXNcIjtcbmltcG9ydCB7IFJvb20sIFJvb21FdmVudCB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvcm9vbVwiO1xuaW1wb3J0IHsgVXNlciwgVXNlckV2ZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy91c2VyXCI7XG5pbXBvcnQgeyBNYXRyaXhFdmVudCB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvZXZlbnRcIjtcbmltcG9ydCB7IEV2ZW50VHlwZSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9AdHlwZXMvZXZlbnRcIjtcbmltcG9ydCB7IEpvaW5SdWxlIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL0B0eXBlcy9wYXJ0aWFsc1wiO1xuaW1wb3J0IHsgVW5zdGFibGVWYWx1ZSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9OYW1lc3BhY2VkVmFsdWVcIjtcblxuaW1wb3J0IFJvb21BdmF0YXIgZnJvbSBcIi4vUm9vbUF2YXRhclwiO1xuaW1wb3J0IE5vdGlmaWNhdGlvbkJhZGdlIGZyb20gJy4uL3Jvb21zL05vdGlmaWNhdGlvbkJhZGdlJztcbmltcG9ydCB7IFJvb21Ob3RpZmljYXRpb25TdGF0ZVN0b3JlIH0gZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy9ub3RpZmljYXRpb25zL1Jvb21Ob3RpZmljYXRpb25TdGF0ZVN0b3JlXCI7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25TdGF0ZSB9IGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvbm90aWZpY2F0aW9ucy9Ob3RpZmljYXRpb25TdGF0ZVwiO1xuaW1wb3J0IHsgaXNQcmVzZW5jZUVuYWJsZWQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcHJlc2VuY2VcIjtcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gXCIuLi8uLi8uLi9NYXRyaXhDbGllbnRQZWdcIjtcbmltcG9ydCB7IF90IH0gZnJvbSBcIi4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IFRleHRXaXRoVG9vbHRpcCBmcm9tIFwiLi4vZWxlbWVudHMvVGV4dFdpdGhUb29sdGlwXCI7XG5pbXBvcnQgRE1Sb29tTWFwIGZyb20gXCIuLi8uLi8uLi91dGlscy9ETVJvb21NYXBcIjtcbmltcG9ydCB7IElPT0JEYXRhIH0gZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy9UaHJlZXBpZEludml0ZVN0b3JlXCI7XG5pbXBvcnQgVG9vbHRpcFRhcmdldCBmcm9tIFwiLi4vZWxlbWVudHMvVG9vbHRpcFRhcmdldFwiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICByb29tOiBSb29tO1xuICAgIGF2YXRhclNpemU6IG51bWJlcjtcbiAgICBkaXNwbGF5QmFkZ2U/OiBib29sZWFuO1xuICAgIGZvcmNlQ291bnQ/OiBib29sZWFuO1xuICAgIG9vYkRhdGE/OiBJT09CRGF0YTtcbiAgICB2aWV3QXZhdGFyT25DbGljaz86IGJvb2xlYW47XG4gICAgdG9vbHRpcFByb3BzPzogT21pdDxSZWFjdC5Db21wb25lbnRQcm9wczx0eXBlb2YgVG9vbHRpcFRhcmdldD4sIFwibGFiZWxcIiB8IFwidG9vbHRpcENsYXNzTmFtZVwiIHwgXCJjbGFzc05hbWVcIj47XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIG5vdGlmaWNhdGlvblN0YXRlPzogTm90aWZpY2F0aW9uU3RhdGU7XG4gICAgaWNvbjogSWNvbjtcbn1cblxuY29uc3QgQlVTWV9QUkVTRU5DRV9OQU1FID0gbmV3IFVuc3RhYmxlVmFsdWUoXCJidXN5XCIsIFwib3JnLm1hdHJpeC5tc2MzMDI2LmJ1c3lcIik7XG5cbmVudW0gSWNvbiB7XG4gICAgLy8gTm90ZTogdGhlIG5hbWVzIGhlcmUgYXJlIHVzZWQgaW4gQ1NTIGNsYXNzIG5hbWVzXG4gICAgTm9uZSA9IFwiTk9ORVwiLCAvLyAuLi4gZXhjZXB0IHRoaXMgb25lXG4gICAgR2xvYmUgPSBcIkdMT0JFXCIsXG4gICAgUHJlc2VuY2VPbmxpbmUgPSBcIk9OTElORVwiLFxuICAgIFByZXNlbmNlQXdheSA9IFwiQVdBWVwiLFxuICAgIFByZXNlbmNlT2ZmbGluZSA9IFwiT0ZGTElORVwiLFxuICAgIFByZXNlbmNlQnVzeSA9IFwiQlVTWVwiLFxufVxuXG5mdW5jdGlvbiB0b29sdGlwVGV4dCh2YXJpYW50OiBJY29uKSB7XG4gICAgc3dpdGNoICh2YXJpYW50KSB7XG4gICAgICAgIGNhc2UgSWNvbi5HbG9iZTpcbiAgICAgICAgICAgIHJldHVybiBfdChcIlRoaXMgcm9vbSBpcyBwdWJsaWNcIik7XG4gICAgICAgIGNhc2UgSWNvbi5QcmVzZW5jZU9ubGluZTpcbiAgICAgICAgICAgIHJldHVybiBfdChcIk9ubGluZVwiKTtcbiAgICAgICAgY2FzZSBJY29uLlByZXNlbmNlQXdheTpcbiAgICAgICAgICAgIHJldHVybiBfdChcIkF3YXlcIik7XG4gICAgICAgIGNhc2UgSWNvbi5QcmVzZW5jZU9mZmxpbmU6XG4gICAgICAgICAgICByZXR1cm4gX3QoXCJPZmZsaW5lXCIpO1xuICAgICAgICBjYXNlIEljb24uUHJlc2VuY2VCdXN5OlxuICAgICAgICAgICAgcmV0dXJuIF90KFwiQnVzeVwiKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERlY29yYXRlZFJvb21BdmF0YXIgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSBfZG1Vc2VyOiBVc2VyO1xuICAgIHByaXZhdGUgaXNVbm1vdW50ZWQgPSBmYWxzZTtcbiAgICBwcml2YXRlIGlzV2F0Y2hpbmdUaW1lbGluZSA9IGZhbHNlO1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvblN0YXRlOiBSb29tTm90aWZpY2F0aW9uU3RhdGVTdG9yZS5pbnN0YW5jZS5nZXRSb29tU3RhdGUodGhpcy5wcm9wcy5yb29tKSxcbiAgICAgICAgICAgIGljb246IHRoaXMuY2FsY3VsYXRlSWNvbigpLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHB1YmxpYyBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgdGhpcy5pc1VubW91bnRlZCA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLmlzV2F0Y2hpbmdUaW1lbGluZSkgdGhpcy5wcm9wcy5yb29tLm9mZihSb29tRXZlbnQuVGltZWxpbmUsIHRoaXMub25Sb29tVGltZWxpbmUpO1xuICAgICAgICB0aGlzLmRtVXNlciA9IG51bGw7IC8vIGNsZWFyIGxpc3RlbmVycywgaWYgYW55XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXQgaXNQdWJsaWNSb29tKCk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBqb2luUnVsZXMgPSB0aGlzLnByb3BzLnJvb20uY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKEV2ZW50VHlwZS5Sb29tSm9pblJ1bGVzLCBcIlwiKTtcbiAgICAgICAgY29uc3Qgam9pblJ1bGUgPSBqb2luUnVsZXMgJiYgam9pblJ1bGVzLmdldENvbnRlbnQoKS5qb2luX3J1bGU7XG4gICAgICAgIHJldHVybiBqb2luUnVsZSA9PT0gSm9pblJ1bGUuUHVibGljO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0IGRtVXNlcigpOiBVc2VyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RtVXNlcjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldCBkbVVzZXIodmFsOiBVc2VyKSB7XG4gICAgICAgIGNvbnN0IG9sZFVzZXIgPSB0aGlzLl9kbVVzZXI7XG4gICAgICAgIHRoaXMuX2RtVXNlciA9IHZhbDtcbiAgICAgICAgaWYgKG9sZFVzZXIgJiYgb2xkVXNlciAhPT0gdGhpcy5fZG1Vc2VyKSB7XG4gICAgICAgICAgICBvbGRVc2VyLm9mZihVc2VyRXZlbnQuQ3VycmVudGx5QWN0aXZlLCB0aGlzLm9uUHJlc2VuY2VVcGRhdGUpO1xuICAgICAgICAgICAgb2xkVXNlci5vZmYoVXNlckV2ZW50LlByZXNlbmNlLCB0aGlzLm9uUHJlc2VuY2VVcGRhdGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9kbVVzZXIgJiYgb2xkVXNlciAhPT0gdGhpcy5fZG1Vc2VyKSB7XG4gICAgICAgICAgICB0aGlzLl9kbVVzZXIub24oVXNlckV2ZW50LkN1cnJlbnRseUFjdGl2ZSwgdGhpcy5vblByZXNlbmNlVXBkYXRlKTtcbiAgICAgICAgICAgIHRoaXMuX2RtVXNlci5vbihVc2VyRXZlbnQuUHJlc2VuY2UsIHRoaXMub25QcmVzZW5jZVVwZGF0ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIG9uUm9vbVRpbWVsaW5lID0gKGV2OiBNYXRyaXhFdmVudCwgcm9vbTogUm9vbSB8IG51bGwpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuaXNVbm1vdW50ZWQpIHJldHVybjtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMucm9vbS5yb29tSWQgIT09IHJvb20/LnJvb21JZCkgcmV0dXJuO1xuXG4gICAgICAgIGlmIChldi5nZXRUeXBlKCkgPT09IEV2ZW50VHlwZS5Sb29tSm9pblJ1bGVzIHx8IGV2LmdldFR5cGUoKSA9PT0gRXZlbnRUeXBlLlJvb21NZW1iZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0ljb24gPSB0aGlzLmNhbGN1bGF0ZUljb24oKTtcbiAgICAgICAgICAgIGlmIChuZXdJY29uICE9PSB0aGlzLnN0YXRlLmljb24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgaWNvbjogbmV3SWNvbiB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUHJlc2VuY2VVcGRhdGUgPSAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmlzVW5tb3VudGVkKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgbmV3SWNvbiA9IHRoaXMuZ2V0UHJlc2VuY2VJY29uKCk7XG4gICAgICAgIGlmIChuZXdJY29uICE9PSB0aGlzLnN0YXRlLmljb24pIHRoaXMuc2V0U3RhdGUoeyBpY29uOiBuZXdJY29uIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIGdldFByZXNlbmNlSWNvbigpOiBJY29uIHtcbiAgICAgICAgaWYgKCF0aGlzLmRtVXNlcikgcmV0dXJuIEljb24uTm9uZTtcblxuICAgICAgICBsZXQgaWNvbiA9IEljb24uTm9uZTtcblxuICAgICAgICBjb25zdCBpc09ubGluZSA9IHRoaXMuZG1Vc2VyLmN1cnJlbnRseUFjdGl2ZSB8fCB0aGlzLmRtVXNlci5wcmVzZW5jZSA9PT0gJ29ubGluZSc7XG4gICAgICAgIGlmIChCVVNZX1BSRVNFTkNFX05BTUUubWF0Y2hlcyh0aGlzLmRtVXNlci5wcmVzZW5jZSkpIHtcbiAgICAgICAgICAgIGljb24gPSBJY29uLlByZXNlbmNlQnVzeTtcbiAgICAgICAgfSBlbHNlIGlmIChpc09ubGluZSkge1xuICAgICAgICAgICAgaWNvbiA9IEljb24uUHJlc2VuY2VPbmxpbmU7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5kbVVzZXIucHJlc2VuY2UgPT09ICdvZmZsaW5lJykge1xuICAgICAgICAgICAgaWNvbiA9IEljb24uUHJlc2VuY2VPZmZsaW5lO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZG1Vc2VyLnByZXNlbmNlID09PSAndW5hdmFpbGFibGUnKSB7XG4gICAgICAgICAgICBpY29uID0gSWNvbi5QcmVzZW5jZUF3YXk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaWNvbjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGN1bGF0ZUljb24oKTogSWNvbiB7XG4gICAgICAgIGxldCBpY29uID0gSWNvbi5Ob25lO1xuXG4gICAgICAgIC8vIFdlIGxvb2sgYXQgdGhlIERNUm9vbU1hcCBhbmQgbm90IHRoZSB0YWcgaGVyZSBzbyB0aGF0IHdlIGRvbid0IGV4Y2x1ZGUgRE1zIGluIEZhdm91cml0ZXNcbiAgICAgICAgY29uc3Qgb3RoZXJVc2VySWQgPSBETVJvb21NYXAuc2hhcmVkKCkuZ2V0VXNlcklkRm9yUm9vbUlkKHRoaXMucHJvcHMucm9vbS5yb29tSWQpO1xuICAgICAgICBpZiAob3RoZXJVc2VySWQgJiYgdGhpcy5wcm9wcy5yb29tLmdldEpvaW5lZE1lbWJlckNvdW50KCkgPT09IDIpIHtcbiAgICAgICAgICAgIC8vIFRyYWNrIHByZXNlbmNlLCBpZiBhdmFpbGFibGVcbiAgICAgICAgICAgIGlmIChpc1ByZXNlbmNlRW5hYmxlZCgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKG90aGVyVXNlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZG1Vc2VyID0gTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFVzZXIob3RoZXJVc2VySWQpO1xuICAgICAgICAgICAgICAgICAgICBpY29uID0gdGhpcy5nZXRQcmVzZW5jZUljb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBUcmFjayBwdWJsaWNpdHlcbiAgICAgICAgICAgIGljb24gPSB0aGlzLmlzUHVibGljUm9vbSA/IEljb24uR2xvYmUgOiBJY29uLk5vbmU7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNXYXRjaGluZ1RpbWVsaW5lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5yb29tLm9uKFJvb21FdmVudC5UaW1lbGluZSwgdGhpcy5vblJvb21UaW1lbGluZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1dhdGNoaW5nVGltZWxpbmUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpY29uO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKTogUmVhY3QuUmVhY3ROb2RlIHtcbiAgICAgICAgbGV0IGJhZGdlOiBSZWFjdC5SZWFjdE5vZGU7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLmRpc3BsYXlCYWRnZSkge1xuICAgICAgICAgICAgYmFkZ2UgPSA8Tm90aWZpY2F0aW9uQmFkZ2VcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb249e3RoaXMuc3RhdGUubm90aWZpY2F0aW9uU3RhdGV9XG4gICAgICAgICAgICAgICAgZm9yY2VDb3VudD17dGhpcy5wcm9wcy5mb3JjZUNvdW50fVxuICAgICAgICAgICAgICAgIHJvb21JZD17dGhpcy5wcm9wcy5yb29tLnJvb21JZH1cbiAgICAgICAgICAgIC8+O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGljb247XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmljb24gIT09IEljb24uTm9uZSkge1xuICAgICAgICAgICAgaWNvbiA9IDxUZXh0V2l0aFRvb2x0aXBcbiAgICAgICAgICAgICAgICB0b29sdGlwPXt0b29sdGlwVGV4dCh0aGlzLnN0YXRlLmljb24pfVxuICAgICAgICAgICAgICAgIHRvb2x0aXBQcm9wcz17dGhpcy5wcm9wcy50b29sdGlwUHJvcHN9XG4gICAgICAgICAgICAgICAgY2xhc3M9e2BteF9EZWNvcmF0ZWRSb29tQXZhdGFyX2ljb24gbXhfRGVjb3JhdGVkUm9vbUF2YXRhcl9pY29uXyR7dGhpcy5zdGF0ZS5pY29uLnRvTG93ZXJDYXNlKCl9YH1cbiAgICAgICAgICAgIC8+O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY2xhc3NlcyA9IGNsYXNzTmFtZXMoXCJteF9EZWNvcmF0ZWRSb29tQXZhdGFyXCIsIHtcbiAgICAgICAgICAgIG14X0RlY29yYXRlZFJvb21BdmF0YXJfY3V0b3V0OiBpY29uLFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9e2NsYXNzZXN9PlxuICAgICAgICAgICAgPFJvb21BdmF0YXJcbiAgICAgICAgICAgICAgICByb29tPXt0aGlzLnByb3BzLnJvb219XG4gICAgICAgICAgICAgICAgd2lkdGg9e3RoaXMucHJvcHMuYXZhdGFyU2l6ZX1cbiAgICAgICAgICAgICAgICBoZWlnaHQ9e3RoaXMucHJvcHMuYXZhdGFyU2l6ZX1cbiAgICAgICAgICAgICAgICBvb2JEYXRhPXt0aGlzLnByb3BzLm9vYkRhdGF9XG4gICAgICAgICAgICAgICAgdmlld0F2YXRhck9uQ2xpY2s9e3RoaXMucHJvcHMudmlld0F2YXRhck9uQ2xpY2t9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICAgeyBpY29uIH1cbiAgICAgICAgICAgIHsgYmFkZ2UgfVxuICAgICAgICA8L2Rpdj47XG4gICAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBc0NBLE1BQU1BLGtCQUFrQixHQUFHLElBQUlDLDhCQUFKLENBQWtCLE1BQWxCLEVBQTBCLHlCQUExQixDQUEzQjtJQUVLQyxJOztXQUFBQSxJO0VBQUFBLEk7RUFBQUEsSTtFQUFBQSxJO0VBQUFBLEk7RUFBQUEsSTtFQUFBQSxJO0dBQUFBLEksS0FBQUEsSTs7QUFVTCxTQUFTQyxXQUFULENBQXFCQyxPQUFyQixFQUFvQztFQUNoQyxRQUFRQSxPQUFSO0lBQ0ksS0FBS0YsSUFBSSxDQUFDRyxLQUFWO01BQ0ksT0FBTyxJQUFBQyxtQkFBQSxFQUFHLHFCQUFILENBQVA7O0lBQ0osS0FBS0osSUFBSSxDQUFDSyxjQUFWO01BQ0ksT0FBTyxJQUFBRCxtQkFBQSxFQUFHLFFBQUgsQ0FBUDs7SUFDSixLQUFLSixJQUFJLENBQUNNLFlBQVY7TUFDSSxPQUFPLElBQUFGLG1CQUFBLEVBQUcsTUFBSCxDQUFQOztJQUNKLEtBQUtKLElBQUksQ0FBQ08sZUFBVjtNQUNJ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
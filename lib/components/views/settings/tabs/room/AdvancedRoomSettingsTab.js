"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _event = require("matrix-js-sdk/src/@types/event");

var _languageHandler = require("../../../../../languageHandler");

var _MatrixClientPeg = require("../../../../../MatrixClientPeg");

var _AccessibleButton = _interopRequireDefault(require("../../../elements/AccessibleButton"));

var _RoomUpgradeDialog = _interopRequireDefault(require("../../../dialogs/RoomUpgradeDialog"));

var _Modal = _interopRequireDefault(require("../../../../../Modal"));

var _dispatcher = _interopRequireDefault(require("../../../../../dispatcher/dispatcher"));

var _actions = require("../../../../../dispatcher/actions");

var _CopyableText = _interopRequireDefault(require("../../../elements/CopyableText"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

class AdvancedRoomSettingsTab extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    (0, _defineProperty2.default)(this, "upgradeRoom", e => {
      const room = _MatrixClientPeg.MatrixClientPeg.get().getRoom(this.props.roomId);

      _Modal.default.createDialog(_RoomUpgradeDialog.default, {
        room
      });
    });
    (0, _defineProperty2.default)(this, "onOldRoomClicked", e => {
      e.preventDefault();
      e.stopPropagation();

      _dispatcher.default.dispatch({
        action: _actions.Action.ViewRoom,
        room_id: this.state.oldRoomId,
        event_id: this.state.oldEventId,
        metricsTrigger: "WebPredecessorSettings",
        metricsViaKeyboard: e.type !== "click"
      });

      this.props.closeSettingsFn();
    });
    this.state = {
      // This is eventually set to the value of room.getRecommendedVersion()
      upgradeRecommendation: null
    }; // we handle lack of this object gracefully later, so don't worry about it failing here.

    const _room = _MatrixClientPeg.MatrixClientPeg.get().getRoom(this.props.roomId);

    _room.getRecommendedVersion().then(v => {
      const tombstone = _room.currentState.getStateEvents(_event.EventType.RoomTombstone, "");

      const additionalStateChanges = {};

      const createEvent = _room.currentState.getStateEvents(_event.EventType.RoomCreate, "");

      const predecessor = createEvent ? createEvent.getContent().predecessor : null;

      if (predecessor && predecessor.room_id) {
        additionalStateChanges.oldRoomId = predecessor.room_id;
        additionalStateChanges.oldEventId = predecessor.event_id;
      }

      this.setState(_objectSpread({
        upgraded: !!tombstone?.getContent().replacement_room,
        upgradeRecommendation: v
      }, additionalStateChanges));
    });
  }

  render() {
    const client = _MatrixClientPeg.MatrixClientPeg.get();

    const room = client.getRoom(this.props.roomId);
    const isSpace = room.isSpaceRoom();
    let unfederatableSection;
    const createEvent = room.currentState.getStateEvents(_event.EventType.RoomCreate, '');

    if (createEvent && createEvent.getContent()['m.federate'] === false) {
      unfederatableSection = /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)('This room is not accessible by remote Matrix servers'));
    }

    let roomUpgradeButton;

    if (this.state.upgradeRecommendation && this.state.upgradeRecommendation.needsUpgrade && !this.state.upgraded) {
      roomUpgradeButton = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", {
        className: "mx_SettingsTab_warningText"
      }, (0, _languageHandler._t)("<b>Warning</b>: Upgrading a room will <i>not automatically migrate room members " + "to the new version of the room.</i> We'll post a link to the new room in the old " + "version of the room - room members will have to click this link to join the new room.", {}, {
        "b": sub => /*#__PURE__*/_react.default.createElement("b", null, sub),
        "i": sub => /*#__PURE__*/_react.default.createElement("i", null, sub)
      })), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        onClick: this.upgradeRoom,
        kind: "primary"
      }, isSpace ? (0, _languageHandler._t)("Upgrade this space to the recommended room version") : (0, _languageHandler._t)("Upgrade this room to the recommended room version")));
    }

    let oldRoomLink;

    if (this.state.oldRoomId) {
      let copy;

      if (isSpace) {
        copy = (0, _languageHandler._t)("View older version of %(spaceName)s.", {
          spaceName: room.name
        });
      } else {
        copy = (0, _languageHandler._t)("View older messages in %(roomName)s.", {
          roomName: room.name
        });
      }

      oldRoomLink = /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        element: "a",
        onClick: this.onOldRoomClicked
      }, copy);
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_heading"
    }, (0, _languageHandler._t)("Advanced")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section mx_SettingsTab_subsectionText"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, room?.isSpaceRoom() ? (0, _languageHandler._t)("Space information") : (0, _languageHandler._t)("Room information")), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("Internal room ID")), /*#__PURE__*/_react.default.createElement(_CopyableText.default, {
      getTextToCopy: () => this.props.roomId
    }, this.props.roomId)), unfederatableSection), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section mx_SettingsTab_subsectionText"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Room version")), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("Room version:")), "\xA0", room.getVersion()), oldRoomLink, roomUpgradeButton));
  }

}

exports.default = AdvancedRoomSettingsTab;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBZHZhbmNlZFJvb21TZXR0aW5nc1RhYiIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImNvbnRleHQiLCJlIiwicm9vbSIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsImdldFJvb20iLCJyb29tSWQiLCJNb2RhbCIsImNyZWF0ZURpYWxvZyIsIlJvb21VcGdyYWRlRGlhbG9nIiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJkaXMiLCJkaXNwYXRjaCIsImFjdGlvbiIsIkFjdGlvbiIsIlZpZXdSb29tIiwicm9vbV9pZCIsInN0YXRlIiwib2xkUm9vbUlkIiwiZXZlbnRfaWQiLCJvbGRFdmVudElkIiwibWV0cmljc1RyaWdnZXIiLCJtZXRyaWNzVmlhS2V5Ym9hcmQiLCJ0eXBlIiwiY2xvc2VTZXR0aW5nc0ZuIiwidXBncmFkZVJlY29tbWVuZGF0aW9uIiwiZ2V0UmVjb21tZW5kZWRWZXJzaW9uIiwidGhlbiIsInYiLCJ0b21ic3RvbmUiLCJjdXJyZW50U3RhdGUiLCJnZXRTdGF0ZUV2ZW50cyIsIkV2ZW50VHlwZSIsIlJvb21Ub21ic3RvbmUiLCJhZGRpdGlvbmFsU3RhdGVDaGFuZ2VzIiwiY3JlYXRlRXZlbnQiLCJSb29tQ3JlYXRlIiwicHJlZGVjZXNzb3IiLCJnZXRDb250ZW50Iiwic2V0U3RhdGUiLCJ1cGdyYWRlZCIsInJlcGxhY2VtZW50X3Jvb20iLCJyZW5kZXIiLCJjbGllbnQiLCJpc1NwYWNlIiwiaXNTcGFjZVJvb20iLCJ1bmZlZGVyYXRhYmxlU2VjdGlvbiIsIl90Iiwicm9vbVVwZ3JhZGVCdXR0b24iLCJuZWVkc1VwZ3JhZGUiLCJzdWIiLCJ1cGdyYWRlUm9vbSIsIm9sZFJvb21MaW5rIiwiY29weSIsInNwYWNlTmFtZSIsIm5hbWUiLCJyb29tTmFtZSIsIm9uT2xkUm9vbUNsaWNrZWQiLCJnZXRWZXJzaW9uIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvdmlld3Mvc2V0dGluZ3MvdGFicy9yb29tL0FkdmFuY2VkUm9vbVNldHRpbmdzVGFiLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTkgLSAyMDIyIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEV2ZW50VHlwZSB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL0B0eXBlcy9ldmVudCc7XG5cbmltcG9ydCB7IF90IH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL01hdHJpeENsaWVudFBlZ1wiO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4uLy4uLy4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b25cIjtcbmltcG9ydCBSb29tVXBncmFkZURpYWxvZyBmcm9tIFwiLi4vLi4vLi4vZGlhbG9ncy9Sb29tVXBncmFkZURpYWxvZ1wiO1xuaW1wb3J0IE1vZGFsIGZyb20gXCIuLi8uLi8uLi8uLi8uLi9Nb2RhbFwiO1xuaW1wb3J0IGRpcyBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyXCI7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9kaXNwYXRjaGVyL2FjdGlvbnMnO1xuaW1wb3J0IENvcHlhYmxlVGV4dCBmcm9tIFwiLi4vLi4vLi4vZWxlbWVudHMvQ29weWFibGVUZXh0XCI7XG5pbXBvcnQgeyBWaWV3Um9vbVBheWxvYWQgfSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vZGlzcGF0Y2hlci9wYXlsb2Fkcy9WaWV3Um9vbVBheWxvYWRcIjtcblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgcm9vbUlkOiBzdHJpbmc7XG4gICAgY2xvc2VTZXR0aW5nc0ZuKCk6IHZvaWQ7XG59XG5cbmludGVyZmFjZSBJUmVjb21tZW5kZWRWZXJzaW9uIHtcbiAgICB2ZXJzaW9uOiBzdHJpbmc7XG4gICAgbmVlZHNVcGdyYWRlOiBib29sZWFuO1xuICAgIHVyZ2VudDogYm9vbGVhbjtcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgdXBncmFkZVJlY29tbWVuZGF0aW9uPzogSVJlY29tbWVuZGVkVmVyc2lvbjtcbiAgICBvbGRSb29tSWQ/OiBzdHJpbmc7XG4gICAgb2xkRXZlbnRJZD86IHN0cmluZztcbiAgICB1cGdyYWRlZD86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFkdmFuY2VkUm9vbVNldHRpbmdzVGFiIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICAgICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICAvLyBUaGlzIGlzIGV2ZW50dWFsbHkgc2V0IHRvIHRoZSB2YWx1ZSBvZiByb29tLmdldFJlY29tbWVuZGVkVmVyc2lvbigpXG4gICAgICAgICAgICB1cGdyYWRlUmVjb21tZW5kYXRpb246IG51bGwsXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gd2UgaGFuZGxlIGxhY2sgb2YgdGhpcyBvYmplY3QgZ3JhY2VmdWxseSBsYXRlciwgc28gZG9uJ3Qgd29ycnkgYWJvdXQgaXQgZmFpbGluZyBoZXJlLlxuICAgICAgICBjb25zdCByb29tID0gTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFJvb20odGhpcy5wcm9wcy5yb29tSWQpO1xuICAgICAgICByb29tLmdldFJlY29tbWVuZGVkVmVyc2lvbigpLnRoZW4oKHYpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRvbWJzdG9uZSA9IHJvb20uY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKEV2ZW50VHlwZS5Sb29tVG9tYnN0b25lLCBcIlwiKTtcblxuICAgICAgICAgICAgY29uc3QgYWRkaXRpb25hbFN0YXRlQ2hhbmdlczogUGFydGlhbDxJU3RhdGU+ID0ge307XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVFdmVudCA9IHJvb20uY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKEV2ZW50VHlwZS5Sb29tQ3JlYXRlLCBcIlwiKTtcbiAgICAgICAgICAgIGNvbnN0IHByZWRlY2Vzc29yID0gY3JlYXRlRXZlbnQgPyBjcmVhdGVFdmVudC5nZXRDb250ZW50KCkucHJlZGVjZXNzb3IgOiBudWxsO1xuICAgICAgICAgICAgaWYgKHByZWRlY2Vzc29yICYmIHByZWRlY2Vzc29yLnJvb21faWQpIHtcbiAgICAgICAgICAgICAgICBhZGRpdGlvbmFsU3RhdGVDaGFuZ2VzLm9sZFJvb21JZCA9IHByZWRlY2Vzc29yLnJvb21faWQ7XG4gICAgICAgICAgICAgICAgYWRkaXRpb25hbFN0YXRlQ2hhbmdlcy5vbGRFdmVudElkID0gcHJlZGVjZXNzb3IuZXZlbnRfaWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHVwZ3JhZGVkOiAhIXRvbWJzdG9uZT8uZ2V0Q29udGVudCgpLnJlcGxhY2VtZW50X3Jvb20sXG4gICAgICAgICAgICAgICAgdXBncmFkZVJlY29tbWVuZGF0aW9uOiB2LFxuICAgICAgICAgICAgICAgIC4uLmFkZGl0aW9uYWxTdGF0ZUNoYW5nZXMsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGdyYWRlUm9vbSA9IChlKSA9PiB7XG4gICAgICAgIGNvbnN0IHJvb20gPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0Um9vbSh0aGlzLnByb3BzLnJvb21JZCk7XG4gICAgICAgIE1vZGFsLmNyZWF0ZURpYWxvZyhSb29tVXBncmFkZURpYWxvZywgeyByb29tIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uT2xkUm9vbUNsaWNrZWQgPSAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgZGlzLmRpc3BhdGNoPFZpZXdSb29tUGF5bG9hZD4oe1xuICAgICAgICAgICAgYWN0aW9uOiBBY3Rpb24uVmlld1Jvb20sXG4gICAgICAgICAgICByb29tX2lkOiB0aGlzLnN0YXRlLm9sZFJvb21JZCxcbiAgICAgICAgICAgIGV2ZW50X2lkOiB0aGlzLnN0YXRlLm9sZEV2ZW50SWQsXG4gICAgICAgICAgICBtZXRyaWNzVHJpZ2dlcjogXCJXZWJQcmVkZWNlc3NvclNldHRpbmdzXCIsXG4gICAgICAgICAgICBtZXRyaWNzVmlhS2V5Ym9hcmQ6IGUudHlwZSAhPT0gXCJjbGlja1wiLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wcm9wcy5jbG9zZVNldHRpbmdzRm4oKTtcbiAgICB9O1xuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCBjbGllbnQgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCk7XG4gICAgICAgIGNvbnN0IHJvb20gPSBjbGllbnQuZ2V0Um9vbSh0aGlzLnByb3BzLnJvb21JZCk7XG4gICAgICAgIGNvbnN0IGlzU3BhY2UgPSByb29tLmlzU3BhY2VSb29tKCk7XG5cbiAgICAgICAgbGV0IHVuZmVkZXJhdGFibGVTZWN0aW9uO1xuICAgICAgICBjb25zdCBjcmVhdGVFdmVudCA9IHJvb20uY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKEV2ZW50VHlwZS5Sb29tQ3JlYXRlLCAnJyk7XG4gICAgICAgIGlmIChjcmVhdGVFdmVudCAmJiBjcmVhdGVFdmVudC5nZXRDb250ZW50KClbJ20uZmVkZXJhdGUnXSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHVuZmVkZXJhdGFibGVTZWN0aW9uID0gPGRpdj57IF90KCdUaGlzIHJvb20gaXMgbm90IGFjY2Vzc2libGUgYnkgcmVtb3RlIE1hdHJpeCBzZXJ2ZXJzJykgfTwvZGl2PjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCByb29tVXBncmFkZUJ1dHRvbjtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUudXBncmFkZVJlY29tbWVuZGF0aW9uICYmIHRoaXMuc3RhdGUudXBncmFkZVJlY29tbWVuZGF0aW9uLm5lZWRzVXBncmFkZSAmJiAhdGhpcy5zdGF0ZS51cGdyYWRlZCkge1xuICAgICAgICAgICAgcm9vbVVwZ3JhZGVCdXR0b24gPSAoXG4gICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSdteF9TZXR0aW5nc1RhYl93YXJuaW5nVGV4dCc+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiPGI+V2FybmluZzwvYj46IFVwZ3JhZGluZyBhIHJvb20gd2lsbCA8aT5ub3QgYXV0b21hdGljYWxseSBtaWdyYXRlIHJvb20gbWVtYmVycyBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0byB0aGUgbmV3IHZlcnNpb24gb2YgdGhlIHJvb20uPC9pPiBXZSdsbCBwb3N0IGEgbGluayB0byB0aGUgbmV3IHJvb20gaW4gdGhlIG9sZCBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2ZXJzaW9uIG9mIHRoZSByb29tIC0gcm9vbSBtZW1iZXJzIHdpbGwgaGF2ZSB0byBjbGljayB0aGlzIGxpbmsgdG8gam9pbiB0aGUgbmV3IHJvb20uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge30sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiXCI6IChzdWIpID0+IDxiPnsgc3ViIH08L2I+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlcIjogKHN1YikgPT4gPGk+eyBzdWIgfTwvaT4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICkgfVxuICAgICAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIG9uQ2xpY2s9e3RoaXMudXBncmFkZVJvb219IGtpbmQ9J3ByaW1hcnknPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBpc1NwYWNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBfdChcIlVwZ3JhZGUgdGhpcyBzcGFjZSB0byB0aGUgcmVjb21tZW5kZWQgcm9vbSB2ZXJzaW9uXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBfdChcIlVwZ3JhZGUgdGhpcyByb29tIHRvIHRoZSByZWNvbW1lbmRlZCByb29tIHZlcnNpb25cIikgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG9sZFJvb21MaW5rO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5vbGRSb29tSWQpIHtcbiAgICAgICAgICAgIGxldCBjb3B5OiBzdHJpbmc7XG4gICAgICAgICAgICBpZiAoaXNTcGFjZSkge1xuICAgICAgICAgICAgICAgIGNvcHkgPSBfdChcIlZpZXcgb2xkZXIgdmVyc2lvbiBvZiAlKHNwYWNlTmFtZSlzLlwiLCB7IHNwYWNlTmFtZTogcm9vbS5uYW1lIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb3B5ID0gX3QoXCJWaWV3IG9sZGVyIG1lc3NhZ2VzIGluICUocm9vbU5hbWUpcy5cIiwgeyByb29tTmFtZTogcm9vbS5uYW1lIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBvbGRSb29tTGluayA9IChcbiAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBlbGVtZW50PSdhJyBvbkNsaWNrPXt0aGlzLm9uT2xkUm9vbUNsaWNrZWR9PlxuICAgICAgICAgICAgICAgICAgICB7IGNvcHkgfVxuICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYlwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfaGVhZGluZ1wiPnsgX3QoXCJBZHZhbmNlZFwiKSB9PC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3NlY3Rpb24gbXhfU2V0dGluZ3NUYWJfc3Vic2VjdGlvblRleHQnPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3N1YmhlYWRpbmcnPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyByb29tPy5pc1NwYWNlUm9vbSgpID8gX3QoXCJTcGFjZSBpbmZvcm1hdGlvblwiKSA6IF90KFwiUm9vbSBpbmZvcm1hdGlvblwiKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPnsgX3QoXCJJbnRlcm5hbCByb29tIElEXCIpIH08L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICA8Q29weWFibGVUZXh0IGdldFRleHRUb0NvcHk9eygpID0+IHRoaXMucHJvcHMucm9vbUlkfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHRoaXMucHJvcHMucm9vbUlkIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQ29weWFibGVUZXh0PlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgeyB1bmZlZGVyYXRhYmxlU2VjdGlvbiB9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3NlY3Rpb24gbXhfU2V0dGluZ3NUYWJfc3Vic2VjdGlvblRleHQnPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3N1YmhlYWRpbmcnPnsgX3QoXCJSb29tIHZlcnNpb25cIikgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPnsgX3QoXCJSb29tIHZlcnNpb246XCIpIH08L3NwYW4+Jm5ic3A7XG4gICAgICAgICAgICAgICAgICAgICAgICB7IHJvb20uZ2V0VmVyc2lvbigpIH1cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIHsgb2xkUm9vbUxpbmsgfVxuICAgICAgICAgICAgICAgICAgICB7IHJvb21VcGdyYWRlQnV0dG9uIH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQXFCZSxNQUFNQSx1QkFBTixTQUFzQ0MsY0FBQSxDQUFNQyxTQUE1QyxDQUFzRTtFQUNqRkMsV0FBVyxDQUFDQyxLQUFELEVBQVFDLE9BQVIsRUFBaUI7SUFDeEIsTUFBTUQsS0FBTixFQUFhQyxPQUFiO0lBRHdCLG1EQTZCTEMsQ0FBRCxJQUFPO01BQ3pCLE1BQU1DLElBQUksR0FBR0MsZ0NBQUEsQ0FBZ0JDLEdBQWhCLEdBQXNCQyxPQUF0QixDQUE4QixLQUFLTixLQUFMLENBQVdPLE1BQXpDLENBQWI7O01BQ0FDLGNBQUEsQ0FBTUMsWUFBTixDQUFtQkMsMEJBQW5CLEVBQXNDO1FBQUVQO01BQUYsQ0FBdEM7SUFDSCxDQWhDMkI7SUFBQSx3REFrQ0FELENBQUQsSUFBTztNQUM5QkEsQ0FBQyxDQUFDUyxjQUFGO01BQ0FULENBQUMsQ0FBQ1UsZUFBRjs7TUFFQUMsbUJBQUEsQ0FBSUMsUUFBSixDQUE4QjtRQUMxQkMsTUFBTSxFQUFFQyxlQUFBLENBQU9DLFFBRFc7UUFFMUJDLE9BQU8sRUFBRSxLQUFLQyxLQUFMLENBQVdDLFNBRk07UUFHMUJDLFFBQVEsRUFBRSxLQUFLRixLQUFMLENBQVdHLFVBSEs7UUFJMUJDLGNBQWMsRUFBRSx3QkFKVTtRQUsxQkMsa0JBQWtCLEVBQUV0QixDQUFDLENBQUN1QixJQUFGLEtBQVc7TUFMTCxDQUE5Qjs7TUFPQSxLQUFLekIsS0FBTCxDQUFXMEIsZUFBWDtJQUNILENBOUMyQjtJQUd4QixLQUFLUCxLQUFMLEdBQWE7TUFDVDtNQUNBUSxxQkFBcUIsRUFBRTtJQUZkLENBQWIsQ0FId0IsQ0FR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
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _event = require("matrix-js-sdk/src/@types/event");

var _partials = require("matrix-js-sdk/src/@types/partials");

var _languageHandler = require("../../../languageHandler");

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _LabelledToggleSwitch = _interopRequireDefault(require("../elements/LabelledToggleSwitch"));

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _BugReportDialog = _interopRequireDefault(require("./BugReportDialog"));

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _DialogButtons = _interopRequireDefault(require("../elements/DialogButtons"));

var _ProgressBar = _interopRequireDefault(require("../elements/ProgressBar"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

/*
Copyright 2019 - 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class RoomUpgradeWarningDialog extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "isPrivate", void 0);
    (0, _defineProperty2.default)(this, "currentVersion", void 0);
    (0, _defineProperty2.default)(this, "onProgressCallback", (progressText, progress, total) => {
      this.setState({
        progressText,
        progress,
        total
      });
    });
    (0, _defineProperty2.default)(this, "onContinue", () => {
      const opts = {
        continue: true,
        invite: this.isPrivate && this.state.inviteUsersToNewRoom
      };

      if (this.props.doUpgrade) {
        this.props.doUpgrade(opts, this.onProgressCallback).then(() => {
          this.props.onFinished(opts);
        });
      } else {
        this.props.onFinished(opts);
      }
    });
    (0, _defineProperty2.default)(this, "onCancel", () => {
      this.props.onFinished({
        continue: false,
        invite: false
      });
    });
    (0, _defineProperty2.default)(this, "onInviteUsersToggle", inviteUsersToNewRoom => {
      this.setState({
        inviteUsersToNewRoom
      });
    });
    (0, _defineProperty2.default)(this, "openBugReportDialog", e => {
      e.preventDefault();
      e.stopPropagation();

      _Modal.default.createDialog(_BugReportDialog.default, {});
    });

    const room = _MatrixClientPeg.MatrixClientPeg.get().getRoom(this.props.roomId);

    const joinRules = room?.currentState.getStateEvents(_event.EventType.RoomJoinRules, "");
    this.isPrivate = joinRules?.getContent()['join_rule'] !== _partials.JoinRule.Public ?? true;
    this.currentVersion = room?.getVersion();
    this.state = {
      inviteUsersToNewRoom: true
    };
  }

  render() {
    const brand = _SdkConfig.default.get().brand;

    let inviteToggle = null;

    if (this.isPrivate) {
      inviteToggle = /*#__PURE__*/_react.default.createElement(_LabelledToggleSwitch.default, {
        value: this.state.inviteUsersToNewRoom,
        onChange: this.onInviteUsersToggle,
        label: (0, _languageHandler._t)("Automatically invite members from this room to the new one")
      });
    }

    const title = this.isPrivate ? (0, _languageHandler._t)("Upgrade private room") : (0, _languageHandler._t)("Upgrade public room");

    let bugReports = /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("This usually only affects how the room is processed on the server. If you're " + "having problems with your %(brand)s, please report a bug.", {
      brand
    }));

    if (_SdkConfig.default.get().bug_report_endpoint_url) {
      bugReports = /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("This usually only affects how the room is processed on the server. If you're " + "having problems with your %(brand)s, please <a>report a bug</a>.", {
        brand
      }, {
        "a": sub => {
          return /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
            kind: "link_inline",
            onClick: this.openBugReportDialog
          }, sub);
        }
      }));
    }

    let footer;

    if (this.state.progressText) {
      footer = /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_RoomUpgradeWarningDialog_progress"
      }, /*#__PURE__*/_react.default.createElement(_ProgressBar.default, {
        value: this.state.progress,
        max: this.state.total
      }), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_RoomUpgradeWarningDialog_progressText"
      }, this.state.progressText));
    } else {
      footer = /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
        primaryButton: (0, _languageHandler._t)("Upgrade"),
        onPrimaryButtonClick: this.onContinue,
        cancelButton: (0, _languageHandler._t)("Cancel"),
        onCancel: this.onCancel
      });
    }

    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: "mx_RoomUpgradeWarningDialog",
      hasCancel: true,
      fixedWidth: false,
      onFinished: this.props.onFinished,
      title: title
    }, /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, this.props.description || (0, _languageHandler._t)("Upgrading a room is an advanced action and is usually recommended when a room " + "is unstable due to bugs, missing features or security vulnerabilities.")), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("<b>Please note upgrading will make a new version of the room</b>. " + "All current messages will stay in this archived room.", {}, {
      b: sub => /*#__PURE__*/_react.default.createElement("b", null, sub)
    })), bugReports, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("You'll upgrade this room from <oldVersion /> to <newVersion />.", {}, {
      oldVersion: () => /*#__PURE__*/_react.default.createElement("code", null, this.currentVersion),
      newVersion: () => /*#__PURE__*/_react.default.createElement("code", null, this.props.targetVersion)
    })), inviteToggle), footer);
  }

}

exports.default = RoomUpgradeWarningDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSb29tVXBncmFkZVdhcm5pbmdEaWFsb2ciLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJwcm9ncmVzc1RleHQiLCJwcm9ncmVzcyIsInRvdGFsIiwic2V0U3RhdGUiLCJvcHRzIiwiY29udGludWUiLCJpbnZpdGUiLCJpc1ByaXZhdGUiLCJzdGF0ZSIsImludml0ZVVzZXJzVG9OZXdSb29tIiwiZG9VcGdyYWRlIiwib25Qcm9ncmVzc0NhbGxiYWNrIiwidGhlbiIsIm9uRmluaXNoZWQiLCJlIiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJNb2RhbCIsImNyZWF0ZURpYWxvZyIsIkJ1Z1JlcG9ydERpYWxvZyIsInJvb20iLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJnZXRSb29tIiwicm9vbUlkIiwiam9pblJ1bGVzIiwiY3VycmVudFN0YXRlIiwiZ2V0U3RhdGVFdmVudHMiLCJFdmVudFR5cGUiLCJSb29tSm9pblJ1bGVzIiwiZ2V0Q29udGVudCIsIkpvaW5SdWxlIiwiUHVibGljIiwiY3VycmVudFZlcnNpb24iLCJnZXRWZXJzaW9uIiwicmVuZGVyIiwiYnJhbmQiLCJTZGtDb25maWciLCJpbnZpdGVUb2dnbGUiLCJvbkludml0ZVVzZXJzVG9nZ2xlIiwiX3QiLCJ0aXRsZSIsImJ1Z1JlcG9ydHMiLCJidWdfcmVwb3J0X2VuZHBvaW50X3VybCIsInN1YiIsIm9wZW5CdWdSZXBvcnREaWFsb2ciLCJmb290ZXIiLCJvbkNvbnRpbnVlIiwib25DYW5jZWwiLCJkZXNjcmlwdGlvbiIsImIiLCJvbGRWZXJzaW9uIiwibmV3VmVyc2lvbiIsInRhcmdldFZlcnNpb24iXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy92aWV3cy9kaWFsb2dzL1Jvb21VcGdyYWRlV2FybmluZ0RpYWxvZy50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IC0gMjAyMSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCwgeyBSZWFjdE5vZGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBFdmVudFR5cGUgfSBmcm9tICdtYXRyaXgtanMtc2RrL3NyYy9AdHlwZXMvZXZlbnQnO1xuaW1wb3J0IHsgSm9pblJ1bGUgfSBmcm9tICdtYXRyaXgtanMtc2RrL3NyYy9AdHlwZXMvcGFydGlhbHMnO1xuXG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBTZGtDb25maWcgZnJvbSBcIi4uLy4uLy4uL1Nka0NvbmZpZ1wiO1xuaW1wb3J0IExhYmVsbGVkVG9nZ2xlU3dpdGNoIGZyb20gXCIuLi9lbGVtZW50cy9MYWJlbGxlZFRvZ2dsZVN3aXRjaFwiO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSBcIi4uLy4uLy4uL01hdHJpeENsaWVudFBlZ1wiO1xuaW1wb3J0IE1vZGFsIGZyb20gXCIuLi8uLi8uLi9Nb2RhbFwiO1xuaW1wb3J0IHsgSURpYWxvZ1Byb3BzIH0gZnJvbSBcIi4vSURpYWxvZ1Byb3BzXCI7XG5pbXBvcnQgQnVnUmVwb3J0RGlhbG9nIGZyb20gJy4vQnVnUmVwb3J0RGlhbG9nJztcbmltcG9ydCBCYXNlRGlhbG9nIGZyb20gXCIuL0Jhc2VEaWFsb2dcIjtcbmltcG9ydCBEaWFsb2dCdXR0b25zIGZyb20gXCIuLi9lbGVtZW50cy9EaWFsb2dCdXR0b25zXCI7XG5pbXBvcnQgUHJvZ3Jlc3NCYXIgZnJvbSBcIi4uL2VsZW1lbnRzL1Byb2dyZXNzQmFyXCI7XG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tICcuLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uJztcblxuZXhwb3J0IGludGVyZmFjZSBJRmluaXNoZWRPcHRzIHtcbiAgICBjb250aW51ZTogYm9vbGVhbjtcbiAgICBpbnZpdGU6IGJvb2xlYW47XG59XG5cbmludGVyZmFjZSBJUHJvcHMgZXh0ZW5kcyBJRGlhbG9nUHJvcHMge1xuICAgIHJvb21JZDogc3RyaW5nO1xuICAgIHRhcmdldFZlcnNpb246IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbj86IFJlYWN0Tm9kZTtcbiAgICBkb1VwZ3JhZGU/KG9wdHM6IElGaW5pc2hlZE9wdHMsIGZuOiAocHJvZ3Jlc3NUZXh0OiBzdHJpbmcsIHByb2dyZXNzOiBudW1iZXIsIHRvdGFsOiBudW1iZXIpID0+IHZvaWQpOiBQcm9taXNlPHZvaWQ+O1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBpbnZpdGVVc2Vyc1RvTmV3Um9vbTogYm9vbGVhbjtcbiAgICBwcm9ncmVzc1RleHQ/OiBzdHJpbmc7XG4gICAgcHJvZ3Jlc3M/OiBudW1iZXI7XG4gICAgdG90YWw/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJvb21VcGdyYWRlV2FybmluZ0RpYWxvZyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgaXNQcml2YXRlOiBib29sZWFuO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgY3VycmVudFZlcnNpb246IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICBjb25zdCByb29tID0gTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFJvb20odGhpcy5wcm9wcy5yb29tSWQpO1xuICAgICAgICBjb25zdCBqb2luUnVsZXMgPSByb29tPy5jdXJyZW50U3RhdGUuZ2V0U3RhdGVFdmVudHMoRXZlbnRUeXBlLlJvb21Kb2luUnVsZXMsIFwiXCIpO1xuICAgICAgICB0aGlzLmlzUHJpdmF0ZSA9IGpvaW5SdWxlcz8uZ2V0Q29udGVudCgpWydqb2luX3J1bGUnXSAhPT0gSm9pblJ1bGUuUHVibGljID8/IHRydWU7XG4gICAgICAgIHRoaXMuY3VycmVudFZlcnNpb24gPSByb29tPy5nZXRWZXJzaW9uKCk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGludml0ZVVzZXJzVG9OZXdSb29tOiB0cnVlLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgb25Qcm9ncmVzc0NhbGxiYWNrID0gKHByb2dyZXNzVGV4dDogc3RyaW5nLCBwcm9ncmVzczogbnVtYmVyLCB0b3RhbDogbnVtYmVyKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBwcm9ncmVzc1RleHQsIHByb2dyZXNzLCB0b3RhbCB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkNvbnRpbnVlID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBvcHRzID0ge1xuICAgICAgICAgICAgY29udGludWU6IHRydWUsXG4gICAgICAgICAgICBpbnZpdGU6IHRoaXMuaXNQcml2YXRlICYmIHRoaXMuc3RhdGUuaW52aXRlVXNlcnNUb05ld1Jvb20sXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuZG9VcGdyYWRlKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLmRvVXBncmFkZShvcHRzLCB0aGlzLm9uUHJvZ3Jlc3NDYWxsYmFjaykudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkZpbmlzaGVkKG9wdHMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLm9uRmluaXNoZWQob3B0cyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkNhbmNlbCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkZpbmlzaGVkKHsgY29udGludWU6IGZhbHNlLCBpbnZpdGU6IGZhbHNlIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uSW52aXRlVXNlcnNUb2dnbGUgPSAoaW52aXRlVXNlcnNUb05ld1Jvb206IGJvb2xlYW4pID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGludml0ZVVzZXJzVG9OZXdSb29tIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9wZW5CdWdSZXBvcnREaWFsb2cgPSAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgTW9kYWwuY3JlYXRlRGlhbG9nKEJ1Z1JlcG9ydERpYWxvZywge30pO1xuICAgIH07XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IGJyYW5kID0gU2RrQ29uZmlnLmdldCgpLmJyYW5kO1xuXG4gICAgICAgIGxldCBpbnZpdGVUb2dnbGUgPSBudWxsO1xuICAgICAgICBpZiAodGhpcy5pc1ByaXZhdGUpIHtcbiAgICAgICAgICAgIGludml0ZVRvZ2dsZSA9IChcbiAgICAgICAgICAgICAgICA8TGFiZWxsZWRUb2dnbGVTd2l0Y2hcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUuaW52aXRlVXNlcnNUb05ld1Jvb219XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uSW52aXRlVXNlcnNUb2dnbGV9XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdChcIkF1dG9tYXRpY2FsbHkgaW52aXRlIG1lbWJlcnMgZnJvbSB0aGlzIHJvb20gdG8gdGhlIG5ldyBvbmVcIil9IC8+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLmlzUHJpdmF0ZSA/IF90KFwiVXBncmFkZSBwcml2YXRlIHJvb21cIikgOiBfdChcIlVwZ3JhZGUgcHVibGljIHJvb21cIik7XG5cbiAgICAgICAgbGV0IGJ1Z1JlcG9ydHMgPSAoXG4gICAgICAgICAgICA8cD5cbiAgICAgICAgICAgICAgICB7IF90KFxuICAgICAgICAgICAgICAgICAgICBcIlRoaXMgdXN1YWxseSBvbmx5IGFmZmVjdHMgaG93IHRoZSByb29tIGlzIHByb2Nlc3NlZCBvbiB0aGUgc2VydmVyLiBJZiB5b3UncmUgXCIgK1xuICAgICAgICAgICAgICAgICAgICBcImhhdmluZyBwcm9ibGVtcyB3aXRoIHlvdXIgJShicmFuZClzLCBwbGVhc2UgcmVwb3J0IGEgYnVnLlwiLCB7IGJyYW5kIH0sXG4gICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICA8L3A+XG4gICAgICAgICk7XG4gICAgICAgIGlmIChTZGtDb25maWcuZ2V0KCkuYnVnX3JlcG9ydF9lbmRwb2ludF91cmwpIHtcbiAgICAgICAgICAgIGJ1Z1JlcG9ydHMgPSAoXG4gICAgICAgICAgICAgICAgPHA+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIlRoaXMgdXN1YWxseSBvbmx5IGFmZmVjdHMgaG93IHRoZSByb29tIGlzIHByb2Nlc3NlZCBvbiB0aGUgc2VydmVyLiBJZiB5b3UncmUgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJoYXZpbmcgcHJvYmxlbXMgd2l0aCB5b3VyICUoYnJhbmQpcywgcGxlYXNlIDxhPnJlcG9ydCBhIGJ1ZzwvYT4uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJhbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYVwiOiAoc3ViKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA8QWNjZXNzaWJsZUJ1dHRvbiBraW5kPSdsaW5rX2lubGluZScgb25DbGljaz17dGhpcy5vcGVuQnVnUmVwb3J0RGlhbG9nfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgc3ViIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBmb290ZXI6IEpTWC5FbGVtZW50O1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5wcm9ncmVzc1RleHQpIHtcbiAgICAgICAgICAgIGZvb3RlciA9IDxzcGFuIGNsYXNzTmFtZT1cIm14X1Jvb21VcGdyYWRlV2FybmluZ0RpYWxvZ19wcm9ncmVzc1wiPlxuICAgICAgICAgICAgICAgIDxQcm9ncmVzc0JhciB2YWx1ZT17dGhpcy5zdGF0ZS5wcm9ncmVzc30gbWF4PXt0aGlzLnN0YXRlLnRvdGFsfSAvPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUm9vbVVwZ3JhZGVXYXJuaW5nRGlhbG9nX3Byb2dyZXNzVGV4dFwiPlxuICAgICAgICAgICAgICAgICAgICB7IHRoaXMuc3RhdGUucHJvZ3Jlc3NUZXh0IH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvc3Bhbj47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb290ZXIgPSA8RGlhbG9nQnV0dG9uc1xuICAgICAgICAgICAgICAgIHByaW1hcnlCdXR0b249e190KFwiVXBncmFkZVwiKX1cbiAgICAgICAgICAgICAgICBvblByaW1hcnlCdXR0b25DbGljaz17dGhpcy5vbkNvbnRpbnVlfVxuICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbj17X3QoXCJDYW5jZWxcIil9XG4gICAgICAgICAgICAgICAgb25DYW5jZWw9e3RoaXMub25DYW5jZWx9XG4gICAgICAgICAgICAvPjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QmFzZURpYWxvZ1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0nbXhfUm9vbVVwZ3JhZGVXYXJuaW5nRGlhbG9nJ1xuICAgICAgICAgICAgICAgIGhhc0NhbmNlbD17dHJ1ZX1cbiAgICAgICAgICAgICAgICBmaXhlZFdpZHRoPXtmYWxzZX1cbiAgICAgICAgICAgICAgICBvbkZpbmlzaGVkPXt0aGlzLnByb3BzLm9uRmluaXNoZWR9XG4gICAgICAgICAgICAgICAgdGl0bGU9e3RpdGxlfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgIDxwPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyB0aGlzLnByb3BzLmRlc2NyaXB0aW9uIHx8IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiVXBncmFkaW5nIGEgcm9vbSBpcyBhbiBhZHZhbmNlZCBhY3Rpb24gYW5kIGlzIHVzdWFsbHkgcmVjb21tZW5kZWQgd2hlbiBhIHJvb20gXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaXMgdW5zdGFibGUgZHVlIHRvIGJ1Z3MsIG1pc3NpbmcgZmVhdHVyZXMgb3Igc2VjdXJpdHkgdnVsbmVyYWJpbGl0aWVzLlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICAgICAgICAgICAgPHA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiPGI+UGxlYXNlIG5vdGUgdXBncmFkaW5nIHdpbGwgbWFrZSBhIG5ldyB2ZXJzaW9uIG9mIHRoZSByb29tPC9iPi4gXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQWxsIGN1cnJlbnQgbWVzc2FnZXMgd2lsbCBzdGF5IGluIHRoaXMgYXJjaGl2ZWQgcm9vbS5cIiwge30sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYjogc3ViID0+IDxiPnsgc3ViIH08L2I+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICApIH1cbiAgICAgICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgICAgICAgICB7IGJ1Z1JlcG9ydHMgfVxuICAgICAgICAgICAgICAgICAgICA8cD5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJZb3UnbGwgdXBncmFkZSB0aGlzIHJvb20gZnJvbSA8b2xkVmVyc2lvbiAvPiB0byA8bmV3VmVyc2lvbiAvPi5cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZFZlcnNpb246ICgpID0+IDxjb2RlPnsgdGhpcy5jdXJyZW50VmVyc2lvbiB9PC9jb2RlPixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3VmVyc2lvbjogKCkgPT4gPGNvZGU+eyB0aGlzLnByb3BzLnRhcmdldFZlcnNpb24gfTwvY29kZT4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICkgfVxuICAgICAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgICAgIHsgaW52aXRlVG9nZ2xlIH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICB7IGZvb3RlciB9XG4gICAgICAgICAgICA8L0Jhc2VEaWFsb2c+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUE5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBcUNlLE1BQU1BLHdCQUFOLFNBQXVDQyxjQUFBLENBQU1DLFNBQTdDLENBQXVFO0VBSWxGQyxXQUFXLENBQUNDLEtBQUQsRUFBUTtJQUNmLE1BQU1BLEtBQU47SUFEZTtJQUFBO0lBQUEsMERBYVUsQ0FBQ0MsWUFBRCxFQUF1QkMsUUFBdkIsRUFBeUNDLEtBQXpDLEtBQWlFO01BQzFGLEtBQUtDLFFBQUwsQ0FBYztRQUFFSCxZQUFGO1FBQWdCQyxRQUFoQjtRQUEwQkM7TUFBMUIsQ0FBZDtJQUNILENBZmtCO0lBQUEsa0RBaUJFLE1BQU07TUFDdkIsTUFBTUUsSUFBSSxHQUFHO1FBQ1RDLFFBQVEsRUFBRSxJQUREO1FBRVRDLE1BQU0sRUFBRSxLQUFLQyxTQUFMLElBQWtCLEtBQUtDLEtBQUwsQ0FBV0M7TUFGNUIsQ0FBYjs7TUFLQSxJQUFJLEtBQUtWLEtBQUws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
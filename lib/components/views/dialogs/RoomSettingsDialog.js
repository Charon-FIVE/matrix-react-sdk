"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ROOM_SECURITY_TAB = exports.ROOM_ROLES_TAB = exports.ROOM_NOTIFICATIONS_TAB = exports.ROOM_GENERAL_TAB = exports.ROOM_BRIDGES_TAB = exports.ROOM_ADVANCED_TAB = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _room = require("matrix-js-sdk/src/models/room");

var _TabbedView = _interopRequireWildcard(require("../../structures/TabbedView"));

var _languageHandler = require("../../../languageHandler");

var _AdvancedRoomSettingsTab = _interopRequireDefault(require("../settings/tabs/room/AdvancedRoomSettingsTab"));

var _RolesRoomSettingsTab = _interopRequireDefault(require("../settings/tabs/room/RolesRoomSettingsTab"));

var _GeneralRoomSettingsTab = _interopRequireDefault(require("../settings/tabs/room/GeneralRoomSettingsTab"));

var _SecurityRoomSettingsTab = _interopRequireDefault(require("../settings/tabs/room/SecurityRoomSettingsTab"));

var _NotificationSettingsTab = _interopRequireDefault(require("../settings/tabs/room/NotificationSettingsTab"));

var _BridgeSettingsTab = _interopRequireDefault(require("../settings/tabs/room/BridgeSettingsTab"));

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _UIFeature = require("../../../settings/UIFeature");

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _actions = require("../../../dispatcher/actions");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2019 New Vector Ltd
Copyright 2019 Michael Telatynski <7t3chguy@gmail.com>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const ROOM_GENERAL_TAB = "ROOM_GENERAL_TAB";
exports.ROOM_GENERAL_TAB = ROOM_GENERAL_TAB;
const ROOM_SECURITY_TAB = "ROOM_SECURITY_TAB";
exports.ROOM_SECURITY_TAB = ROOM_SECURITY_TAB;
const ROOM_ROLES_TAB = "ROOM_ROLES_TAB";
exports.ROOM_ROLES_TAB = ROOM_ROLES_TAB;
const ROOM_NOTIFICATIONS_TAB = "ROOM_NOTIFICATIONS_TAB";
exports.ROOM_NOTIFICATIONS_TAB = ROOM_NOTIFICATIONS_TAB;
const ROOM_BRIDGES_TAB = "ROOM_BRIDGES_TAB";
exports.ROOM_BRIDGES_TAB = ROOM_BRIDGES_TAB;
const ROOM_ADVANCED_TAB = "ROOM_ADVANCED_TAB";
exports.ROOM_ADVANCED_TAB = ROOM_ADVANCED_TAB;

class RoomSettingsDialog extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "dispatcherRef", void 0);
    (0, _defineProperty2.default)(this, "onAction", payload => {
      // When view changes below us, close the room settings
      // whilst the modal is open this can only be triggered when someone hits Leave Room
      if (payload.action === _actions.Action.ViewHomePage) {
        this.props.onFinished(true);
      }
    });
    (0, _defineProperty2.default)(this, "onRoomName", () => {
      this.setState({
        roomName: _MatrixClientPeg.MatrixClientPeg.get().getRoom(this.props.roomId).name
      });
    });
    this.state = {
      roomName: ''
    };
  }

  componentDidMount() {
    this.dispatcherRef = _dispatcher.default.register(this.onAction);

    _MatrixClientPeg.MatrixClientPeg.get().on(_room.RoomEvent.Name, this.onRoomName);

    this.onRoomName();
  }

  componentWillUnmount() {
    if (this.dispatcherRef) {
      _dispatcher.default.unregister(this.dispatcherRef);
    }

    _MatrixClientPeg.MatrixClientPeg.get().removeListener(_room.RoomEvent.Name, this.onRoomName);
  }

  getTabs() {
    const tabs = [];
    tabs.push(new _TabbedView.Tab(ROOM_GENERAL_TAB, (0, _languageHandler._td)("General"), "mx_RoomSettingsDialog_settingsIcon", /*#__PURE__*/_react.default.createElement(_GeneralRoomSettingsTab.default, {
      roomId: this.props.roomId
    }), "RoomSettingsGeneral"));
    tabs.push(new _TabbedView.Tab(ROOM_SECURITY_TAB, (0, _languageHandler._td)("Security & Privacy"), "mx_RoomSettingsDialog_securityIcon", /*#__PURE__*/_react.default.createElement(_SecurityRoomSettingsTab.default, {
      roomId: this.props.roomId,
      closeSettingsFn: () => this.props.onFinished(true)
    }), "RoomSettingsSecurityPrivacy"));
    tabs.push(new _TabbedView.Tab(ROOM_ROLES_TAB, (0, _languageHandler._td)("Roles & Permissions"), "mx_RoomSettingsDialog_rolesIcon", /*#__PURE__*/_react.default.createElement(_RolesRoomSettingsTab.default, {
      roomId: this.props.roomId
    }), "RoomSettingsRolesPermissions"));
    tabs.push(new _TabbedView.Tab(ROOM_NOTIFICATIONS_TAB, (0, _languageHandler._td)("Notifications"), "mx_RoomSettingsDialog_notificationsIcon", /*#__PURE__*/_react.default.createElement(_NotificationSettingsTab.default, {
      roomId: this.props.roomId,
      closeSettingsFn: () => this.props.onFinished(true)
    }), "RoomSettingsNotifications"));

    if (_SettingsStore.default.getValue("feature_bridge_state")) {
      tabs.push(new _TabbedView.Tab(ROOM_BRIDGES_TAB, (0, _languageHandler._td)("Bridges"), "mx_RoomSettingsDialog_bridgesIcon", /*#__PURE__*/_react.default.createElement(_BridgeSettingsTab.default, {
        roomId: this.props.roomId
      }), "RoomSettingsBridges"));
    }

    if (_SettingsStore.default.getValue(_UIFeature.UIFeature.AdvancedSettings)) {
      tabs.push(new _TabbedView.Tab(ROOM_ADVANCED_TAB, (0, _languageHandler._td)("Advanced"), "mx_RoomSettingsDialog_warningIcon", /*#__PURE__*/_react.default.createElement(_AdvancedRoomSettingsTab.default, {
        roomId: this.props.roomId,
        closeSettingsFn: () => this.props.onFinished(true)
      }), "RoomSettingsAdvanced"));
    }

    return tabs;
  }

  render() {
    const roomName = this.state.roomName;
    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: "mx_RoomSettingsDialog",
      hasCancel: true,
      onFinished: this.props.onFinished,
      title: (0, _languageHandler._t)("Room Settings - %(roomName)s", {
        roomName
      })
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsDialog_content"
    }, /*#__PURE__*/_react.default.createElement(_TabbedView.default, {
      tabs: this.getTabs(),
      initialTabId: this.props.initialTabId,
      screenName: "RoomSettings"
    })));
  }

}

exports.default = RoomSettingsDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJST09NX0dFTkVSQUxfVEFCIiwiUk9PTV9TRUNVUklUWV9UQUIiLCJST09NX1JPTEVTX1RBQiIsIlJPT01fTk9USUZJQ0FUSU9OU19UQUIiLCJST09NX0JSSURHRVNfVEFCIiwiUk9PTV9BRFZBTkNFRF9UQUIiLCJSb29tU2V0dGluZ3NEaWFsb2ciLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJwYXlsb2FkIiwiYWN0aW9uIiwiQWN0aW9uIiwiVmlld0hvbWVQYWdlIiwib25GaW5pc2hlZCIsInNldFN0YXRlIiwicm9vbU5hbWUiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJnZXRSb29tIiwicm9vbUlkIiwibmFtZSIsInN0YXRlIiwiY29tcG9uZW50RGlkTW91bnQiLCJkaXNwYXRjaGVyUmVmIiwiZGlzIiwicmVnaXN0ZXIiLCJvbkFjdGlvbiIsIm9uIiwiUm9vbUV2ZW50IiwiTmFtZSIsIm9uUm9vbU5hbWUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInVucmVnaXN0ZXIiLCJyZW1vdmVMaXN0ZW5lciIsImdldFRhYnMiLCJ0YWJzIiwicHVzaCIsIlRhYiIsIl90ZCIsIlNldHRpbmdzU3RvcmUiLCJnZXRWYWx1ZSIsIlVJRmVhdHVyZSIsIkFkdmFuY2VkU2V0dGluZ3MiLCJyZW5kZXIiLCJfdCIsImluaXRpYWxUYWJJZCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvUm9vbVNldHRpbmdzRGlhbG9nLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTkgTmV3IFZlY3RvciBMdGRcbkNvcHlyaWdodCAyMDE5IE1pY2hhZWwgVGVsYXR5bnNraSA8N3QzY2hndXlAZ21haWwuY29tPlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBSb29tRXZlbnQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb21cIjtcblxuaW1wb3J0IFRhYmJlZFZpZXcsIHsgVGFiIH0gZnJvbSBcIi4uLy4uL3N0cnVjdHVyZXMvVGFiYmVkVmlld1wiO1xuaW1wb3J0IHsgX3QsIF90ZCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBBZHZhbmNlZFJvb21TZXR0aW5nc1RhYiBmcm9tIFwiLi4vc2V0dGluZ3MvdGFicy9yb29tL0FkdmFuY2VkUm9vbVNldHRpbmdzVGFiXCI7XG5pbXBvcnQgUm9sZXNSb29tU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvcm9vbS9Sb2xlc1Jvb21TZXR0aW5nc1RhYlwiO1xuaW1wb3J0IEdlbmVyYWxSb29tU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvcm9vbS9HZW5lcmFsUm9vbVNldHRpbmdzVGFiXCI7XG5pbXBvcnQgU2VjdXJpdHlSb29tU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvcm9vbS9TZWN1cml0eVJvb21TZXR0aW5nc1RhYlwiO1xuaW1wb3J0IE5vdGlmaWNhdGlvblNldHRpbmdzVGFiIGZyb20gXCIuLi9zZXR0aW5ncy90YWJzL3Jvb20vTm90aWZpY2F0aW9uU2V0dGluZ3NUYWJcIjtcbmltcG9ydCBCcmlkZ2VTZXR0aW5nc1RhYiBmcm9tIFwiLi4vc2V0dGluZ3MvdGFicy9yb29tL0JyaWRnZVNldHRpbmdzVGFiXCI7XG5pbXBvcnQgeyBNYXRyaXhDbGllbnRQZWcgfSBmcm9tIFwiLi4vLi4vLi4vTWF0cml4Q2xpZW50UGVnXCI7XG5pbXBvcnQgZGlzIGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gXCIuLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5pbXBvcnQgeyBVSUZlYXR1cmUgfSBmcm9tIFwiLi4vLi4vLi4vc2V0dGluZ3MvVUlGZWF0dXJlXCI7XG5pbXBvcnQgQmFzZURpYWxvZyBmcm9tIFwiLi9CYXNlRGlhbG9nXCI7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tICcuLi8uLi8uLi9kaXNwYXRjaGVyL2FjdGlvbnMnO1xuXG5leHBvcnQgY29uc3QgUk9PTV9HRU5FUkFMX1RBQiA9IFwiUk9PTV9HRU5FUkFMX1RBQlwiO1xuZXhwb3J0IGNvbnN0IFJPT01fU0VDVVJJVFlfVEFCID0gXCJST09NX1NFQ1VSSVRZX1RBQlwiO1xuZXhwb3J0IGNvbnN0IFJPT01fUk9MRVNfVEFCID0gXCJST09NX1JPTEVTX1RBQlwiO1xuZXhwb3J0IGNvbnN0IFJPT01fTk9USUZJQ0FUSU9OU19UQUIgPSBcIlJPT01fTk9USUZJQ0FUSU9OU19UQUJcIjtcbmV4cG9ydCBjb25zdCBST09NX0JSSURHRVNfVEFCID0gXCJST09NX0JSSURHRVNfVEFCXCI7XG5leHBvcnQgY29uc3QgUk9PTV9BRFZBTkNFRF9UQUIgPSBcIlJPT01fQURWQU5DRURfVEFCXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIHJvb21JZDogc3RyaW5nO1xuICAgIG9uRmluaXNoZWQ6IChzdWNjZXNzOiBib29sZWFuKSA9PiB2b2lkO1xuICAgIGluaXRpYWxUYWJJZD86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgcm9vbU5hbWU6IHN0cmluZztcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUm9vbVNldHRpbmdzRGlhbG9nIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSBkaXNwYXRjaGVyUmVmOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHsgcm9vbU5hbWU6ICcnIH07XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICB0aGlzLmRpc3BhdGNoZXJSZWYgPSBkaXMucmVnaXN0ZXIodGhpcy5vbkFjdGlvbik7XG4gICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5vbihSb29tRXZlbnQuTmFtZSwgdGhpcy5vblJvb21OYW1lKTtcbiAgICAgICAgdGhpcy5vblJvb21OYW1lKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBpZiAodGhpcy5kaXNwYXRjaGVyUmVmKSB7XG4gICAgICAgICAgICBkaXMudW5yZWdpc3Rlcih0aGlzLmRpc3BhdGNoZXJSZWYpO1xuICAgICAgICB9XG5cbiAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLnJlbW92ZUxpc3RlbmVyKFJvb21FdmVudC5OYW1lLCB0aGlzLm9uUm9vbU5hbWUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25BY3Rpb24gPSAocGF5bG9hZCk6IHZvaWQgPT4ge1xuICAgICAgICAvLyBXaGVuIHZpZXcgY2hhbmdlcyBiZWxvdyB1cywgY2xvc2UgdGhlIHJvb20gc2V0dGluZ3NcbiAgICAgICAgLy8gd2hpbHN0IHRoZSBtb2RhbCBpcyBvcGVuIHRoaXMgY2FuIG9ubHkgYmUgdHJpZ2dlcmVkIHdoZW4gc29tZW9uZSBoaXRzIExlYXZlIFJvb21cbiAgICAgICAgaWYgKHBheWxvYWQuYWN0aW9uID09PSBBY3Rpb24uVmlld0hvbWVQYWdlKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLm9uRmluaXNoZWQodHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblJvb21OYW1lID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHJvb21OYW1lOiBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0Um9vbSh0aGlzLnByb3BzLnJvb21JZCkubmFtZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgZ2V0VGFicygpOiBUYWJbXSB7XG4gICAgICAgIGNvbnN0IHRhYnM6IFRhYltdID0gW107XG5cbiAgICAgICAgdGFicy5wdXNoKG5ldyBUYWIoXG4gICAgICAgICAgICBST09NX0dFTkVSQUxfVEFCLFxuICAgICAgICAgICAgX3RkKFwiR2VuZXJhbFwiKSxcbiAgICAgICAgICAgIFwibXhfUm9vbVNldHRpbmdzRGlhbG9nX3NldHRpbmdzSWNvblwiLFxuICAgICAgICAgICAgPEdlbmVyYWxSb29tU2V0dGluZ3NUYWIgcm9vbUlkPXt0aGlzLnByb3BzLnJvb21JZH0gLz4sXG4gICAgICAgICAgICBcIlJvb21TZXR0aW5nc0dlbmVyYWxcIixcbiAgICAgICAgKSk7XG4gICAgICAgIHRhYnMucHVzaChuZXcgVGFiKFxuICAgICAgICAgICAgUk9PTV9TRUNVUklUWV9UQUIsXG4gICAgICAgICAgICBfdGQoXCJTZWN1cml0eSAmIFByaXZhY3lcIiksXG4gICAgICAgICAgICBcIm14X1Jvb21TZXR0aW5nc0RpYWxvZ19zZWN1cml0eUljb25cIixcbiAgICAgICAgICAgIDxTZWN1cml0eVJvb21TZXR0aW5nc1RhYlxuICAgICAgICAgICAgICAgIHJvb21JZD17dGhpcy5wcm9wcy5yb29tSWR9XG4gICAgICAgICAgICAgICAgY2xvc2VTZXR0aW5nc0ZuPXsoKSA9PiB0aGlzLnByb3BzLm9uRmluaXNoZWQodHJ1ZSl9XG4gICAgICAgICAgICAvPixcbiAgICAgICAgICAgIFwiUm9vbVNldHRpbmdzU2VjdXJpdHlQcml2YWN5XCIsXG4gICAgICAgICkpO1xuICAgICAgICB0YWJzLnB1c2gobmV3IFRhYihcbiAgICAgICAgICAgIFJPT01fUk9MRVNfVEFCLFxuICAgICAgICAgICAgX3RkKFwiUm9sZXMgJiBQZXJtaXNzaW9uc1wiKSxcbiAgICAgICAgICAgIFwibXhfUm9vbVNldHRpbmdzRGlhbG9nX3JvbGVzSWNvblwiLFxuICAgICAgICAgICAgPFJvbGVzUm9vbVNldHRpbmdzVGFiIHJvb21JZD17dGhpcy5wcm9wcy5yb29tSWR9IC8+LFxuICAgICAgICAgICAgXCJSb29tU2V0dGluZ3NSb2xlc1Blcm1pc3Npb25zXCIsXG4gICAgICAgICkpO1xuICAgICAgICB0YWJzLnB1c2gobmV3IFRhYihcbiAgICAgICAgICAgIFJPT01fTk9USUZJQ0FUSU9OU19UQUIsXG4gICAgICAgICAgICBfdGQoXCJOb3RpZmljYXRpb25zXCIpLFxuICAgICAgICAgICAgXCJteF9Sb29tU2V0dGluZ3NEaWFsb2dfbm90aWZpY2F0aW9uc0ljb25cIixcbiAgICAgICAgICAgIDxOb3RpZmljYXRpb25TZXR0aW5nc1RhYiByb29tSWQ9e3RoaXMucHJvcHMucm9vbUlkfSBjbG9zZVNldHRpbmdzRm49eygpID0+IHRoaXMucHJvcHMub25GaW5pc2hlZCh0cnVlKX0gLz4sXG4gICAgICAgICAgICBcIlJvb21TZXR0aW5nc05vdGlmaWNhdGlvbnNcIixcbiAgICAgICAgKSk7XG5cbiAgICAgICAgaWYgKFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJmZWF0dXJlX2JyaWRnZV9zdGF0ZVwiKSkge1xuICAgICAgICAgICAgdGFicy5wdXNoKG5ldyBUYWIoXG4gICAgICAgICAgICAgICAgUk9PTV9CUklER0VTX1RBQixcbiAgICAgICAgICAgICAgICBfdGQoXCJCcmlkZ2VzXCIpLFxuICAgICAgICAgICAgICAgIFwibXhfUm9vbVNldHRpbmdzRGlhbG9nX2JyaWRnZXNJY29uXCIsXG4gICAgICAgICAgICAgICAgPEJyaWRnZVNldHRpbmdzVGFiIHJvb21JZD17dGhpcy5wcm9wcy5yb29tSWR9IC8+LFxuICAgICAgICAgICAgICAgIFwiUm9vbVNldHRpbmdzQnJpZGdlc1wiLFxuICAgICAgICAgICAgKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShVSUZlYXR1cmUuQWR2YW5jZWRTZXR0aW5ncykpIHtcbiAgICAgICAgICAgIHRhYnMucHVzaChuZXcgVGFiKFxuICAgICAgICAgICAgICAgIFJPT01fQURWQU5DRURfVEFCLFxuICAgICAgICAgICAgICAgIF90ZChcIkFkdmFuY2VkXCIpLFxuICAgICAgICAgICAgICAgIFwibXhfUm9vbVNldHRpbmdzRGlhbG9nX3dhcm5pbmdJY29uXCIsXG4gICAgICAgICAgICAgICAgPEFkdmFuY2VkUm9vbVNldHRpbmdzVGFiXG4gICAgICAgICAgICAgICAgICAgIHJvb21JZD17dGhpcy5wcm9wcy5yb29tSWR9XG4gICAgICAgICAgICAgICAgICAgIGNsb3NlU2V0dGluZ3NGbj17KCkgPT4gdGhpcy5wcm9wcy5vbkZpbmlzaGVkKHRydWUpfVxuICAgICAgICAgICAgICAgIC8+LFxuICAgICAgICAgICAgICAgIFwiUm9vbVNldHRpbmdzQWR2YW5jZWRcIixcbiAgICAgICAgICAgICkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRhYnM7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCByb29tTmFtZSA9IHRoaXMuc3RhdGUucm9vbU5hbWU7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QmFzZURpYWxvZ1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0nbXhfUm9vbVNldHRpbmdzRGlhbG9nJ1xuICAgICAgICAgICAgICAgIGhhc0NhbmNlbD17dHJ1ZX1cbiAgICAgICAgICAgICAgICBvbkZpbmlzaGVkPXt0aGlzLnByb3BzLm9uRmluaXNoZWR9XG4gICAgICAgICAgICAgICAgdGl0bGU9e190KFwiUm9vbSBTZXR0aW5ncyAtICUocm9vbU5hbWUpc1wiLCB7IHJvb21OYW1lIH0pfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdteF9TZXR0aW5nc0RpYWxvZ19jb250ZW50Jz5cbiAgICAgICAgICAgICAgICAgICAgPFRhYmJlZFZpZXdcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYnM9e3RoaXMuZ2V0VGFicygpfVxuICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbFRhYklkPXt0aGlzLnByb3BzLmluaXRpYWxUYWJJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbk5hbWU9XCJSb29tU2V0dGluZ3NcIlxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9CYXNlRGlhbG9nPlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpQkE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQWpDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQW9CTyxNQUFNQSxnQkFBZ0IsR0FBRyxrQkFBekI7O0FBQ0EsTUFB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
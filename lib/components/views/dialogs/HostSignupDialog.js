"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _logger = require("matrix-js-sdk/src/logger");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _QuestionDialog = _interopRequireDefault(require("./QuestionDialog"));

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _languageHandler = require("../../../languageHandler");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _HostSignupStore = require("../../../stores/HostSignupStore");

var _OwnProfileStore = require("../../../stores/OwnProfileStore");

var _HostSignupDialogTypes = require("./HostSignupDialogTypes");

/*
Copyright 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class HostSignupDialog extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "iframeRef", /*#__PURE__*/_react.default.createRef());
    (0, _defineProperty2.default)(this, "config", void 0);
    (0, _defineProperty2.default)(this, "messageHandler", async message => {
      if (!this.config.get("url").startsWith(message.origin)) {
        return;
      }

      switch (message.data.action) {
        case _HostSignupDialogTypes.PostmessageAction.HostSignupAccountDetailsRequest:
          this.onAccountDetailsRequest();
          break;

        case _HostSignupDialogTypes.PostmessageAction.Maximize:
          this.setState({
            minimized: false
          });
          break;

        case _HostSignupDialogTypes.PostmessageAction.Minimize:
          this.setState({
            minimized: true
          });
          break;

        case _HostSignupDialogTypes.PostmessageAction.SetupComplete:
          this.setState({
            completed: true
          });
          break;

        case _HostSignupDialogTypes.PostmessageAction.CloseDialog:
          return this.closeDialog();
      }
    });
    (0, _defineProperty2.default)(this, "maximizeDialog", () => {
      this.setState({
        minimized: false
      }); // Send this action to the iframe so it can act accordingly

      this.sendMessage({
        action: _HostSignupDialogTypes.PostmessageAction.Maximize
      });
    });
    (0, _defineProperty2.default)(this, "minimizeDialog", () => {
      this.setState({
        minimized: true
      }); // Send this action to the iframe so it can act accordingly

      this.sendMessage({
        action: _HostSignupDialogTypes.PostmessageAction.Minimize
      });
    });
    (0, _defineProperty2.default)(this, "closeDialog", async () => {
      window.removeEventListener("message", this.messageHandler); // Finally clear the flag in

      return _HostSignupStore.HostSignupStore.instance.setHostSignupActive(false);
    });
    (0, _defineProperty2.default)(this, "onCloseClick", async () => {
      if (this.state.completed) {
        // We're done, close
        return this.closeDialog();
      } else {
        _Modal.default.createDialog(_QuestionDialog.default, {
          title: (0, _languageHandler._t)("Confirm abort of host creation"),
          description: (0, _languageHandler._t)("Are you sure you wish to abort creation of the host? The process cannot be continued."),
          button: (0, _languageHandler._t)("Abort"),
          onFinished: result => {
            if (result) {
              return this.closeDialog();
            }
          }
        });
      }
    });
    (0, _defineProperty2.default)(this, "sendMessage", message => {
      this.iframeRef.current.contentWindow.postMessage(message, this.config.get("url"));
    });
    (0, _defineProperty2.default)(this, "onAccountDetailsDialogFinished", async result => {
      if (result) {
        return this.sendAccountDetails();
      }

      return this.closeDialog();
    });
    (0, _defineProperty2.default)(this, "onAccountDetailsRequest", () => {
      const cookiePolicyUrl = this.config.get("cookie_policy_url");
      const privacyPolicyUrl = this.config.get("privacy_policy_url");
      const tosUrl = this.config.get("terms_of_service_url");

      const textComponent = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Continuing temporarily allows the %(hostSignupBrand)s setup process to access your " + "account to fetch verified email addresses. This data is not stored.", {
        hostSignupBrand: this.config.get("brand")
      })), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Learn more in our <privacyPolicyLink />, <termsOfServiceLink /> and <cookiePolicyLink />.", {}, {
        cookiePolicyLink: () => /*#__PURE__*/_react.default.createElement("a", {
          href: cookiePolicyUrl,
          target: "_blank",
          rel: "noreferrer noopener"
        }, (0, _languageHandler._t)("Cookie Policy")),
        privacyPolicyLink: () => /*#__PURE__*/_react.default.createElement("a", {
          href: privacyPolicyUrl,
          target: "_blank",
          rel: "noreferrer noopener"
        }, (0, _languageHandler._t)("Privacy Policy")),
        termsOfServiceLink: () => /*#__PURE__*/_react.default.createElement("a", {
          href: tosUrl,
          target: "_blank",
          rel: "noreferrer noopener"
        }, (0, _languageHandler._t)("Terms of Service"))
      })));

      _Modal.default.createDialog(_QuestionDialog.default, {
        title: (0, _languageHandler._t)("You should know"),
        description: textComponent,
        button: (0, _languageHandler._t)("Continue"),
        onFinished: this.onAccountDetailsDialogFinished
      });
    });
    this.state = {
      completed: false,
      error: null,
      minimized: false
    };
    this.config = _SdkConfig.default.getObject("host_signup");
  }

  async sendAccountDetails() {
    const openIdToken = await _MatrixClientPeg.MatrixClientPeg.get().getOpenIdToken();

    if (!openIdToken || !openIdToken.access_token) {
      _logger.logger.warn("Failed to connect to homeserver for OpenID token.");

      this.setState({
        completed: true,
        error: (0, _languageHandler._t)("Failed to connect to your homeserver. Please close this dialog and try again.")
      });
      return;
    }

    this.sendMessage({
      action: _HostSignupDialogTypes.PostmessageAction.HostSignupAccountDetails,
      account: {
        accessToken: await _MatrixClientPeg.MatrixClientPeg.get().getAccessToken(),
        name: _OwnProfileStore.OwnProfileStore.instance.displayName,
        openIdToken: openIdToken.access_token,
        serverName: await _MatrixClientPeg.MatrixClientPeg.get().getDomain(),
        userLocalpart: await _MatrixClientPeg.MatrixClientPeg.get().getUserIdLocalpart(),
        termsAccepted: true
      }
    });
  }

  componentDidMount() {
    window.addEventListener("message", this.messageHandler);
  }

  componentWillUnmount() {
    if (_HostSignupStore.HostSignupStore.instance.isHostSignupActive) {
      // Run the close dialog actions if we're still active, otherwise good to go
      return this.closeDialog();
    }
  }

  render() {
    return /*#__PURE__*/_react.default.createElement("div", {
      className: (0, _classnames.default)({
        "mx_Dialog_wrapper": !this.state.minimized
      })
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: (0, _classnames.default)("mx_Dialog", {
        "mx_HostSignupDialog_minimized": this.state.minimized,
        "mx_HostSignupDialog": !this.state.minimized
      })
    }, this.state.minimized && /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Dialog_header mx_Dialog_headerWithButton"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Dialog_title"
    }, (0, _languageHandler._t)("%(hostSignupBrand)s Setup", {
      hostSignupBrand: this.config.get("brand")
    })), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      className: "mx_HostSignup_maximize_button",
      onClick: this.maximizeDialog,
      "aria-label": (0, _languageHandler._t)("Maximise dialog"),
      title: (0, _languageHandler._t)("Maximise dialog")
    })), !this.state.minimized && /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Dialog_header mx_Dialog_headerWithCancel"
    }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.minimizeDialog,
      className: "mx_HostSignup_minimize_button",
      "aria-label": (0, _languageHandler._t)("Minimise dialog"),
      title: (0, _languageHandler._t)("Minimise dialog")
    }), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.onCloseClick,
      className: "mx_Dialog_cancelButton",
      "aria-label": (0, _languageHandler._t)("Close dialog"),
      title: (0, _languageHandler._t)("Close dialog")
    })), this.state.error && /*#__PURE__*/_react.default.createElement("div", null, this.state.error), !this.state.error && /*#__PURE__*/_react.default.createElement("iframe", {
      title: (0, _languageHandler._t)("Upgrade to %(hostSignupBrand)s", {
        hostSignupBrand: this.config.get("brand")
      }),
      src: this.config.get("url"),
      ref: this.iframeRef,
      sandbox: "allow-forms allow-scripts allow-same-origin allow-popups"
    })));
  }

}

exports.default = HostSignupDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJIb3N0U2lnbnVwRGlhbG9nIiwiUmVhY3QiLCJQdXJlQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImNyZWF0ZVJlZiIsIm1lc3NhZ2UiLCJjb25maWciLCJnZXQiLCJzdGFydHNXaXRoIiwib3JpZ2luIiwiZGF0YSIsImFjdGlvbiIsIlBvc3RtZXNzYWdlQWN0aW9uIiwiSG9zdFNpZ251cEFjY291bnREZXRhaWxzUmVxdWVzdCIsIm9uQWNjb3VudERldGFpbHNSZXF1ZXN0IiwiTWF4aW1pemUiLCJzZXRTdGF0ZSIsIm1pbmltaXplZCIsIk1pbmltaXplIiwiU2V0dXBDb21wbGV0ZSIsImNvbXBsZXRlZCIsIkNsb3NlRGlhbG9nIiwiY2xvc2VEaWFsb2ciLCJzZW5kTWVzc2FnZSIsIndpbmRvdyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJtZXNzYWdlSGFuZGxlciIsIkhvc3RTaWdudXBTdG9yZSIsImluc3RhbmNlIiwic2V0SG9zdFNpZ251cEFjdGl2ZSIsInN0YXRlIiwiTW9kYWwiLCJjcmVhdGVEaWFsb2ciLCJRdWVzdGlvbkRpYWxvZyIsInRpdGxlIiwiX3QiLCJkZXNjcmlwdGlvbiIsImJ1dHRvbiIsIm9uRmluaXNoZWQiLCJyZXN1bHQiLCJpZnJhbWVSZWYiLCJjdXJyZW50IiwiY29udGVudFdpbmRvdyIsInBvc3RNZXNzYWdlIiwic2VuZEFjY291bnREZXRhaWxzIiwiY29va2llUG9saWN5VXJsIiwicHJpdmFjeVBvbGljeVVybCIsInRvc1VybCIsInRleHRDb21wb25lbnQiLCJob3N0U2lnbnVwQnJhbmQiLCJjb29raWVQb2xpY3lMaW5rIiwicHJpdmFjeVBvbGljeUxpbmsiLCJ0ZXJtc09mU2VydmljZUxpbmsiLCJvbkFjY291bnREZXRhaWxzRGlhbG9nRmluaXNoZWQiLCJlcnJvciIsIlNka0NvbmZpZyIsImdldE9iamVjdCIsIm9wZW5JZFRva2VuIiwiTWF0cml4Q2xpZW50UGVnIiwiZ2V0T3BlbklkVG9rZW4iLCJhY2Nlc3NfdG9rZW4iLCJsb2dnZXIiLCJ3YXJuIiwiSG9zdFNpZ251cEFjY291bnREZXRhaWxzIiwiYWNjb3VudCIsImFjY2Vzc1Rva2VuIiwiZ2V0QWNjZXNzVG9rZW4iLCJuYW1lIiwiT3duUHJvZmlsZVN0b3JlIiwiZGlzcGxheU5hbWUiLCJzZXJ2ZXJOYW1lIiwiZ2V0RG9tYWluIiwidXNlckxvY2FscGFydCIsImdldFVzZXJJZExvY2FscGFydCIsInRlcm1zQWNjZXB0ZWQiLCJjb21wb25lbnREaWRNb3VudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImlzSG9zdFNpZ251cEFjdGl2ZSIsInJlbmRlciIsImNsYXNzTmFtZXMiLCJtYXhpbWl6ZURpYWxvZyIsIm1pbmltaXplRGlhbG9nIiwib25DbG9zZUNsaWNrIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvdmlld3MvZGlhbG9ncy9Ib3N0U2lnbnVwRGlhbG9nLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tIFwiY2xhc3NuYW1lc1wiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuXG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tIFwiLi4vZWxlbWVudHMvQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IE1vZGFsIGZyb20gXCIuLi8uLi8uLi9Nb2RhbFwiO1xuaW1wb3J0IFF1ZXN0aW9uRGlhbG9nIGZyb20gJy4vUXVlc3Rpb25EaWFsb2cnO1xuaW1wb3J0IFNka0NvbmZpZyBmcm9tIFwiLi4vLi4vLi4vU2RrQ29uZmlnXCI7XG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gXCIuLi8uLi8uLi9NYXRyaXhDbGllbnRQZWdcIjtcbmltcG9ydCB7IEhvc3RTaWdudXBTdG9yZSB9IGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvSG9zdFNpZ251cFN0b3JlXCI7XG5pbXBvcnQgeyBPd25Qcm9maWxlU3RvcmUgfSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL093blByb2ZpbGVTdG9yZVwiO1xuaW1wb3J0IHtcbiAgICBJUG9zdG1lc3NhZ2UsXG4gICAgSVBvc3RtZXNzYWdlUmVzcG9uc2VEYXRhLFxuICAgIFBvc3RtZXNzYWdlQWN0aW9uLFxufSBmcm9tIFwiLi9Ib3N0U2lnbnVwRGlhbG9nVHlwZXNcIjtcbmltcG9ydCB7IElDb25maWdPcHRpb25zIH0gZnJvbSBcIi4uLy4uLy4uL0lDb25maWdPcHRpb25zXCI7XG5pbXBvcnQgeyBTbmFrZWRPYmplY3QgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvU25ha2VkT2JqZWN0XCI7XG5cbmludGVyZmFjZSBJUHJvcHMge31cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgY29tcGxldGVkOiBib29sZWFuO1xuICAgIGVycm9yOiBzdHJpbmc7XG4gICAgbWluaW1pemVkOiBib29sZWFuO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBIb3N0U2lnbnVwRGlhbG9nIGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHByaXZhdGUgaWZyYW1lUmVmOiBSZWFjdC5SZWZPYmplY3Q8SFRNTElGcmFtZUVsZW1lbnQ+ID0gUmVhY3QuY3JlYXRlUmVmKCk7XG4gICAgcHJpdmF0ZSByZWFkb25seSBjb25maWc6IFNuYWtlZE9iamVjdDxJQ29uZmlnT3B0aW9uc1tcImhvc3Rfc2lnbnVwXCJdPjtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBjb21wbGV0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgICBtaW5pbWl6ZWQ6IGZhbHNlLFxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuY29uZmlnID0gU2RrQ29uZmlnLmdldE9iamVjdChcImhvc3Rfc2lnbnVwXCIpO1xuICAgIH1cblxuICAgIHByaXZhdGUgbWVzc2FnZUhhbmRsZXIgPSBhc3luYyAobWVzc2FnZTogSVBvc3RtZXNzYWdlKSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5jb25maWcuZ2V0KFwidXJsXCIpLnN0YXJ0c1dpdGgobWVzc2FnZS5vcmlnaW4pKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoIChtZXNzYWdlLmRhdGEuYWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIFBvc3RtZXNzYWdlQWN0aW9uLkhvc3RTaWdudXBBY2NvdW50RGV0YWlsc1JlcXVlc3Q6XG4gICAgICAgICAgICAgICAgdGhpcy5vbkFjY291bnREZXRhaWxzUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBQb3N0bWVzc2FnZUFjdGlvbi5NYXhpbWl6ZTpcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgbWluaW1pemVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgUG9zdG1lc3NhZ2VBY3Rpb24uTWluaW1pemU6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIG1pbmltaXplZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgUG9zdG1lc3NhZ2VBY3Rpb24uU2V0dXBDb21wbGV0ZTpcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBQb3N0bWVzc2FnZUFjdGlvbi5DbG9zZURpYWxvZzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jbG9zZURpYWxvZygpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgbWF4aW1pemVEaWFsb2cgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgbWluaW1pemVkOiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFNlbmQgdGhpcyBhY3Rpb24gdG8gdGhlIGlmcmFtZSBzbyBpdCBjYW4gYWN0IGFjY29yZGluZ2x5XG4gICAgICAgIHRoaXMuc2VuZE1lc3NhZ2Uoe1xuICAgICAgICAgICAgYWN0aW9uOiBQb3N0bWVzc2FnZUFjdGlvbi5NYXhpbWl6ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgbWluaW1pemVEaWFsb2cgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgbWluaW1pemVkOiB0cnVlLFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gU2VuZCB0aGlzIGFjdGlvbiB0byB0aGUgaWZyYW1lIHNvIGl0IGNhbiBhY3QgYWNjb3JkaW5nbHlcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSh7XG4gICAgICAgICAgICBhY3Rpb246IFBvc3RtZXNzYWdlQWN0aW9uLk1pbmltaXplLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBjbG9zZURpYWxvZyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIHRoaXMubWVzc2FnZUhhbmRsZXIpO1xuICAgICAgICAvLyBGaW5hbGx5IGNsZWFyIHRoZSBmbGFnIGluXG4gICAgICAgIHJldHVybiBIb3N0U2lnbnVwU3RvcmUuaW5zdGFuY2Uuc2V0SG9zdFNpZ251cEFjdGl2ZShmYWxzZSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25DbG9zZUNsaWNrID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5jb21wbGV0ZWQpIHtcbiAgICAgICAgICAgIC8vIFdlJ3JlIGRvbmUsIGNsb3NlXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jbG9zZURpYWxvZygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgTW9kYWwuY3JlYXRlRGlhbG9nKFxuICAgICAgICAgICAgICAgIFF1ZXN0aW9uRGlhbG9nLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IF90KFwiQ29uZmlybSBhYm9ydCBvZiBob3N0IGNyZWF0aW9uXCIpLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2lzaCB0byBhYm9ydCBjcmVhdGlvbiBvZiB0aGUgaG9zdD8gVGhlIHByb2Nlc3MgY2Fubm90IGJlIGNvbnRpbnVlZC5cIixcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiBfdChcIkFib3J0XCIpLFxuICAgICAgICAgICAgICAgICAgICBvbkZpbmlzaGVkOiByZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNsb3NlRGlhbG9nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBzZW5kTWVzc2FnZSA9IChtZXNzYWdlOiBJUG9zdG1lc3NhZ2VSZXNwb25zZURhdGEpID0+IHtcbiAgICAgICAgdGhpcy5pZnJhbWVSZWYuY3VycmVudC5jb250ZW50V2luZG93LnBvc3RNZXNzYWdlKG1lc3NhZ2UsIHRoaXMuY29uZmlnLmdldChcInVybFwiKSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgYXN5bmMgc2VuZEFjY291bnREZXRhaWxzKCkge1xuICAgICAgICBjb25zdCBvcGVuSWRUb2tlbiA9IGF3YWl0IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRPcGVuSWRUb2tlbigpO1xuICAgICAgICBpZiAoIW9wZW5JZFRva2VuIHx8ICFvcGVuSWRUb2tlbi5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKFwiRmFpbGVkIHRvIGNvbm5lY3QgdG8gaG9tZXNlcnZlciBmb3IgT3BlbklEIHRva2VuLlwiKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlcnJvcjogX3QoXCJGYWlsZWQgdG8gY29ubmVjdCB0byB5b3VyIGhvbWVzZXJ2ZXIuIFBsZWFzZSBjbG9zZSB0aGlzIGRpYWxvZyBhbmQgdHJ5IGFnYWluLlwiKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2VuZE1lc3NhZ2Uoe1xuICAgICAgICAgICAgYWN0aW9uOiBQb3N0bWVzc2FnZUFjdGlvbi5Ib3N0U2lnbnVwQWNjb3VudERldGFpbHMsXG4gICAgICAgICAgICBhY2NvdW50OiB7XG4gICAgICAgICAgICAgICAgYWNjZXNzVG9rZW46IGF3YWl0IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRBY2Nlc3NUb2tlbigpLFxuICAgICAgICAgICAgICAgIG5hbWU6IE93blByb2ZpbGVTdG9yZS5pbnN0YW5jZS5kaXNwbGF5TmFtZSxcbiAgICAgICAgICAgICAgICBvcGVuSWRUb2tlbjogb3BlbklkVG9rZW4uYWNjZXNzX3Rva2VuLFxuICAgICAgICAgICAgICAgIHNlcnZlck5hbWU6IGF3YWl0IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXREb21haW4oKSxcbiAgICAgICAgICAgICAgICB1c2VyTG9jYWxwYXJ0OiBhd2FpdCBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0VXNlcklkTG9jYWxwYXJ0KCksXG4gICAgICAgICAgICAgICAgdGVybXNBY2NlcHRlZDogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25BY2NvdW50RGV0YWlsc0RpYWxvZ0ZpbmlzaGVkID0gYXN5bmMgKHJlc3VsdCkgPT4ge1xuICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZW5kQWNjb3VudERldGFpbHMoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5jbG9zZURpYWxvZygpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQWNjb3VudERldGFpbHNSZXF1ZXN0ID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBjb29raWVQb2xpY3lVcmwgPSB0aGlzLmNvbmZpZy5nZXQoXCJjb29raWVfcG9saWN5X3VybFwiKTtcbiAgICAgICAgY29uc3QgcHJpdmFjeVBvbGljeVVybCA9IHRoaXMuY29uZmlnLmdldChcInByaXZhY3lfcG9saWN5X3VybFwiKTtcbiAgICAgICAgY29uc3QgdG9zVXJsID0gdGhpcy5jb25maWcuZ2V0KFwidGVybXNfb2Zfc2VydmljZV91cmxcIik7XG5cbiAgICAgICAgY29uc3QgdGV4dENvbXBvbmVudCA9IChcbiAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgICAgPHA+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJDb250aW51aW5nIHRlbXBvcmFyaWx5IGFsbG93cyB0aGUgJShob3N0U2lnbnVwQnJhbmQpcyBzZXR1cCBwcm9jZXNzIHRvIGFjY2VzcyB5b3VyIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYWNjb3VudCB0byBmZXRjaCB2ZXJpZmllZCBlbWFpbCBhZGRyZXNzZXMuIFRoaXMgZGF0YSBpcyBub3Qgc3RvcmVkLlwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBob3N0U2lnbnVwQnJhbmQ6IHRoaXMuY29uZmlnLmdldChcImJyYW5kXCIpLFxuICAgICAgICAgICAgICAgICAgICB9KSB9XG4gICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgICAgIDxwPlxuICAgICAgICAgICAgICAgICAgICB7IF90KFwiTGVhcm4gbW9yZSBpbiBvdXIgPHByaXZhY3lQb2xpY3lMaW5rIC8+LCA8dGVybXNPZlNlcnZpY2VMaW5rIC8+IGFuZCA8Y29va2llUG9saWN5TGluayAvPi5cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZVBvbGljeUxpbms6ICgpID0+IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj17Y29va2llUG9saWN5VXJsfSB0YXJnZXQ9XCJfYmxhbmtcIiByZWw9XCJub3JlZmVycmVyIG5vb3BlbmVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiQ29va2llIFBvbGljeVwiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaXZhY3lQb2xpY3lMaW5rOiAoKSA9PiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9e3ByaXZhY3lQb2xpY3lVcmx9IHRhcmdldD1cIl9ibGFua1wiIHJlbD1cIm5vcmVmZXJyZXIgbm9vcGVuZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJQcml2YWN5IFBvbGljeVwiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlcm1zT2ZTZXJ2aWNlTGluazogKCkgPT4gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPXt0b3NVcmx9IHRhcmdldD1cIl9ibGFua1wiIHJlbD1cIm5vcmVmZXJyZXIgbm9vcGVuZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJUZXJtcyBvZiBTZXJ2aWNlXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICApIH1cbiAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICA8Lz5cbiAgICAgICAgKTtcbiAgICAgICAgTW9kYWwuY3JlYXRlRGlhbG9nKFxuICAgICAgICAgICAgUXVlc3Rpb25EaWFsb2csXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IF90KFwiWW91IHNob3VsZCBrbm93XCIpLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0ZXh0Q29tcG9uZW50LFxuICAgICAgICAgICAgICAgIGJ1dHRvbjogX3QoXCJDb250aW51ZVwiKSxcbiAgICAgICAgICAgICAgICBvbkZpbmlzaGVkOiB0aGlzLm9uQWNjb3VudERldGFpbHNEaWFsb2dGaW5pc2hlZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIHRoaXMubWVzc2FnZUhhbmRsZXIpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgaWYgKEhvc3RTaWdudXBTdG9yZS5pbnN0YW5jZS5pc0hvc3RTaWdudXBBY3RpdmUpIHtcbiAgICAgICAgICAgIC8vIFJ1biB0aGUgY2xvc2UgZGlhbG9nIGFjdGlvbnMgaWYgd2UncmUgc3RpbGwgYWN0aXZlLCBvdGhlcndpc2UgZ29vZCB0byBnb1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2VEaWFsb2coKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKTogUmVhY3QuUmVhY3ROb2RlIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtjbGFzc05hbWVzKHsgXCJteF9EaWFsb2dfd3JhcHBlclwiOiAhdGhpcy5zdGF0ZS5taW5pbWl6ZWQgfSl9PlxuICAgICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwibXhfRGlhbG9nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJteF9Ib3N0U2lnbnVwRGlhbG9nX21pbmltaXplZFwiOiB0aGlzLnN0YXRlLm1pbmltaXplZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm14X0hvc3RTaWdudXBEaWFsb2dcIjogIXRoaXMuc3RhdGUubWluaW1pemVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIHsgdGhpcy5zdGF0ZS5taW5pbWl6ZWQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfRGlhbG9nX2hlYWRlciBteF9EaWFsb2dfaGVhZGVyV2l0aEJ1dHRvblwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfRGlhbG9nX3RpdGxlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCIlKGhvc3RTaWdudXBCcmFuZClzIFNldHVwXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvc3RTaWdudXBCcmFuZDogdGhpcy5jb25maWcuZ2V0KFwiYnJhbmRcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9Ib3N0U2lnbnVwX21heGltaXplX2J1dHRvblwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMubWF4aW1pemVEaWFsb2d9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e190KFwiTWF4aW1pc2UgZGlhbG9nXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT17X3QoXCJNYXhpbWlzZSBkaWFsb2dcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHsgIXRoaXMuc3RhdGUubWluaW1pemVkICYmXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0RpYWxvZ19oZWFkZXIgbXhfRGlhbG9nX2hlYWRlcldpdGhDYW5jZWxcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLm1pbmltaXplRGlhbG9nfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9Ib3N0U2lnbnVwX21pbmltaXplX2J1dHRvblwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e190KFwiTWluaW1pc2UgZGlhbG9nXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT17X3QoXCJNaW5pbWlzZSBkaWFsb2dcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLm9uQ2xvc2VDbGlja31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfRGlhbG9nX2NhbmNlbEJ1dHRvblwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e190KFwiQ2xvc2UgZGlhbG9nXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT17X3QoXCJDbG9zZSBkaWFsb2dcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHsgdGhpcy5zdGF0ZS5lcnJvciAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHRoaXMuc3RhdGUuZXJyb3IgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgeyAhdGhpcy5zdGF0ZS5lcnJvciAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgPGlmcmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPXtfdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJVcGdyYWRlIHRvICUoaG9zdFNpZ251cEJyYW5kKXNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9zdFNpZ251cEJyYW5kOiB0aGlzLmNvbmZpZy5nZXQoXCJicmFuZFwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyYz17dGhpcy5jb25maWcuZ2V0KFwidXJsXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZj17dGhpcy5pZnJhbWVSZWZ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FuZGJveD1cImFsbG93LWZvcm1zIGFsbG93LXNjcmlwdHMgYWxsb3ctc2FtZS1vcmlnaW4gYWxsb3ctcG9wdXBzXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBNUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQThCZSxNQUFNQSxnQkFBTixTQUErQkMsY0FBQSxDQUFNQyxhQUFyQyxDQUFtRTtFQUk5RUMsV0FBVyxDQUFDQyxLQUFELEVBQWdCO0lBQ3ZCLE1BQU1BLEtBQU47SUFEdUIsOERBSDZCSCxjQUFBLENBQU1JLFNBQU4sRUFHN0I7SUFBQTtJQUFBLHNEQVlGLE1BQU9DLE9BQVAsSUFBaUM7TUFDdEQsSUFBSSxDQUFDLEtBQUtDLE1BQUwsQ0FBWUMsR0FBWixDQUFnQixLQUFoQixFQUF1QkMsVUFBdkIsQ0FBa0NILE9BQU8sQ0FBQ0ksTUFBMUMsQ0FBTCxFQUF3RDtRQUNwRDtNQUNIOztNQUNELFFBQVFKLE9BQU8sQ0FBQ0ssSUFBUixDQUFhQyxNQUFyQjtRQUNJLEtBQUtDLHdDQUFBLENBQWtCQywrQkFBdkI7VUFDSSxLQUFLQyx1QkFBTDtVQUNBOztRQUNKLEtBQUtGLHdDQUFBLENBQWtCRyxRQUF2QjtVQUNJLEtBQUtDLFFB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
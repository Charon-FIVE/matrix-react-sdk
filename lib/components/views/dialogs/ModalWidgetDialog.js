"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var React = _interopRequireWildcard(require("react"));

var _matrixWidgetApi = require("matrix-widget-api");

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _languageHandler = require("../../../languageHandler");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _StopGapWidgetDriver = require("../../../stores/widgets/StopGapWidgetDriver");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _OwnProfileStore = require("../../../stores/OwnProfileStore");

var _arrays = require("../../../utils/arrays");

var _StopGapWidget = require("../../../stores/widgets/StopGapWidget");

var _identifiers = require("../../../identifiers");

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

const MAX_BUTTONS = 3;

class ModalWidgetDialog extends React.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "widget", void 0);
    (0, _defineProperty2.default)(this, "possibleButtons", void 0);
    (0, _defineProperty2.default)(this, "appFrame", /*#__PURE__*/React.createRef());
    (0, _defineProperty2.default)(this, "state", {
      disabledButtonIds: (this.props.widgetDefinition.buttons || []).filter(b => b.disabled).map(b => b.id)
    });
    (0, _defineProperty2.default)(this, "onReady", () => {
      this.state.messaging.sendWidgetConfig(this.props.widgetDefinition);
    });
    (0, _defineProperty2.default)(this, "onLoad", () => {
      this.state.messaging.once("ready", this.onReady);
      this.state.messaging.on(`action:${_matrixWidgetApi.WidgetApiFromWidgetAction.CloseModalWidget}`, this.onWidgetClose);
      this.state.messaging.on(`action:${_matrixWidgetApi.WidgetApiFromWidgetAction.SetModalButtonEnabled}`, this.onButtonEnableToggle);
    });
    (0, _defineProperty2.default)(this, "onWidgetClose", ev => {
      this.props.onFinished(true, ev.detail.data);
    });
    (0, _defineProperty2.default)(this, "onButtonEnableToggle", ev => {
      ev.preventDefault();
      const isClose = ev.detail.data.button === _matrixWidgetApi.BuiltInModalButtonID.Close;

      if (isClose || !this.possibleButtons.includes(ev.detail.data.button)) {
        return this.state.messaging.transport.reply(ev.detail, {
          error: {
            message: "Invalid button"
          }
        });
      }

      let buttonIds;

      if (ev.detail.data.enabled) {
        buttonIds = (0, _arrays.arrayFastClone)(this.state.disabledButtonIds).filter(i => i !== ev.detail.data.button);
      } else {
        // use a set to swap the operation to avoid memory leaky arrays.
        const tempSet = new Set(this.state.disabledButtonIds);
        tempSet.add(ev.detail.data.button);
        buttonIds = Array.from(tempSet);
      }

      this.setState({
        disabledButtonIds: buttonIds
      });
      this.state.messaging.transport.reply(ev.detail, {});
    });
    this.widget = new _StopGapWidget.ElementWidget(_objectSpread(_objectSpread({}, this.props.widgetDefinition), {}, {
      creatorUserId: _MatrixClientPeg.MatrixClientPeg.get().getUserId(),
      id: `modal_${this.props.sourceWidgetId}`
    }));
    this.possibleButtons = (this.props.widgetDefinition.buttons || []).map(b => b.id);
  }

  componentDidMount() {
    const driver = new _StopGapWidgetDriver.StopGapWidgetDriver([], this.widget, _matrixWidgetApi.WidgetKind.Modal);
    const messaging = new _matrixWidgetApi.ClientWidgetApi(this.widget, this.appFrame.current, driver);
    this.setState({
      messaging
    });
  }

  componentWillUnmount() {
    this.state.messaging.off("ready", this.onReady);
    this.state.messaging.off(`action:${_matrixWidgetApi.WidgetApiFromWidgetAction.CloseModalWidget}`, this.onWidgetClose);
    this.state.messaging.stop();
  }

  render() {
    const templated = this.widget.getCompleteUrl({
      widgetRoomId: this.props.widgetRoomId,
      currentUserId: _MatrixClientPeg.MatrixClientPeg.get().getUserId(),
      userDisplayName: _OwnProfileStore.OwnProfileStore.instance.displayName,
      userHttpAvatarUrl: _OwnProfileStore.OwnProfileStore.instance.getHttpAvatarUrl(),
      clientId: _identifiers.ELEMENT_CLIENT_ID,
      clientTheme: _SettingsStore.default.getValue("theme"),
      clientLanguage: (0, _languageHandler.getUserLanguage)()
    });
    const parsed = new URL(templated); // Add in some legacy support sprinkles (for non-popout widgets)
    // TODO: Replace these with proper widget params
    // See https://github.com/matrix-org/matrix-doc/pull/1958/files#r405714833

    parsed.searchParams.set('widgetId', this.widget.id);
    parsed.searchParams.set('parentUrl', window.location.href.split('#', 2)[0]); // Replace the encoded dollar signs back to dollar signs. They have no special meaning
    // in HTTP, but URL parsers encode them anyways.

    const widgetUrl = parsed.toString().replace(/%24/g, '$');
    let buttons;

    if (this.props.widgetDefinition.buttons) {
      // show first button rightmost for a more natural specification
      buttons = this.props.widgetDefinition.buttons.slice(0, MAX_BUTTONS).reverse().map(def => {
        let kind = "secondary";

        switch (def.kind) {
          case _matrixWidgetApi.ModalButtonKind.Primary:
            kind = "primary";
            break;

          case _matrixWidgetApi.ModalButtonKind.Secondary:
            kind = "primary_outline";
            break;

          case _matrixWidgetApi.ModalButtonKind.Danger:
            kind = "danger";
            break;
        }

        const onClick = () => {
          this.state.messaging.notifyModalWidgetButtonClicked(def.id);
        };

        const isDisabled = this.state.disabledButtonIds.includes(def.id);
        return /*#__PURE__*/React.createElement(_AccessibleButton.default, {
          key: def.id,
          kind: kind,
          onClick: onClick,
          disabled: isDisabled
        }, def.label);
      });
    }

    return /*#__PURE__*/React.createElement(_BaseDialog.default, {
      title: this.props.widgetDefinition.name || (0, _languageHandler._t)("Modal Widget"),
      className: "mx_ModalWidgetDialog",
      contentId: "mx_Dialog_content",
      onFinished: this.props.onFinished
    }, /*#__PURE__*/React.createElement("div", {
      className: "mx_ModalWidgetDialog_warning"
    }, /*#__PURE__*/React.createElement("img", {
      src: require("../../../../res/img/element-icons/warning-badge.svg").default,
      height: "16",
      width: "16",
      alt: ""
    }), (0, _languageHandler._t)("Data on this screen is shared with %(widgetDomain)s", {
      widgetDomain: parsed.hostname
    })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("iframe", {
      title: this.widget.name,
      ref: this.appFrame,
      sandbox: "allow-forms allow-scripts allow-same-origin",
      src: widgetUrl,
      onLoad: this.onLoad
    })), /*#__PURE__*/React.createElement("div", {
      className: "mx_ModalWidgetDialog_buttons"
    }, buttons));
  }

}

exports.default = ModalWidgetDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNQVhfQlVUVE9OUyIsIk1vZGFsV2lkZ2V0RGlhbG9nIiwiUmVhY3QiLCJQdXJlQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImNyZWF0ZVJlZiIsImRpc2FibGVkQnV0dG9uSWRzIiwid2lkZ2V0RGVmaW5pdGlvbiIsImJ1dHRvbnMiLCJmaWx0ZXIiLCJiIiwiZGlzYWJsZWQiLCJtYXAiLCJpZCIsInN0YXRlIiwibWVzc2FnaW5nIiwic2VuZFdpZGdldENvbmZpZyIsIm9uY2UiLCJvblJlYWR5Iiwib24iLCJXaWRnZXRBcGlGcm9tV2lkZ2V0QWN0aW9uIiwiQ2xvc2VNb2RhbFdpZGdldCIsIm9uV2lkZ2V0Q2xvc2UiLCJTZXRNb2RhbEJ1dHRvbkVuYWJsZWQiLCJvbkJ1dHRvbkVuYWJsZVRvZ2dsZSIsImV2Iiwib25GaW5pc2hlZCIsImRldGFpbCIsImRhdGEiLCJwcmV2ZW50RGVmYXVsdCIsImlzQ2xvc2UiLCJidXR0b24iLCJCdWlsdEluTW9kYWxCdXR0b25JRCIsIkNsb3NlIiwicG9zc2libGVCdXR0b25zIiwiaW5jbHVkZXMiLCJ0cmFuc3BvcnQiLCJyZXBseSIsImVycm9yIiwibWVzc2FnZSIsImJ1dHRvbklkcyIsImVuYWJsZWQiLCJhcnJheUZhc3RDbG9uZSIsImkiLCJ0ZW1wU2V0IiwiU2V0IiwiYWRkIiwiQXJyYXkiLCJmcm9tIiwic2V0U3RhdGUiLCJ3aWRnZXQiLCJFbGVtZW50V2lkZ2V0IiwiY3JlYXRvclVzZXJJZCIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsImdldFVzZXJJZCIsInNvdXJjZVdpZGdldElkIiwiY29tcG9uZW50RGlkTW91bnQiLCJkcml2ZXIiLCJTdG9wR2FwV2lkZ2V0RHJpdmVyIiwiV2lkZ2V0S2luZCIsIk1vZGFsIiwiQ2xpZW50V2lkZ2V0QXBpIiwiYXBwRnJhbWUiLCJjdXJyZW50IiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJvZmYiLCJzdG9wIiwicmVuZGVyIiwidGVtcGxhdGVkIiwiZ2V0Q29tcGxldGVVcmwiLCJ3aWRnZXRSb29tSWQiLCJjdXJyZW50VXNlcklkIiwidXNlckRpc3BsYXlOYW1lIiwiT3duUHJvZmlsZVN0b3JlIiwiaW5zdGFuY2UiLCJkaXNwbGF5TmFtZSIsInVzZXJIdHRwQXZhdGFyVXJsIiwiZ2V0SHR0cEF2YXRhclVybCIsImNsaWVudElkIiwiRUxFTUVOVF9DTElFTlRfSUQiLCJjbGllbnRUaGVtZSIsIlNldHRpbmdzU3RvcmUiLCJnZXRWYWx1ZSIsImNsaWVudExhbmd1YWdlIiwiZ2V0VXNlckxhbmd1YWdlIiwicGFyc2VkIiwiVVJMIiwic2VhcmNoUGFyYW1zIiwic2V0Iiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwic3BsaXQiLCJ3aWRnZXRVcmwiLCJ0b1N0cmluZyIsInJlcGxhY2UiLCJzbGljZSIsInJldmVyc2UiLCJkZWYiLCJraW5kIiwiTW9kYWxCdXR0b25LaW5kIiwiUHJpbWFyeSIsIlNlY29uZGFyeSIsIkRhbmdlciIsIm9uQ2xpY2siLCJub3RpZnlNb2RhbFdpZGdldEJ1dHRvbkNsaWNrZWQiLCJpc0Rpc2FibGVkIiwibGFiZWwiLCJuYW1lIiwiX3QiLCJyZXF1aXJlIiwiZGVmYXVsdCIsIndpZGdldERvbWFpbiIsImhvc3RuYW1lIiwib25Mb2FkIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvdmlld3MvZGlhbG9ncy9Nb2RhbFdpZGdldERpYWxvZy50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIwLCAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgICBDbGllbnRXaWRnZXRBcGksXG4gICAgSU1vZGFsV2lkZ2V0Q2xvc2VSZXF1ZXN0LFxuICAgIElNb2RhbFdpZGdldE9wZW5SZXF1ZXN0RGF0YSxcbiAgICBJTW9kYWxXaWRnZXRSZXR1cm5EYXRhLFxuICAgIElTZXRNb2RhbEJ1dHRvbkVuYWJsZWRBY3Rpb25SZXF1ZXN0LFxuICAgIElXaWRnZXRBcGlBY2tub3dsZWRnZVJlc3BvbnNlRGF0YSxcbiAgICBJV2lkZ2V0QXBpRXJyb3JSZXNwb25zZURhdGEsXG4gICAgQnVpbHRJbk1vZGFsQnV0dG9uSUQsXG4gICAgTW9kYWxCdXR0b25JRCxcbiAgICBNb2RhbEJ1dHRvbktpbmQsXG4gICAgV2lkZ2V0LFxuICAgIFdpZGdldEFwaUZyb21XaWRnZXRBY3Rpb24sXG4gICAgV2lkZ2V0S2luZCxcbn0gZnJvbSBcIm1hdHJpeC13aWRnZXQtYXBpXCI7XG5cbmltcG9ydCBCYXNlRGlhbG9nIGZyb20gJy4vQmFzZURpYWxvZyc7XG5pbXBvcnQgeyBfdCwgZ2V0VXNlckxhbmd1YWdlIH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gXCIuLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uXCI7XG5pbXBvcnQgeyBTdG9wR2FwV2lkZ2V0RHJpdmVyIH0gZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy93aWRnZXRzL1N0b3BHYXBXaWRnZXREcml2ZXJcIjtcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gXCIuLi8uLi8uLi9NYXRyaXhDbGllbnRQZWdcIjtcbmltcG9ydCB7IE93blByb2ZpbGVTdG9yZSB9IGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvT3duUHJvZmlsZVN0b3JlXCI7XG5pbXBvcnQgeyBhcnJheUZhc3RDbG9uZSB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9hcnJheXNcIjtcbmltcG9ydCB7IEVsZW1lbnRXaWRnZXQgfSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL3dpZGdldHMvU3RvcEdhcFdpZGdldFwiO1xuaW1wb3J0IHsgRUxFTUVOVF9DTElFTlRfSUQgfSBmcm9tIFwiLi4vLi4vLi4vaWRlbnRpZmllcnNcIjtcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gXCIuLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIHdpZGdldERlZmluaXRpb246IElNb2RhbFdpZGdldE9wZW5SZXF1ZXN0RGF0YTtcbiAgICB3aWRnZXRSb29tSWQ/OiBzdHJpbmc7XG4gICAgc291cmNlV2lkZ2V0SWQ6IHN0cmluZztcbiAgICBvbkZpbmlzaGVkKHN1Y2Nlc3M6IGJvb2xlYW4sIGRhdGE/OiBJTW9kYWxXaWRnZXRSZXR1cm5EYXRhKTogdm9pZDtcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgbWVzc2FnaW5nPzogQ2xpZW50V2lkZ2V0QXBpO1xuICAgIGRpc2FibGVkQnV0dG9uSWRzOiBNb2RhbEJ1dHRvbklEW107XG59XG5cbmNvbnN0IE1BWF9CVVRUT05TID0gMztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWxXaWRnZXREaWFsb2cgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSByZWFkb25seSB3aWRnZXQ6IFdpZGdldDtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHBvc3NpYmxlQnV0dG9uczogTW9kYWxCdXR0b25JRFtdO1xuICAgIHByaXZhdGUgYXBwRnJhbWU6IFJlYWN0LlJlZk9iamVjdDxIVE1MSUZyYW1lRWxlbWVudD4gPSBSZWFjdC5jcmVhdGVSZWYoKTtcblxuICAgIHN0YXRlOiBJU3RhdGUgPSB7XG4gICAgICAgIGRpc2FibGVkQnV0dG9uSWRzOiAodGhpcy5wcm9wcy53aWRnZXREZWZpbml0aW9uLmJ1dHRvbnMgfHwgW10pLmZpbHRlcihiID0+IGIuZGlzYWJsZWQpXG4gICAgICAgICAgICAubWFwKGIgPT4gYi5pZCksXG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLndpZGdldCA9IG5ldyBFbGVtZW50V2lkZ2V0KHtcbiAgICAgICAgICAgIC4uLnRoaXMucHJvcHMud2lkZ2V0RGVmaW5pdGlvbixcbiAgICAgICAgICAgIGNyZWF0b3JVc2VySWQ6IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRVc2VySWQoKSxcbiAgICAgICAgICAgIGlkOiBgbW9kYWxfJHt0aGlzLnByb3BzLnNvdXJjZVdpZGdldElkfWAsXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBvc3NpYmxlQnV0dG9ucyA9ICh0aGlzLnByb3BzLndpZGdldERlZmluaXRpb24uYnV0dG9ucyB8fCBbXSkubWFwKGIgPT4gYi5pZCk7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCBkcml2ZXIgPSBuZXcgU3RvcEdhcFdpZGdldERyaXZlcihbXSwgdGhpcy53aWRnZXQsIFdpZGdldEtpbmQuTW9kYWwpO1xuICAgICAgICBjb25zdCBtZXNzYWdpbmcgPSBuZXcgQ2xpZW50V2lkZ2V0QXBpKHRoaXMud2lkZ2V0LCB0aGlzLmFwcEZyYW1lLmN1cnJlbnQsIGRyaXZlcik7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBtZXNzYWdpbmcgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICB0aGlzLnN0YXRlLm1lc3NhZ2luZy5vZmYoXCJyZWFkeVwiLCB0aGlzLm9uUmVhZHkpO1xuICAgICAgICB0aGlzLnN0YXRlLm1lc3NhZ2luZy5vZmYoYGFjdGlvbjoke1dpZGdldEFwaUZyb21XaWRnZXRBY3Rpb24uQ2xvc2VNb2RhbFdpZGdldH1gLCB0aGlzLm9uV2lkZ2V0Q2xvc2UpO1xuICAgICAgICB0aGlzLnN0YXRlLm1lc3NhZ2luZy5zdG9wKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblJlYWR5ID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnN0YXRlLm1lc3NhZ2luZy5zZW5kV2lkZ2V0Q29uZmlnKHRoaXMucHJvcHMud2lkZ2V0RGVmaW5pdGlvbik7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Mb2FkID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnN0YXRlLm1lc3NhZ2luZy5vbmNlKFwicmVhZHlcIiwgdGhpcy5vblJlYWR5KTtcbiAgICAgICAgdGhpcy5zdGF0ZS5tZXNzYWdpbmcub24oYGFjdGlvbjoke1dpZGdldEFwaUZyb21XaWRnZXRBY3Rpb24uQ2xvc2VNb2RhbFdpZGdldH1gLCB0aGlzLm9uV2lkZ2V0Q2xvc2UpO1xuICAgICAgICB0aGlzLnN0YXRlLm1lc3NhZ2luZy5vbihgYWN0aW9uOiR7V2lkZ2V0QXBpRnJvbVdpZGdldEFjdGlvbi5TZXRNb2RhbEJ1dHRvbkVuYWJsZWR9YCwgdGhpcy5vbkJ1dHRvbkVuYWJsZVRvZ2dsZSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25XaWRnZXRDbG9zZSA9IChldjogQ3VzdG9tRXZlbnQ8SU1vZGFsV2lkZ2V0Q2xvc2VSZXF1ZXN0PikgPT4ge1xuICAgICAgICB0aGlzLnByb3BzLm9uRmluaXNoZWQodHJ1ZSwgZXYuZGV0YWlsLmRhdGEpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQnV0dG9uRW5hYmxlVG9nZ2xlID0gKGV2OiBDdXN0b21FdmVudDxJU2V0TW9kYWxCdXR0b25FbmFibGVkQWN0aW9uUmVxdWVzdD4pID0+IHtcbiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgaXNDbG9zZSA9IGV2LmRldGFpbC5kYXRhLmJ1dHRvbiA9PT0gQnVpbHRJbk1vZGFsQnV0dG9uSUQuQ2xvc2U7XG4gICAgICAgIGlmIChpc0Nsb3NlIHx8ICF0aGlzLnBvc3NpYmxlQnV0dG9ucy5pbmNsdWRlcyhldi5kZXRhaWwuZGF0YS5idXR0b24pKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5tZXNzYWdpbmcudHJhbnNwb3J0LnJlcGx5KGV2LmRldGFpbCwge1xuICAgICAgICAgICAgICAgIGVycm9yOiB7IG1lc3NhZ2U6IFwiSW52YWxpZCBidXR0b25cIiB9LFxuICAgICAgICAgICAgfSBhcyBJV2lkZ2V0QXBpRXJyb3JSZXNwb25zZURhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGJ1dHRvbklkczogTW9kYWxCdXR0b25JRFtdO1xuICAgICAgICBpZiAoZXYuZGV0YWlsLmRhdGEuZW5hYmxlZCkge1xuICAgICAgICAgICAgYnV0dG9uSWRzID0gYXJyYXlGYXN0Q2xvbmUodGhpcy5zdGF0ZS5kaXNhYmxlZEJ1dHRvbklkcykuZmlsdGVyKGkgPT4gaSAhPT0gZXYuZGV0YWlsLmRhdGEuYnV0dG9uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHVzZSBhIHNldCB0byBzd2FwIHRoZSBvcGVyYXRpb24gdG8gYXZvaWQgbWVtb3J5IGxlYWt5IGFycmF5cy5cbiAgICAgICAgICAgIGNvbnN0IHRlbXBTZXQgPSBuZXcgU2V0KHRoaXMuc3RhdGUuZGlzYWJsZWRCdXR0b25JZHMpO1xuICAgICAgICAgICAgdGVtcFNldC5hZGQoZXYuZGV0YWlsLmRhdGEuYnV0dG9uKTtcbiAgICAgICAgICAgIGJ1dHRvbklkcyA9IEFycmF5LmZyb20odGVtcFNldCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGRpc2FibGVkQnV0dG9uSWRzOiBidXR0b25JZHMgfSk7XG4gICAgICAgIHRoaXMuc3RhdGUubWVzc2FnaW5nLnRyYW5zcG9ydC5yZXBseShldi5kZXRhaWwsIHt9IGFzIElXaWRnZXRBcGlBY2tub3dsZWRnZVJlc3BvbnNlRGF0YSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHRlbXBsYXRlZCA9IHRoaXMud2lkZ2V0LmdldENvbXBsZXRlVXJsKHtcbiAgICAgICAgICAgIHdpZGdldFJvb21JZDogdGhpcy5wcm9wcy53aWRnZXRSb29tSWQsXG4gICAgICAgICAgICBjdXJyZW50VXNlcklkOiBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0VXNlcklkKCksXG4gICAgICAgICAgICB1c2VyRGlzcGxheU5hbWU6IE93blByb2ZpbGVTdG9yZS5pbnN0YW5jZS5kaXNwbGF5TmFtZSxcbiAgICAgICAgICAgIHVzZXJIdHRwQXZhdGFyVXJsOiBPd25Qcm9maWxlU3RvcmUuaW5zdGFuY2UuZ2V0SHR0cEF2YXRhclVybCgpLFxuICAgICAgICAgICAgY2xpZW50SWQ6IEVMRU1FTlRfQ0xJRU5UX0lELFxuICAgICAgICAgICAgY2xpZW50VGhlbWU6IFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJ0aGVtZVwiKSxcbiAgICAgICAgICAgIGNsaWVudExhbmd1YWdlOiBnZXRVc2VyTGFuZ3VhZ2UoKSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcGFyc2VkID0gbmV3IFVSTCh0ZW1wbGF0ZWQpO1xuXG4gICAgICAgIC8vIEFkZCBpbiBzb21lIGxlZ2FjeSBzdXBwb3J0IHNwcmlua2xlcyAoZm9yIG5vbi1wb3BvdXQgd2lkZ2V0cylcbiAgICAgICAgLy8gVE9ETzogUmVwbGFjZSB0aGVzZSB3aXRoIHByb3BlciB3aWRnZXQgcGFyYW1zXG4gICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vbWF0cml4LW9yZy9tYXRyaXgtZG9jL3B1bGwvMTk1OC9maWxlcyNyNDA1NzE0ODMzXG4gICAgICAgIHBhcnNlZC5zZWFyY2hQYXJhbXMuc2V0KCd3aWRnZXRJZCcsIHRoaXMud2lkZ2V0LmlkKTtcbiAgICAgICAgcGFyc2VkLnNlYXJjaFBhcmFtcy5zZXQoJ3BhcmVudFVybCcsIHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCcjJywgMilbMF0pO1xuXG4gICAgICAgIC8vIFJlcGxhY2UgdGhlIGVuY29kZWQgZG9sbGFyIHNpZ25zIGJhY2sgdG8gZG9sbGFyIHNpZ25zLiBUaGV5IGhhdmUgbm8gc3BlY2lhbCBtZWFuaW5nXG4gICAgICAgIC8vIGluIEhUVFAsIGJ1dCBVUkwgcGFyc2VycyBlbmNvZGUgdGhlbSBhbnl3YXlzLlxuICAgICAgICBjb25zdCB3aWRnZXRVcmwgPSBwYXJzZWQudG9TdHJpbmcoKS5yZXBsYWNlKC8lMjQvZywgJyQnKTtcblxuICAgICAgICBsZXQgYnV0dG9ucztcbiAgICAgICAgaWYgKHRoaXMucHJvcHMud2lkZ2V0RGVmaW5pdGlvbi5idXR0b25zKSB7XG4gICAgICAgICAgICAvLyBzaG93IGZpcnN0IGJ1dHRvbiByaWdodG1vc3QgZm9yIGEgbW9yZSBuYXR1cmFsIHNwZWNpZmljYXRpb25cbiAgICAgICAgICAgIGJ1dHRvbnMgPSB0aGlzLnByb3BzLndpZGdldERlZmluaXRpb24uYnV0dG9ucy5zbGljZSgwLCBNQVhfQlVUVE9OUykucmV2ZXJzZSgpLm1hcChkZWYgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBraW5kID0gXCJzZWNvbmRhcnlcIjtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGRlZi5raW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kYWxCdXR0b25LaW5kLlByaW1hcnk6XG4gICAgICAgICAgICAgICAgICAgICAgICBraW5kID0gXCJwcmltYXJ5XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RhbEJ1dHRvbktpbmQuU2Vjb25kYXJ5OlxuICAgICAgICAgICAgICAgICAgICAgICAga2luZCA9IFwicHJpbWFyeV9vdXRsaW5lXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RhbEJ1dHRvbktpbmQuRGFuZ2VyOlxuICAgICAgICAgICAgICAgICAgICAgICAga2luZCA9IFwiZGFuZ2VyXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBvbkNsaWNrID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLm1lc3NhZ2luZy5ub3RpZnlNb2RhbFdpZGdldEJ1dHRvbkNsaWNrZWQoZGVmLmlkKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgY29uc3QgaXNEaXNhYmxlZCA9IHRoaXMuc3RhdGUuZGlzYWJsZWRCdXR0b25JZHMuaW5jbHVkZXMoZGVmLmlkKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiA8QWNjZXNzaWJsZUJ1dHRvbiBrZXk9e2RlZi5pZH0ga2luZD17a2luZH0gb25DbGljaz17b25DbGlja30gZGlzYWJsZWQ9e2lzRGlzYWJsZWR9PlxuICAgICAgICAgICAgICAgICAgICB7IGRlZi5sYWJlbCB9XG4gICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIDxCYXNlRGlhbG9nXG4gICAgICAgICAgICB0aXRsZT17dGhpcy5wcm9wcy53aWRnZXREZWZpbml0aW9uLm5hbWUgfHwgX3QoXCJNb2RhbCBXaWRnZXRcIil9XG4gICAgICAgICAgICBjbGFzc05hbWU9XCJteF9Nb2RhbFdpZGdldERpYWxvZ1wiXG4gICAgICAgICAgICBjb250ZW50SWQ9XCJteF9EaWFsb2dfY29udGVudFwiXG4gICAgICAgICAgICBvbkZpbmlzaGVkPXt0aGlzLnByb3BzLm9uRmluaXNoZWR9XG4gICAgICAgID5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfTW9kYWxXaWRnZXREaWFsb2dfd2FybmluZ1wiPlxuICAgICAgICAgICAgICAgIDxpbWdcbiAgICAgICAgICAgICAgICAgICAgc3JjPXtyZXF1aXJlKFwiLi4vLi4vLi4vLi4vcmVzL2ltZy9lbGVtZW50LWljb25zL3dhcm5pbmctYmFkZ2Uuc3ZnXCIpLmRlZmF1bHR9XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodD1cIjE2XCJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg9XCIxNlwiXG4gICAgICAgICAgICAgICAgICAgIGFsdD1cIlwiXG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICB7IF90KFwiRGF0YSBvbiB0aGlzIHNjcmVlbiBpcyBzaGFyZWQgd2l0aCAlKHdpZGdldERvbWFpbilzXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0RG9tYWluOiBwYXJzZWQuaG9zdG5hbWUsXG4gICAgICAgICAgICAgICAgfSkgfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgIDxpZnJhbWVcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU9e3RoaXMud2lkZ2V0Lm5hbWV9XG4gICAgICAgICAgICAgICAgICAgIHJlZj17dGhpcy5hcHBGcmFtZX1cbiAgICAgICAgICAgICAgICAgICAgc2FuZGJveD1cImFsbG93LWZvcm1zIGFsbG93LXNjcmlwdHMgYWxsb3ctc2FtZS1vcmlnaW5cIlxuICAgICAgICAgICAgICAgICAgICBzcmM9e3dpZGdldFVybH1cbiAgICAgICAgICAgICAgICAgICAgb25Mb2FkPXt0aGlzLm9uTG9hZH1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01vZGFsV2lkZ2V0RGlhbG9nX2J1dHRvbnNcIj5cbiAgICAgICAgICAgICAgICB7IGJ1dHRvbnMgfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvQmFzZURpYWxvZz47XG4gICAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFnQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7QUFjQSxNQUFNQSxXQUFXLEdBQUcsQ0FBcEI7O0FBRWUsTUFBTUMsaUJBQU4sU0FBZ0NDLEtBQUssQ0FBQ0MsYUFBdEMsQ0FBb0U7RUFVL0VDLFdBQVcsQ0FBQ0MsS0FBRCxFQUFRO0lBQ2YsTUFBTUEsS0FBTjtJQURlO0lBQUE7SUFBQSw2REFQb0NILEtBQUssQ0FBQ0ksU0FBTixFQU9wQztJQUFBLDZDQUxIO01BQ1pDLGlCQUFpQixFQUFFLENBQUMsS0FBS0YsS0FBTCxDQUFXRyxnQkFBWCxDQUE0QkMsT0FBNUIsSUFBdUMsRUFBeEMsRUFBNENDLE1BQTVDLENBQW1EQyxDQUFDLElBQUlBLENBQUMsQ0FBQ0MsUUFBMUQsRUFDZEMsR0FEYyxDQUNWRixDQUFDLElBQUlBLENBQUMsQ0FBQ0csRUFERztJQURQLENBS0c7SUFBQSwrQ0F1QkQsTUFBTTtNQUNwQixLQUFLQyxLQUFMLENBQVdDLFNBQVgsQ0FBcUJDLGdCQUFyQixDQUFzQyxLQUFLWixLQUFMLENBQVdHLGdCQUFqRDtJQUNILENBekJrQjtJQUFBLDhDQTJCRixNQUFNO01BQ25CLEtBQUtPLEtBQUwsQ0FBV0MsU0FBWCxDQUFxQkUsSUFBckIsQ0FBMEIsT0FBMUIsRUFBbUMsS0FBS0MsT0FBeEM7TUFDQSxLQUFLSixLQUFMLENBQVdDLFNBQVgsQ0FBcUJJLEVBQXJCLENBQXlCLFVBQVNDLDBDQUFBLENBQTBCQyxnQkFBaUIsRUFBN0UsRUFBZ0YsS0FBS0MsYUFBckY7TUFDQSxLQUFLUixLQUFMLENBQVdDLFNBQVgsQ0FBcUJJLEVBQXJCLENBQXlCLFVBQVNDLDBDQUFBLENBQTBCRyxxQkFBc0IsRUFBbEYsRUFBcUYsS0FBS0Msb0JBQTFGO0lBQ0gsQ0EvQmtCO0lBQUEscURBaUNNQyxFQUFELElBQStDO01BQ25FLEtBQUtyQixLQUFMLENBQVdzQixVQUFYLENBQXNCLElBQXRCLEVBQTRCRCxFQUFFLENBQUNFLE1BQUgsQ0FBVUMsSUFBdEM7SUFDSCxDQW5Da0I7SUFBQSw0REFxQ2FILEVBQUQsSUFBMEQ7TUFDckZBLEVBQUUsQ0FBQ0ksY0FBSDtNQUNBLE1BQU1DLE9BQU8sR0FBR0wsRUFBRSxDQUFDRSxNQUFILENBQVVDLElBQVYsQ0FBZUcsTUFBZixLQUEwQkMscUNBQUEsQ0FBcUJDLEtBQS9EOztNQUNBLElBQUlILE9BQU8sSUFBSSxDQUFDLEtBQUtJLGVBQUwsQ0FBcUJDLFFBQXJCLENBQThCVixFQUFFLENBQUNFLE1BQUgsQ0FBVUMsSUFBVixDQUFlRyxNQUE3QyxDQUFoQixFQUFzRTtRQUNsRSxPQUFPLEtBQUtqQixLQUFMLENBQVdDLFNBQVgsQ0FBcUJxQixTQUFyQixDQUErQkMsS0FBL0IsQ0FBcUNaLEVBQUUsQ0FBQ0UsTUFBeEMsRUFBZ0Q7VUFDbkRXLEtBQUssRUFBRTtZQUFFQyxPQUFPLEVBQUU7VUFBWDtRQUQ0QyxDQUFoRCxDQUFQO01BR0g7O01BRUQsSUFBSUMsU0FBSjs7TUFDQSxJQUFJZixFQUFFLENBQUNFLE1BQUgsQ0FBVUMsSUFBVixDQUFlYSxPQUFuQixFQUE0QjtRQUN4QkQsU0FBUyxHQUFHLElBQUFFLHNCQUFBLEVBQWUsS0FBSzVCLEtBQUwsQ0FBV1IsaUJBQTFCLEVBQTZDRyxNQUE3QyxDQUFvRGtDLENBQUMsSUFBSUEsQ0FBQyxLQUFLbEIsRUFBRSxDQUFDRSxNQUFILENBQVVDLElBQVYsQ0FBZUcsTUFBOUUsQ0FBWjtNQUNILENBRkQsTUFFTztRQUNIO1FBQ0EsTUFBTWEsT0FBTyxHQUFHLElBQUlDLEdBQUosQ0FBUSxLQUFLL0IsS0FBTCxDQUFXUixpQkFBbkIsQ0FBaEI7UUFDQXNDLE9BQU8sQ0FBQ0UsR0FBUixDQUFZckIsRUFBRSxDQUFDRSxNQUFILENBQVVDLElBQVYsQ0FBZUcsTUFBM0I7UUFDQVMsU0FBUyxHQUFHTyxLQUFLLENBQUNDLElBQU4sQ0FBV0osT0FBWCxDQUFaO01BQ0g7O01BQ0QsS0FBS0ssUUFBTCxDQUFjO1FBQUUzQyxpQkFBaUIsRUFBRWtDO01BQXJCLENBQWQ7TUFDQSxLQUFLMUIsS0FBTCxDQUFXQyxTQUFYLENBQXFCcUIsU0FBckIsQ0FBK0JDLEtBQS9CLENBQXFDWixFQUFFLENBQUNFLE1BQXhDLEVBQWdELEVBQWhEO0lBQ0gsQ0F6RGtCO0lBR2YsS0FBS3VCLE1BQUwsR0FBYyxJQUFJQyw0QkFBSixpQ0FDUCxLQUFLL0MsS0FBTCxDQUFXRyxnQkFESjtNQUVWNkMsYUFBYSxFQUFFQyxnQ0FBQSxDQUFnQkMsR0FBaEIsR0FBc0JDLFNBQXRCLEVBRkw7TUFHVjFDLEVBQUUsRUFBRyxTQUFRLEtBQUtULEtBQUwsQ0FBV29ELGNBQWU7SUFIN0IsR0FBZDtJQUtBLEtBQUt0QixlQUFMLEdBQXVCLENBQUMsS0FBSzlCLEtBQUwsQ0FBV0csZ0JBQVgsQ0FBNEJDLE9BQTVCLElBQXVDLEVBQXhDLEVBQTRDSSxHQUE1QyxDQUFnREYsQ0FBQyxJQUFJQSxDQUFDLENBQUNHLEVBQXZELENBQXZCO0VBQ0g7O0VBRU00QyxpQkFBaUIsR0FBRztJQUN2QixNQUFNQyxNQUFNLEdBQUcsSUFBSUMsd0NBQUosQ0FBd0IsRUFBeEIsRUFBNEIsS0FBS1QsTUFBakMsRUFBeUNVLDJCQUFBLENBQVdDLEtBQXBELENBQWY7SUFDQSxNQUFNOUMsU0FBUyxHQUFHLElBQUkrQyxnQ0FBSixDQUFvQixLQUFLWixNQUF6QixFQUFpQyxLQUFLYSxRQUFMLENBQWNDLE9BQS9DLEVBQXdETixNQUF4RCxDQUFsQjtJQUNBLEtBQUtULFFBQUwsQ0FBYztNQUFFbEM7SUFBRixDQUFkO0VBQ0g7O0VBRU1rRCxvQkFBb0IsR0FBRztJQUMxQixLQUFLbkQsS0FBTCxDQUFXQyxTQUFYLENBQXFCbUQsR0FBckIsQ0FBeUIsT0FBekIsRUFBa0MsS0FBS2hELE9BQXZDO0lBQ0EsS0FBS0osS0FBTCxDQUFXQyxTQUFYLENBQXFCbUQsR0FBckIsQ0FBMEIsVUFBUzlDLDBDQUFBLENBQTBCQyxnQkFBaUIsRUFBOUUsRUFBaUYsS0FBS0MsYUFBdEY7SUFDQSxLQUFLUixLQUFMLENBQVdDLFNBQVgsQ0FBcUJvRCxJQUFyQjtFQUNIOztFQXNDTUMsTUFBTSxHQUFHO0lBQ1osTUFBTUMsU0FBUyxHQUFHLEtBQUtuQixNQUFMLENBQVlvQixjQUFaLENBQTJCO01BQ3pDQyxZQUFZLEVBQUUsS0FBS25FLEtBQUwsQ0FBV21FLFlBRGdCO01BRXpDQyxhQUFhLEVBQUVuQixnQ0FBQSxDQUFnQkMsR0FBaEIsR0FBc0JDLFNBQXRCLEVBRjBCO01BR3pDa0IsZUFBZSxFQUFFQyxnQ0FBQSxDQUFnQkMsUUFBaEIsQ0FBeUJDLFdBSEQ7TUFJekNDLGlCQUFpQixFQUFFSCxnQ0FBQSxDQUFnQkMsUUFBaEIsQ0FBeUJHLGdCQUF6QixFQUpzQjtNQUt6Q0MsUUFBUSxFQUFFQyw4QkFMK0I7TUFNekNDLFdBQVcsRUFBRUMsc0JBQUEsQ0FBY0MsUUFBZCxDQUF1QixPQUF2QixDQU40QjtNQU96Q0MsY0FBYyxFQUFFLElBQUFDLGdDQUFBO0lBUHlCLENBQTNCLENBQWxCO0lBVUEsTUFBTUMsTUFBTSxHQUFHLElBQUlDLEdBQUosQ0FBUWxCLFNBQVIsQ0FBZixDQVhZLENBYVo7SUFDQTtJQUNBOztJQUNBaUIsTUFBTSxDQUFDRSxZQUFQLENBQW9CQyxHQUFwQixDQUF3QixVQUF4QixFQUFvQyxLQUFLdkMsTUFBTCxDQUFZckMsRUFBaEQ7SUFDQXlFLE1BQU0sQ0FBQ0UsWUFBUCxDQUFvQkMsR0FBcEIsQ0FBd0IsV0FBeEIsRUFBcUNDLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsSUFBaEIsQ0FBcUJDLEtBQXJCLENBQTJCLEdBQTNCLEVBQWdDLENBQWhDLEVBQW1DLENBQW5DLENBQXJDLEVBakJZLENBbUJaO0lBQ0E7O0lBQ0EsTUFBTUMsU0FBUyxHQUFHUixNQUFNLENBQUNTLFFBQVAsR0FBa0JDLE9BQWxCLENBQTBCLE1BQTFCLEVBQWtDLEdBQWxDLENBQWxCO0lBRUEsSUFBSXhGLE9BQUo7O0lBQ0EsSUFBSSxLQUFLSixLQUFMLENBQVdHLGdCQUFYLENBQTRCQyxPQUFoQyxFQUF5QztNQUNyQztNQUNBQSxPQUFPLEdBQUcsS0FBS0osS0FBTCxDQUFXRyxnQkFBWCxDQUE0QkMsT0FBNUIsQ0FBb0N5RixLQUFwQyxDQUEwQyxDQUExQyxFQUE2Q2xHLFdBQTdDLEVBQTBEbUcsT0FBMUQsR0FBb0V0RixHQUFwRSxDQUF3RXVGLEdBQUcsSUFBSTtRQUNyRixJQUFJQyxJQUFJLEdBQUcsV0FBWDs7UUFDQSxRQUFRRCxHQUFHLENBQUNDLElBQVo7VUFDSSxLQUFLQyxnQ0FBQSxDQUFnQkMsT0FBckI7WUFDSUYsSUFBSSxHQUFHLFNBQVA7WUFDQTs7VUFDSixLQUFLQyxnQ0FBQSxDQUFnQkUsU0FBckI7WUFDSUgsSUFBSSxHQUFHLGlCQUFQO1lBQ0E7O1VBQ0osS0FBS0MsZ0NBQUEsQ0FBZ0JHLE1BQXJCO1lBQ0lKLElBQUksR0FBRyxRQUFQO1lBQ0E7UUFUUjs7UUFZQSxNQUFNSyxPQUFPLEdBQUcsTUFBTTtVQUNsQixLQUFLM0YsS0FBTCxDQUFXQyxTQUFYLENBQXFCMkYsOEJBQXJCLENBQW9EUCxHQUFHLENBQUN0RixFQUF4RDtRQUNILENBRkQ7O1FBSUEsTUFBTThGLFVBQVUsR0FBRyxLQUFLN0YsS0FBTCxDQUFXUixpQkFBWCxDQUE2QjZCLFFBQTdCLENBQXNDZ0UsR0FBRyxDQUFDdEYsRUFBMUMsQ0FBbkI7UUFFQSxvQkFBTyxvQkFBQyx5QkFBRDtVQUFrQixHQUFHLEVBQUVzRixHQUFHLENBQUN0RixFQUEzQjtVQUErQixJQUFJLEVBQUV1RixJQUFyQztVQUEyQyxPQUFPLEVBQUVLLE9BQXBEO1VBQTZELFFBQVEsRUFBRUU7UUFBdkUsR0FDRFIsR0FBRyxDQUFDUyxLQURILENBQVA7TUFHSCxDQXZCUyxDQUFWO0lBd0JIOztJQUVELG9CQUFPLG9CQUFDLG1CQUFEO01BQ0gsS0FBSyxFQUFFLEtBQUt4RyxLQUFMLENBQVdHLGdCQUFYLENBQTRCc0csSUFBNUIsSUFBb0MsSUFBQUMsbUJBQUEsRUFBRyxjQUFILENBRHhDO01BRUgsU0FBUyxFQUFDLHNCQUZQO01BR0gsU0FBUyxFQUFDLG1CQUhQO01BSUgsVUFBVSxFQUFFLEtBQUsxRyxLQUFMLENBQVdzQjtJQUpwQixnQkFNSDtNQUFLLFNBQVMsRUFBQztJQUFmLGdCQUNJO01BQ0ksR0FBRyxFQUFFcUYsT0FBTyxDQUFDLHFEQUFELENBQVAsQ0FBK0RDLE9BRHhFO01BRUksTUFBTSxFQUFDLElBRlg7TUFHSSxLQUFLLEVBQUMsSUFIVjtNQUlJLEdBQUcsRUFBQztJQUpSLEVBREosRUFPTSxJQUFBRixtQkFBQSxFQUFHLHFEQUFILEVBQTBEO01BQ3hERyxZQUFZLEVBQUUzQixNQUFNLENBQUM0QjtJQURtQyxDQUExRCxDQVBOLENBTkcsZUFpQkgsOENBQ0k7TUFDSSxLQUFLLEVBQUUsS0FBS2hFLE1BQUwsQ0FBWTJELElBRHZCO01BRUksR0FBRyxFQUFFLEtBQUs5QyxRQUZkO01BR0ksT0FBTyxFQUFDLDZDQUhaO01BSUksR0FBRyxFQUFFK0IsU0FKVDtNQUtJLE1BQU0sRUFBRSxLQUFLcUI7SUFMakIsRUFESixDQWpCRyxlQTBCSDtNQUFLLFNBQVMsRUFBQztJQUFmLEdBQ00zRyxPQUROLENBMUJHLENBQVA7RUE4Qkg7O0FBdko4RSJ9
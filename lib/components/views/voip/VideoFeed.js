"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _classnames = _interopRequireDefault(require("classnames"));

var _react = _interopRequireDefault(require("react"));

var _callFeed = require("matrix-js-sdk/src/webrtc/callFeed");

var _logger = require("matrix-js-sdk/src/logger");

var _callEventTypes = require("matrix-js-sdk/src/webrtc/callEventTypes");

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _MemberAvatar = _interopRequireDefault(require("../avatars/MemberAvatar"));

/*
Copyright 2015, 2016, 2019, 2020, 2021 The Matrix.org Foundation C.I.C.
Copyright 2021 - 2022 Šimon Brandner <simon.bra.ag@gmail.com>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class VideoFeed extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "element", void 0);
    (0, _defineProperty2.default)(this, "setElementRef", element => {
      if (!element) {
        this.element?.removeEventListener('resize', this.onResize);
        return;
      }

      this.element = element;
      element.addEventListener('resize', this.onResize);
    });
    (0, _defineProperty2.default)(this, "onNewStream", () => {
      this.setState({
        audioMuted: this.props.feed.isAudioMuted(),
        videoMuted: this.props.feed.isVideoMuted()
      });
      this.playMedia();
    });
    (0, _defineProperty2.default)(this, "onMuteStateChanged", () => {
      this.setState({
        audioMuted: this.props.feed.isAudioMuted(),
        videoMuted: this.props.feed.isVideoMuted()
      });
    });
    (0, _defineProperty2.default)(this, "onResize", e => {
      if (this.props.onResize && !this.props.feed.isLocal()) {
        this.props.onResize(e);
      }
    });
    this.state = {
      audioMuted: this.props.feed.isAudioMuted(),
      videoMuted: this.props.feed.isVideoMuted()
    };
  }

  componentDidMount() {
    this.updateFeed(null, this.props.feed);
    this.playMedia();
  }

  componentWillUnmount() {
    this.updateFeed(this.props.feed, null);
  }

  componentDidUpdate(prevProps, prevState) {
    this.updateFeed(prevProps.feed, this.props.feed); // If the mutes state has changed, we try to playMedia()

    if (prevState.videoMuted !== this.state.videoMuted || prevProps.feed.stream !== this.props.feed.stream) {
      this.playMedia();
    }
  }

  static getDerivedStateFromProps(props) {
    return {
      audioMuted: props.feed.isAudioMuted(),
      videoMuted: props.feed.isVideoMuted()
    };
  }

  updateFeed(oldFeed, newFeed) {
    if (oldFeed === newFeed) return;

    if (oldFeed) {
      this.props.feed.removeListener(_callFeed.CallFeedEvent.NewStream, this.onNewStream);
      this.props.feed.removeListener(_callFeed.CallFeedEvent.MuteStateChanged, this.onMuteStateChanged);

      if (this.props.feed.purpose === _callEventTypes.SDPStreamMetadataPurpose.Usermedia) {
        this.props.feed.measureVolumeActivity(false);
      }

      this.stopMedia();
    }

    if (newFeed) {
      this.props.feed.addListener(_callFeed.CallFeedEvent.NewStream, this.onNewStream);
      this.props.feed.addListener(_callFeed.CallFeedEvent.MuteStateChanged, this.onMuteStateChanged);

      if (this.props.feed.purpose === _callEventTypes.SDPStreamMetadataPurpose.Usermedia) {
        this.props.feed.measureVolumeActivity(true);
      }

      this.playMedia();
    }
  }

  async playMedia() {
    const element = this.element;
    if (!element) return; // We play audio in AudioFeed, not here

    element.muted = true;
    element.srcObject = this.props.feed.stream;
    element.autoplay = true;

    try {
      // A note on calling methods on media elements:
      // We used to have queues per media element to serialise all calls on those elements.
      // The reason given for this was that load() and play() were racing. However, we now
      // never call load() explicitly so this seems unnecessary. However, serialising every
      // operation was causing bugs where video would not resume because some play command
      // had got stuck and all media operations were queued up behind it. If necessary, we
      // should serialise the ones that need to be serialised but then be able to interrupt
      // them with another load() which will cancel the pending one, but since we don't call
      // load() explicitly, it shouldn't be a problem. - Dave
      await element.play();
    } catch (e) {
      _logger.logger.info(`Failed to play media element with feed for userId ` + `${this.props.feed.userId} with purpose ${this.props.feed.purpose}`, e);
    }
  }

  stopMedia() {
    const element = this.element;
    if (!element) return;
    element.pause();
    element.src = null; // As per comment in componentDidMount, setting the sink ID back to the
    // default once the call is over makes setSinkId work reliably. - Dave
    // Since we are not using the same element anymore, the above doesn't
    // seem to be necessary - Šimon
  }

  render() {
    const {
      pipMode,
      primary,
      secondary,
      feed
    } = this.props;
    const wrapperClasses = (0, _classnames.default)("mx_VideoFeed", {
      mx_VideoFeed_primary: primary,
      mx_VideoFeed_secondary: secondary,
      mx_VideoFeed_voice: this.state.videoMuted
    });
    const micIconClasses = (0, _classnames.default)("mx_VideoFeed_mic", {
      mx_VideoFeed_mic_muted: this.state.audioMuted,
      mx_VideoFeed_mic_unmuted: !this.state.audioMuted
    });
    let micIcon;

    if (feed.purpose !== _callEventTypes.SDPStreamMetadataPurpose.Screenshare && !primary && !pipMode) {
      micIcon = /*#__PURE__*/_react.default.createElement("div", {
        className: micIconClasses
      });
    }

    let content;

    if (this.state.videoMuted) {
      const member = this.props.feed.getMember();
      let avatarSize;
      if (pipMode && primary) avatarSize = 76;else if (pipMode && !primary) avatarSize = 16;else if (!pipMode && primary) avatarSize = 160;else ; // TBD

      content = /*#__PURE__*/_react.default.createElement(_MemberAvatar.default, {
        member: member,
        height: avatarSize,
        width: avatarSize
      });
    } else {
      const videoClasses = (0, _classnames.default)("mx_VideoFeed_video", {
        mx_VideoFeed_video_mirror: this.props.feed.isLocal() && this.props.feed.purpose === _callEventTypes.SDPStreamMetadataPurpose.Usermedia && _SettingsStore.default.getValue('VideoView.flipVideoHorizontally')
      });
      content = /*#__PURE__*/_react.default.createElement("video", {
        className: videoClasses,
        ref: this.setElementRef
      });
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: wrapperClasses
    }, micIcon, content);
  }

}

exports.default = VideoFeed;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWaWRlb0ZlZWQiLCJSZWFjdCIsIlB1cmVDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiZWxlbWVudCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJvblJlc2l6ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJzZXRTdGF0ZSIsImF1ZGlvTXV0ZWQiLCJmZWVkIiwiaXNBdWRpb011dGVkIiwidmlkZW9NdXRlZCIsImlzVmlkZW9NdXRlZCIsInBsYXlNZWRpYSIsImUiLCJpc0xvY2FsIiwic3RhdGUiLCJjb21wb25lbnREaWRNb3VudCIsInVwZGF0ZUZlZWQiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImNvbXBvbmVudERpZFVwZGF0ZSIsInByZXZQcm9wcyIsInByZXZTdGF0ZSIsInN0cmVhbSIsImdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyIsIm9sZEZlZWQiLCJuZXdGZWVkIiwicmVtb3ZlTGlzdGVuZXIiLCJDYWxsRmVlZEV2ZW50IiwiTmV3U3RyZWFtIiwib25OZXdTdHJlYW0iLCJNdXRlU3RhdGVDaGFuZ2VkIiwib25NdXRlU3RhdGVDaGFuZ2VkIiwicHVycG9zZSIsIlNEUFN0cmVhbU1ldGFkYXRhUHVycG9zZSIsIlVzZXJtZWRpYSIsIm1lYXN1cmVWb2x1bWVBY3Rpdml0eSIsInN0b3BNZWRpYSIsImFkZExpc3RlbmVyIiwibXV0ZWQiLCJzcmNPYmplY3QiLCJhdXRvcGxheSIsInBsYXkiLCJsb2dnZXIiLCJpbmZvIiwidXNlcklkIiwicGF1c2UiLCJzcmMiLCJyZW5kZXIiLCJwaXBNb2RlIiwicHJpbWFyeSIsInNlY29uZGFyeSIsIndyYXBwZXJDbGFzc2VzIiwiY2xhc3NuYW1lcyIsIm14X1ZpZGVvRmVlZF9wcmltYXJ5IiwibXhfVmlkZW9GZWVkX3NlY29uZGFyeSIsIm14X1ZpZGVvRmVlZF92b2ljZSIsIm1pY0ljb25DbGFzc2VzIiwibXhfVmlkZW9GZWVkX21pY19tdXRlZCIsIm14X1ZpZGVvRmVlZF9taWNfdW5tdXRlZCIsIm1pY0ljb24iLCJTY3JlZW5zaGFyZSIsImNvbnRlbnQiLCJtZW1iZXIiLCJnZXRNZW1iZXIiLCJhdmF0YXJTaXplIiwidmlkZW9DbGFzc2VzIiwibXhfVmlkZW9GZWVkX3ZpZGVvX21pcnJvciIsIlNldHRpbmdzU3RvcmUiLCJnZXRWYWx1ZSIsInNldEVsZW1lbnRSZWYiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy92aWV3cy92b2lwL1ZpZGVvRmVlZC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE1LCAyMDE2LCAyMDE5LCAyMDIwLCAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5Db3B5cmlnaHQgMjAyMSAtIDIwMjIgxaBpbW9uIEJyYW5kbmVyIDxzaW1vbi5icmEuYWdAZ21haWwuY29tPlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBjbGFzc25hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IHsgTWF0cml4Q2FsbCB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL3dlYnJ0Yy9jYWxsJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBDYWxsRmVlZCwgQ2FsbEZlZWRFdmVudCB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL3dlYnJ0Yy9jYWxsRmVlZCc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdtYXRyaXgtanMtc2RrL3NyYy9sb2dnZXInO1xuaW1wb3J0IHsgU0RQU3RyZWFtTWV0YWRhdGFQdXJwb3NlIH0gZnJvbSAnbWF0cml4LWpzLXNkay9zcmMvd2VicnRjL2NhbGxFdmVudFR5cGVzJztcblxuaW1wb3J0IFNldHRpbmdzU3RvcmUgZnJvbSBcIi4uLy4uLy4uL3NldHRpbmdzL1NldHRpbmdzU3RvcmVcIjtcbmltcG9ydCBNZW1iZXJBdmF0YXIgZnJvbSBcIi4uL2F2YXRhcnMvTWVtYmVyQXZhdGFyXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIGNhbGw6IE1hdHJpeENhbGw7XG5cbiAgICBmZWVkOiBDYWxsRmVlZDtcblxuICAgIC8vIFdoZXRoZXIgdGhpcyBjYWxsIHZpZXcgaXMgZm9yIHBpY3R1cmUtaW4tcGljdHVyZSBtb2RlXG4gICAgLy8gb3RoZXJ3aXNlLCBpdCdzIHRoZSBsYXJnZXIgY2FsbCB2aWV3IHdoZW4gdmlld2luZyB0aGUgcm9vbSB0aGUgY2FsbCBpcyBpbi5cbiAgICAvLyBUaGlzIGlzIHNvcnQgb2YgYSBwcm94eSBmb3IgYSBudW1iZXIgb2YgdGhpbmdzIGJ1dCB3ZSBjdXJyZW50bHkgaGF2ZSBub1xuICAgIC8vIG5lZWQgdG8gY29udHJvbCB0aG9zZSB0aGluZ3Mgc2VwYXJhdGVseSwgc28gdGhpcyBpcyBzaW1wbGVyLlxuICAgIHBpcE1vZGU/OiBib29sZWFuO1xuXG4gICAgLy8gYSBjYWxsYmFjayB3aGljaCBpcyBjYWxsZWQgd2hlbiB0aGUgdmlkZW8gZWxlbWVudCBpcyByZXNpemVkXG4gICAgLy8gZHVlIHRvIGEgY2hhbmdlIGluIHZpZGVvIG1ldGFkYXRhXG4gICAgb25SZXNpemU/OiAoZTogRXZlbnQpID0+IHZvaWQ7XG5cbiAgICBwcmltYXJ5PzogYm9vbGVhbjtcbiAgICBzZWNvbmRhcnk/OiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBhdWRpb011dGVkOiBib29sZWFuO1xuICAgIHZpZGVvTXV0ZWQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZpZGVvRmVlZCBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBwcml2YXRlIGVsZW1lbnQ6IEhUTUxWaWRlb0VsZW1lbnQ7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgYXVkaW9NdXRlZDogdGhpcy5wcm9wcy5mZWVkLmlzQXVkaW9NdXRlZCgpLFxuICAgICAgICAgICAgdmlkZW9NdXRlZDogdGhpcy5wcm9wcy5mZWVkLmlzVmlkZW9NdXRlZCgpLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICB0aGlzLnVwZGF0ZUZlZWQobnVsbCwgdGhpcy5wcm9wcy5mZWVkKTtcbiAgICAgICAgdGhpcy5wbGF5TWVkaWEoKTtcbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgdGhpcy51cGRhdGVGZWVkKHRoaXMucHJvcHMuZmVlZCwgbnVsbCk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wczogSVByb3BzLCBwcmV2U3RhdGU6IElTdGF0ZSkge1xuICAgICAgICB0aGlzLnVwZGF0ZUZlZWQocHJldlByb3BzLmZlZWQsIHRoaXMucHJvcHMuZmVlZCk7XG4gICAgICAgIC8vIElmIHRoZSBtdXRlcyBzdGF0ZSBoYXMgY2hhbmdlZCwgd2UgdHJ5IHRvIHBsYXlNZWRpYSgpXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHByZXZTdGF0ZS52aWRlb011dGVkICE9PSB0aGlzLnN0YXRlLnZpZGVvTXV0ZWQgfHxcbiAgICAgICAgICAgIHByZXZQcm9wcy5mZWVkLnN0cmVhbSAhPT0gdGhpcy5wcm9wcy5mZWVkLnN0cmVhbVxuICAgICAgICApIHtcbiAgICAgICAgICAgIHRoaXMucGxheU1lZGlhKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzKHByb3BzOiBJUHJvcHMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGF1ZGlvTXV0ZWQ6IHByb3BzLmZlZWQuaXNBdWRpb011dGVkKCksXG4gICAgICAgICAgICB2aWRlb011dGVkOiBwcm9wcy5mZWVkLmlzVmlkZW9NdXRlZCgpLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0RWxlbWVudFJlZiA9IChlbGVtZW50OiBIVE1MVmlkZW9FbGVtZW50KTogdm9pZCA9PiB7XG4gICAgICAgIGlmICghZWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50Py5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5vblJlc2l6ZSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgdXBkYXRlRmVlZChvbGRGZWVkOiBDYWxsRmVlZCwgbmV3RmVlZDogQ2FsbEZlZWQpIHtcbiAgICAgICAgaWYgKG9sZEZlZWQgPT09IG5ld0ZlZWQpIHJldHVybjtcblxuICAgICAgICBpZiAob2xkRmVlZCkge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5mZWVkLnJlbW92ZUxpc3RlbmVyKENhbGxGZWVkRXZlbnQuTmV3U3RyZWFtLCB0aGlzLm9uTmV3U3RyZWFtKTtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZmVlZC5yZW1vdmVMaXN0ZW5lcihDYWxsRmVlZEV2ZW50Lk11dGVTdGF0ZUNoYW5nZWQsIHRoaXMub25NdXRlU3RhdGVDaGFuZ2VkKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLmZlZWQucHVycG9zZSA9PT0gU0RQU3RyZWFtTWV0YWRhdGFQdXJwb3NlLlVzZXJtZWRpYSkge1xuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuZmVlZC5tZWFzdXJlVm9sdW1lQWN0aXZpdHkoZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zdG9wTWVkaWEoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3RmVlZCkge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5mZWVkLmFkZExpc3RlbmVyKENhbGxGZWVkRXZlbnQuTmV3U3RyZWFtLCB0aGlzLm9uTmV3U3RyZWFtKTtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZmVlZC5hZGRMaXN0ZW5lcihDYWxsRmVlZEV2ZW50Lk11dGVTdGF0ZUNoYW5nZWQsIHRoaXMub25NdXRlU3RhdGVDaGFuZ2VkKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLmZlZWQucHVycG9zZSA9PT0gU0RQU3RyZWFtTWV0YWRhdGFQdXJwb3NlLlVzZXJtZWRpYSkge1xuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuZmVlZC5tZWFzdXJlVm9sdW1lQWN0aXZpdHkodHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnBsYXlNZWRpYSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBwbGF5TWVkaWEoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgIGlmICghZWxlbWVudCkgcmV0dXJuO1xuICAgICAgICAvLyBXZSBwbGF5IGF1ZGlvIGluIEF1ZGlvRmVlZCwgbm90IGhlcmVcbiAgICAgICAgZWxlbWVudC5tdXRlZCA9IHRydWU7XG4gICAgICAgIGVsZW1lbnQuc3JjT2JqZWN0ID0gdGhpcy5wcm9wcy5mZWVkLnN0cmVhbTtcbiAgICAgICAgZWxlbWVudC5hdXRvcGxheSA9IHRydWU7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBBIG5vdGUgb24gY2FsbGluZyBtZXRob2RzIG9uIG1lZGlhIGVsZW1lbnRzOlxuICAgICAgICAgICAgLy8gV2UgdXNlZCB0byBoYXZlIHF1ZXVlcyBwZXIgbWVkaWEgZWxlbWVudCB0byBzZXJpYWxpc2UgYWxsIGNhbGxzIG9uIHRob3NlIGVsZW1lbnRzLlxuICAgICAgICAgICAgLy8gVGhlIHJlYXNvbiBnaXZlbiBmb3IgdGhpcyB3YXMgdGhhdCBsb2FkKCkgYW5kIHBsYXkoKSB3ZXJlIHJhY2luZy4gSG93ZXZlciwgd2Ugbm93XG4gICAgICAgICAgICAvLyBuZXZlciBjYWxsIGxvYWQoKSBleHBsaWNpdGx5IHNvIHRoaXMgc2VlbXMgdW5uZWNlc3NhcnkuIEhvd2V2ZXIsIHNlcmlhbGlzaW5nIGV2ZXJ5XG4gICAgICAgICAgICAvLyBvcGVyYXRpb24gd2FzIGNhdXNpbmcgYnVncyB3aGVyZSB2aWRlbyB3b3VsZCBub3QgcmVzdW1lIGJlY2F1c2Ugc29tZSBwbGF5IGNvbW1hbmRcbiAgICAgICAgICAgIC8vIGhhZCBnb3Qgc3R1Y2sgYW5kIGFsbCBtZWRpYSBvcGVyYXRpb25zIHdlcmUgcXVldWVkIHVwIGJlaGluZCBpdC4gSWYgbmVjZXNzYXJ5LCB3ZVxuICAgICAgICAgICAgLy8gc2hvdWxkIHNlcmlhbGlzZSB0aGUgb25lcyB0aGF0IG5lZWQgdG8gYmUgc2VyaWFsaXNlZCBidXQgdGhlbiBiZSBhYmxlIHRvIGludGVycnVwdFxuICAgICAgICAgICAgLy8gdGhlbSB3aXRoIGFub3RoZXIgbG9hZCgpIHdoaWNoIHdpbGwgY2FuY2VsIHRoZSBwZW5kaW5nIG9uZSwgYnV0IHNpbmNlIHdlIGRvbid0IGNhbGxcbiAgICAgICAgICAgIC8vIGxvYWQoKSBleHBsaWNpdGx5LCBpdCBzaG91bGRuJ3QgYmUgYSBwcm9ibGVtLiAtIERhdmVcbiAgICAgICAgICAgIGF3YWl0IGVsZW1lbnQucGxheSgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBsb2dnZXIuaW5mbyhcbiAgICAgICAgICAgICAgICBgRmFpbGVkIHRvIHBsYXkgbWVkaWEgZWxlbWVudCB3aXRoIGZlZWQgZm9yIHVzZXJJZCBgICtcbiAgICAgICAgICAgICAgICBgJHt0aGlzLnByb3BzLmZlZWQudXNlcklkfSB3aXRoIHB1cnBvc2UgJHt0aGlzLnByb3BzLmZlZWQucHVycG9zZX1gLCBlLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc3RvcE1lZGlhKCkge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICBpZiAoIWVsZW1lbnQpIHJldHVybjtcblxuICAgICAgICBlbGVtZW50LnBhdXNlKCk7XG4gICAgICAgIGVsZW1lbnQuc3JjID0gbnVsbDtcblxuICAgICAgICAvLyBBcyBwZXIgY29tbWVudCBpbiBjb21wb25lbnREaWRNb3VudCwgc2V0dGluZyB0aGUgc2luayBJRCBiYWNrIHRvIHRoZVxuICAgICAgICAvLyBkZWZhdWx0IG9uY2UgdGhlIGNhbGwgaXMgb3ZlciBtYWtlcyBzZXRTaW5rSWQgd29yayByZWxpYWJseS4gLSBEYXZlXG4gICAgICAgIC8vIFNpbmNlIHdlIGFyZSBub3QgdXNpbmcgdGhlIHNhbWUgZWxlbWVudCBhbnltb3JlLCB0aGUgYWJvdmUgZG9lc24ndFxuICAgICAgICAvLyBzZWVtIHRvIGJlIG5lY2Vzc2FyeSAtIMWgaW1vblxuICAgIH1cblxuICAgIHByaXZhdGUgb25OZXdTdHJlYW0gPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgYXVkaW9NdXRlZDogdGhpcy5wcm9wcy5mZWVkLmlzQXVkaW9NdXRlZCgpLFxuICAgICAgICAgICAgdmlkZW9NdXRlZDogdGhpcy5wcm9wcy5mZWVkLmlzVmlkZW9NdXRlZCgpLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wbGF5TWVkaWEoKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbk11dGVTdGF0ZUNoYW5nZWQgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgYXVkaW9NdXRlZDogdGhpcy5wcm9wcy5mZWVkLmlzQXVkaW9NdXRlZCgpLFxuICAgICAgICAgICAgdmlkZW9NdXRlZDogdGhpcy5wcm9wcy5mZWVkLmlzVmlkZW9NdXRlZCgpLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblJlc2l6ZSA9IChlKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uUmVzaXplICYmICF0aGlzLnByb3BzLmZlZWQuaXNMb2NhbCgpKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLm9uUmVzaXplKGUpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBwaXBNb2RlLCBwcmltYXJ5LCBzZWNvbmRhcnksIGZlZWQgfSA9IHRoaXMucHJvcHM7XG5cbiAgICAgICAgY29uc3Qgd3JhcHBlckNsYXNzZXMgPSBjbGFzc25hbWVzKFwibXhfVmlkZW9GZWVkXCIsIHtcbiAgICAgICAgICAgIG14X1ZpZGVvRmVlZF9wcmltYXJ5OiBwcmltYXJ5LFxuICAgICAgICAgICAgbXhfVmlkZW9GZWVkX3NlY29uZGFyeTogc2Vjb25kYXJ5LFxuICAgICAgICAgICAgbXhfVmlkZW9GZWVkX3ZvaWNlOiB0aGlzLnN0YXRlLnZpZGVvTXV0ZWQsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBtaWNJY29uQ2xhc3NlcyA9IGNsYXNzbmFtZXMoXCJteF9WaWRlb0ZlZWRfbWljXCIsIHtcbiAgICAgICAgICAgIG14X1ZpZGVvRmVlZF9taWNfbXV0ZWQ6IHRoaXMuc3RhdGUuYXVkaW9NdXRlZCxcbiAgICAgICAgICAgIG14X1ZpZGVvRmVlZF9taWNfdW5tdXRlZDogIXRoaXMuc3RhdGUuYXVkaW9NdXRlZCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IG1pY0ljb247XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIGZlZWQucHVycG9zZSAhPT0gU0RQU3RyZWFtTWV0YWRhdGFQdXJwb3NlLlNjcmVlbnNoYXJlICYmXG4gICAgICAgICAgICAhcHJpbWFyeSAmJlxuICAgICAgICAgICAgIXBpcE1vZGVcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBtaWNJY29uID0gKFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXttaWNJY29uQ2xhc3Nlc30gLz5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgY29udGVudDtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUudmlkZW9NdXRlZCkge1xuICAgICAgICAgICAgY29uc3QgbWVtYmVyID0gdGhpcy5wcm9wcy5mZWVkLmdldE1lbWJlcigpO1xuXG4gICAgICAgICAgICBsZXQgYXZhdGFyU2l6ZTtcbiAgICAgICAgICAgIGlmIChwaXBNb2RlICYmIHByaW1hcnkpIGF2YXRhclNpemUgPSA3NjtcbiAgICAgICAgICAgIGVsc2UgaWYgKHBpcE1vZGUgJiYgIXByaW1hcnkpIGF2YXRhclNpemUgPSAxNjtcbiAgICAgICAgICAgIGVsc2UgaWYgKCFwaXBNb2RlICYmIHByaW1hcnkpIGF2YXRhclNpemUgPSAxNjA7XG4gICAgICAgICAgICBlbHNlOyAvLyBUQkRcblxuICAgICAgICAgICAgY29udGVudCA9KFxuICAgICAgICAgICAgICAgIDxNZW1iZXJBdmF0YXJcbiAgICAgICAgICAgICAgICAgICAgbWVtYmVyPXttZW1iZXJ9XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodD17YXZhdGFyU2l6ZX1cbiAgICAgICAgICAgICAgICAgICAgd2lkdGg9e2F2YXRhclNpemV9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB2aWRlb0NsYXNzZXMgPSBjbGFzc25hbWVzKFwibXhfVmlkZW9GZWVkX3ZpZGVvXCIsIHtcbiAgICAgICAgICAgICAgICBteF9WaWRlb0ZlZWRfdmlkZW9fbWlycm9yOiAoXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuZmVlZC5pc0xvY2FsKCkgJiZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5mZWVkLnB1cnBvc2UgPT09IFNEUFN0cmVhbU1ldGFkYXRhUHVycG9zZS5Vc2VybWVkaWEgJiZcbiAgICAgICAgICAgICAgICAgICAgU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZSgnVmlkZW9WaWV3LmZsaXBWaWRlb0hvcml6b250YWxseScpXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250ZW50ID0gKFxuICAgICAgICAgICAgICAgIDx2aWRlbyBjbGFzc05hbWU9e3ZpZGVvQ2xhc3Nlc30gcmVmPXt0aGlzLnNldEVsZW1lbnRSZWZ9IC8+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXt3cmFwcGVyQ2xhc3Nlc30+XG4gICAgICAgICAgICAgICAgeyBtaWNJY29uIH1cbiAgICAgICAgICAgICAgICB7IGNvbnRlbnQgfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWlCQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUF6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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
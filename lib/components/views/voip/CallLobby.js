"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.CallLobby = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _logger = require("matrix-js-sdk/src/logger");

var _languageHandler = require("../../../languageHandler");

var _useAsyncMemo = require("../../../hooks/useAsyncMemo");

var _MediaDeviceHandler = _interopRequireWildcard(require("../../../MediaDeviceHandler"));

var _useCall = require("../../../hooks/useCall");

var _CallStore = require("../../../stores/CallStore");

var _IconizedContextMenu = _interopRequireWildcard(require("../context_menus/IconizedContextMenu"));

var _ContextMenu = require("../../structures/ContextMenu");

var _Tooltip = require("../elements/Tooltip");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _AccessibleTooltipButton = _interopRequireDefault(require("../elements/AccessibleTooltipButton"));

var _FacePile = _interopRequireDefault(require("../elements/FacePile"));

var _MemberAvatar = _interopRequireDefault(require("../avatars/MemberAvatar"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2022 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const DeviceButton = _ref => {
  let {
    kind,
    devices,
    setDevice,
    deviceListLabel,
    fallbackDeviceLabel,
    muted,
    disabled,
    toggle,
    unmutedTitle,
    mutedTitle
  } = _ref;
  const [menuDisplayed, buttonRef, openMenu, closeMenu] = (0, _ContextMenu.useContextMenu)();
  let contextMenu;

  if (menuDisplayed) {
    const selectDevice = device => {
      setDevice(device);
      closeMenu();
    };

    const buttonRect = buttonRef.current.getBoundingClientRect();
    contextMenu = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.default, (0, _extends2.default)({}, (0, _ContextMenu.aboveLeftOf)(buttonRect), {
      onFinished: closeMenu
    }), /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOptionList, null, devices.map((d, index) => /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
      key: d.deviceId,
      label: d.label || fallbackDeviceLabel(index + 1),
      onClick: () => selectDevice(d)
    }))));
  }

  if (!devices.length) return null;
  return /*#__PURE__*/_react.default.createElement("div", {
    className: (0, _classnames.default)("mx_CallLobby_deviceButtonWrapper", {
      "mx_CallLobby_deviceButtonWrapper_muted": muted
    })
  }, /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
    className: `mx_CallLobby_deviceButton mx_CallLobby_deviceButton_${kind}`,
    title: muted ? mutedTitle : unmutedTitle,
    alignment: _Tooltip.Alignment.Top,
    onClick: toggle,
    disabled: disabled
  }), devices.length > 1 ? /*#__PURE__*/_react.default.createElement(_ContextMenu.ContextMenuButton, {
    className: "mx_CallLobby_deviceListButton",
    inputRef: buttonRef,
    onClick: openMenu,
    isExpanded: menuDisplayed,
    label: deviceListLabel,
    disabled: disabled
  }) : null, contextMenu);
};

const MAX_FACES = 8;

const CallLobby = _ref2 => {
  let {
    room,
    call
  } = _ref2;
  const [connecting, setConnecting] = (0, _react.useState)(false);
  const me = (0, _react.useMemo)(() => room.getMember(room.myUserId), [room]);
  const participants = (0, _useCall.useParticipants)(call);
  const videoRef = (0, _react.useRef)(null);
  const [audioInputs, videoInputs] = (0, _useAsyncMemo.useAsyncMemo)(async () => {
    try {
      const devices = await _MediaDeviceHandler.default.getDevices();
      return [devices[_MediaDeviceHandler.MediaDeviceKindEnum.AudioInput], devices[_MediaDeviceHandler.MediaDeviceKindEnum.VideoInput]];
    } catch (e) {
      _logger.logger.warn(`Failed to get media device list`, e);

      return [[], []];
    }
  }, [], [[], []]);
  const [videoInputId, setVideoInputId] = (0, _react.useState)(() => _MediaDeviceHandler.default.getVideoInput());
  const setAudioInput = (0, _react.useCallback)(device => {
    _MediaDeviceHandler.default.instance.setAudioInput(device.deviceId);
  }, []);
  const setVideoInput = (0, _react.useCallback)(device => {
    _MediaDeviceHandler.default.instance.setVideoInput(device.deviceId);

    setVideoInputId(device.deviceId);
  }, []);
  const [audioMuted, setAudioMuted] = (0, _react.useState)(() => _MediaDeviceHandler.default.startWithAudioMuted);
  const [videoMuted, setVideoMuted] = (0, _react.useState)(() => _MediaDeviceHandler.default.startWithVideoMuted);
  const toggleAudio = (0, _react.useCallback)(() => {
    _MediaDeviceHandler.default.startWithAudioMuted = !audioMuted;
    setAudioMuted(!audioMuted);
  }, [audioMuted, setAudioMuted]);
  const toggleVideo = (0, _react.useCallback)(() => {
    _MediaDeviceHandler.default.startWithVideoMuted = !videoMuted;
    setVideoMuted(!videoMuted);
  }, [videoMuted, setVideoMuted]);
  const videoStream = (0, _useAsyncMemo.useAsyncMemo)(async () => {
    if (videoInputId && !videoMuted) {
      try {
        return await navigator.mediaDevices.getUserMedia({
          video: {
            deviceId: videoInputId
          }
        });
      } catch (e) {
        _logger.logger.error(`Failed to get stream for device ${videoInputId}`, e);
      }
    }

    return null;
  }, [videoInputId, videoMuted]);
  (0, _react.useEffect)(() => {
    if (videoStream) {
      const videoElement = videoRef.current;
      videoElement.srcObject = videoStream;
      videoElement.play();
      return () => {
        videoStream?.getTracks().forEach(track => track.stop());
        videoElement.srcObject = null;
      };
    }
  }, [videoStream]);
  const connect = (0, _react.useCallback)(async () => {
    setConnecting(true);

    try {
      // Disconnect from any other active calls first, since we don't yet support holding
      await Promise.all([..._CallStore.CallStore.instance.activeCalls].map(call => call.disconnect()));
      await call.connect();
    } catch (e) {
      _logger.logger.error(e);

      setConnecting(false);
    }
  }, [call, setConnecting]);
  let facePile = null;

  if (participants.size) {
    const shownMembers = [...participants].slice(0, MAX_FACES);
    const overflow = participants.size > shownMembers.length;
    facePile = /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CallLobby_participants"
    }, (0, _languageHandler._t)("%(count)s people joined", {
      count: participants.size
    }), /*#__PURE__*/_react.default.createElement(_FacePile.default, {
      members: shownMembers,
      faceSize: 24,
      overflow: overflow
    }));
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_CallLobby"
  }, facePile, /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_CallLobby_preview"
  }, /*#__PURE__*/_react.default.createElement(_MemberAvatar.default, {
    key: me.userId,
    member: me,
    width: 200,
    height: 200,
    resizeMethod: "scale"
  }), /*#__PURE__*/_react.default.createElement("video", {
    ref: videoRef,
    style: {
      visibility: videoMuted ? "hidden" : undefined
    },
    muted: true,
    playsInline: true,
    disablePictureInPicture: true
  }), /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_CallLobby_controls"
  }, /*#__PURE__*/_react.default.createElement(DeviceButton, {
    kind: "audio",
    devices: audioInputs,
    setDevice: setAudioInput,
    deviceListLabel: (0, _languageHandler._t)("Audio devices"),
    fallbackDeviceLabel: n => (0, _languageHandler._t)("Audio input %(n)s", {
      n
    }),
    muted: audioMuted,
    disabled: connecting,
    toggle: toggleAudio,
    unmutedTitle: (0, _languageHandler._t)("Mute microphone"),
    mutedTitle: (0, _languageHandler._t)("Unmute microphone")
  }), /*#__PURE__*/_react.default.createElement(DeviceButton, {
    kind: "video",
    devices: videoInputs,
    setDevice: setVideoInput,
    deviceListLabel: (0, _languageHandler._t)("Video devices"),
    fallbackDeviceLabel: n => (0, _languageHandler._t)("Video input %(n)s", {
      n
    }),
    muted: videoMuted,
    disabled: connecting,
    toggle: toggleVideo,
    unmutedTitle: (0, _languageHandler._t)("Turn off camera"),
    mutedTitle: (0, _languageHandler._t)("Turn on camera")
  }))), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
    className: "mx_CallLobby_connectButton",
    kind: "primary",
    disabled: connecting,
    onClick: connect
  }, (0, _languageHandler._t)("Join")));
};

exports.CallLobby = CallLobby;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXZpY2VCdXR0b24iLCJraW5kIiwiZGV2aWNlcyIsInNldERldmljZSIsImRldmljZUxpc3RMYWJlbCIsImZhbGxiYWNrRGV2aWNlTGFiZWwiLCJtdXRlZCIsImRpc2FibGVkIiwidG9nZ2xlIiwidW5tdXRlZFRpdGxlIiwibXV0ZWRUaXRsZSIsIm1lbnVEaXNwbGF5ZWQiLCJidXR0b25SZWYiLCJvcGVuTWVudSIsImNsb3NlTWVudSIsInVzZUNvbnRleHRNZW51IiwiY29udGV4dE1lbnUiLCJzZWxlY3REZXZpY2UiLCJkZXZpY2UiLCJidXR0b25SZWN0IiwiY3VycmVudCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImFib3ZlTGVmdE9mIiwibWFwIiwiZCIsImluZGV4IiwiZGV2aWNlSWQiLCJsYWJlbCIsImxlbmd0aCIsImNsYXNzTmFtZXMiLCJBbGlnbm1lbnQiLCJUb3AiLCJNQVhfRkFDRVMiLCJDYWxsTG9iYnkiLCJyb29tIiwiY2FsbCIsImNvbm5lY3RpbmciLCJzZXRDb25uZWN0aW5nIiwidXNlU3RhdGUiLCJtZSIsInVzZU1lbW8iLCJnZXRNZW1iZXIiLCJteVVzZXJJZCIsInBhcnRpY2lwYW50cyIsInVzZVBhcnRpY2lwYW50cyIsInZpZGVvUmVmIiwidXNlUmVmIiwiYXVkaW9JbnB1dHMiLCJ2aWRlb0lucHV0cyIsInVzZUFzeW5jTWVtbyIsIk1lZGlhRGV2aWNlSGFuZGxlciIsImdldERldmljZXMiLCJNZWRpYURldmljZUtpbmRFbnVtIiwiQXVkaW9JbnB1dCIsIlZpZGVvSW5wdXQiLCJlIiwibG9nZ2VyIiwid2FybiIsInZpZGVvSW5wdXRJZCIsInNldFZpZGVvSW5wdXRJZCIsImdldFZpZGVvSW5wdXQiLCJzZXRBdWRpb0lucHV0IiwidXNlQ2FsbGJhY2siLCJpbnN0YW5jZSIsInNldFZpZGVvSW5wdXQiLCJhdWRpb011dGVkIiwic2V0QXVkaW9NdXRlZCIsInN0YXJ0V2l0aEF1ZGlvTXV0ZWQiLCJ2aWRlb011dGVkIiwic2V0VmlkZW9NdXRlZCIsInN0YXJ0V2l0aFZpZGVvTXV0ZWQiLCJ0b2dnbGVBdWRpbyIsInRvZ2dsZVZpZGVvIiwidmlkZW9TdHJlYW0iLCJuYXZpZ2F0b3IiLCJtZWRpYURldmljZXMiLCJnZXRVc2VyTWVkaWEiLCJ2aWRlbyIsImVycm9yIiwidXNlRWZmZWN0IiwidmlkZW9FbGVtZW50Iiwic3JjT2JqZWN0IiwicGxheSIsImdldFRyYWNrcyIsImZvckVhY2giLCJ0cmFjayIsInN0b3AiLCJjb25uZWN0IiwiUHJvbWlzZSIsImFsbCIsIkNhbGxTdG9yZSIsImFjdGl2ZUNhbGxzIiwiZGlzY29ubmVjdCIsImZhY2VQaWxlIiwic2l6ZSIsInNob3duTWVtYmVycyIsInNsaWNlIiwib3ZlcmZsb3ciLCJfdCIsImNvdW50IiwidXNlcklkIiwidmlzaWJpbGl0eSIsInVuZGVmaW5lZCIsIm4iXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy92aWV3cy92b2lwL0NhbGxMb2JieS50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIyIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0LCB7IEZDLCB1c2VTdGF0ZSwgdXNlTWVtbywgdXNlUmVmLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tIFwiY2xhc3NuYW1lc1wiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuaW1wb3J0IHsgUm9vbSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvcm9vbVwiO1xuXG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCB7IHVzZUFzeW5jTWVtbyB9IGZyb20gXCIuLi8uLi8uLi9ob29rcy91c2VBc3luY01lbW9cIjtcbmltcG9ydCBNZWRpYURldmljZUhhbmRsZXIsIHsgTWVkaWFEZXZpY2VLaW5kRW51bSB9IGZyb20gXCIuLi8uLi8uLi9NZWRpYURldmljZUhhbmRsZXJcIjtcbmltcG9ydCB7IHVzZVBhcnRpY2lwYW50cyB9IGZyb20gXCIuLi8uLi8uLi9ob29rcy91c2VDYWxsXCI7XG5pbXBvcnQgeyBDYWxsU3RvcmUgfSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL0NhbGxTdG9yZVwiO1xuaW1wb3J0IHsgQ2FsbCB9IGZyb20gXCIuLi8uLi8uLi9tb2RlbHMvQ2FsbFwiO1xuaW1wb3J0IEljb25pemVkQ29udGV4dE1lbnUsIHtcbiAgICBJY29uaXplZENvbnRleHRNZW51T3B0aW9uLFxuICAgIEljb25pemVkQ29udGV4dE1lbnVPcHRpb25MaXN0LFxufSBmcm9tIFwiLi4vY29udGV4dF9tZW51cy9JY29uaXplZENvbnRleHRNZW51XCI7XG5pbXBvcnQgeyBhYm92ZUxlZnRPZiwgQ29udGV4dE1lbnVCdXR0b24sIHVzZUNvbnRleHRNZW51IH0gZnJvbSBcIi4uLy4uL3N0cnVjdHVyZXMvQ29udGV4dE1lbnVcIjtcbmltcG9ydCB7IEFsaWdubWVudCB9IGZyb20gXCIuLi9lbGVtZW50cy9Ub29sdGlwXCI7XG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tIFwiLi4vZWxlbWVudHMvQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IEFjY2Vzc2libGVUb29sdGlwQnV0dG9uIGZyb20gXCIuLi9lbGVtZW50cy9BY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvblwiO1xuaW1wb3J0IEZhY2VQaWxlIGZyb20gXCIuLi9lbGVtZW50cy9GYWNlUGlsZVwiO1xuaW1wb3J0IE1lbWJlckF2YXRhciBmcm9tIFwiLi4vYXZhdGFycy9NZW1iZXJBdmF0YXJcIjtcblxuaW50ZXJmYWNlIERldmljZUJ1dHRvblByb3BzIHtcbiAgICBraW5kOiBzdHJpbmc7XG4gICAgZGV2aWNlczogTWVkaWFEZXZpY2VJbmZvW107XG4gICAgc2V0RGV2aWNlOiAoZGV2aWNlOiBNZWRpYURldmljZUluZm8pID0+IHZvaWQ7XG4gICAgZGV2aWNlTGlzdExhYmVsOiBzdHJpbmc7XG4gICAgZmFsbGJhY2tEZXZpY2VMYWJlbDogKG46IG51bWJlcikgPT4gc3RyaW5nO1xuICAgIG11dGVkOiBib29sZWFuO1xuICAgIGRpc2FibGVkOiBib29sZWFuO1xuICAgIHRvZ2dsZTogKCkgPT4gdm9pZDtcbiAgICB1bm11dGVkVGl0bGU6IHN0cmluZztcbiAgICBtdXRlZFRpdGxlOiBzdHJpbmc7XG59XG5cbmNvbnN0IERldmljZUJ1dHRvbjogRkM8RGV2aWNlQnV0dG9uUHJvcHM+ID0gKHtcbiAgICBraW5kLCBkZXZpY2VzLCBzZXREZXZpY2UsIGRldmljZUxpc3RMYWJlbCwgZmFsbGJhY2tEZXZpY2VMYWJlbCwgbXV0ZWQsIGRpc2FibGVkLCB0b2dnbGUsIHVubXV0ZWRUaXRsZSwgbXV0ZWRUaXRsZSxcbn0pID0+IHtcbiAgICBjb25zdCBbbWVudURpc3BsYXllZCwgYnV0dG9uUmVmLCBvcGVuTWVudSwgY2xvc2VNZW51XSA9IHVzZUNvbnRleHRNZW51KCk7XG4gICAgbGV0IGNvbnRleHRNZW51O1xuICAgIGlmIChtZW51RGlzcGxheWVkKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdERldmljZSA9IChkZXZpY2U6IE1lZGlhRGV2aWNlSW5mbykgPT4ge1xuICAgICAgICAgICAgc2V0RGV2aWNlKGRldmljZSk7XG4gICAgICAgICAgICBjbG9zZU1lbnUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBidXR0b25SZWN0ID0gYnV0dG9uUmVmLmN1cnJlbnQhLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjb250ZXh0TWVudSA9IDxJY29uaXplZENvbnRleHRNZW51IHsuLi5hYm92ZUxlZnRPZihidXR0b25SZWN0KX0gb25GaW5pc2hlZD17Y2xvc2VNZW51fT5cbiAgICAgICAgICAgIDxJY29uaXplZENvbnRleHRNZW51T3B0aW9uTGlzdD5cbiAgICAgICAgICAgICAgICB7IGRldmljZXMubWFwKChkLCBpbmRleCkgPT5cbiAgICAgICAgICAgICAgICAgICAgPEljb25pemVkQ29udGV4dE1lbnVPcHRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGtleT17ZC5kZXZpY2VJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPXtkLmxhYmVsIHx8IGZhbGxiYWNrRGV2aWNlTGFiZWwoaW5kZXggKyAxKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNlbGVjdERldmljZShkKX1cbiAgICAgICAgICAgICAgICAgICAgLz4sXG4gICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICA8L0ljb25pemVkQ29udGV4dE1lbnVPcHRpb25MaXN0PlxuICAgICAgICA8L0ljb25pemVkQ29udGV4dE1lbnU+O1xuICAgIH1cblxuICAgIGlmICghZGV2aWNlcy5sZW5ndGgpIHJldHVybiBudWxsO1xuXG4gICAgcmV0dXJuIDxkaXZcbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwibXhfQ2FsbExvYmJ5X2RldmljZUJ1dHRvbldyYXBwZXJcIiwge1xuICAgICAgICAgICAgXCJteF9DYWxsTG9iYnlfZGV2aWNlQnV0dG9uV3JhcHBlcl9tdXRlZFwiOiBtdXRlZCxcbiAgICAgICAgfSl9XG4gICAgPlxuICAgICAgICA8QWNjZXNzaWJsZVRvb2x0aXBCdXR0b25cbiAgICAgICAgICAgIGNsYXNzTmFtZT17YG14X0NhbGxMb2JieV9kZXZpY2VCdXR0b24gbXhfQ2FsbExvYmJ5X2RldmljZUJ1dHRvbl8ke2tpbmR9YH1cbiAgICAgICAgICAgIHRpdGxlPXttdXRlZCA/IG11dGVkVGl0bGUgOiB1bm11dGVkVGl0bGV9XG4gICAgICAgICAgICBhbGlnbm1lbnQ9e0FsaWdubWVudC5Ub3B9XG4gICAgICAgICAgICBvbkNsaWNrPXt0b2dnbGV9XG4gICAgICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgIC8+XG4gICAgICAgIHsgZGV2aWNlcy5sZW5ndGggPiAxID8gKFxuICAgICAgICAgICAgPENvbnRleHRNZW51QnV0dG9uXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfQ2FsbExvYmJ5X2RldmljZUxpc3RCdXR0b25cIlxuICAgICAgICAgICAgICAgIGlucHV0UmVmPXtidXR0b25SZWZ9XG4gICAgICAgICAgICAgICAgb25DbGljaz17b3Blbk1lbnV9XG4gICAgICAgICAgICAgICAgaXNFeHBhbmRlZD17bWVudURpc3BsYXllZH1cbiAgICAgICAgICAgICAgICBsYWJlbD17ZGV2aWNlTGlzdExhYmVsfVxuICAgICAgICAgICAgICAgIGRpc2FibGVkPXtkaXNhYmxlZH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICkgOiBudWxsIH1cbiAgICAgICAgeyBjb250ZXh0TWVudSB9XG4gICAgPC9kaXY+O1xufTtcblxuY29uc3QgTUFYX0ZBQ0VTID0gODtcblxuaW50ZXJmYWNlIFByb3BzIHtcbiAgICByb29tOiBSb29tO1xuICAgIGNhbGw6IENhbGw7XG59XG5cbmV4cG9ydCBjb25zdCBDYWxsTG9iYnk6IEZDPFByb3BzPiA9ICh7IHJvb20sIGNhbGwgfSkgPT4ge1xuICAgIGNvbnN0IFtjb25uZWN0aW5nLCBzZXRDb25uZWN0aW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBtZSA9IHVzZU1lbW8oKCkgPT4gcm9vbS5nZXRNZW1iZXIocm9vbS5teVVzZXJJZCkhLCBbcm9vbV0pO1xuICAgIGNvbnN0IHBhcnRpY2lwYW50cyA9IHVzZVBhcnRpY2lwYW50cyhjYWxsKTtcbiAgICBjb25zdCB2aWRlb1JlZiA9IHVzZVJlZjxIVE1MVmlkZW9FbGVtZW50PihudWxsKTtcblxuICAgIGNvbnN0IFthdWRpb0lucHV0cywgdmlkZW9JbnB1dHNdID0gdXNlQXN5bmNNZW1vKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGRldmljZXMgPSBhd2FpdCBNZWRpYURldmljZUhhbmRsZXIuZ2V0RGV2aWNlcygpO1xuICAgICAgICAgICAgcmV0dXJuIFtkZXZpY2VzW01lZGlhRGV2aWNlS2luZEVudW0uQXVkaW9JbnB1dF0sIGRldmljZXNbTWVkaWFEZXZpY2VLaW5kRW51bS5WaWRlb0lucHV0XV07XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKGBGYWlsZWQgdG8gZ2V0IG1lZGlhIGRldmljZSBsaXN0YCwgZSk7XG4gICAgICAgICAgICByZXR1cm4gW1tdLCBbXV07XG4gICAgICAgIH1cbiAgICB9LCBbXSwgW1tdLCBbXV0pO1xuXG4gICAgY29uc3QgW3ZpZGVvSW5wdXRJZCwgc2V0VmlkZW9JbnB1dElkXSA9IHVzZVN0YXRlPHN0cmluZz4oKCkgPT4gTWVkaWFEZXZpY2VIYW5kbGVyLmdldFZpZGVvSW5wdXQoKSk7XG5cbiAgICBjb25zdCBzZXRBdWRpb0lucHV0ID0gdXNlQ2FsbGJhY2soKGRldmljZTogTWVkaWFEZXZpY2VJbmZvKSA9PiB7XG4gICAgICAgIE1lZGlhRGV2aWNlSGFuZGxlci5pbnN0YW5jZS5zZXRBdWRpb0lucHV0KGRldmljZS5kZXZpY2VJZCk7XG4gICAgfSwgW10pO1xuICAgIGNvbnN0IHNldFZpZGVvSW5wdXQgPSB1c2VDYWxsYmFjaygoZGV2aWNlOiBNZWRpYURldmljZUluZm8pID0+IHtcbiAgICAgICAgTWVkaWFEZXZpY2VIYW5kbGVyLmluc3RhbmNlLnNldFZpZGVvSW5wdXQoZGV2aWNlLmRldmljZUlkKTtcbiAgICAgICAgc2V0VmlkZW9JbnB1dElkKGRldmljZS5kZXZpY2VJZCk7XG4gICAgfSwgW10pO1xuXG4gICAgY29uc3QgW2F1ZGlvTXV0ZWQsIHNldEF1ZGlvTXV0ZWRdID0gdXNlU3RhdGUoKCkgPT4gTWVkaWFEZXZpY2VIYW5kbGVyLnN0YXJ0V2l0aEF1ZGlvTXV0ZWQpO1xuICAgIGNvbnN0IFt2aWRlb011dGVkLCBzZXRWaWRlb011dGVkXSA9IHVzZVN0YXRlKCgpID0+IE1lZGlhRGV2aWNlSGFuZGxlci5zdGFydFdpdGhWaWRlb011dGVkKTtcblxuICAgIGNvbnN0IHRvZ2dsZUF1ZGlvID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgICBNZWRpYURldmljZUhhbmRsZXIuc3RhcnRXaXRoQXVkaW9NdXRlZCA9ICFhdWRpb011dGVkO1xuICAgICAgICBzZXRBdWRpb011dGVkKCFhdWRpb011dGVkKTtcbiAgICB9LCBbYXVkaW9NdXRlZCwgc2V0QXVkaW9NdXRlZF0pO1xuICAgIGNvbnN0IHRvZ2dsZVZpZGVvID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgICBNZWRpYURldmljZUhhbmRsZXIuc3RhcnRXaXRoVmlkZW9NdXRlZCA9ICF2aWRlb011dGVkO1xuICAgICAgICBzZXRWaWRlb011dGVkKCF2aWRlb011dGVkKTtcbiAgICB9LCBbdmlkZW9NdXRlZCwgc2V0VmlkZW9NdXRlZF0pO1xuXG4gICAgY29uc3QgdmlkZW9TdHJlYW0gPSB1c2VBc3luY01lbW8oYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAodmlkZW9JbnB1dElkICYmICF2aWRlb011dGVkKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7XG4gICAgICAgICAgICAgICAgICAgIHZpZGVvOiB7IGRldmljZUlkOiB2aWRlb0lucHV0SWQgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoYEZhaWxlZCB0byBnZXQgc3RyZWFtIGZvciBkZXZpY2UgJHt2aWRlb0lucHV0SWR9YCwgZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSwgW3ZpZGVvSW5wdXRJZCwgdmlkZW9NdXRlZF0pO1xuXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKHZpZGVvU3RyZWFtKSB7XG4gICAgICAgICAgICBjb25zdCB2aWRlb0VsZW1lbnQgPSB2aWRlb1JlZi5jdXJyZW50ITtcbiAgICAgICAgICAgIHZpZGVvRWxlbWVudC5zcmNPYmplY3QgPSB2aWRlb1N0cmVhbTtcbiAgICAgICAgICAgIHZpZGVvRWxlbWVudC5wbGF5KCk7XG5cbiAgICAgICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmlkZW9TdHJlYW0/LmdldFRyYWNrcygpLmZvckVhY2godHJhY2sgPT4gdHJhY2suc3RvcCgpKTtcbiAgICAgICAgICAgICAgICB2aWRlb0VsZW1lbnQuc3JjT2JqZWN0ID0gbnVsbDtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9LCBbdmlkZW9TdHJlYW1dKTtcblxuICAgIGNvbnN0IGNvbm5lY3QgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XG4gICAgICAgIHNldENvbm5lY3RpbmcodHJ1ZSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBEaXNjb25uZWN0IGZyb20gYW55IG90aGVyIGFjdGl2ZSBjYWxscyBmaXJzdCwgc2luY2Ugd2UgZG9uJ3QgeWV0IHN1cHBvcnQgaG9sZGluZ1xuICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoWy4uLkNhbGxTdG9yZS5pbnN0YW5jZS5hY3RpdmVDYWxsc10ubWFwKGNhbGwgPT4gY2FsbC5kaXNjb25uZWN0KCkpKTtcbiAgICAgICAgICAgIGF3YWl0IGNhbGwuY29ubmVjdCgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZSk7XG4gICAgICAgICAgICBzZXRDb25uZWN0aW5nKGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH0sIFtjYWxsLCBzZXRDb25uZWN0aW5nXSk7XG5cbiAgICBsZXQgZmFjZVBpbGU6IEpTWC5FbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gICAgaWYgKHBhcnRpY2lwYW50cy5zaXplKSB7XG4gICAgICAgIGNvbnN0IHNob3duTWVtYmVycyA9IFsuLi5wYXJ0aWNpcGFudHNdLnNsaWNlKDAsIE1BWF9GQUNFUyk7XG4gICAgICAgIGNvbnN0IG92ZXJmbG93ID0gcGFydGljaXBhbnRzLnNpemUgPiBzaG93bk1lbWJlcnMubGVuZ3RoO1xuXG4gICAgICAgIGZhY2VQaWxlID0gPGRpdiBjbGFzc05hbWU9XCJteF9DYWxsTG9iYnlfcGFydGljaXBhbnRzXCI+XG4gICAgICAgICAgICB7IF90KFwiJShjb3VudClzIHBlb3BsZSBqb2luZWRcIiwgeyBjb3VudDogcGFydGljaXBhbnRzLnNpemUgfSkgfVxuICAgICAgICAgICAgPEZhY2VQaWxlIG1lbWJlcnM9e3Nob3duTWVtYmVyc30gZmFjZVNpemU9ezI0fSBvdmVyZmxvdz17b3ZlcmZsb3d9IC8+XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG5cbiAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJteF9DYWxsTG9iYnlcIj5cbiAgICAgICAgeyBmYWNlUGlsZSB9XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ2FsbExvYmJ5X3ByZXZpZXdcIj5cbiAgICAgICAgICAgIDxNZW1iZXJBdmF0YXIga2V5PXttZS51c2VySWR9IG1lbWJlcj17bWV9IHdpZHRoPXsyMDB9IGhlaWdodD17MjAwfSByZXNpemVNZXRob2Q9XCJzY2FsZVwiIC8+XG4gICAgICAgICAgICA8dmlkZW9cbiAgICAgICAgICAgICAgICByZWY9e3ZpZGVvUmVmfVxuICAgICAgICAgICAgICAgIHN0eWxlPXt7IHZpc2liaWxpdHk6IHZpZGVvTXV0ZWQgPyBcImhpZGRlblwiIDogdW5kZWZpbmVkIH19XG4gICAgICAgICAgICAgICAgbXV0ZWRcbiAgICAgICAgICAgICAgICBwbGF5c0lubGluZVxuICAgICAgICAgICAgICAgIGRpc2FibGVQaWN0dXJlSW5QaWN0dXJlXG4gICAgICAgICAgICAvPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DYWxsTG9iYnlfY29udHJvbHNcIj5cbiAgICAgICAgICAgICAgICA8RGV2aWNlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIGtpbmQ9XCJhdWRpb1wiXG4gICAgICAgICAgICAgICAgICAgIGRldmljZXM9e2F1ZGlvSW5wdXRzfVxuICAgICAgICAgICAgICAgICAgICBzZXREZXZpY2U9e3NldEF1ZGlvSW5wdXR9XG4gICAgICAgICAgICAgICAgICAgIGRldmljZUxpc3RMYWJlbD17X3QoXCJBdWRpbyBkZXZpY2VzXCIpfVxuICAgICAgICAgICAgICAgICAgICBmYWxsYmFja0RldmljZUxhYmVsPXtuID0+IF90KFwiQXVkaW8gaW5wdXQgJShuKXNcIiwgeyBuIH0pfVxuICAgICAgICAgICAgICAgICAgICBtdXRlZD17YXVkaW9NdXRlZH1cbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ9e2Nvbm5lY3Rpbmd9XG4gICAgICAgICAgICAgICAgICAgIHRvZ2dsZT17dG9nZ2xlQXVkaW99XG4gICAgICAgICAgICAgICAgICAgIHVubXV0ZWRUaXRsZT17X3QoXCJNdXRlIG1pY3JvcGhvbmVcIil9XG4gICAgICAgICAgICAgICAgICAgIG11dGVkVGl0bGU9e190KFwiVW5tdXRlIG1pY3JvcGhvbmVcIil9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8RGV2aWNlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIGtpbmQ9XCJ2aWRlb1wiXG4gICAgICAgICAgICAgICAgICAgIGRldmljZXM9e3ZpZGVvSW5wdXRzfVxuICAgICAgICAgICAgICAgICAgICBzZXREZXZpY2U9e3NldFZpZGVvSW5wdXR9XG4gICAgICAgICAgICAgICAgICAgIGRldmljZUxpc3RMYWJlbD17X3QoXCJWaWRlbyBkZXZpY2VzXCIpfVxuICAgICAgICAgICAgICAgICAgICBmYWxsYmFja0RldmljZUxhYmVsPXtuID0+IF90KFwiVmlkZW8gaW5wdXQgJShuKXNcIiwgeyBuIH0pfVxuICAgICAgICAgICAgICAgICAgICBtdXRlZD17dmlkZW9NdXRlZH1cbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ9e2Nvbm5lY3Rpbmd9XG4gICAgICAgICAgICAgICAgICAgIHRvZ2dsZT17dG9nZ2xlVmlkZW99XG4gICAgICAgICAgICAgICAgICAgIHVubXV0ZWRUaXRsZT17X3QoXCJUdXJuIG9mZiBjYW1lcmFcIil9XG4gICAgICAgICAgICAgICAgICAgIG11dGVkVGl0bGU9e190KFwiVHVybiBvbiBjYW1lcmFcIil9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPEFjY2Vzc2libGVCdXR0b25cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0NhbGxMb2JieV9jb25uZWN0QnV0dG9uXCJcbiAgICAgICAgICAgIGtpbmQ9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgIGRpc2FibGVkPXtjb25uZWN0aW5nfVxuICAgICAgICAgICAgb25DbGljaz17Y29ubmVjdH1cbiAgICAgICAgPlxuICAgICAgICAgICAgeyBfdChcIkpvaW5cIikgfVxuICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgPC9kaXY+O1xufTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBSUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQXBDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFxQ0EsTUFBTUEsWUFBbUMsR0FBRyxRQUV0QztFQUFBLElBRnVDO0lBQ3pDQyxJQUR5QztJQUNuQ0MsT0FEbUM7SUFDMUJDLFNBRDBCO0lBQ2ZDLGVBRGU7SUFDRUMsbUJBREY7SUFDdUJDLEtBRHZCO0lBQzhCQyxRQUQ5QjtJQUN3Q0MsTUFEeEM7SUFDZ0RDLFlBRGhEO0lBQzhEQztFQUQ5RCxDQUV2QztFQUNGLE1BQU0sQ0FBQ0MsYUFBRCxFQUFnQkMsU0FBaEIsRUFBMkJDLFFBQTNCLEVBQXFDQyxTQUFyQyxJQUFrRCxJQUFBQywyQkFBQSxHQUF4RDtFQUNBLElBQUlDLFdBQUo7O0VBQ0EsSUFBSUwsYUFBSixFQUFtQjtJQUNmLE1BQU1NLFlBQVksR0FBSUMsTUFBRCxJQUE2QjtNQUM5Q2YsU0FBUyxDQUFDZSxNQUFELENBQVQ7TUFDQUosU0FBUztJQUNaLENBSEQ7O0lBS0EsTUFBTUssVUFBVSxHQUFHUCxTQUFTLENBQUNRLE9BQVYsQ0FBbUJDLHFCQUFuQixFQUFuQjtJQUNBTCxXQUFXLGdCQUFHLDZCQUFDLDRCQUFELDZCQUF5QixJQUFBTSx3QkFBQSxFQUFZSCxVQUFaLENBQXpCO01BQWtELFVBQVUsRUFBRUw7SUFBOUQsaUJBQ1YsNkJBQUMsa0RBQUQsUUFDTVosT0FBTyxDQUFDcUIsR0FBUixDQUFZLENBQUNDLENBQUQsRUFBSUMsS0FBSixrQkFDViw2QkFBQyw4Q0FBRDtNQUNJLEdBQUcsRUFBRUQsQ0FBQyxDQUFDRSxRQURYO01BRUksS0FBSyxFQUFFRixDQUFDLENBQUNHLEtBQUYsSUFBV3RCLG1CQUFtQixDQUFDb0IsS0FBSyxHQUFHLENBQVQsQ0FGekM7TUFHSSxPQUFPLEVBQUUsTUFBTVIsWUFBWSxDQUFDTyxDQUFEO0lBSC9CLEVBREYsQ0FETixDQURVLENBQWQ7RUFXSDs7RUFFRCxJQUFJLENBQUN0QixPQUFPLENBQUMwQixNQUFiLEVBQXFCLE9BQU8sSUFBUDtFQUVyQixvQkFBTztJQUNILFNBQVMsRUFBRSxJQUFBQyxtQkFBQSxFQUFXLGtDQUFYLEVBQStDO01BQ3RELDBDQUEwQ3ZCO0lBRFksQ0FBL0M7RUFEUixnQkFLSCw2QkFBQyxnQ0FBRDtJQUNJLFNBQVMsRUFBRyx1REFBc0RMLElBQUssRUFEM0U7SUFFSSxLQUFLLEVBQUVLLEtBQUssR0FBR0ksVUFBSCxHQUFnQkQsWUFGaEM7SUFHSSxTQUFTLEVBQUVxQixrQkFBQSxDQUFVQyxHQUh6QjtJQUlJLE9BQU8sRUFBRXZCLE1BSmI7SUFLSSxRQUFRLEVBQUVEO0VBTGQsRUFMRyxFQVlETCxPQUFPLENBQUMwQixNQUFSLEdBQWlCLENBQWpCLGdCQUNFLDZCQUFDLDhCQUFEO0lBQ0ksU0FBUyxFQUFDLCtCQURkO0lBRUksUUFBUSxFQUFFaEIsU0FGZDtJQUdJLE9BQU8sRUFBRUMsUUFIYjtJQUlJLFVBQVUsRUFBRUYsYUFKaEI7SUFLSSxLQUFLLEVBQUVQLGVBTFg7SUFNSSxRQUFRLEVBQUVHO0VBTmQsRUFERixHQVNFLElBckJELEVBc0JEUyxXQXRCQyxDQUFQO0FBd0JILENBbkREOztBQXFEQSxNQUFNZ0IsU0FBUyxHQUFHLENBQWxCOztBQU9PLE1BQU1DLFNBQW9CLEdBQUcsU0FBb0I7RUFBQSxJQUFuQjtJQUFFQyxJQUFGO0lBQVFDO0VBQVIsQ0FBbUI7RUFDcEQsTUFBTSxDQUFDQyxVQUFELEVBQWFDLGFBQWIsSUFBOEIsSUFBQUMsZUFBQSxFQUFTLEtBQVQsQ0FBcEM7RUFDQSxNQUFNQyxFQUFFLEdBQUcsSUFBQUMsY0FBQSxFQUFRLE1BQU1OLElBQUksQ0FBQ08sU0FBTCxDQUFlUCxJQUFJLENBQUNRLFFBQXBCLENBQWQsRUFBOEMsQ0FBQ1IsSUFBRCxDQUE5QyxDQUFYO0VBQ0EsTUFBTVMsWUFBWSxHQUFHLElBQUFDLHdCQUFBLEVBQWdCVCxJQUFoQixDQUFyQjtFQUNBLE1BQU1VLFFBQVEsR0FBRyxJQUFBQyxhQUFBLEVBQXlCLElBQXpCLENBQWpCO0VBRUEsTUFBTSxDQUFDQyxXQUFELEVBQWNDLFdBQWQsSUFBNkIsSUFBQUMsMEJBQUEsRUFBYSxZQUFZO0lBQ3hELElBQUk7TUFDQSxNQUFNL0MsT0FBTyxHQUFHLE1BQU1nRCwyQkFBQSxDQUFtQkMsVUFBbkIsRUFBdEI7TUFDQSxPQUFPLENBQUNqRCxPQUFPLENBQUNrRCx1Q0FBQSxDQUFvQkMsVUFBckIsQ0FBUixFQUEwQ25ELE9BQU8sQ0FBQ2tELHVDQUFBLENBQW9CRSxVQUFyQixDQUFqRCxDQUFQO0lBQ0gsQ0FIRCxDQUdFLE9BQU9DLENBQVAsRUFBVTtNQUNSQyxjQUFBLENBQU9DLElBQVAsQ0FBYSxpQ0FBYixFQUErQ0YsQ0FBL0M7O01BQ0EsT0FBTyxDQUFDLEVBQUQsRUFBSyxFQUFMLENBQVA7SUFDSDtFQUNKLENBUmtDLEVBUWhDLEVBUmdDLEVBUTVCLENBQUMsRUFBRCxFQUFLLEVBQUwsQ0FSNEIsQ0FBbkM7RUFVQSxNQUFNLENBQUNHLFlBQUQsRUFBZUMsZUFBZixJQUFrQyxJQUFBckIsZUFBQSxFQUFpQixNQUFNWSwyQkFBQSxDQUFtQlUsYUFBbkIsRUFBdkIsQ0FBeEM7RUFFQSxNQUFNQyxhQUFhLEdBQUcsSUFBQUMsa0JBQUEsRUFBYTVDLE1BQUQsSUFBNkI7SUFDM0RnQywyQkFBQSxDQUFtQmEsUUFBbkIsQ0FBNEJGLGFBQTVCLENBQTBDM0MsTUFBTSxDQUFDUSxRQUFqRDtFQUNILENBRnFCLEVBRW5CLEVBRm1CLENBQXRCO0VBR0EsTUFBTXNDLGFBQWEsR0FBRyxJQUFBRixrQkFBQSxFQUFhNUMsTUFBRCxJQUE2QjtJQUMzRGdDLDJCQUFBLENBQW1CYSxRQUFuQixDQUE0QkMsYUFBNUIsQ0FBMEM5QyxNQUFNLENBQUNRLFFBQWpEOztJQUNBaUMsZUFBZSxDQUFDekMsTUFBTSxDQUFDUSxRQUFSLENBQWY7RUFDSCxDQUhxQixFQUduQixFQUhtQixDQUF0QjtFQUtBLE1BQU0sQ0FBQ3VDLFVBQUQsRUFBYUMsYUFBYixJQUE4QixJQUFBNUIsZUFBQSxFQUFTLE1BQU1ZLDJCQUFBLENBQW1CaUIsbUJBQWxDLENBQXBDO0VBQ0EsTUFBTSxDQUFDQyxVQUFELEVBQWFDLGFBQWIsSUFBOEIsSUFBQS9CLGVBQUEsRUFBUyxNQUFNWSwyQkFBQSxDQUFtQm9CLG1CQUFsQyxDQUFwQztFQUVBLE1BQU1DLFdBQVcsR0FBRyxJQUFBVCxrQkFBQSxFQUFZLE1BQU07SUFDbENaLDJCQUFBLENBQW1CaUIsbUJBQW5CLEdBQXlDLENBQUNGLFVBQTFDO0lBQ0FDLGFBQWEsQ0FBQyxDQUFDRCxVQUFGLENBQWI7RUFDSCxDQUhtQixFQUdqQixDQUFDQSxVQUFELEVBQWFDLGFBQWIsQ0FIaUIsQ0FBcEI7RUFJQSxNQUFNTSxXQUFXLEdBQUcsSUFBQVYsa0JBQUEsRUFBWSxNQUFNO0lBQ2xDWiwyQkFBQSxDQUFtQm9CLG1CQUFuQixHQUF5QyxDQUFDRixVQUExQztJQUNBQyxhQUFhLENBQUMsQ0FBQ0QsVUFBRixDQUFiO0VBQ0gsQ0FIbUIsRUFHakIsQ0FBQ0EsVUFBRCxFQUFhQyxhQUFiLENBSGlCLENBQXBCO0VBS0EsTUFBTUksV0FBVyxHQUFHLElBQUF4QiwwQkFBQSxFQUFhLFlBQVk7SUFDekMsSUFBSVMsWUFBWSxJQUFJLENBQUNVLFVBQXJCLEVBQWlDO01BQzdCLElBQUk7UUFDQSxPQUFPLE1BQU1NLFNBQVMsQ0FBQ0MsWUFBVixDQUF1QkMsWUFBdkIsQ0FBb0M7VUFDN0NDLEtBQUssRUFBRTtZQUFFbkQsUUFBUSxFQUFFZ0M7VUFBWjtRQURzQyxDQUFwQyxDQUFiO01BR0gsQ0FKRCxDQUlFLE9BQU9ILENBQVAsRUFBVTtRQUNSQyxjQUFBLENBQU9zQixLQUFQLENBQWMsbUNBQWtDcEIsWUFBYSxFQUE3RCxFQUFnRUgsQ0FBaEU7TUFDSDtJQUNKOztJQUNELE9BQU8sSUFBUDtFQUNILENBWG1CLEVBV2pCLENBQUNHLFlBQUQsRUFBZVUsVUFBZixDQVhpQixDQUFwQjtFQWFBLElBQUFXLGdCQUFBLEVBQVUsTUFBTTtJQUNaLElBQUlOLFdBQUosRUFBaUI7TUFDYixNQUFNTyxZQUFZLEdBQUduQyxRQUFRLENBQUN6QixPQUE5QjtNQUNBNEQsWUFBWSxDQUFDQyxTQUFiLEdBQXlCUixXQUF6QjtNQUNBTyxZQUFZLENBQUNFLElBQWI7TUFFQSxPQUFPLE1BQU07UUFDVFQsV0FBVyxFQUFFVSxTQUFiLEdBQXlCQyxPQUF6QixDQUFpQ0MsS0FBSyxJQUFJQSxLQUFLLENBQUNDLElBQU4sRUFBMUM7UUFDQU4sWUFBWSxDQUFDQyxTQUFiLEdBQXlCLElBQXpCO01BQ0gsQ0FIRDtJQUlIO0VBQ0osQ0FYRCxFQVdHLENBQUNSLFdBQUQsQ0FYSDtFQWFBLE1BQU1jLE9BQU8sR0FBRyxJQUFBekIsa0JBQUEsRUFBWSxZQUFZO0lBQ3BDekIsYUFBYSxDQUFDLElBQUQsQ0FBYjs7SUFDQSxJQUFJO01BQ0E7TUFDQSxNQUFNbUQsT0FBTyxDQUFDQyxHQUFSLENBQVksQ0FBQyxHQUFHQyxvQkFBQSxDQUFVM0IsUUFBVixDQUFtQjRCLFdBQXZCLEVBQW9DcEUsR0FBcEMsQ0FBd0NZLElBQUksSUFBSUEsSUFBSSxDQUFDeUQsVUFBTCxFQUFoRCxDQUFaLENBQU47TUFDQSxNQUFNekQsSUFBSSxDQUFDb0QsT0FBTCxFQUFOO0lBQ0gsQ0FKRCxDQUlFLE9BQU9oQyxDQUFQLEVBQVU7TUFDUkMsY0FBQSxDQUFPc0IsS0FBUCxDQUFhdkIsQ0FBYjs7TUFDQWxCLGFBQWEsQ0FBQyxLQUFELENBQWI7SUFDSDtFQUNKLENBVmUsRUFVYixDQUFDRixJQUFELEVBQU9FLGFBQVAsQ0FWYSxDQUFoQjtFQVlBLElBQUl3RCxRQUE0QixHQUFHLElBQW5DOztFQUNBLElBQUlsRCxZQUFZLENBQUNtRCxJQUFqQixFQUF1QjtJQUNuQixNQUFNQyxZQUFZLEdBQUcsQ0FBQyxHQUFHcEQsWUFBSixFQUFrQnFELEtBQWxCLENBQXdCLENBQXhCLEVBQTJCaEUsU0FBM0IsQ0FBckI7SUFDQSxNQUFNaUUsUUFBUSxHQUFHdEQsWUFBWSxDQUFDbUQsSUFBYixHQUFvQkMsWUFBWSxDQUFDbkUsTUFBbEQ7SUFFQWlFLFFBQVEsZ0JBQUc7TUFBSyxTQUFTLEVBQUM7SUFBZixHQUNMLElBQUFLLG1CQUFBLEVBQUcseUJBQUgsRUFBOEI7TUFBRUMsS0FBSyxFQUFFeEQsWUFBWSxDQUFDbUQ7SUFBdEIsQ0FBOUIsQ0FESyxlQUVQLDZCQUFDLGlCQUFEO01BQVUsT0FBTyxFQUFFQyxZQUFuQjtNQUFpQyxRQUFRLEVBQUUsRUFBM0M7TUFBK0MsUUFBUSxFQUFFRTtJQUF6RCxFQUZPLENBQVg7RUFJSDs7RUFFRCxvQkFBTztJQUFLLFNBQVMsRUFBQztFQUFmLEdBQ0RKLFFBREMsZUFFSDtJQUFLLFNBQVMsRUFBQztFQUFmLGdCQUNJLDZCQUFDLHFCQUFEO0lBQWMsR0FBRyxFQUFFdEQsRUFBRSxDQUFDNkQsTUFBdEI7SUFBOEIsTUFBTSxFQUFFN0QsRUFBdEM7SUFBMEMsS0FBSyxFQUFFLEdBQWpEO0lBQXNELE1BQU0sRUFBRSxHQUE5RDtJQUFtRSxZQUFZLEVBQUM7RUFBaEYsRUFESixlQUVJO0lBQ0ksR0FBRyxFQUFFTSxRQURUO0lBRUksS0FBSyxFQUFFO01BQUV3RCxVQUFVLEVBQUVqQyxVQUFVLEdBQUcsUUFBSCxHQUFja0M7SUFBdEMsQ0FGWDtJQUdJLEtBQUssTUFIVDtJQUlJLFdBQVcsTUFKZjtJQUtJLHVCQUF1QjtFQUwzQixFQUZKLGVBU0k7SUFBSyxTQUFTLEVBQUM7RUFBZixnQkFDSSw2QkFBQyxZQUFEO0lBQ0ksSUFBSSxFQUFDLE9BRFQ7SUFFSSxPQUFPLEVBQUV2RCxXQUZiO0lBR0ksU0FBUyxFQUFFYyxhQUhmO0lBSUksZUFBZSxFQUFFLElBQUFxQyxtQkFBQSxFQUFHLGVBQUgsQ0FKckI7SUFLSSxtQkFBbUIsRUFBRUssQ0FBQyxJQUFJLElBQUFMLG1CQUFBLEVBQUcsbUJBQUgsRUFBd0I7TUFBRUs7SUFBRixDQUF4QixDQUw5QjtJQU1JLEtBQUssRUFBRXRDLFVBTlg7SUFPSSxRQUFRLEVBQUU3QixVQVBkO0lBUUksTUFBTSxFQUFFbUMsV0FSWjtJQVNJLFlBQVksRUFBRSxJQUFBMkIsbUJBQUEsRUFBRyxpQkFBSCxDQVRsQjtJQVVJLFVBQVUsRUFBRSxJQUFBQSxtQkFBQSxFQUFHLG1CQUFIO0VBVmhCLEVBREosZUFhSSw2QkFBQyxZQUFEO0lBQ0ksSUFBSSxFQUFDLE9BRFQ7SUFFSSxPQUFPLEVBQUVsRCxXQUZiO0lBR0ksU0FBUyxFQUFFZ0IsYUFIZjtJQUlJLGVBQWUsRUFBRSxJQUFBa0MsbUJBQUEsRUFBRyxlQUFILENBSnJCO0lBS0ksbUJBQW1CLEVBQUVLLENBQUMsSUFBSSxJQUFBTCxtQkFBQSxFQUFHLG1CQUFILEVBQXdCO01BQUVLO0lBQUYsQ0FBeEIsQ0FMOUI7SUFNSSxLQUFLLEVBQUVuQyxVQU5YO0lBT0ksUUFBUSxFQUFFaEMsVUFQZDtJQVFJLE1BQU0sRUFBRW9DLFdBUlo7SUFTSSxZQUFZLEVBQUUsSUFBQTBCLG1CQUFBLEVBQUcsaUJBQUgsQ0FUbEI7SUFVSSxVQUFVLEVBQUUsSUFBQUEsbUJBQUEsRUFBRyxnQkFBSDtFQVZoQixFQWJKLENBVEosQ0FGRyxlQXNDSCw2QkFBQyx5QkFBRDtJQUNJLFNBQVMsRUFBQyw0QkFEZDtJQUVJLElBQUksRUFBQyxTQUZUO0lBR0ksUUFBUSxFQUFFOUQsVUFIZDtJQUlJLE9BQU8sRUFBRW1EO0VBSmIsR0FNTSxJQUFBVyxtQkFBQSxFQUFHLE1BQUgsQ0FOTixDQXRDRyxDQUFQO0FBK0NILENBdElNIn0=
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _classnames = _interopRequireDefault(require("classnames"));

var _react = _interopRequireWildcard(require("react"));

var _useEventEmitter = require("../../../hooks/useEventEmitter");

var _languageHandler = require("../../../languageHandler");

var _OwnBeaconStore = require("../../../stores/OwnBeaconStore");

var _liveLocation = require("../../../../res/img/location/live-location.svg");

var _actions = require("../../../dispatcher/actions");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2022 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

/**
 * Choose the most relevant beacon
 */
const chooseBestBeacon = (liveBeaconIds, updateErrorBeaconIds, locationErrorBeaconIds) => {
  // both lists are ordered by creation timestamp in store
  // so select latest beacon
  const beaconId = updateErrorBeaconIds?.[0] ?? locationErrorBeaconIds?.[0] ?? liveBeaconIds?.[0];

  if (!beaconId) {
    return undefined;
  }

  const beacon = _OwnBeaconStore.OwnBeaconStore.instance.getBeaconById(beaconId);

  return beacon;
};

const getLabel = (hasStoppingErrors, hasLocationErrors) => {
  if (hasStoppingErrors) {
    return (0, _languageHandler._t)('An error occurred while stopping your live location');
  }

  if (hasLocationErrors) {
    return (0, _languageHandler._t)('An error occurred whilst sharing your live location');
  }

  return (0, _languageHandler._t)('You are sharing your live location');
};

const useLivenessMonitor = (liveBeaconIds, beacons) => {
  (0, _react.useEffect)(() => {
    // chromium sets the minimum timer interval to 1000ms
    // for inactive tabs
    // refresh beacon monitors when the tab becomes active again
    const onPageVisibilityChanged = () => {
      if (document.visibilityState === 'visible') {
        liveBeaconIds.forEach(identifier => beacons.get(identifier)?.monitorLiveness());
      }
    };

    if (liveBeaconIds.length) {
      document.addEventListener("visibilitychange", onPageVisibilityChanged);
    }

    return () => {
      document.removeEventListener("visibilitychange", onPageVisibilityChanged);
    };
  }, [liveBeaconIds, beacons]);
};

const LeftPanelLiveShareWarning = _ref => {
  let {
    isMinimized
  } = _ref;
  const isMonitoringLiveLocation = (0, _useEventEmitter.useEventEmitterState)(_OwnBeaconStore.OwnBeaconStore.instance, _OwnBeaconStore.OwnBeaconStoreEvent.MonitoringLivePosition, () => _OwnBeaconStore.OwnBeaconStore.instance.isMonitoringLiveLocation);
  const beaconIdsWithLocationPublishError = (0, _useEventEmitter.useEventEmitterState)(_OwnBeaconStore.OwnBeaconStore.instance, _OwnBeaconStore.OwnBeaconStoreEvent.LocationPublishError, () => _OwnBeaconStore.OwnBeaconStore.instance.getLiveBeaconIdsWithLocationPublishError());
  const beaconIdsWithStoppingError = (0, _useEventEmitter.useEventEmitterState)(_OwnBeaconStore.OwnBeaconStore.instance, _OwnBeaconStore.OwnBeaconStoreEvent.BeaconUpdateError, () => _OwnBeaconStore.OwnBeaconStore.instance.getLiveBeaconIds().filter(beaconId => _OwnBeaconStore.OwnBeaconStore.instance.beaconUpdateErrors.has(beaconId)));
  const liveBeaconIds = (0, _useEventEmitter.useEventEmitterState)(_OwnBeaconStore.OwnBeaconStore.instance, _OwnBeaconStore.OwnBeaconStoreEvent.LivenessChange, () => _OwnBeaconStore.OwnBeaconStore.instance.getLiveBeaconIds());
  const hasLocationPublishErrors = !!beaconIdsWithLocationPublishError.length;
  const hasStoppingErrors = !!beaconIdsWithStoppingError.length;
  useLivenessMonitor(liveBeaconIds, _OwnBeaconStore.OwnBeaconStore.instance.beacons);

  if (!isMonitoringLiveLocation) {
    return null;
  }

  const relevantBeacon = chooseBestBeacon(liveBeaconIds, beaconIdsWithStoppingError, beaconIdsWithLocationPublishError);
  const onWarningClick = relevantBeacon ? () => {
    _dispatcher.default.dispatch({
      action: _actions.Action.ViewRoom,
      room_id: relevantBeacon.roomId,
      metricsTrigger: undefined,
      event_id: relevantBeacon.beaconInfoId,
      scroll_into_view: true,
      highlighted: true
    });
  } : undefined;
  const label = getLabel(hasStoppingErrors, hasLocationPublishErrors);
  return /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
    className: (0, _classnames.default)('mx_LeftPanelLiveShareWarning', {
      'mx_LeftPanelLiveShareWarning__minimized': isMinimized,
      'mx_LeftPanelLiveShareWarning__error': hasLocationPublishErrors || hasStoppingErrors
    }),
    title: isMinimized ? label : undefined,
    onClick: onWarningClick
  }, isMinimized ? /*#__PURE__*/_react.default.createElement(_liveLocation.Icon, {
    height: 10
  }) : label);
};

var _default = LeftPanelLiveShareWarning;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjaG9vc2VCZXN0QmVhY29uIiwibGl2ZUJlYWNvbklkcyIsInVwZGF0ZUVycm9yQmVhY29uSWRzIiwibG9jYXRpb25FcnJvckJlYWNvbklkcyIsImJlYWNvbklkIiwidW5kZWZpbmVkIiwiYmVhY29uIiwiT3duQmVhY29uU3RvcmUiLCJpbnN0YW5jZSIsImdldEJlYWNvbkJ5SWQiLCJnZXRMYWJlbCIsImhhc1N0b3BwaW5nRXJyb3JzIiwiaGFzTG9jYXRpb25FcnJvcnMiLCJfdCIsInVzZUxpdmVuZXNzTW9uaXRvciIsImJlYWNvbnMiLCJ1c2VFZmZlY3QiLCJvblBhZ2VWaXNpYmlsaXR5Q2hhbmdlZCIsImRvY3VtZW50IiwidmlzaWJpbGl0eVN0YXRlIiwiZm9yRWFjaCIsImlkZW50aWZpZXIiLCJnZXQiLCJtb25pdG9yTGl2ZW5lc3MiLCJsZW5ndGgiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIkxlZnRQYW5lbExpdmVTaGFyZVdhcm5pbmciLCJpc01pbmltaXplZCIsImlzTW9uaXRvcmluZ0xpdmVMb2NhdGlvbiIsInVzZUV2ZW50RW1pdHRlclN0YXRlIiwiT3duQmVhY29uU3RvcmVFdmVudCIsIk1vbml0b3JpbmdMaXZlUG9zaXRpb24iLCJiZWFjb25JZHNXaXRoTG9jYXRpb25QdWJsaXNoRXJyb3IiLCJMb2NhdGlvblB1Ymxpc2hFcnJvciIsImdldExpdmVCZWFjb25JZHNXaXRoTG9jYXRpb25QdWJsaXNoRXJyb3IiLCJiZWFjb25JZHNXaXRoU3RvcHBpbmdFcnJvciIsIkJlYWNvblVwZGF0ZUVycm9yIiwiZ2V0TGl2ZUJlYWNvbklkcyIsImZpbHRlciIsImJlYWNvblVwZGF0ZUVycm9ycyIsImhhcyIsIkxpdmVuZXNzQ2hhbmdlIiwiaGFzTG9jYXRpb25QdWJsaXNoRXJyb3JzIiwicmVsZXZhbnRCZWFjb24iLCJvbldhcm5pbmdDbGljayIsImRpc3BhdGNoZXIiLCJkaXNwYXRjaCIsImFjdGlvbiIsIkFjdGlvbiIsIlZpZXdSb29tIiwicm9vbV9pZCIsInJvb21JZCIsIm1ldHJpY3NUcmlnZ2VyIiwiZXZlbnRfaWQiLCJiZWFjb25JbmZvSWQiLCJzY3JvbGxfaW50b192aWV3IiwiaGlnaGxpZ2h0ZWQiLCJsYWJlbCIsImNsYXNzTmFtZXMiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy92aWV3cy9iZWFjb24vTGVmdFBhbmVsTGl2ZVNoYXJlV2FybmluZy50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIyIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgQmVhY29uLCBCZWFjb25JZGVudGlmaWVyIH0gZnJvbSAnbWF0cml4LWpzLXNkay9zcmMvbWF0cml4JztcblxuaW1wb3J0IHsgdXNlRXZlbnRFbWl0dGVyU3RhdGUgfSBmcm9tICcuLi8uLi8uLi9ob29rcy91c2VFdmVudEVtaXR0ZXInO1xuaW1wb3J0IHsgX3QgfSBmcm9tICcuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IHsgT3duQmVhY29uU3RvcmUsIE93bkJlYWNvblN0b3JlRXZlbnQgfSBmcm9tICcuLi8uLi8uLi9zdG9yZXMvT3duQmVhY29uU3RvcmUnO1xuaW1wb3J0IHsgSWNvbiBhcyBMaXZlTG9jYXRpb25JY29uIH0gZnJvbSAnLi4vLi4vLi4vLi4vcmVzL2ltZy9sb2NhdGlvbi9saXZlLWxvY2F0aW9uLnN2Zyc7XG5pbXBvcnQgeyBWaWV3Um9vbVBheWxvYWQgfSBmcm9tICcuLi8uLi8uLi9kaXNwYXRjaGVyL3BheWxvYWRzL1ZpZXdSb29tUGF5bG9hZCc7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tICcuLi8uLi8uLi9kaXNwYXRjaGVyL2FjdGlvbnMnO1xuaW1wb3J0IGRpc3BhdGNoZXIgZnJvbSAnLi4vLi4vLi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyJztcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gJy4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b24nO1xuXG5pbnRlcmZhY2UgUHJvcHMge1xuICAgIGlzTWluaW1pemVkPzogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBDaG9vc2UgdGhlIG1vc3QgcmVsZXZhbnQgYmVhY29uXG4gKi9cbmNvbnN0IGNob29zZUJlc3RCZWFjb24gPSAoXG4gICAgbGl2ZUJlYWNvbklkczogQmVhY29uSWRlbnRpZmllcltdLFxuICAgIHVwZGF0ZUVycm9yQmVhY29uSWRzOiBCZWFjb25JZGVudGlmaWVyW10sXG4gICAgbG9jYXRpb25FcnJvckJlYWNvbklkczogQmVhY29uSWRlbnRpZmllcltdLFxuKTogQmVhY29uIHwgdW5kZWZpbmVkID0+IHtcbiAgICAvLyBib3RoIGxpc3RzIGFyZSBvcmRlcmVkIGJ5IGNyZWF0aW9uIHRpbWVzdGFtcCBpbiBzdG9yZVxuICAgIC8vIHNvIHNlbGVjdCBsYXRlc3QgYmVhY29uXG4gICAgY29uc3QgYmVhY29uSWQgPSB1cGRhdGVFcnJvckJlYWNvbklkcz8uWzBdID8/IGxvY2F0aW9uRXJyb3JCZWFjb25JZHM/LlswXSA/PyBsaXZlQmVhY29uSWRzPy5bMF07XG4gICAgaWYgKCFiZWFjb25JZCkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBjb25zdCBiZWFjb24gPSBPd25CZWFjb25TdG9yZS5pbnN0YW5jZS5nZXRCZWFjb25CeUlkKGJlYWNvbklkKTtcblxuICAgIHJldHVybiBiZWFjb247XG59O1xuXG5jb25zdCBnZXRMYWJlbCA9IChoYXNTdG9wcGluZ0Vycm9yczogYm9vbGVhbiwgaGFzTG9jYXRpb25FcnJvcnM6IGJvb2xlYW4pOiBzdHJpbmcgPT4ge1xuICAgIGlmIChoYXNTdG9wcGluZ0Vycm9ycykge1xuICAgICAgICByZXR1cm4gX3QoJ0FuIGVycm9yIG9jY3VycmVkIHdoaWxlIHN0b3BwaW5nIHlvdXIgbGl2ZSBsb2NhdGlvbicpO1xuICAgIH1cbiAgICBpZiAoaGFzTG9jYXRpb25FcnJvcnMpIHtcbiAgICAgICAgcmV0dXJuIF90KCdBbiBlcnJvciBvY2N1cnJlZCB3aGlsc3Qgc2hhcmluZyB5b3VyIGxpdmUgbG9jYXRpb24nKTtcbiAgICB9XG4gICAgcmV0dXJuIF90KCdZb3UgYXJlIHNoYXJpbmcgeW91ciBsaXZlIGxvY2F0aW9uJyk7XG59O1xuXG5jb25zdCB1c2VMaXZlbmVzc01vbml0b3IgPSAobGl2ZUJlYWNvbklkczogQmVhY29uSWRlbnRpZmllcltdLCBiZWFjb25zOiBNYXA8QmVhY29uSWRlbnRpZmllciwgQmVhY29uPik6IHZvaWQgPT4ge1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIC8vIGNocm9taXVtIHNldHMgdGhlIG1pbmltdW0gdGltZXIgaW50ZXJ2YWwgdG8gMTAwMG1zXG4gICAgICAgIC8vIGZvciBpbmFjdGl2ZSB0YWJzXG4gICAgICAgIC8vIHJlZnJlc2ggYmVhY29uIG1vbml0b3JzIHdoZW4gdGhlIHRhYiBiZWNvbWVzIGFjdGl2ZSBhZ2FpblxuICAgICAgICBjb25zdCBvblBhZ2VWaXNpYmlsaXR5Q2hhbmdlZCA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmIChkb2N1bWVudC52aXNpYmlsaXR5U3RhdGUgPT09ICd2aXNpYmxlJykge1xuICAgICAgICAgICAgICAgIGxpdmVCZWFjb25JZHMuZm9yRWFjaChpZGVudGlmaWVyID0+IGJlYWNvbnMuZ2V0KGlkZW50aWZpZXIpPy5tb25pdG9yTGl2ZW5lc3MoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChsaXZlQmVhY29uSWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgb25QYWdlVmlzaWJpbGl0eUNoYW5nZWQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwidmlzaWJpbGl0eWNoYW5nZVwiLCBvblBhZ2VWaXNpYmlsaXR5Q2hhbmdlZCk7XG4gICAgICAgIH07XG4gICAgfSwgW2xpdmVCZWFjb25JZHMsIGJlYWNvbnNdKTtcbn07XG5cbmNvbnN0IExlZnRQYW5lbExpdmVTaGFyZVdhcm5pbmc6IFJlYWN0LkZDPFByb3BzPiA9ICh7IGlzTWluaW1pemVkIH0pID0+IHtcbiAgICBjb25zdCBpc01vbml0b3JpbmdMaXZlTG9jYXRpb24gPSB1c2VFdmVudEVtaXR0ZXJTdGF0ZShcbiAgICAgICAgT3duQmVhY29uU3RvcmUuaW5zdGFuY2UsXG4gICAgICAgIE93bkJlYWNvblN0b3JlRXZlbnQuTW9uaXRvcmluZ0xpdmVQb3NpdGlvbixcbiAgICAgICAgKCkgPT4gT3duQmVhY29uU3RvcmUuaW5zdGFuY2UuaXNNb25pdG9yaW5nTGl2ZUxvY2F0aW9uLFxuICAgICk7XG5cbiAgICBjb25zdCBiZWFjb25JZHNXaXRoTG9jYXRpb25QdWJsaXNoRXJyb3IgPSB1c2VFdmVudEVtaXR0ZXJTdGF0ZShcbiAgICAgICAgT3duQmVhY29uU3RvcmUuaW5zdGFuY2UsXG4gICAgICAgIE93bkJlYWNvblN0b3JlRXZlbnQuTG9jYXRpb25QdWJsaXNoRXJyb3IsXG4gICAgICAgICgpID0+IE93bkJlYWNvblN0b3JlLmluc3RhbmNlLmdldExpdmVCZWFjb25JZHNXaXRoTG9jYXRpb25QdWJsaXNoRXJyb3IoKSxcbiAgICApO1xuXG4gICAgY29uc3QgYmVhY29uSWRzV2l0aFN0b3BwaW5nRXJyb3IgPSB1c2VFdmVudEVtaXR0ZXJTdGF0ZShcbiAgICAgICAgT3duQmVhY29uU3RvcmUuaW5zdGFuY2UsXG4gICAgICAgIE93bkJlYWNvblN0b3JlRXZlbnQuQmVhY29uVXBkYXRlRXJyb3IsXG4gICAgICAgICgpID0+IE93bkJlYWNvblN0b3JlLmluc3RhbmNlLmdldExpdmVCZWFjb25JZHMoKS5maWx0ZXIoXG4gICAgICAgICAgICBiZWFjb25JZCA9PiBPd25CZWFjb25TdG9yZS5pbnN0YW5jZS5iZWFjb25VcGRhdGVFcnJvcnMuaGFzKGJlYWNvbklkKSxcbiAgICAgICAgKSxcbiAgICApO1xuXG4gICAgY29uc3QgbGl2ZUJlYWNvbklkcyA9IHVzZUV2ZW50RW1pdHRlclN0YXRlKFxuICAgICAgICBPd25CZWFjb25TdG9yZS5pbnN0YW5jZSxcbiAgICAgICAgT3duQmVhY29uU3RvcmVFdmVudC5MaXZlbmVzc0NoYW5nZSxcbiAgICAgICAgKCkgPT4gT3duQmVhY29uU3RvcmUuaW5zdGFuY2UuZ2V0TGl2ZUJlYWNvbklkcygpLFxuICAgICk7XG5cbiAgICBjb25zdCBoYXNMb2NhdGlvblB1Ymxpc2hFcnJvcnMgPSAhIWJlYWNvbklkc1dpdGhMb2NhdGlvblB1Ymxpc2hFcnJvci5sZW5ndGg7XG4gICAgY29uc3QgaGFzU3RvcHBpbmdFcnJvcnMgPSAhIWJlYWNvbklkc1dpdGhTdG9wcGluZ0Vycm9yLmxlbmd0aDtcblxuICAgIHVzZUxpdmVuZXNzTW9uaXRvcihsaXZlQmVhY29uSWRzLCBPd25CZWFjb25TdG9yZS5pbnN0YW5jZS5iZWFjb25zKTtcblxuICAgIGlmICghaXNNb25pdG9yaW5nTGl2ZUxvY2F0aW9uKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IHJlbGV2YW50QmVhY29uID0gY2hvb3NlQmVzdEJlYWNvbihcbiAgICAgICAgbGl2ZUJlYWNvbklkcywgYmVhY29uSWRzV2l0aFN0b3BwaW5nRXJyb3IsIGJlYWNvbklkc1dpdGhMb2NhdGlvblB1Ymxpc2hFcnJvcixcbiAgICApO1xuXG4gICAgY29uc3Qgb25XYXJuaW5nQ2xpY2sgPSByZWxldmFudEJlYWNvbiA/ICgpID0+IHtcbiAgICAgICAgZGlzcGF0Y2hlci5kaXNwYXRjaDxWaWV3Um9vbVBheWxvYWQ+KHtcbiAgICAgICAgICAgIGFjdGlvbjogQWN0aW9uLlZpZXdSb29tLFxuICAgICAgICAgICAgcm9vbV9pZDogcmVsZXZhbnRCZWFjb24ucm9vbUlkLFxuICAgICAgICAgICAgbWV0cmljc1RyaWdnZXI6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGV2ZW50X2lkOiByZWxldmFudEJlYWNvbi5iZWFjb25JbmZvSWQsXG4gICAgICAgICAgICBzY3JvbGxfaW50b192aWV3OiB0cnVlLFxuICAgICAgICAgICAgaGlnaGxpZ2h0ZWQ6IHRydWUsXG4gICAgICAgIH0pO1xuICAgIH0gOiB1bmRlZmluZWQ7XG5cbiAgICBjb25zdCBsYWJlbCA9IGdldExhYmVsKGhhc1N0b3BwaW5nRXJyb3JzLCBoYXNMb2NhdGlvblB1Ymxpc2hFcnJvcnMpO1xuXG4gICAgcmV0dXJuIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcygnbXhfTGVmdFBhbmVsTGl2ZVNoYXJlV2FybmluZycsIHtcbiAgICAgICAgICAgICdteF9MZWZ0UGFuZWxMaXZlU2hhcmVXYXJuaW5nX19taW5pbWl6ZWQnOiBpc01pbmltaXplZCxcbiAgICAgICAgICAgICdteF9MZWZ0UGFuZWxMaXZlU2hhcmVXYXJuaW5nX19lcnJvcic6IGhhc0xvY2F0aW9uUHVibGlzaEVycm9ycyB8fCBoYXNTdG9wcGluZ0Vycm9ycyxcbiAgICAgICAgfSl9XG4gICAgICAgIHRpdGxlPXtpc01pbmltaXplZCA/IGxhYmVsIDogdW5kZWZpbmVkfVxuICAgICAgICBvbkNsaWNrPXtvbldhcm5pbmdDbGlja31cbiAgICA+XG4gICAgICAgIHsgaXNNaW5pbWl6ZWQgPyA8TGl2ZUxvY2F0aW9uSWNvbiBoZWlnaHQ9ezEwfSAvPiA6IGxhYmVsIH1cbiAgICA8L0FjY2Vzc2libGVCdXR0b24+O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgTGVmdFBhbmVsTGl2ZVNoYXJlV2FybmluZztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBZ0JBOztBQUNBOztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOzs7Ozs7QUEzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQW1CQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQSxnQkFBZ0IsR0FBRyxDQUNyQkMsYUFEcUIsRUFFckJDLG9CQUZxQixFQUdyQkMsc0JBSHFCLEtBSUE7RUFDckI7RUFDQTtFQUNBLE1BQU1DLFFBQVEsR0FBR0Ysb0JBQW9CLEdBQUcsQ0FBSCxDQUFwQixJQUE2QkMsc0JBQXNCLEdBQUcsQ0FBSCxDQUFuRCxJQUE0REYsYUFBYSxHQUFHLENBQUgsQ0FBMUY7O0VBQ0EsSUFBSSxDQUFDRyxRQUFMLEVBQWU7SUFDWCxPQUFPQyxTQUFQO0VBQ0g7O0VBQ0QsTUFBTUMsTUFBTSxHQUFHQyw4QkFBQSxDQUFlQyxRQUFmLENBQXdCQyxh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
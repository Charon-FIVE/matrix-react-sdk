"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _utils = require("matrix-js-sdk/src/utils");

var _lodash = require("lodash");

var _roomState = require("matrix-js-sdk/src/models/room-state");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _AppsDrawer = _interopRequireDefault(require("./AppsDrawer"));

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _AutoHideScrollbar = _interopRequireDefault(require("../../structures/AutoHideScrollbar"));

var _UIFeature = require("../../../settings/UIFeature");

var _LegacyCallViewForRoom = _interopRequireDefault(require("../voip/LegacyCallViewForRoom"));

var _objects = require("../../../utils/objects");

/*
Copyright 2015, 2016, 2017, 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class AuxPanel extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "onRoomStateEvents", ev => {
      if (ev.getType() === "re.jki.counter") {
        this.updateCounters();
      }
    });
    (0, _defineProperty2.default)(this, "updateCounters", (0, _lodash.throttle)(() => {
      this.setState({
        counters: this.computeCounters()
      });
    }, 500, {
      leading: true,
      trailing: true
    }));
    this.state = {
      counters: this.computeCounters()
    };
  }

  componentDidMount() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    if (_SettingsStore.default.getValue("feature_state_counters")) {
      cli.on(_roomState.RoomStateEvent.Events, this.onRoomStateEvents);
    }
  }

  componentWillUnmount() {
    if (_SettingsStore.default.getValue("feature_state_counters")) {
      _MatrixClientPeg.MatrixClientPeg.get()?.removeListener(_roomState.RoomStateEvent.Events, this.onRoomStateEvents);
    }
  }

  shouldComponentUpdate(nextProps, nextState) {
    return (0, _objects.objectHasDiff)(this.props, nextProps) || (0, _objects.objectHasDiff)(this.state, nextState);
  }

  computeCounters() {
    const counters = [];

    if (this.props.room && _SettingsStore.default.getValue("feature_state_counters")) {
      const stateEvs = this.props.room.currentState.getStateEvents('re.jki.counter');
      stateEvs.sort((a, b) => (0, _utils.lexicographicCompare)(a.getStateKey(), b.getStateKey()));

      for (const ev of stateEvs) {
        const title = ev.getContent().title;
        const value = ev.getContent().value;
        const link = ev.getContent().link;
        const severity = ev.getContent().severity || "normal";
        const stateKey = ev.getStateKey(); // We want a non-empty title but can accept falsy values (e.g.
        // zero)

        if (title && value !== undefined) {
          counters.push({
            title,
            value,
            link,
            severity,
            stateKey
          });
        }
      }
    }

    return counters;
  }

  render() {
    const callView = /*#__PURE__*/_react.default.createElement(_LegacyCallViewForRoom.default, {
      roomId: this.props.room.roomId,
      resizeNotifier: this.props.resizeNotifier,
      showApps: this.props.showApps
    });

    let appsDrawer;

    if (_SettingsStore.default.getValue(_UIFeature.UIFeature.Widgets)) {
      appsDrawer = /*#__PURE__*/_react.default.createElement(_AppsDrawer.default, {
        room: this.props.room,
        userId: this.props.userId,
        showApps: this.props.showApps,
        resizeNotifier: this.props.resizeNotifier
      });
    }

    let stateViews = null;

    if (this.state.counters && _SettingsStore.default.getValue("feature_state_counters")) {
      const counters = [];
      this.state.counters.forEach((counter, idx) => {
        const title = counter.title;
        const value = counter.value;
        const link = counter.link;
        const severity = counter.severity;
        const stateKey = counter.stateKey;

        let span = /*#__PURE__*/_react.default.createElement("span", null, title, ": ", value);

        if (link) {
          span = /*#__PURE__*/_react.default.createElement("a", {
            href: link,
            target: "_blank",
            rel: "noreferrer noopener"
          }, span);
        }

        span = /*#__PURE__*/_react.default.createElement("span", {
          className: "m_RoomView_auxPanel_stateViews_span",
          "data-severity": severity,
          key: "x-" + stateKey
        }, span);
        counters.push(span);
        counters.push( /*#__PURE__*/_react.default.createElement("span", {
          className: "m_RoomView_auxPanel_stateViews_delim",
          key: "delim" + idx
        }, " \u2500 "));
      });

      if (counters.length > 0) {
        counters.pop(); // remove last deliminator

        stateViews = /*#__PURE__*/_react.default.createElement("div", {
          className: "m_RoomView_auxPanel_stateViews"
        }, counters);
      }
    }

    return /*#__PURE__*/_react.default.createElement(_AutoHideScrollbar.default, {
      className: "mx_RoomView_auxPanel"
    }, stateViews, this.props.children, appsDrawer, callView);
  }

}

exports.default = AuxPanel;
(0, _defineProperty2.default)(AuxPanel, "defaultProps", {
  showApps: true
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBdXhQYW5lbCIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImV2IiwiZ2V0VHlwZSIsInVwZGF0ZUNvdW50ZXJzIiwidGhyb3R0bGUiLCJzZXRTdGF0ZSIsImNvdW50ZXJzIiwiY29tcHV0ZUNvdW50ZXJzIiwibGVhZGluZyIsInRyYWlsaW5nIiwic3RhdGUiLCJjb21wb25lbnREaWRNb3VudCIsImNsaSIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsIlNldHRpbmdzU3RvcmUiLCJnZXRWYWx1ZSIsIm9uIiwiUm9vbVN0YXRlRXZlbnQiLCJFdmVudHMiLCJvblJvb21TdGF0ZUV2ZW50cyIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVtb3ZlTGlzdGVuZXIiLCJzaG91bGRDb21wb25lbnRVcGRhdGUiLCJuZXh0UHJvcHMiLCJuZXh0U3RhdGUiLCJvYmplY3RIYXNEaWZmIiwicm9vbSIsInN0YXRlRXZzIiwiY3VycmVudFN0YXRlIiwiZ2V0U3RhdGVFdmVudHMiLCJzb3J0IiwiYSIsImIiLCJsZXhpY29ncmFwaGljQ29tcGFyZSIsImdldFN0YXRlS2V5IiwidGl0bGUiLCJnZXRDb250ZW50IiwidmFsdWUiLCJsaW5rIiwic2V2ZXJpdHkiLCJzdGF0ZUtleSIsInVuZGVmaW5lZCIsInB1c2giLCJyZW5kZXIiLCJjYWxsVmlldyIsInJvb21JZCIsInJlc2l6ZU5vdGlmaWVyIiwic2hvd0FwcHMiLCJhcHBzRHJhd2VyIiwiVUlGZWF0dXJlIiwiV2lkZ2V0cyIsInVzZXJJZCIsInN0YXRlVmlld3MiLCJmb3JFYWNoIiwiY291bnRlciIsImlkeCIsInNwYW4iLCJsZW5ndGgiLCJwb3AiLCJjaGlsZHJlbiJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21zL0F1eFBhbmVsLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTUsIDIwMTYsIDIwMTcsIDIwMjAgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgbGV4aWNvZ3JhcGhpY0NvbXBhcmUgfSBmcm9tICdtYXRyaXgtanMtc2RrL3NyYy91dGlscyc7XG5pbXBvcnQgeyBSb29tIH0gZnJvbSAnbWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb20nO1xuaW1wb3J0IHsgdGhyb3R0bGUgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgUm9vbVN0YXRlRXZlbnQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb20tc3RhdGVcIjtcbmltcG9ydCB7IE1hdHJpeEV2ZW50IH0gZnJvbSAnbWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL2V2ZW50JztcblxuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSBcIi4uLy4uLy4uL01hdHJpeENsaWVudFBlZ1wiO1xuaW1wb3J0IEFwcHNEcmF3ZXIgZnJvbSAnLi9BcHBzRHJhd2VyJztcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gXCIuLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5pbXBvcnQgQXV0b0hpZGVTY3JvbGxiYXIgZnJvbSBcIi4uLy4uL3N0cnVjdHVyZXMvQXV0b0hpZGVTY3JvbGxiYXJcIjtcbmltcG9ydCB7IFVJRmVhdHVyZSB9IGZyb20gXCIuLi8uLi8uLi9zZXR0aW5ncy9VSUZlYXR1cmVcIjtcbmltcG9ydCBSZXNpemVOb3RpZmllciBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvUmVzaXplTm90aWZpZXJcIjtcbmltcG9ydCBMZWdhY3lDYWxsVmlld0ZvclJvb20gZnJvbSAnLi4vdm9pcC9MZWdhY3lDYWxsVmlld0ZvclJvb20nO1xuaW1wb3J0IHsgb2JqZWN0SGFzRGlmZiB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9vYmplY3RzXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIC8vIGpzLXNkayByb29tIG9iamVjdFxuICAgIHJvb206IFJvb207XG4gICAgdXNlcklkOiBzdHJpbmc7XG4gICAgc2hvd0FwcHM6IGJvb2xlYW47IC8vIFJlbmRlciBhcHBzXG4gICAgcmVzaXplTm90aWZpZXI6IFJlc2l6ZU5vdGlmaWVyO1xufVxuXG5pbnRlcmZhY2UgQ291bnRlciB7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICB2YWx1ZTogbnVtYmVyO1xuICAgIGxpbms6IHN0cmluZztcbiAgICBzZXZlcml0eTogc3RyaW5nO1xuICAgIHN0YXRlS2V5OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIGNvdW50ZXJzOiBDb3VudGVyW107XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEF1eFBhbmVsIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICAgICAgc2hvd0FwcHM6IHRydWUsXG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgY291bnRlcnM6IHRoaXMuY29tcHV0ZUNvdW50ZXJzKCksXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIGNvbnN0IGNsaSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcbiAgICAgICAgaWYgKFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJmZWF0dXJlX3N0YXRlX2NvdW50ZXJzXCIpKSB7XG4gICAgICAgICAgICBjbGkub24oUm9vbVN0YXRlRXZlbnQuRXZlbnRzLCB0aGlzLm9uUm9vbVN0YXRlRXZlbnRzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBpZiAoU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcImZlYXR1cmVfc3RhdGVfY291bnRlcnNcIikpIHtcbiAgICAgICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKT8ucmVtb3ZlTGlzdGVuZXIoUm9vbVN0YXRlRXZlbnQuRXZlbnRzLCB0aGlzLm9uUm9vbVN0YXRlRXZlbnRzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNob3VsZENvbXBvbmVudFVwZGF0ZShuZXh0UHJvcHMsIG5leHRTdGF0ZSkge1xuICAgICAgICByZXR1cm4gb2JqZWN0SGFzRGlmZih0aGlzLnByb3BzLCBuZXh0UHJvcHMpIHx8IG9iamVjdEhhc0RpZmYodGhpcy5zdGF0ZSwgbmV4dFN0YXRlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uUm9vbVN0YXRlRXZlbnRzID0gKGV2OiBNYXRyaXhFdmVudCkgPT4ge1xuICAgICAgICBpZiAoZXYuZ2V0VHlwZSgpID09PSBcInJlLmpraS5jb3VudGVyXCIpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQ291bnRlcnMoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIHVwZGF0ZUNvdW50ZXJzID0gdGhyb3R0bGUoKCkgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgY291bnRlcnM6IHRoaXMuY29tcHV0ZUNvdW50ZXJzKCkgfSk7XG4gICAgfSwgNTAwLCB7IGxlYWRpbmc6IHRydWUsIHRyYWlsaW5nOiB0cnVlIH0pO1xuXG4gICAgcHJpdmF0ZSBjb21wdXRlQ291bnRlcnMoKSB7XG4gICAgICAgIGNvbnN0IGNvdW50ZXJzID0gW107XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMucm9vbSAmJiBTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFwiZmVhdHVyZV9zdGF0ZV9jb3VudGVyc1wiKSkge1xuICAgICAgICAgICAgY29uc3Qgc3RhdGVFdnMgPSB0aGlzLnByb3BzLnJvb20uY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKCdyZS5qa2kuY291bnRlcicpO1xuICAgICAgICAgICAgc3RhdGVFdnMuc29ydCgoYSwgYikgPT4gbGV4aWNvZ3JhcGhpY0NvbXBhcmUoYS5nZXRTdGF0ZUtleSgpLCBiLmdldFN0YXRlS2V5KCkpKTtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBldiBvZiBzdGF0ZUV2cykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gZXYuZ2V0Q29udGVudCgpLnRpdGxlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZXYuZ2V0Q29udGVudCgpLnZhbHVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBldi5nZXRDb250ZW50KCkubGluaztcbiAgICAgICAgICAgICAgICBjb25zdCBzZXZlcml0eSA9IGV2LmdldENvbnRlbnQoKS5zZXZlcml0eSB8fCBcIm5vcm1hbFwiO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlS2V5ID0gZXYuZ2V0U3RhdGVLZXkoKTtcblxuICAgICAgICAgICAgICAgIC8vIFdlIHdhbnQgYSBub24tZW1wdHkgdGl0bGUgYnV0IGNhbiBhY2NlcHQgZmFsc3kgdmFsdWVzIChlLmcuXG4gICAgICAgICAgICAgICAgLy8gemVybylcbiAgICAgICAgICAgICAgICBpZiAodGl0bGUgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBjb3VudGVycy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2V2ZXJpdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUtleSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNvdW50ZXJzO1xuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgY2FsbFZpZXcgPSAoXG4gICAgICAgICAgICA8TGVnYWN5Q2FsbFZpZXdGb3JSb29tXG4gICAgICAgICAgICAgICAgcm9vbUlkPXt0aGlzLnByb3BzLnJvb20ucm9vbUlkfVxuICAgICAgICAgICAgICAgIHJlc2l6ZU5vdGlmaWVyPXt0aGlzLnByb3BzLnJlc2l6ZU5vdGlmaWVyfVxuICAgICAgICAgICAgICAgIHNob3dBcHBzPXt0aGlzLnByb3BzLnNob3dBcHBzfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgKTtcblxuICAgICAgICBsZXQgYXBwc0RyYXdlcjtcbiAgICAgICAgaWYgKFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoVUlGZWF0dXJlLldpZGdldHMpKSB7XG4gICAgICAgICAgICBhcHBzRHJhd2VyID0gPEFwcHNEcmF3ZXJcbiAgICAgICAgICAgICAgICByb29tPXt0aGlzLnByb3BzLnJvb219XG4gICAgICAgICAgICAgICAgdXNlcklkPXt0aGlzLnByb3BzLnVzZXJJZH1cbiAgICAgICAgICAgICAgICBzaG93QXBwcz17dGhpcy5wcm9wcy5zaG93QXBwc31cbiAgICAgICAgICAgICAgICByZXNpemVOb3RpZmllcj17dGhpcy5wcm9wcy5yZXNpemVOb3RpZmllcn1cbiAgICAgICAgICAgIC8+O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHN0YXRlVmlld3MgPSBudWxsO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5jb3VudGVycyAmJiBTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFwiZmVhdHVyZV9zdGF0ZV9jb3VudGVyc1wiKSkge1xuICAgICAgICAgICAgY29uc3QgY291bnRlcnMgPSBbXTtcblxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5jb3VudGVycy5mb3JFYWNoKChjb3VudGVyLCBpZHgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aXRsZSA9IGNvdW50ZXIudGl0bGU7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjb3VudGVyLnZhbHVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBjb3VudGVyLmxpbms7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2V2ZXJpdHkgPSBjb3VudGVyLnNldmVyaXR5O1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlS2V5ID0gY291bnRlci5zdGF0ZUtleTtcblxuICAgICAgICAgICAgICAgIGxldCBzcGFuID0gPHNwYW4+eyB0aXRsZSB9OiB7IHZhbHVlIH08L3NwYW4+O1xuXG4gICAgICAgICAgICAgICAgaWYgKGxpbmspIHtcbiAgICAgICAgICAgICAgICAgICAgc3BhbiA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9e2xpbmt9IHRhcmdldD1cIl9ibGFua1wiIHJlbD1cIm5vcmVmZXJyZXIgbm9vcGVuZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHNwYW4gfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNwYW4gPSAoXG4gICAgICAgICAgICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJtX1Jvb21WaWV3X2F1eFBhbmVsX3N0YXRlVmlld3Nfc3BhblwiXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLXNldmVyaXR5PXtzZXZlcml0eX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGtleT17XCJ4LVwiICsgc3RhdGVLZXl9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgc3BhbiB9XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgY291bnRlcnMucHVzaChzcGFuKTtcbiAgICAgICAgICAgICAgICBjb3VudGVycy5wdXNoKFxuICAgICAgICAgICAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibV9Sb29tVmlld19hdXhQYW5lbF9zdGF0ZVZpZXdzX2RlbGltXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleT17XCJkZWxpbVwiICsgaWR4fVxuICAgICAgICAgICAgICAgICAgICA+IOKUgCA8L3NwYW4+LFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGNvdW50ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBjb3VudGVycy5wb3AoKTsgLy8gcmVtb3ZlIGxhc3QgZGVsaW1pbmF0b3JcbiAgICAgICAgICAgICAgICBzdGF0ZVZpZXdzID0gKFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm1fUm9vbVZpZXdfYXV4UGFuZWxfc3RhdGVWaWV3c1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBjb3VudGVycyB9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPEF1dG9IaWRlU2Nyb2xsYmFyIGNsYXNzTmFtZT1cIm14X1Jvb21WaWV3X2F1eFBhbmVsXCI+XG4gICAgICAgICAgICAgICAgeyBzdGF0ZVZpZXdzIH1cbiAgICAgICAgICAgICAgICB7IHRoaXMucHJvcHMuY2hpbGRyZW4gfVxuICAgICAgICAgICAgICAgIHsgYXBwc0RyYXdlciB9XG4gICAgICAgICAgICAgICAgeyBjYWxsVmlldyB9XG4gICAgICAgICAgICA8L0F1dG9IaWRlU2Nyb2xsYmFyPlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXNDZSxNQUFNQSxRQUFOLFNBQXVCQyxjQUFBLENBQU1DLFNBQTdCLENBQXVEO0VBS2xFQyxXQUFXLENBQUNDLEtBQUQsRUFBUTtJQUNmLE1BQU1BLEtBQU47SUFEZSx5REF5QlVDLEVBQUQsSUFBcUI7TUFDN0MsSUFBSUEsRUFBRSxDQUFDQyxPQUFILE9BQWlCLGdCQUFyQixFQUF1QztRQUNuQyxLQUFLQyxjQUFMO01BQ0g7SUFDSixDQTdCa0I7SUFBQSxzREErQk0sSUFBQUMsZ0JBQUEsRUFBUyxNQUFNO01BQ3BDLEtBQUtDLFFBQUwsQ0FBYztRQUFFQyxRQUFRLEVBQUUsS0FBS0MsZUFBTDtNQUFaLENBQWQ7SUFDSCxDQUZ3QixFQUV0QixHQUZzQixFQUVqQjtNQUFFQyxPQUFPLEVBQUUsSUFB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
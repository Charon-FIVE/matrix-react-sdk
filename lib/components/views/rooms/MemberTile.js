"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _event = require("matrix-js-sdk/src/@types/event");

var _crypto = require("matrix-js-sdk/src/crypto");

var _roomState = require("matrix-js-sdk/src/models/room-state");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _languageHandler = require("../../../languageHandler");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _actions = require("../../../dispatcher/actions");

var _EntityTile = _interopRequireWildcard(require("./EntityTile"));

var _MemberAvatar = _interopRequireDefault(require("./../avatars/MemberAvatar"));

var _DisambiguatedProfile = _interopRequireDefault(require("../messages/DisambiguatedProfile"));

var _UserIdentifier = _interopRequireDefault(require("../../../customisations/UserIdentifier"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2015, 2016 OpenMarket Ltd
Copyright 2019, 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class MemberTile extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "userLastModifiedTime", void 0);
    (0, _defineProperty2.default)(this, "memberLastModifiedTime", void 0);
    (0, _defineProperty2.default)(this, "onRoomStateEvents", ev => {
      if (ev.getType() !== _event.EventType.RoomEncryption) return;
      const {
        roomId
      } = this.props.member;
      if (ev.getRoomId() !== roomId) return; // The room is encrypted now.

      const cli = _MatrixClientPeg.MatrixClientPeg.get();

      cli.removeListener(_roomState.RoomStateEvent.Events, this.onRoomStateEvents);
      this.setState({
        isRoomEncrypted: true
      });
      this.updateE2EStatus();
    });
    (0, _defineProperty2.default)(this, "onUserTrustStatusChanged", (userId, trustStatus) => {
      if (userId !== this.props.member.userId) return;
      this.updateE2EStatus();
    });
    (0, _defineProperty2.default)(this, "onDeviceVerificationChanged", (userId, deviceId, deviceInfo) => {
      if (userId !== this.props.member.userId) return;
      this.updateE2EStatus();
    });
    (0, _defineProperty2.default)(this, "onClick", () => {
      _dispatcher.default.dispatch({
        action: _actions.Action.ViewUser,
        member: this.props.member,
        push: true
      });
    });
    this.state = {
      isRoomEncrypted: false,
      e2eStatus: null
    };
  }

  componentDidMount() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    const {
      roomId
    } = this.props.member;

    if (roomId) {
      const isRoomEncrypted = cli.isRoomEncrypted(roomId);
      this.setState({
        isRoomEncrypted
      });

      if (isRoomEncrypted) {
        cli.on(_crypto.CryptoEvent.UserTrustStatusChanged, this.onUserTrustStatusChanged);
        cli.on(_crypto.CryptoEvent.DeviceVerificationChanged, this.onDeviceVerificationChanged);
        this.updateE2EStatus();
      } else {
        // Listen for room to become encrypted
        cli.on(_roomState.RoomStateEvent.Events, this.onRoomStateEvents);
      }
    }
  }

  componentWillUnmount() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    if (cli) {
      cli.removeListener(_roomState.RoomStateEvent.Events, this.onRoomStateEvents);
      cli.removeListener(_crypto.CryptoEvent.UserTrustStatusChanged, this.onUserTrustStatusChanged);
      cli.removeListener(_crypto.CryptoEvent.DeviceVerificationChanged, this.onDeviceVerificationChanged);
    }
  }

  async updateE2EStatus() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    const {
      userId
    } = this.props.member;
    const isMe = userId === cli.getUserId();
    const userTrust = cli.checkUserTrust(userId);

    if (!userTrust.isCrossSigningVerified()) {
      this.setState({
        e2eStatus: userTrust.wasCrossSigningVerified() ? "warning" : "normal"
      });
      return;
    }

    const devices = cli.getStoredDevicesForUser(userId);
    const anyDeviceUnverified = devices.some(device => {
      const {
        deviceId
      } = device; // For your own devices, we use the stricter check of cross-signing
      // verification to encourage everyone to trust their own devices via
      // cross-signing so that other users can then safely trust you.
      // For other people's devices, the more general verified check that
      // includes locally verified devices can be used.

      const deviceTrust = cli.checkDeviceTrust(userId, deviceId);
      return isMe ? !deviceTrust.isCrossSigningVerified() : !deviceTrust.isVerified();
    });
    this.setState({
      e2eStatus: anyDeviceUnverified ? "warning" : "verified"
    });
  }

  shouldComponentUpdate(nextProps, nextState) {
    if (this.memberLastModifiedTime === undefined || this.memberLastModifiedTime < nextProps.member.getLastModifiedTime()) {
      return true;
    }

    if (nextProps.member.user && (this.userLastModifiedTime === undefined || this.userLastModifiedTime < nextProps.member.user.getLastModifiedTime())) {
      return true;
    }

    if (nextState.isRoomEncrypted !== this.state.isRoomEncrypted || nextState.e2eStatus !== this.state.e2eStatus) {
      return true;
    }

    return false;
  }

  getDisplayName() {
    return this.props.member.name;
  }

  getPowerLabel() {
    return (0, _languageHandler._t)("%(userName)s (power %(powerLevelNumber)s)", {
      userName: _UserIdentifier.default.getDisplayUserIdentifier(this.props.member.userId, {
        roomId: this.props.member.roomId
      }),
      powerLevelNumber: this.props.member.powerLevel
    }).trim();
  }

  render() {
    const member = this.props.member;
    const name = this.getDisplayName();
    const presenceState = member.user ? member.user.presence : null;

    const av = /*#__PURE__*/_react.default.createElement(_MemberAvatar.default, {
      member: member,
      width: 36,
      height: 36,
      "aria-hidden": "true"
    });

    if (member.user) {
      this.userLastModifiedTime = member.user.getLastModifiedTime();
    }

    this.memberLastModifiedTime = member.getLastModifiedTime();
    const powerStatusMap = new Map([[100, _EntityTile.PowerStatus.Admin], [50, _EntityTile.PowerStatus.Moderator]]); // Find the nearest power level with a badge

    let powerLevel = this.props.member.powerLevel;

    for (const [pl] of powerStatusMap) {
      if (this.props.member.powerLevel >= pl) {
        powerLevel = pl;
        break;
      }
    }

    const powerStatus = powerStatusMap.get(powerLevel);
    let e2eStatus;

    if (this.state.isRoomEncrypted) {
      e2eStatus = this.state.e2eStatus;
    }

    const nameJSX = /*#__PURE__*/_react.default.createElement(_DisambiguatedProfile.default, {
      member: member,
      fallbackName: name || ""
    });

    return /*#__PURE__*/_react.default.createElement(_EntityTile.default, (0, _extends2.default)({}, this.props, {
      presenceState: presenceState,
      presenceLastActiveAgo: member.user ? member.user.lastActiveAgo : 0,
      presenceLastTs: member.user ? member.user.lastPresenceTs : 0,
      presenceCurrentlyActive: member.user ? member.user.currentlyActive : false,
      avatarJsx: av,
      title: this.getPowerLabel(),
      name: name,
      nameJSX: nameJSX,
      powerStatus: powerStatus,
      showPresence: this.props.showPresence,
      e2eStatus: e2eStatus,
      onClick: this.onClick
    }));
  }

}

exports.default = MemberTile;
(0, _defineProperty2.default)(MemberTile, "defaultProps", {
  showPresence: true
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNZW1iZXJUaWxlIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiZXYiLCJnZXRUeXBlIiwiRXZlbnRUeXBlIiwiUm9vbUVuY3J5cHRpb24iLCJyb29tSWQiLCJtZW1iZXIiLCJnZXRSb29tSWQiLCJjbGkiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJyZW1vdmVMaXN0ZW5lciIsIlJvb21TdGF0ZUV2ZW50IiwiRXZlbnRzIiwib25Sb29tU3RhdGVFdmVudHMiLCJzZXRTdGF0ZSIsImlzUm9vbUVuY3J5cHRlZCIsInVwZGF0ZUUyRVN0YXR1cyIsInVzZXJJZCIsInRydXN0U3RhdHVzIiwiZGV2aWNlSWQiLCJkZXZpY2VJbmZvIiwiZGlzIiwiZGlzcGF0Y2giLCJhY3Rpb24iLCJBY3Rpb24iLCJWaWV3VXNlciIsInB1c2giLCJzdGF0ZSIsImUyZVN0YXR1cyIsImNvbXBvbmVudERpZE1vdW50Iiwib24iLCJDcnlwdG9FdmVudCIsIlVzZXJUcnVzdFN0YXR1c0NoYW5nZWQiLCJvblVzZXJUcnVzdFN0YXR1c0NoYW5nZWQiLCJEZXZpY2VWZXJpZmljYXRpb25DaGFuZ2VkIiwib25EZXZpY2VWZXJpZmljYXRpb25DaGFuZ2VkIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJpc01lIiwiZ2V0VXNlcklkIiwidXNlclRydXN0IiwiY2hlY2tVc2VyVHJ1c3QiLCJpc0Nyb3NzU2lnbmluZ1ZlcmlmaWVkIiwid2FzQ3Jvc3NTaWduaW5nVmVyaWZpZWQiLCJkZXZpY2VzIiwiZ2V0U3RvcmVkRGV2aWNlc0ZvclVzZXIiLCJhbnlEZXZpY2VVbnZlcmlmaWVkIiwic29tZSIsImRldmljZSIsImRldmljZVRydXN0IiwiY2hlY2tEZXZpY2VUcnVzdCIsImlzVmVyaWZpZWQiLCJzaG91bGRDb21wb25lbnRVcGRhdGUiLCJuZXh0UHJvcHMiLCJuZXh0U3RhdGUiLCJtZW1iZXJMYXN0TW9kaWZpZWRUaW1lIiwidW5kZWZpbmVkIiwiZ2V0TGFzdE1vZGlmaWVkVGltZSIsInVzZXIiLCJ1c2VyTGFzdE1vZGlmaWVkVGltZSIsImdldERpc3BsYXlOYW1lIiwibmFtZSIsImdldFBvd2VyTGFiZWwiLCJfdCIsInVzZXJOYW1lIiwiVXNlcklkZW50aWZpZXJDdXN0b21pc2F0aW9ucyIsImdldERpc3BsYXlVc2VySWRlbnRpZmllciIsInBvd2VyTGV2ZWxOdW1iZXIiLCJwb3dlckxldmVsIiwidHJpbSIsInJlbmRlciIsInByZXNlbmNlU3RhdGUiLCJwcmVzZW5jZSIsImF2IiwicG93ZXJTdGF0dXNNYXAiLCJNYXAiLCJQb3dlclN0YXR1cyIsIkFkbWluIiwiTW9kZXJhdG9yIiwicGwiLCJwb3dlclN0YXR1cyIsIm5hbWVKU1giLCJsYXN0QWN0aXZlQWdvIiwibGFzdFByZXNlbmNlVHMiLCJjdXJyZW50bHlBY3RpdmUiLCJzaG93UHJlc2VuY2UiLCJvbkNsaWNrIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvdmlld3Mvcm9vbXMvTWVtYmVyVGlsZS50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE1LCAyMDE2IE9wZW5NYXJrZXQgTHRkXG5Db3B5cmlnaHQgMjAxOSwgMjAyMCBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBSb29tTWVtYmVyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tLW1lbWJlclwiO1xuaW1wb3J0IHsgTWF0cml4RXZlbnQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL2V2ZW50XCI7XG5pbXBvcnQgeyBFdmVudFR5cGUgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvQHR5cGVzL2V2ZW50XCI7XG5pbXBvcnQgeyBEZXZpY2VJbmZvIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2NyeXB0by9kZXZpY2VpbmZvXCI7XG5pbXBvcnQgeyBDcnlwdG9FdmVudCB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9jcnlwdG9cIjtcbmltcG9ydCB7IFJvb21TdGF0ZUV2ZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tLXN0YXRlXCI7XG5pbXBvcnQgeyBVc2VyVHJ1c3RMZXZlbCB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL2NyeXB0by9Dcm9zc1NpZ25pbmcnO1xuXG5pbXBvcnQgZGlzIGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gXCIuLi8uLi8uLi9NYXRyaXhDbGllbnRQZWdcIjtcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2FjdGlvbnNcIjtcbmltcG9ydCBFbnRpdHlUaWxlLCB7IFBvd2VyU3RhdHVzIH0gZnJvbSBcIi4vRW50aXR5VGlsZVwiO1xuaW1wb3J0IE1lbWJlckF2YXRhciBmcm9tIFwiLi8uLi9hdmF0YXJzL01lbWJlckF2YXRhclwiO1xuaW1wb3J0IERpc2FtYmlndWF0ZWRQcm9maWxlIGZyb20gXCIuLi9tZXNzYWdlcy9EaXNhbWJpZ3VhdGVkUHJvZmlsZVwiO1xuaW1wb3J0IFVzZXJJZGVudGlmaWVyQ3VzdG9taXNhdGlvbnMgZnJvbSAnLi4vLi4vLi4vY3VzdG9taXNhdGlvbnMvVXNlcklkZW50aWZpZXInO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICBtZW1iZXI6IFJvb21NZW1iZXI7XG4gICAgc2hvd1ByZXNlbmNlPzogYm9vbGVhbjtcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgaXNSb29tRW5jcnlwdGVkOiBib29sZWFuO1xuICAgIGUyZVN0YXR1czogc3RyaW5nO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNZW1iZXJUaWxlIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSB1c2VyTGFzdE1vZGlmaWVkVGltZTogbnVtYmVyO1xuICAgIHByaXZhdGUgbWVtYmVyTGFzdE1vZGlmaWVkVGltZTogbnVtYmVyO1xuXG4gICAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICAgICAgc2hvd1ByZXNlbmNlOiB0cnVlLFxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGlzUm9vbUVuY3J5cHRlZDogZmFsc2UsXG4gICAgICAgICAgICBlMmVTdGF0dXM6IG51bGwsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIGNvbnN0IGNsaSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcblxuICAgICAgICBjb25zdCB7IHJvb21JZCB9ID0gdGhpcy5wcm9wcy5tZW1iZXI7XG4gICAgICAgIGlmIChyb29tSWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGlzUm9vbUVuY3J5cHRlZCA9IGNsaS5pc1Jvb21FbmNyeXB0ZWQocm9vbUlkKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGlzUm9vbUVuY3J5cHRlZCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGlzUm9vbUVuY3J5cHRlZCkge1xuICAgICAgICAgICAgICAgIGNsaS5vbihDcnlwdG9FdmVudC5Vc2VyVHJ1c3RTdGF0dXNDaGFuZ2VkLCB0aGlzLm9uVXNlclRydXN0U3RhdHVzQ2hhbmdlZCk7XG4gICAgICAgICAgICAgICAgY2xpLm9uKENyeXB0b0V2ZW50LkRldmljZVZlcmlmaWNhdGlvbkNoYW5nZWQsIHRoaXMub25EZXZpY2VWZXJpZmljYXRpb25DaGFuZ2VkKTtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUUyRVN0YXR1cygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBMaXN0ZW4gZm9yIHJvb20gdG8gYmVjb21lIGVuY3J5cHRlZFxuICAgICAgICAgICAgICAgIGNsaS5vbihSb29tU3RhdGVFdmVudC5FdmVudHMsIHRoaXMub25Sb29tU3RhdGVFdmVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGNvbnN0IGNsaSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcblxuICAgICAgICBpZiAoY2xpKSB7XG4gICAgICAgICAgICBjbGkucmVtb3ZlTGlzdGVuZXIoUm9vbVN0YXRlRXZlbnQuRXZlbnRzLCB0aGlzLm9uUm9vbVN0YXRlRXZlbnRzKTtcbiAgICAgICAgICAgIGNsaS5yZW1vdmVMaXN0ZW5lcihDcnlwdG9FdmVudC5Vc2VyVHJ1c3RTdGF0dXNDaGFuZ2VkLCB0aGlzLm9uVXNlclRydXN0U3RhdHVzQ2hhbmdlZCk7XG4gICAgICAgICAgICBjbGkucmVtb3ZlTGlzdGVuZXIoQ3J5cHRvRXZlbnQuRGV2aWNlVmVyaWZpY2F0aW9uQ2hhbmdlZCwgdGhpcy5vbkRldmljZVZlcmlmaWNhdGlvbkNoYW5nZWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblJvb21TdGF0ZUV2ZW50cyA9IChldjogTWF0cml4RXZlbnQpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKGV2LmdldFR5cGUoKSAhPT0gRXZlbnRUeXBlLlJvb21FbmNyeXB0aW9uKSByZXR1cm47XG4gICAgICAgIGNvbnN0IHsgcm9vbUlkIH0gPSB0aGlzLnByb3BzLm1lbWJlcjtcbiAgICAgICAgaWYgKGV2LmdldFJvb21JZCgpICE9PSByb29tSWQpIHJldHVybjtcblxuICAgICAgICAvLyBUaGUgcm9vbSBpcyBlbmNyeXB0ZWQgbm93LlxuICAgICAgICBjb25zdCBjbGkgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCk7XG4gICAgICAgIGNsaS5yZW1vdmVMaXN0ZW5lcihSb29tU3RhdGVFdmVudC5FdmVudHMsIHRoaXMub25Sb29tU3RhdGVFdmVudHMpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGlzUm9vbUVuY3J5cHRlZDogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudXBkYXRlRTJFU3RhdHVzKCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Vc2VyVHJ1c3RTdGF0dXNDaGFuZ2VkID0gKHVzZXJJZDogc3RyaW5nLCB0cnVzdFN0YXR1czogVXNlclRydXN0TGV2ZWwpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKHVzZXJJZCAhPT0gdGhpcy5wcm9wcy5tZW1iZXIudXNlcklkKSByZXR1cm47XG4gICAgICAgIHRoaXMudXBkYXRlRTJFU3RhdHVzKCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25EZXZpY2VWZXJpZmljYXRpb25DaGFuZ2VkID0gKHVzZXJJZDogc3RyaW5nLCBkZXZpY2VJZDogc3RyaW5nLCBkZXZpY2VJbmZvOiBEZXZpY2VJbmZvKTogdm9pZCA9PiB7XG4gICAgICAgIGlmICh1c2VySWQgIT09IHRoaXMucHJvcHMubWVtYmVyLnVzZXJJZCkgcmV0dXJuO1xuICAgICAgICB0aGlzLnVwZGF0ZUUyRVN0YXR1cygpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIGFzeW5jIHVwZGF0ZUUyRVN0YXR1cygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgICAgICBjb25zdCB7IHVzZXJJZCB9ID0gdGhpcy5wcm9wcy5tZW1iZXI7XG4gICAgICAgIGNvbnN0IGlzTWUgPSB1c2VySWQgPT09IGNsaS5nZXRVc2VySWQoKTtcbiAgICAgICAgY29uc3QgdXNlclRydXN0ID0gY2xpLmNoZWNrVXNlclRydXN0KHVzZXJJZCk7XG4gICAgICAgIGlmICghdXNlclRydXN0LmlzQ3Jvc3NTaWduaW5nVmVyaWZpZWQoKSkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgZTJlU3RhdHVzOiB1c2VyVHJ1c3Qud2FzQ3Jvc3NTaWduaW5nVmVyaWZpZWQoKSA/IFwid2FybmluZ1wiIDogXCJub3JtYWxcIixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZGV2aWNlcyA9IGNsaS5nZXRTdG9yZWREZXZpY2VzRm9yVXNlcih1c2VySWQpO1xuICAgICAgICBjb25zdCBhbnlEZXZpY2VVbnZlcmlmaWVkID0gZGV2aWNlcy5zb21lKGRldmljZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGRldmljZUlkIH0gPSBkZXZpY2U7XG4gICAgICAgICAgICAvLyBGb3IgeW91ciBvd24gZGV2aWNlcywgd2UgdXNlIHRoZSBzdHJpY3RlciBjaGVjayBvZiBjcm9zcy1zaWduaW5nXG4gICAgICAgICAgICAvLyB2ZXJpZmljYXRpb24gdG8gZW5jb3VyYWdlIGV2ZXJ5b25lIHRvIHRydXN0IHRoZWlyIG93biBkZXZpY2VzIHZpYVxuICAgICAgICAgICAgLy8gY3Jvc3Mtc2lnbmluZyBzbyB0aGF0IG90aGVyIHVzZXJzIGNhbiB0aGVuIHNhZmVseSB0cnVzdCB5b3UuXG4gICAgICAgICAgICAvLyBGb3Igb3RoZXIgcGVvcGxlJ3MgZGV2aWNlcywgdGhlIG1vcmUgZ2VuZXJhbCB2ZXJpZmllZCBjaGVjayB0aGF0XG4gICAgICAgICAgICAvLyBpbmNsdWRlcyBsb2NhbGx5IHZlcmlmaWVkIGRldmljZXMgY2FuIGJlIHVzZWQuXG4gICAgICAgICAgICBjb25zdCBkZXZpY2VUcnVzdCA9IGNsaS5jaGVja0RldmljZVRydXN0KHVzZXJJZCwgZGV2aWNlSWQpO1xuICAgICAgICAgICAgcmV0dXJuIGlzTWUgPyAhZGV2aWNlVHJ1c3QuaXNDcm9zc1NpZ25pbmdWZXJpZmllZCgpIDogIWRldmljZVRydXN0LmlzVmVyaWZpZWQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZTJlU3RhdHVzOiBhbnlEZXZpY2VVbnZlcmlmaWVkID8gXCJ3YXJuaW5nXCIgOiBcInZlcmlmaWVkXCIsXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNob3VsZENvbXBvbmVudFVwZGF0ZShuZXh0UHJvcHM6IElQcm9wcywgbmV4dFN0YXRlOiBJU3RhdGUpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgdGhpcy5tZW1iZXJMYXN0TW9kaWZpZWRUaW1lID09PSB1bmRlZmluZWQgfHxcbiAgICAgICAgICAgIHRoaXMubWVtYmVyTGFzdE1vZGlmaWVkVGltZSA8IG5leHRQcm9wcy5tZW1iZXIuZ2V0TGFzdE1vZGlmaWVkVGltZSgpXG4gICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgbmV4dFByb3BzLm1lbWJlci51c2VyICYmXG4gICAgICAgICAgICAodGhpcy51c2VyTGFzdE1vZGlmaWVkVGltZSA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICAgICAgICB0aGlzLnVzZXJMYXN0TW9kaWZpZWRUaW1lIDwgbmV4dFByb3BzLm1lbWJlci51c2VyLmdldExhc3RNb2RpZmllZFRpbWUoKSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoXG4gICAgICAgICAgICBuZXh0U3RhdGUuaXNSb29tRW5jcnlwdGVkICE9PSB0aGlzLnN0YXRlLmlzUm9vbUVuY3J5cHRlZCB8fFxuICAgICAgICAgICAgbmV4dFN0YXRlLmUyZVN0YXR1cyAhPT0gdGhpcy5zdGF0ZS5lMmVTdGF0dXNcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkNsaWNrID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICBkaXMuZGlzcGF0Y2goe1xuICAgICAgICAgICAgYWN0aW9uOiBBY3Rpb24uVmlld1VzZXIsXG4gICAgICAgICAgICBtZW1iZXI6IHRoaXMucHJvcHMubWVtYmVyLFxuICAgICAgICAgICAgcHVzaDogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgZ2V0RGlzcGxheU5hbWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMubWVtYmVyLm5hbWU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQb3dlckxhYmVsKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBfdChcIiUodXNlck5hbWUpcyAocG93ZXIgJShwb3dlckxldmVsTnVtYmVyKXMpXCIsIHtcbiAgICAgICAgICAgIHVzZXJOYW1lOiBVc2VySWRlbnRpZmllckN1c3RvbWlzYXRpb25zLmdldERpc3BsYXlVc2VySWRlbnRpZmllcihcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLm1lbWJlci51c2VySWQsIHsgcm9vbUlkOiB0aGlzLnByb3BzLm1lbWJlci5yb29tSWQgfSxcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBwb3dlckxldmVsTnVtYmVyOiB0aGlzLnByb3BzLm1lbWJlci5wb3dlckxldmVsLFxuICAgICAgICB9KS50cmltKCk7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCBtZW1iZXIgPSB0aGlzLnByb3BzLm1lbWJlcjtcbiAgICAgICAgY29uc3QgbmFtZSA9IHRoaXMuZ2V0RGlzcGxheU5hbWUoKTtcbiAgICAgICAgY29uc3QgcHJlc2VuY2VTdGF0ZSA9IG1lbWJlci51c2VyID8gbWVtYmVyLnVzZXIucHJlc2VuY2UgOiBudWxsO1xuXG4gICAgICAgIGNvbnN0IGF2ID0gKFxuICAgICAgICAgICAgPE1lbWJlckF2YXRhciBtZW1iZXI9e21lbWJlcn0gd2lkdGg9ezM2fSBoZWlnaHQ9ezM2fSBhcmlhLWhpZGRlbj1cInRydWVcIiAvPlxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChtZW1iZXIudXNlcikge1xuICAgICAgICAgICAgdGhpcy51c2VyTGFzdE1vZGlmaWVkVGltZSA9IG1lbWJlci51c2VyLmdldExhc3RNb2RpZmllZFRpbWUoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1lbWJlckxhc3RNb2RpZmllZFRpbWUgPSBtZW1iZXIuZ2V0TGFzdE1vZGlmaWVkVGltZSgpO1xuXG4gICAgICAgIGNvbnN0IHBvd2VyU3RhdHVzTWFwID0gbmV3IE1hcChbXG4gICAgICAgICAgICBbMTAwLCBQb3dlclN0YXR1cy5BZG1pbl0sXG4gICAgICAgICAgICBbNTAsIFBvd2VyU3RhdHVzLk1vZGVyYXRvcl0sXG4gICAgICAgIF0pO1xuXG4gICAgICAgIC8vIEZpbmQgdGhlIG5lYXJlc3QgcG93ZXIgbGV2ZWwgd2l0aCBhIGJhZGdlXG4gICAgICAgIGxldCBwb3dlckxldmVsID0gdGhpcy5wcm9wcy5tZW1iZXIucG93ZXJMZXZlbDtcbiAgICAgICAgZm9yIChjb25zdCBbcGxdIG9mIHBvd2VyU3RhdHVzTWFwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5tZW1iZXIucG93ZXJMZXZlbCA+PSBwbCkge1xuICAgICAgICAgICAgICAgIHBvd2VyTGV2ZWwgPSBwbDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBvd2VyU3RhdHVzID0gcG93ZXJTdGF0dXNNYXAuZ2V0KHBvd2VyTGV2ZWwpO1xuXG4gICAgICAgIGxldCBlMmVTdGF0dXM7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmlzUm9vbUVuY3J5cHRlZCkge1xuICAgICAgICAgICAgZTJlU3RhdHVzID0gdGhpcy5zdGF0ZS5lMmVTdGF0dXM7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuYW1lSlNYID0gKFxuICAgICAgICAgICAgPERpc2FtYmlndWF0ZWRQcm9maWxlXG4gICAgICAgICAgICAgICAgbWVtYmVyPXttZW1iZXJ9XG4gICAgICAgICAgICAgICAgZmFsbGJhY2tOYW1lPXtuYW1lIHx8IFwiXCJ9XG4gICAgICAgICAgICAvPlxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8RW50aXR5VGlsZVxuICAgICAgICAgICAgICAgIHsuLi50aGlzLnByb3BzfVxuICAgICAgICAgICAgICAgIHByZXNlbmNlU3RhdGU9e3ByZXNlbmNlU3RhdGV9XG4gICAgICAgICAgICAgICAgcHJlc2VuY2VMYXN0QWN0aXZlQWdvPXttZW1iZXIudXNlciA/IG1lbWJlci51c2VyLmxhc3RBY3RpdmVBZ28gOiAwfVxuICAgICAgICAgICAgICAgIHByZXNlbmNlTGFzdFRzPXttZW1iZXIudXNlciA/IG1lbWJlci51c2VyLmxhc3RQcmVzZW5jZVRzIDogMH1cbiAgICAgICAgICAgICAgICBwcmVzZW5jZUN1cnJlbnRseUFjdGl2ZT17bWVtYmVyLnVzZXIgPyBtZW1iZXIudXNlci5jdXJyZW50bHlBY3RpdmUgOiBmYWxzZX1cbiAgICAgICAgICAgICAgICBhdmF0YXJKc3g9e2F2fVxuICAgICAgICAgICAgICAgIHRpdGxlPXt0aGlzLmdldFBvd2VyTGFiZWwoKX1cbiAgICAgICAgICAgICAgICBuYW1lPXtuYW1lfVxuICAgICAgICAgICAgICAgIG5hbWVKU1g9e25hbWVKU1h9XG4gICAgICAgICAgICAgICAgcG93ZXJTdGF0dXM9e3Bvd2VyU3RhdHVzfVxuICAgICAgICAgICAgICAgIHNob3dQcmVzZW5jZT17dGhpcy5wcm9wcy5zaG93UHJlc2VuY2V9XG4gICAgICAgICAgICAgICAgZTJlU3RhdHVzPXtlMmVTdGF0dXN9XG4gICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vbkNsaWNrfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFpQkE7O0FBR0E7O0FBRUE7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQWpDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQThCZSxNQUFNQSxVQUFOLFNBQXlCQyxjQUFBLENBQU1DLFNBQS9CLENBQXlEO0VBUXBFQyxXQUFXLENBQUNDLEtBQUQsRUFBUTtJQUNmLE1BQU1BLEtBQU47SUFEZTtJQUFBO0lBQUEseURBdUNVQyxFQUFELElBQTJCO01BQ25ELElBQUlBLEVBQUUsQ0FBQ0MsT0FBSCxPQUFpQkMsZ0JBQUEsQ0FBVUMsY0FBL0IsRUFBK0M7TUFDL0MsTUFBTTtRQUFFQztNQUFGLElBQWEsS0FBS0wsS0FBTCxDQUFXTSxNQUE5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
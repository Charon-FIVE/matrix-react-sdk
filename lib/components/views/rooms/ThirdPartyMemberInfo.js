"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _logger = require("matrix-js-sdk/src/logger");

var _roomState = require("matrix-js-sdk/src/models/room-state");

var _event = require("matrix-js-sdk/src/@types/event");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _languageHandler = require("../../../languageHandler");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _RoomInvite = require("../../../RoomInvite");

var _RoomAvatar = _interopRequireDefault(require("../avatars/RoomAvatar"));

var _RoomName = _interopRequireDefault(require("../elements/RoomName"));

var _ErrorDialog = _interopRequireDefault(require("../dialogs/ErrorDialog"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

/*
Copyright 2019-2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class ThirdPartyMemberInfo extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "room", void 0);
    (0, _defineProperty2.default)(this, "onRoomStateEvents", ev => {
      if (ev.getType() === _event.EventType.RoomThirdPartyInvite && ev.getStateKey() === this.state.stateKey) {
        const newDisplayName = ev.getContent().display_name;
        const isInvited = (0, _RoomInvite.isValid3pidInvite)(ev);
        const newState = {
          invited: isInvited
        };
        if (newDisplayName) newState['displayName'] = newDisplayName;
        this.setState(newState);
      }
    });
    (0, _defineProperty2.default)(this, "onCancel", () => {
      _dispatcher.default.dispatch({
        action: "view_3pid_invite",
        event: null
      });
    });
    (0, _defineProperty2.default)(this, "onKickClick", () => {
      _MatrixClientPeg.MatrixClientPeg.get().sendStateEvent(this.state.roomId, "m.room.third_party_invite", {}, this.state.stateKey).catch(err => {
        _logger.logger.error(err); // Revert echo because of error


        this.setState({
          invited: true
        });

        _Modal.default.createDialog(_ErrorDialog.default, {
          title: (0, _languageHandler._t)("Failed to revoke invite"),
          description: (0, _languageHandler._t)("Could not revoke the invite. The server may be experiencing a temporary problem or " + "you do not have sufficient permissions to revoke the invite.")
        });
      }); // Local echo


      this.setState({
        invited: false
      });
    });
    this.room = _MatrixClientPeg.MatrixClientPeg.get().getRoom(this.props.event.getRoomId());
    const me = this.room.getMember(_MatrixClientPeg.MatrixClientPeg.get().getUserId());
    const powerLevels = this.room.currentState.getStateEvents("m.room.power_levels", "");
    let kickLevel = powerLevels ? powerLevels.getContent().kick : 50;
    if (typeof kickLevel !== 'number') kickLevel = 50;
    const sender = this.room.getMember(this.props.event.getSender());
    this.state = {
      stateKey: this.props.event.getStateKey(),
      roomId: this.props.event.getRoomId(),
      displayName: this.props.event.getContent().display_name,
      invited: true,
      canKick: me ? me.powerLevel > kickLevel : false,
      senderName: sender ? sender.name : this.props.event.getSender()
    };
  }

  componentDidMount() {
    _MatrixClientPeg.MatrixClientPeg.get().on(_roomState.RoomStateEvent.Events, this.onRoomStateEvents);
  }

  componentWillUnmount() {
    const client = _MatrixClientPeg.MatrixClientPeg.get();

    if (client) {
      client.removeListener(_roomState.RoomStateEvent.Events, this.onRoomStateEvents);
    }
  }

  render() {
    let adminTools = null;

    if (this.state.canKick && this.state.invited) {
      adminTools = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo_container"
      }, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Admin Tools")), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo_buttons"
      }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        className: "mx_MemberInfo_field",
        onClick: this.onKickClick
      }, (0, _languageHandler._t)("Revoke invite"))));
    }

    let scopeHeader;

    if (this.room.isSpaceRoom()) {
      scopeHeader = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_RightPanel_scopeHeader"
      }, /*#__PURE__*/_react.default.createElement(_RoomAvatar.default, {
        room: this.room,
        height: 32,
        width: 32
      }), /*#__PURE__*/_react.default.createElement(_RoomName.default, {
        room: this.room
      }));
    } // We shamelessly rip off the MemberInfo styles here.


    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MemberInfo",
      role: "tabpanel"
    }, scopeHeader, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MemberInfo_name"
    }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      className: "mx_MemberInfo_cancel",
      onClick: this.onCancel,
      title: (0, _languageHandler._t)('Close')
    }), /*#__PURE__*/_react.default.createElement("h2", null, this.state.displayName)), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MemberInfo_container"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MemberInfo_profile"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MemberInfo_profileField"
    }, (0, _languageHandler._t)("Invited by %(sender)s", {
      sender: this.state.senderName
    })))), adminTools);
  }

}

exports.default = ThirdPartyMemberInfo;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJUaGlyZFBhcnR5TWVtYmVySW5mbyIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImV2IiwiZ2V0VHlwZSIsIkV2ZW50VHlwZSIsIlJvb21UaGlyZFBhcnR5SW52aXRlIiwiZ2V0U3RhdGVLZXkiLCJzdGF0ZSIsInN0YXRlS2V5IiwibmV3RGlzcGxheU5hbWUiLCJnZXRDb250ZW50IiwiZGlzcGxheV9uYW1lIiwiaXNJbnZpdGVkIiwiaXNWYWxpZDNwaWRJbnZpdGUiLCJuZXdTdGF0ZSIsImludml0ZWQiLCJzZXRTdGF0ZSIsImRpcyIsImRpc3BhdGNoIiwiYWN0aW9uIiwiZXZlbnQiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJzZW5kU3RhdGVFdmVudCIsInJvb21JZCIsImNhdGNoIiwiZXJyIiwibG9nZ2VyIiwiZXJyb3IiLCJNb2RhbCIsImNyZWF0ZURpYWxvZyIsIkVycm9yRGlhbG9nIiwidGl0bGUiLCJfdCIsImRlc2NyaXB0aW9uIiwicm9vbSIsImdldFJvb20iLCJnZXRSb29tSWQiLCJtZSIsImdldE1lbWJlciIsImdldFVzZXJJZCIsInBvd2VyTGV2ZWxzIiwiY3VycmVudFN0YXRlIiwiZ2V0U3RhdGVFdmVudHMiLCJraWNrTGV2ZWwiLCJraWNrIiwic2VuZGVyIiwiZ2V0U2VuZGVyIiwiZGlzcGxheU5hbWUiLCJjYW5LaWNrIiwicG93ZXJMZXZlbCIsInNlbmRlck5hbWUiLCJuYW1lIiwiY29tcG9uZW50RGlkTW91bnQiLCJvbiIsIlJvb21TdGF0ZUV2ZW50IiwiRXZlbnRzIiwib25Sb29tU3RhdGVFdmVudHMiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImNsaWVudCIsInJlbW92ZUxpc3RlbmVyIiwicmVuZGVyIiwiYWRtaW5Ub29scyIsIm9uS2lja0NsaWNrIiwic2NvcGVIZWFkZXIiLCJpc1NwYWNlUm9vbSIsIm9uQ2FuY2VsIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvdmlld3Mvcm9vbXMvVGhpcmRQYXJ0eU1lbWJlckluZm8udHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOS0yMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IE1hdHJpeEV2ZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9ldmVudFwiO1xuaW1wb3J0IHsgUm9vbSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvcm9vbVwiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuaW1wb3J0IHsgUm9vbVN0YXRlRXZlbnQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb20tc3RhdGVcIjtcbmltcG9ydCB7IEV2ZW50VHlwZSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9AdHlwZXMvZXZlbnRcIjtcblxuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSBcIi4uLy4uLy4uL01hdHJpeENsaWVudFBlZ1wiO1xuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5pbXBvcnQgZGlzIGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCBNb2RhbCBmcm9tIFwiLi4vLi4vLi4vTW9kYWxcIjtcbmltcG9ydCB7IGlzVmFsaWQzcGlkSW52aXRlIH0gZnJvbSBcIi4uLy4uLy4uL1Jvb21JbnZpdGVcIjtcbmltcG9ydCBSb29tQXZhdGFyIGZyb20gXCIuLi9hdmF0YXJzL1Jvb21BdmF0YXJcIjtcbmltcG9ydCBSb29tTmFtZSBmcm9tIFwiLi4vZWxlbWVudHMvUm9vbU5hbWVcIjtcbmltcG9ydCBFcnJvckRpYWxvZyBmcm9tICcuLi9kaWFsb2dzL0Vycm9yRGlhbG9nJztcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gJy4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b24nO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICBldmVudDogTWF0cml4RXZlbnQ7XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIHN0YXRlS2V5OiBzdHJpbmc7XG4gICAgcm9vbUlkOiBzdHJpbmc7XG4gICAgZGlzcGxheU5hbWU6IHN0cmluZztcbiAgICBpbnZpdGVkOiBib29sZWFuO1xuICAgIGNhbktpY2s6IGJvb2xlYW47XG4gICAgc2VuZGVyTmFtZTogc3RyaW5nO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUaGlyZFBhcnR5TWVtYmVySW5mbyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHByaXZhdGUgcm9vbTogUm9vbTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnJvb20gPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0Um9vbSh0aGlzLnByb3BzLmV2ZW50LmdldFJvb21JZCgpKTtcbiAgICAgICAgY29uc3QgbWUgPSB0aGlzLnJvb20uZ2V0TWVtYmVyKE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRVc2VySWQoKSk7XG4gICAgICAgIGNvbnN0IHBvd2VyTGV2ZWxzID0gdGhpcy5yb29tLmN1cnJlbnRTdGF0ZS5nZXRTdGF0ZUV2ZW50cyhcIm0ucm9vbS5wb3dlcl9sZXZlbHNcIiwgXCJcIik7XG5cbiAgICAgICAgbGV0IGtpY2tMZXZlbCA9IHBvd2VyTGV2ZWxzID8gcG93ZXJMZXZlbHMuZ2V0Q29udGVudCgpLmtpY2sgOiA1MDtcbiAgICAgICAgaWYgKHR5cGVvZihraWNrTGV2ZWwpICE9PSAnbnVtYmVyJykga2lja0xldmVsID0gNTA7XG5cbiAgICAgICAgY29uc3Qgc2VuZGVyID0gdGhpcy5yb29tLmdldE1lbWJlcih0aGlzLnByb3BzLmV2ZW50LmdldFNlbmRlcigpKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgc3RhdGVLZXk6IHRoaXMucHJvcHMuZXZlbnQuZ2V0U3RhdGVLZXkoKSxcbiAgICAgICAgICAgIHJvb21JZDogdGhpcy5wcm9wcy5ldmVudC5nZXRSb29tSWQoKSxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiB0aGlzLnByb3BzLmV2ZW50LmdldENvbnRlbnQoKS5kaXNwbGF5X25hbWUsXG4gICAgICAgICAgICBpbnZpdGVkOiB0cnVlLFxuICAgICAgICAgICAgY2FuS2ljazogbWUgPyBtZS5wb3dlckxldmVsID4ga2lja0xldmVsIDogZmFsc2UsXG4gICAgICAgICAgICBzZW5kZXJOYW1lOiBzZW5kZXIgPyBzZW5kZXIubmFtZSA6IHRoaXMucHJvcHMuZXZlbnQuZ2V0U2VuZGVyKCksXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkTW91bnQoKTogdm9pZCB7XG4gICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5vbihSb29tU3RhdGVFdmVudC5FdmVudHMsIHRoaXMub25Sb29tU3RhdGVFdmVudHMpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCk6IHZvaWQge1xuICAgICAgICBjb25zdCBjbGllbnQgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCk7XG4gICAgICAgIGlmIChjbGllbnQpIHtcbiAgICAgICAgICAgIGNsaWVudC5yZW1vdmVMaXN0ZW5lcihSb29tU3RhdGVFdmVudC5FdmVudHMsIHRoaXMub25Sb29tU3RhdGVFdmVudHMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25Sb29tU3RhdGVFdmVudHMgPSAoZXY6IE1hdHJpeEV2ZW50KSA9PiB7XG4gICAgICAgIGlmIChldi5nZXRUeXBlKCkgPT09IEV2ZW50VHlwZS5Sb29tVGhpcmRQYXJ0eUludml0ZSAmJiBldi5nZXRTdGF0ZUtleSgpID09PSB0aGlzLnN0YXRlLnN0YXRlS2V5KSB7XG4gICAgICAgICAgICBjb25zdCBuZXdEaXNwbGF5TmFtZSA9IGV2LmdldENvbnRlbnQoKS5kaXNwbGF5X25hbWU7XG4gICAgICAgICAgICBjb25zdCBpc0ludml0ZWQgPSBpc1ZhbGlkM3BpZEludml0ZShldik7XG5cbiAgICAgICAgICAgIGNvbnN0IG5ld1N0YXRlID0geyBpbnZpdGVkOiBpc0ludml0ZWQgfTtcbiAgICAgICAgICAgIGlmIChuZXdEaXNwbGF5TmFtZSkgbmV3U3RhdGVbJ2Rpc3BsYXlOYW1lJ10gPSBuZXdEaXNwbGF5TmFtZTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUobmV3U3RhdGUpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIG9uQ2FuY2VsID0gKCkgPT4ge1xuICAgICAgICBkaXMuZGlzcGF0Y2goe1xuICAgICAgICAgICAgYWN0aW9uOiBcInZpZXdfM3BpZF9pbnZpdGVcIixcbiAgICAgICAgICAgIGV2ZW50OiBudWxsLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgb25LaWNrQ2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5zZW5kU3RhdGVFdmVudCh0aGlzLnN0YXRlLnJvb21JZCwgXCJtLnJvb20udGhpcmRfcGFydHlfaW52aXRlXCIsIHt9LCB0aGlzLnN0YXRlLnN0YXRlS2V5KVxuICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyKTtcblxuICAgICAgICAgICAgICAgIC8vIFJldmVydCBlY2hvIGJlY2F1c2Ugb2YgZXJyb3JcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgaW52aXRlZDogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgICAgIE1vZGFsLmNyZWF0ZURpYWxvZyhFcnJvckRpYWxvZywge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogX3QoXCJGYWlsZWQgdG8gcmV2b2tlIGludml0ZVwiKSxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJDb3VsZCBub3QgcmV2b2tlIHRoZSBpbnZpdGUuIFRoZSBzZXJ2ZXIgbWF5IGJlIGV4cGVyaWVuY2luZyBhIHRlbXBvcmFyeSBwcm9ibGVtIG9yIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwieW91IGRvIG5vdCBoYXZlIHN1ZmZpY2llbnQgcGVybWlzc2lvbnMgdG8gcmV2b2tlIHRoZSBpbnZpdGUuXCIsXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBMb2NhbCBlY2hvXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpbnZpdGVkOiBmYWxzZSB9KTtcbiAgICB9O1xuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBsZXQgYWRtaW5Ub29scyA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmNhbktpY2sgJiYgdGhpcy5zdGF0ZS5pbnZpdGVkKSB7XG4gICAgICAgICAgICBhZG1pblRvb2xzID0gKFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfTWVtYmVySW5mb19jb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPGgzPnsgX3QoXCJBZG1pbiBUb29sc1wiKSB9PC9oMz5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9NZW1iZXJJbmZvX2J1dHRvbnNcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9fZmllbGRcIiBvbkNsaWNrPXt0aGlzLm9uS2lja0NsaWNrfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiUmV2b2tlIGludml0ZVwiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBzY29wZUhlYWRlcjtcbiAgICAgICAgaWYgKHRoaXMucm9vbS5pc1NwYWNlUm9vbSgpKSB7XG4gICAgICAgICAgICBzY29wZUhlYWRlciA9IDxkaXYgY2xhc3NOYW1lPVwibXhfUmlnaHRQYW5lbF9zY29wZUhlYWRlclwiPlxuICAgICAgICAgICAgICAgIDxSb29tQXZhdGFyIHJvb209e3RoaXMucm9vbX0gaGVpZ2h0PXszMn0gd2lkdGg9ezMyfSAvPlxuICAgICAgICAgICAgICAgIDxSb29tTmFtZSByb29tPXt0aGlzLnJvb219IC8+XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBXZSBzaGFtZWxlc3NseSByaXAgb2ZmIHRoZSBNZW1iZXJJbmZvIHN0eWxlcyBoZXJlLlxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9NZW1iZXJJbmZvXCIgcm9sZT1cInRhYnBhbmVsXCI+XG4gICAgICAgICAgICAgICAgeyBzY29wZUhlYWRlciB9XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9NZW1iZXJJbmZvX25hbWVcIj5cbiAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gY2xhc3NOYW1lPVwibXhfTWVtYmVySW5mb19jYW5jZWxcIlxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vbkNhbmNlbH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPXtfdCgnQ2xvc2UnKX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPGgyPnsgdGhpcy5zdGF0ZS5kaXNwbGF5TmFtZSB9PC9oMj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9fY29udGFpbmVyXCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfTWVtYmVySW5mb19wcm9maWxlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9fcHJvZmlsZUZpZWxkXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIkludml0ZWQgYnkgJShzZW5kZXIpc1wiLCB7IHNlbmRlcjogdGhpcy5zdGF0ZS5zZW5kZXJOYW1lIH0pIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICB7IGFkbWluVG9vbHMgfVxuICAgICAgICAgICAgPC9kaXY+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
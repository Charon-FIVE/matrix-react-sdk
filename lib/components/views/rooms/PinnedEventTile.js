"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _relations = require("matrix-js-sdk/src/models/relations");

var _event = require("matrix-js-sdk/src/@types/event");

var _logger = require("matrix-js-sdk/src/logger");

var _matrixEventsSdk = require("matrix-events-sdk");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _actions = require("../../../dispatcher/actions");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _MessageEvent = _interopRequireDefault(require("../messages/MessageEvent"));

var _MemberAvatar = _interopRequireDefault(require("../avatars/MemberAvatar"));

var _languageHandler = require("../../../languageHandler");

var _DateUtils = require("../../../DateUtils");

var _MatrixClientContext = _interopRequireDefault(require("../../../contexts/MatrixClientContext"));

var _FormattingUtils = require("../../../utils/FormattingUtils");

var _AccessibleTooltipButton = _interopRequireDefault(require("../elements/AccessibleTooltipButton"));

/*
Copyright 2017 Travis Ralston
Copyright 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const AVATAR_SIZE = 24;

class PinnedEventTile extends _react.default.Component {
  constructor() {
    super(...arguments);
    (0, _defineProperty2.default)(this, "onTileClicked", () => {
      _dispatcher.default.dispatch({
        action: _actions.Action.ViewRoom,
        event_id: this.props.event.getId(),
        highlighted: true,
        room_id: this.props.event.getRoomId(),
        metricsTrigger: undefined // room doesn't change

      });
    });
    (0, _defineProperty2.default)(this, "relations", new Map());
    (0, _defineProperty2.default)(this, "getRelationsForEvent", (eventId, relationType, eventType) => {
      if (eventId === this.props.event.getId()) {
        return this.relations.get(relationType)?.get(eventType);
      }
    });
  }

  async componentDidMount() {
    // Fetch poll responses
    if (_matrixEventsSdk.M_POLL_START.matches(this.props.event.getType())) {
      const eventId = this.props.event.getId();
      const roomId = this.props.event.getRoomId();
      const room = this.context.getRoom(roomId);

      try {
        await Promise.all([_matrixEventsSdk.M_POLL_RESPONSE.name, _matrixEventsSdk.M_POLL_RESPONSE.altName, _matrixEventsSdk.M_POLL_END.name, _matrixEventsSdk.M_POLL_END.altName].map(async eventType => {
          const relations = new _relations.Relations(_event.RelationType.Reference, eventType, room);
          relations.setTargetEvent(this.props.event);

          if (!this.relations.has(_event.RelationType.Reference)) {
            this.relations.set(_event.RelationType.Reference, new Map());
          }

          this.relations.get(_event.RelationType.Reference).set(eventType, relations);
          let nextBatch;

          do {
            const page = await this.context.relations(roomId, eventId, _event.RelationType.Reference, eventType, {
              from: nextBatch
            });
            nextBatch = page.nextBatch;
            page.events.forEach(event => relations.addEvent(event));
          } while (nextBatch);
        }));
      } catch (err) {
        _logger.logger.error(`Error fetching responses to pinned poll ${eventId} in room ${roomId}`);

        _logger.logger.error(err);
      }
    }
  }

  render() {
    const sender = this.props.event.getSender();
    let unpinButton = null;

    if (this.props.onUnpinClicked) {
      unpinButton = /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
        onClick: this.props.onUnpinClicked,
        className: "mx_PinnedEventTile_unpinButton",
        title: (0, _languageHandler._t)("Unpin")
      });
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_PinnedEventTile"
    }, /*#__PURE__*/_react.default.createElement(_MemberAvatar.default, {
      className: "mx_PinnedEventTile_senderAvatar",
      member: this.props.event.sender,
      width: AVATAR_SIZE,
      height: AVATAR_SIZE,
      fallbackUserId: sender
    }), /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_PinnedEventTile_sender " + (0, _FormattingUtils.getUserNameColorClass)(sender)
    }, this.props.event.sender?.name || sender), unpinButton, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_PinnedEventTile_message"
    }, /*#__PURE__*/_react.default.createElement(_MessageEvent.default, {
      mxEvent: this.props.event,
      getRelationsForEvent: this.getRelationsForEvent // @ts-ignore - complaining that className is invalid when it's not
      ,
      className: "mx_PinnedEventTile_body",
      maxImageHeight: 150,
      onHeightChanged: () => {} // we need to give this, apparently
      ,
      permalinkCreator: this.props.permalinkCreator,
      replacingEventId: this.props.event.replacingEventId()
    })), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_PinnedEventTile_footer"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_MessageTimestamp mx_PinnedEventTile_timestamp"
    }, (0, _DateUtils.formatDate)(new Date(this.props.event.getTs()))), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.onTileClicked,
      kind: "link"
    }, (0, _languageHandler._t)("View message"))));
  }

}

exports.default = PinnedEventTile;
(0, _defineProperty2.default)(PinnedEventTile, "contextType", _MatrixClientContext.default);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBVkFUQVJfU0laRSIsIlBpbm5lZEV2ZW50VGlsZSIsIlJlYWN0IiwiQ29tcG9uZW50IiwiZGlzIiwiZGlzcGF0Y2giLCJhY3Rpb24iLCJBY3Rpb24iLCJWaWV3Um9vbSIsImV2ZW50X2lkIiwicHJvcHMiLCJldmVudCIsImdldElkIiwiaGlnaGxpZ2h0ZWQiLCJyb29tX2lkIiwiZ2V0Um9vbUlkIiwibWV0cmljc1RyaWdnZXIiLCJ1bmRlZmluZWQiLCJNYXAiLCJldmVudElkIiwicmVsYXRpb25UeXBlIiwiZXZlbnRUeXBlIiwicmVsYXRpb25zIiwiZ2V0IiwiY29tcG9uZW50RGlkTW91bnQiLCJNX1BPTExfU1RBUlQiLCJtYXRjaGVzIiwiZ2V0VHlwZSIsInJvb21JZCIsInJvb20iLCJjb250ZXh0IiwiZ2V0Um9vbSIsIlByb21pc2UiLCJhbGwiLCJNX1BPTExfUkVTUE9OU0UiLCJuYW1lIiwiYWx0TmFtZSIsIk1fUE9MTF9FTkQiLCJtYXAiLCJSZWxhdGlvbnMiLCJSZWxhdGlvblR5cGUiLCJSZWZlcmVuY2UiLCJzZXRUYXJnZXRFdmVudCIsImhhcyIsInNldCIsIm5leHRCYXRjaCIsInBhZ2UiLCJmcm9tIiwiZXZlbnRzIiwiZm9yRWFjaCIsImFkZEV2ZW50IiwiZXJyIiwibG9nZ2VyIiwiZXJyb3IiLCJyZW5kZXIiLCJzZW5kZXIiLCJnZXRTZW5kZXIiLCJ1bnBpbkJ1dHRvbiIsIm9uVW5waW5DbGlja2VkIiwiX3QiLCJnZXRVc2VyTmFtZUNvbG9yQ2xhc3MiLCJnZXRSZWxhdGlvbnNGb3JFdmVudCIsInBlcm1hbGlua0NyZWF0b3IiLCJyZXBsYWNpbmdFdmVudElkIiwiZm9ybWF0RGF0ZSIsIkRhdGUiLCJnZXRUcyIsIm9uVGlsZUNsaWNrZWQiLCJNYXRyaXhDbGllbnRDb250ZXh0Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvdmlld3Mvcm9vbXMvUGlubmVkRXZlbnRUaWxlLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTcgVHJhdmlzIFJhbHN0b25cbkNvcHlyaWdodCAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgTWF0cml4RXZlbnQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL2V2ZW50XCI7XG5pbXBvcnQgeyBSZWxhdGlvbnMgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3JlbGF0aW9uc1wiO1xuaW1wb3J0IHsgRXZlbnRUeXBlLCBSZWxhdGlvblR5cGUgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvQHR5cGVzL2V2ZW50XCI7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbG9nZ2VyXCI7XG5pbXBvcnQgeyBNX1BPTExfU1RBUlQsIE1fUE9MTF9SRVNQT05TRSwgTV9QT0xMX0VORCB9IGZyb20gXCJtYXRyaXgtZXZlbnRzLXNka1wiO1xuXG5pbXBvcnQgZGlzIGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2FjdGlvbnNcIjtcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gXCIuLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uXCI7XG5pbXBvcnQgTWVzc2FnZUV2ZW50IGZyb20gXCIuLi9tZXNzYWdlcy9NZXNzYWdlRXZlbnRcIjtcbmltcG9ydCBNZW1iZXJBdmF0YXIgZnJvbSBcIi4uL2F2YXRhcnMvTWVtYmVyQXZhdGFyXCI7XG5pbXBvcnQgeyBfdCB9IGZyb20gJy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlcic7XG5pbXBvcnQgeyBmb3JtYXREYXRlIH0gZnJvbSAnLi4vLi4vLi4vRGF0ZVV0aWxzJztcbmltcG9ydCBNYXRyaXhDbGllbnRDb250ZXh0IGZyb20gXCIuLi8uLi8uLi9jb250ZXh0cy9NYXRyaXhDbGllbnRDb250ZXh0XCI7XG5pbXBvcnQgeyBnZXRVc2VyTmFtZUNvbG9yQ2xhc3MgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvRm9ybWF0dGluZ1V0aWxzXCI7XG5pbXBvcnQgQWNjZXNzaWJsZVRvb2x0aXBCdXR0b24gZnJvbSBcIi4uL2VsZW1lbnRzL0FjY2Vzc2libGVUb29sdGlwQnV0dG9uXCI7XG5pbXBvcnQgeyBWaWV3Um9vbVBheWxvYWQgfSBmcm9tIFwiLi4vLi4vLi4vZGlzcGF0Y2hlci9wYXlsb2Fkcy9WaWV3Um9vbVBheWxvYWRcIjtcbmltcG9ydCB7IFJvb21QZXJtYWxpbmtDcmVhdG9yIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3Blcm1hbGlua3MvUGVybWFsaW5rc1wiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICBldmVudDogTWF0cml4RXZlbnQ7XG4gICAgcGVybWFsaW5rQ3JlYXRvcjogUm9vbVBlcm1hbGlua0NyZWF0b3I7XG4gICAgb25VbnBpbkNsaWNrZWQ/KCk6IHZvaWQ7XG59XG5cbmNvbnN0IEFWQVRBUl9TSVpFID0gMjQ7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBpbm5lZEV2ZW50VGlsZSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHM+IHtcbiAgICBwdWJsaWMgc3RhdGljIGNvbnRleHRUeXBlID0gTWF0cml4Q2xpZW50Q29udGV4dDtcblxuICAgIHByaXZhdGUgb25UaWxlQ2xpY2tlZCA9ICgpID0+IHtcbiAgICAgICAgZGlzLmRpc3BhdGNoPFZpZXdSb29tUGF5bG9hZD4oe1xuICAgICAgICAgICAgYWN0aW9uOiBBY3Rpb24uVmlld1Jvb20sXG4gICAgICAgICAgICBldmVudF9pZDogdGhpcy5wcm9wcy5ldmVudC5nZXRJZCgpLFxuICAgICAgICAgICAgaGlnaGxpZ2h0ZWQ6IHRydWUsXG4gICAgICAgICAgICByb29tX2lkOiB0aGlzLnByb3BzLmV2ZW50LmdldFJvb21JZCgpLFxuICAgICAgICAgICAgbWV0cmljc1RyaWdnZXI6IHVuZGVmaW5lZCwgLy8gcm9vbSBkb2Vzbid0IGNoYW5nZVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLy8gRm9yIGV2ZW50IHR5cGVzIGxpa2UgcG9sbHMgdGhhdCB1c2UgcmVsYXRpb25zLCB3ZSBmZXRjaCB0aG9zZSBtYW51YWxseSBvblxuICAgIC8vIG1vdW50IGFuZCBzdG9yZSB0aGVtIGhlcmUsIGV4cG9zaW5nIHRoZW0gdGhyb3VnaCBnZXRSZWxhdGlvbnNGb3JFdmVudFxuICAgIHByaXZhdGUgcmVsYXRpb25zID0gbmV3IE1hcDxzdHJpbmcsIE1hcDxzdHJpbmcsIFJlbGF0aW9ucz4+KCk7XG4gICAgcHJpdmF0ZSBnZXRSZWxhdGlvbnNGb3JFdmVudCA9IChcbiAgICAgICAgZXZlbnRJZDogc3RyaW5nLFxuICAgICAgICByZWxhdGlvblR5cGU6IFJlbGF0aW9uVHlwZSB8IHN0cmluZyxcbiAgICAgICAgZXZlbnRUeXBlOiBFdmVudFR5cGUgfCBzdHJpbmcsXG4gICAgKTogUmVsYXRpb25zID0+IHtcbiAgICAgICAgaWYgKGV2ZW50SWQgPT09IHRoaXMucHJvcHMuZXZlbnQuZ2V0SWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVsYXRpb25zLmdldChyZWxhdGlvblR5cGUpPy5nZXQoZXZlbnRUeXBlKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhc3luYyBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgLy8gRmV0Y2ggcG9sbCByZXNwb25zZXNcbiAgICAgICAgaWYgKE1fUE9MTF9TVEFSVC5tYXRjaGVzKHRoaXMucHJvcHMuZXZlbnQuZ2V0VHlwZSgpKSkge1xuICAgICAgICAgICAgY29uc3QgZXZlbnRJZCA9IHRoaXMucHJvcHMuZXZlbnQuZ2V0SWQoKTtcbiAgICAgICAgICAgIGNvbnN0IHJvb21JZCA9IHRoaXMucHJvcHMuZXZlbnQuZ2V0Um9vbUlkKCk7XG4gICAgICAgICAgICBjb25zdCByb29tID0gdGhpcy5jb250ZXh0LmdldFJvb20ocm9vbUlkKTtcblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICAgICAgICAgICAgW01fUE9MTF9SRVNQT05TRS5uYW1lLCBNX1BPTExfUkVTUE9OU0UuYWx0TmFtZSwgTV9QT0xMX0VORC5uYW1lLCBNX1BPTExfRU5ELmFsdE5hbWVdXG4gICAgICAgICAgICAgICAgICAgICAgICAubWFwKGFzeW5jIGV2ZW50VHlwZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVsYXRpb25zID0gbmV3IFJlbGF0aW9ucyhSZWxhdGlvblR5cGUuUmVmZXJlbmNlLCBldmVudFR5cGUsIHJvb20pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aW9ucy5zZXRUYXJnZXRFdmVudCh0aGlzLnByb3BzLmV2ZW50KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5yZWxhdGlvbnMuaGFzKFJlbGF0aW9uVHlwZS5SZWZlcmVuY2UpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVsYXRpb25zLnNldChSZWxhdGlvblR5cGUuUmVmZXJlbmNlLCBuZXcgTWFwPHN0cmluZywgUmVsYXRpb25zPigpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWxhdGlvbnMuZ2V0KFJlbGF0aW9uVHlwZS5SZWZlcmVuY2UpLnNldChldmVudFR5cGUsIHJlbGF0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbmV4dEJhdGNoOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYWdlID0gYXdhaXQgdGhpcy5jb250ZXh0LnJlbGF0aW9ucyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb21JZCwgZXZlbnRJZCwgUmVsYXRpb25UeXBlLlJlZmVyZW5jZSwgZXZlbnRUeXBlLCB7IGZyb206IG5leHRCYXRjaCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0QmF0Y2ggPSBwYWdlLm5leHRCYXRjaDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZS5ldmVudHMuZm9yRWFjaChldmVudCA9PiByZWxhdGlvbnMuYWRkRXZlbnQoZXZlbnQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlIChuZXh0QmF0Y2gpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgZmV0Y2hpbmcgcmVzcG9uc2VzIHRvIHBpbm5lZCBwb2xsICR7ZXZlbnRJZH0gaW4gcm9vbSAke3Jvb21JZH1gKTtcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3Qgc2VuZGVyID0gdGhpcy5wcm9wcy5ldmVudC5nZXRTZW5kZXIoKTtcblxuICAgICAgICBsZXQgdW5waW5CdXR0b24gPSBudWxsO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5vblVucGluQ2xpY2tlZCkge1xuICAgICAgICAgICAgdW5waW5CdXR0b24gPSAoXG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVUb29sdGlwQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMucHJvcHMub25VbnBpbkNsaWNrZWR9XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1Bpbm5lZEV2ZW50VGlsZV91bnBpbkJ1dHRvblwiXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlPXtfdChcIlVucGluXCIpfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwibXhfUGlubmVkRXZlbnRUaWxlXCI+XG4gICAgICAgICAgICA8TWVtYmVyQXZhdGFyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfUGlubmVkRXZlbnRUaWxlX3NlbmRlckF2YXRhclwiXG4gICAgICAgICAgICAgICAgbWVtYmVyPXt0aGlzLnByb3BzLmV2ZW50LnNlbmRlcn1cbiAgICAgICAgICAgICAgICB3aWR0aD17QVZBVEFSX1NJWkV9XG4gICAgICAgICAgICAgICAgaGVpZ2h0PXtBVkFUQVJfU0laRX1cbiAgICAgICAgICAgICAgICBmYWxsYmFja1VzZXJJZD17c2VuZGVyfVxuICAgICAgICAgICAgLz5cblxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXtcIm14X1Bpbm5lZEV2ZW50VGlsZV9zZW5kZXIgXCIgKyBnZXRVc2VyTmFtZUNvbG9yQ2xhc3Moc2VuZGVyKX0+XG4gICAgICAgICAgICAgICAgeyB0aGlzLnByb3BzLmV2ZW50LnNlbmRlcj8ubmFtZSB8fCBzZW5kZXIgfVxuICAgICAgICAgICAgPC9zcGFuPlxuXG4gICAgICAgICAgICB7IHVucGluQnV0dG9uIH1cblxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9QaW5uZWRFdmVudFRpbGVfbWVzc2FnZVwiPlxuICAgICAgICAgICAgICAgIDxNZXNzYWdlRXZlbnRcbiAgICAgICAgICAgICAgICAgICAgbXhFdmVudD17dGhpcy5wcm9wcy5ldmVudH1cbiAgICAgICAgICAgICAgICAgICAgZ2V0UmVsYXRpb25zRm9yRXZlbnQ9e3RoaXMuZ2V0UmVsYXRpb25zRm9yRXZlbnR9XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUgLSBjb21wbGFpbmluZyB0aGF0IGNsYXNzTmFtZSBpcyBpbnZhbGlkIHdoZW4gaXQncyBub3RcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfUGlubmVkRXZlbnRUaWxlX2JvZHlcIlxuICAgICAgICAgICAgICAgICAgICBtYXhJbWFnZUhlaWdodD17MTUwfVxuICAgICAgICAgICAgICAgICAgICBvbkhlaWdodENoYW5nZWQ9eygpID0+IHt9fSAvLyB3ZSBuZWVkIHRvIGdpdmUgdGhpcywgYXBwYXJlbnRseVxuICAgICAgICAgICAgICAgICAgICBwZXJtYWxpbmtDcmVhdG9yPXt0aGlzLnByb3BzLnBlcm1hbGlua0NyZWF0b3J9XG4gICAgICAgICAgICAgICAgICAgIHJlcGxhY2luZ0V2ZW50SWQ9e3RoaXMucHJvcHMuZXZlbnQucmVwbGFjaW5nRXZlbnRJZCgpfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9QaW5uZWRFdmVudFRpbGVfZm9vdGVyXCI+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfTWVzc2FnZVRpbWVzdGFtcCBteF9QaW5uZWRFdmVudFRpbGVfdGltZXN0YW1wXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgZm9ybWF0RGF0ZShuZXcgRGF0ZSh0aGlzLnByb3BzLmV2ZW50LmdldFRzKCkpKSB9XG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuXG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gb25DbGljaz17dGhpcy5vblRpbGVDbGlja2VkfSBraW5kPVwibGlua1wiPlxuICAgICAgICAgICAgICAgICAgICB7IF90KFwiVmlldyBtZXNzYWdlXCIpIH1cbiAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+O1xuICAgIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpQkE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNEJBLE1BQU1BLFdBQVcsR0FBRyxFQUFwQjs7QUFFZSxNQUFNQyxlQUFOLFNBQThCQyxjQUFBLENBQU1DLFNBQXBDLENBQXNEO0VBQUE7SUFBQTtJQUFBLHFEQUd6QyxNQUFNO01BQzFCQyxtQkFBQSxDQUFJQyxRQUFKLENBQThCO1FBQzFCQyxNQUFNLEVBQUVDLGVBQUEsQ0FBT0MsUUFEVztRQUUxQkMsUUFBUSxF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
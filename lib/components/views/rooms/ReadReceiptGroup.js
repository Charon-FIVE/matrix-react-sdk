"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.READ_AVATAR_SIZE = void 0;
exports.ReadReceiptGroup = ReadReceiptGroup;
exports.determineAvatarPosition = determineAvatarPosition;
exports.readReceiptTooltip = readReceiptTooltip;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _react = _interopRequireWildcard(require("react"));

var _ReadReceiptMarker = _interopRequireDefault(require("./ReadReceiptMarker"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _MemberAvatar = _interopRequireDefault(require("../avatars/MemberAvatar"));

var _AutoHideScrollbar = _interopRequireDefault(require("../../structures/AutoHideScrollbar"));

var _Tooltip = require("../elements/Tooltip");

var _DateUtils = require("../../../DateUtils");

var _actions = require("../../../dispatcher/actions");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _ContextMenu = _interopRequireWildcard(require("../../structures/ContextMenu"));

var _useTooltip = require("../../../utils/useTooltip");

var _languageHandler = require("../../../languageHandler");

var _RovingTabIndex = require("../../../accessibility/RovingTabIndex");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2022 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
// #20547 Design specified that we should show the three latest read receipts
const MAX_READ_AVATARS_PLUS_N = 3; // #21935 If we’ve got just 4, don’t show +1, just show all of them

const MAX_READ_AVATARS = MAX_READ_AVATARS_PLUS_N + 1;
const READ_AVATAR_OFFSET = 10;
const READ_AVATAR_SIZE = 16;
exports.READ_AVATAR_SIZE = READ_AVATAR_SIZE;

function determineAvatarPosition(index, max) {
  if (index < max) {
    return {
      hidden: false,
      position: index
    };
  } else {
    return {
      hidden: true,
      position: 0
    };
  }
}

function readReceiptTooltip(members, hasMore) {
  if (hasMore) {
    return (0, _languageHandler._t)("%(members)s and more", {
      members: members.join(", ")
    });
  } else if (members.length > 1) {
    return (0, _languageHandler._t)("%(members)s and %(last)s", {
      last: members.pop(),
      members: members.join(", ")
    });
  } else if (members.length) {
    return members[0];
  } else {
    return null;
  }
}

function ReadReceiptGroup(_ref) {
  let {
    readReceipts,
    readReceiptMap,
    checkUnmounting,
    suppressAnimation,
    isTwelveHour
  } = _ref;
  const [menuDisplayed, button, openMenu, closeMenu] = (0, _ContextMenu.useContextMenu)(); // If we are above MAX_READ_AVATARS, we’ll have to remove a few to have space for the +n count.

  const hasMore = readReceipts.length > MAX_READ_AVATARS;
  const maxAvatars = hasMore ? MAX_READ_AVATARS_PLUS_N : MAX_READ_AVATARS;
  const tooltipMembers = readReceipts.slice(0, maxAvatars).map(it => it.roomMember?.name ?? it.userId);
  const tooltipText = readReceiptTooltip(tooltipMembers, hasMore);
  const [{
    showTooltip,
    hideTooltip
  }, tooltip] = (0, _useTooltip.useTooltip)({
    label: /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Tooltip_title"
    }, (0, _languageHandler._t)("Seen by %(count)s people", {
      count: readReceipts.length
    })), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Tooltip_sub"
    }, tooltipText)),
    alignment: _Tooltip.Alignment.TopRight
  }); // return early if there are no read receipts

  if (readReceipts.length === 0) {
    // We currently must include `mx_ReadReceiptGroup_container` in
    // the DOM of all events, as it is the positioned parent of the
    // animated read receipts. We can't let it unmount when a receipt
    // moves events, so for now we mount it for all events. Without
    // it, the animation will start from the top of the timeline
    // (because it lost its container).
    // See also https://github.com/vector-im/element-web/issues/17561
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_EventTile_msgOption"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ReadReceiptGroup"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ReadReceiptGroup_button"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_ReadReceiptGroup_container"
    }))));
  }

  const avatars = readReceipts.map((receipt, index) => {
    const {
      hidden,
      position
    } = determineAvatarPosition(index, maxAvatars);
    const userId = receipt.userId;
    let readReceiptInfo;

    if (readReceiptMap) {
      readReceiptInfo = readReceiptMap[userId];

      if (!readReceiptInfo) {
        readReceiptInfo = {};
        readReceiptMap[userId] = readReceiptInfo;
      }
    }

    return /*#__PURE__*/_react.default.createElement(_ReadReceiptMarker.default, {
      key: userId,
      member: receipt.roomMember,
      fallbackUserId: userId,
      offset: position * READ_AVATAR_OFFSET,
      hidden: hidden,
      readReceiptInfo: readReceiptInfo,
      checkUnmounting: checkUnmounting,
      suppressAnimation: suppressAnimation,
      timestamp: receipt.ts,
      showTwelveHour: isTwelveHour
    });
  }).reverse();
  let remText;
  const remainder = readReceipts.length - maxAvatars;

  if (remainder > 0) {
    remText = /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_ReadReceiptGroup_remainder",
      "aria-live": "off"
    }, "+", remainder);
  }

  let contextMenu;

  if (menuDisplayed) {
    const buttonRect = button.current.getBoundingClientRect();
    contextMenu = /*#__PURE__*/_react.default.createElement(_ContextMenu.default, (0, _extends2.default)({
      menuClassName: "mx_ReadReceiptGroup_popup",
      onFinished: closeMenu
    }, (0, _ContextMenu.aboveLeftOf)(buttonRect)), /*#__PURE__*/_react.default.createElement(_AutoHideScrollbar.default, null, /*#__PURE__*/_react.default.createElement(SectionHeader, {
      className: "mx_ReadReceiptGroup_title"
    }, (0, _languageHandler._t)("Seen by %(count)s people", {
      count: readReceipts.length
    })), readReceipts.map(receipt => /*#__PURE__*/_react.default.createElement(ReadReceiptPerson, (0, _extends2.default)({
      key: receipt.userId
    }, receipt, {
      isTwelveHour: isTwelveHour,
      onAfterClick: closeMenu
    })))));
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_EventTile_msgOption"
  }, /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_ReadReceiptGroup",
    role: "group",
    "aria-label": (0, _languageHandler._t)("Read receipts")
  }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
    className: "mx_ReadReceiptGroup_button",
    inputRef: button,
    "aria-label": tooltipText,
    "aria-haspopup": "true",
    onClick: openMenu,
    onMouseOver: showTooltip,
    onMouseLeave: hideTooltip,
    onFocus: showTooltip,
    onBlur: hideTooltip
  }, remText, /*#__PURE__*/_react.default.createElement("span", {
    className: "mx_ReadReceiptGroup_container",
    style: {
      width: Math.min(maxAvatars, readReceipts.length) * READ_AVATAR_OFFSET + READ_AVATAR_SIZE - READ_AVATAR_OFFSET
    }
  }, avatars)), tooltip, contextMenu));
}

function ReadReceiptPerson(_ref2) {
  let {
    userId,
    roomMember,
    ts,
    isTwelveHour,
    onAfterClick
  } = _ref2;
  const [{
    showTooltip,
    hideTooltip
  }, tooltip] = (0, _useTooltip.useTooltip)({
    alignment: _Tooltip.Alignment.Top,
    tooltipClassName: "mx_ReadReceiptGroup_person--tooltip",
    label: /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Tooltip_title"
    }, roomMember?.rawDisplayName ?? userId), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Tooltip_sub"
    }, userId))
  });
  return /*#__PURE__*/_react.default.createElement(_ContextMenu.MenuItem, {
    className: "mx_ReadReceiptGroup_person",
    onClick: () => {
      _dispatcher.default.dispatch({
        action: _actions.Action.ViewUser,
        // XXX: We should be using a real member object and not assuming what the receiver wants.
        // The ViewUser action leads to the RightPanelStore, and RightPanelStoreIPanelState defines the
        // member property of IRightPanelCardState as `RoomMember | User`, so we’re fine for now, but we
        // should definitely clean this up later
        member: roomMember ?? {
          userId
        },
        push: false
      });

      onAfterClick?.();
    },
    onMouseOver: showTooltip,
    onMouseLeave: hideTooltip,
    onFocus: showTooltip,
    onBlur: hideTooltip,
    onWheel: hideTooltip
  }, /*#__PURE__*/_react.default.createElement(_MemberAvatar.default, {
    member: roomMember,
    fallbackUserId: userId,
    width: 24,
    height: 24,
    "aria-hidden": "true",
    "aria-live": "off",
    resizeMethod: "crop",
    hideTitle: true
  }), /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_ReadReceiptGroup_name"
  }, /*#__PURE__*/_react.default.createElement("p", null, roomMember?.name ?? userId), /*#__PURE__*/_react.default.createElement("p", {
    className: "mx_ReadReceiptGroup_secondary"
  }, (0, _DateUtils.formatDate)(new Date(ts), isTwelveHour))), tooltip);
}

function SectionHeader(_ref3) {
  let {
    className,
    children
  } = _ref3;
  const ref = (0, _react.useRef)();
  const [onFocus] = (0, _RovingTabIndex.useRovingTabIndex)(ref);
  return /*#__PURE__*/_react.default.createElement("h3", {
    className: className,
    role: "menuitem",
    onFocus: onFocus,
    tabIndex: -1,
    ref: ref
  }, children);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNQVhfUkVBRF9BVkFUQVJTX1BMVVNfTiIsIk1BWF9SRUFEX0FWQVRBUlMiLCJSRUFEX0FWQVRBUl9PRkZTRVQiLCJSRUFEX0FWQVRBUl9TSVpFIiwiZGV0ZXJtaW5lQXZhdGFyUG9zaXRpb24iLCJpbmRleCIsIm1heCIsImhpZGRlbiIsInBvc2l0aW9uIiwicmVhZFJlY2VpcHRUb29sdGlwIiwibWVtYmVycyIsImhhc01vcmUiLCJfdCIsImpvaW4iLCJsZW5ndGgiLCJsYXN0IiwicG9wIiwiUmVhZFJlY2VpcHRHcm91cCIsInJlYWRSZWNlaXB0cyIsInJlYWRSZWNlaXB0TWFwIiwiY2hlY2tVbm1vdW50aW5nIiwic3VwcHJlc3NBbmltYXRpb24iLCJpc1R3ZWx2ZUhvdXIiLCJtZW51RGlzcGxheWVkIiwiYnV0dG9uIiwib3Blbk1lbnUiLCJjbG9zZU1lbnUiLCJ1c2VDb250ZXh0TWVudSIsIm1heEF2YXRhcnMiLCJ0b29sdGlwTWVtYmVycyIsInNsaWNlIiwibWFwIiwiaXQiLCJyb29tTWVtYmVyIiwibmFtZSIsInVzZXJJZCIsInRvb2x0aXBUZXh0Iiwic2hvd1Rvb2x0aXAiLCJoaWRlVG9vbHRpcCIsInRvb2x0aXAiLCJ1c2VUb29sdGlwIiwibGFiZWwiLCJjb3VudCIsImFsaWdubWVudCIsIkFsaWdubWVudCIsIlRvcFJpZ2h0IiwiYXZhdGFycyIsInJlY2VpcHQiLCJyZWFkUmVjZWlwdEluZm8iLCJ0cyIsInJldmVyc2UiLCJyZW1UZXh0IiwicmVtYWluZGVyIiwiY29udGV4dE1lbnUiLCJidXR0b25SZWN0IiwiY3VycmVudCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImFib3ZlTGVmdE9mIiwid2lkdGgiLCJNYXRoIiwibWluIiwiUmVhZFJlY2VpcHRQZXJzb24iLCJvbkFmdGVyQ2xpY2siLCJUb3AiLCJ0b29sdGlwQ2xhc3NOYW1lIiwicmF3RGlzcGxheU5hbWUiLCJkaXMiLCJkaXNwYXRjaCIsImFjdGlvbiIsIkFjdGlvbiIsIlZpZXdVc2VyIiwibWVtYmVyIiwicHVzaCIsImZvcm1hdERhdGUiLCJEYXRlIiwiU2VjdGlvbkhlYWRlciIsImNsYXNzTmFtZSIsImNoaWxkcmVuIiwicmVmIiwidXNlUmVmIiwib25Gb2N1cyIsInVzZVJvdmluZ1RhYkluZGV4Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvdmlld3Mvcm9vbXMvUmVhZFJlY2VpcHRHcm91cC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIyIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0LCB7IFByb3BzV2l0aENoaWxkcmVuLCB1c2VSZWYgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IFVzZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbWF0cml4XCI7XG5cbmltcG9ydCBSZWFkUmVjZWlwdE1hcmtlciwgeyBJUmVhZFJlY2VpcHRJbmZvIH0gZnJvbSBcIi4vUmVhZFJlY2VpcHRNYXJrZXJcIjtcbmltcG9ydCB7IElSZWFkUmVjZWlwdFByb3BzIH0gZnJvbSBcIi4vRXZlbnRUaWxlXCI7XG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tIFwiLi4vZWxlbWVudHMvQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IE1lbWJlckF2YXRhciBmcm9tIFwiLi4vYXZhdGFycy9NZW1iZXJBdmF0YXJcIjtcbmltcG9ydCBBdXRvSGlkZVNjcm9sbGJhciBmcm9tIFwiLi4vLi4vc3RydWN0dXJlcy9BdXRvSGlkZVNjcm9sbGJhclwiO1xuaW1wb3J0IHsgQWxpZ25tZW50IH0gZnJvbSBcIi4uL2VsZW1lbnRzL1Rvb2x0aXBcIjtcbmltcG9ydCB7IGZvcm1hdERhdGUgfSBmcm9tIFwiLi4vLi4vLi4vRGF0ZVV0aWxzXCI7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tIFwiLi4vLi4vLi4vZGlzcGF0Y2hlci9hY3Rpb25zXCI7XG5pbXBvcnQgZGlzIGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCBDb250ZXh0TWVudSwgeyBhYm92ZUxlZnRPZiwgTWVudUl0ZW0sIHVzZUNvbnRleHRNZW51IH0gZnJvbSBcIi4uLy4uL3N0cnVjdHVyZXMvQ29udGV4dE1lbnVcIjtcbmltcG9ydCB7IHVzZVRvb2x0aXAgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvdXNlVG9vbHRpcFwiO1xuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5pbXBvcnQgeyB1c2VSb3ZpbmdUYWJJbmRleCB9IGZyb20gXCIuLi8uLi8uLi9hY2Nlc3NpYmlsaXR5L1JvdmluZ1RhYkluZGV4XCI7XG5cbi8vICMyMDU0NyBEZXNpZ24gc3BlY2lmaWVkIHRoYXQgd2Ugc2hvdWxkIHNob3cgdGhlIHRocmVlIGxhdGVzdCByZWFkIHJlY2VpcHRzXG5jb25zdCBNQVhfUkVBRF9BVkFUQVJTX1BMVVNfTiA9IDM7XG4vLyAjMjE5MzUgSWYgd2XigJl2ZSBnb3QganVzdCA0LCBkb27igJl0IHNob3cgKzEsIGp1c3Qgc2hvdyBhbGwgb2YgdGhlbVxuY29uc3QgTUFYX1JFQURfQVZBVEFSUyA9IE1BWF9SRUFEX0FWQVRBUlNfUExVU19OICsgMTtcblxuY29uc3QgUkVBRF9BVkFUQVJfT0ZGU0VUID0gMTA7XG5leHBvcnQgY29uc3QgUkVBRF9BVkFUQVJfU0laRSA9IDE2O1xuXG5pbnRlcmZhY2UgUHJvcHMge1xuICAgIHJlYWRSZWNlaXB0czogSVJlYWRSZWNlaXB0UHJvcHNbXTtcbiAgICByZWFkUmVjZWlwdE1hcDogeyBbdXNlcklkOiBzdHJpbmddOiBJUmVhZFJlY2VpcHRJbmZvIH07XG4gICAgY2hlY2tVbm1vdW50aW5nOiAoKSA9PiBib29sZWFuO1xuICAgIHN1cHByZXNzQW5pbWF0aW9uOiBib29sZWFuO1xuICAgIGlzVHdlbHZlSG91cjogYm9vbGVhbjtcbn1cblxuaW50ZXJmYWNlIElBdmF0YXJQb3NpdGlvbiB7XG4gICAgaGlkZGVuOiBib29sZWFuO1xuICAgIHBvc2l0aW9uOiBudW1iZXI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZXRlcm1pbmVBdmF0YXJQb3NpdGlvbihpbmRleDogbnVtYmVyLCBtYXg6IG51bWJlcik6IElBdmF0YXJQb3NpdGlvbiB7XG4gICAgaWYgKGluZGV4IDwgbWF4KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICAgICAgcG9zaXRpb246IGluZGV4LFxuICAgICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBoaWRkZW46IHRydWUsXG4gICAgICAgICAgICBwb3NpdGlvbjogMCxcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkUmVjZWlwdFRvb2x0aXAobWVtYmVyczogc3RyaW5nW10sIGhhc01vcmU6IGJvb2xlYW4pOiBzdHJpbmcgfCBudWxsIHtcbiAgICBpZiAoaGFzTW9yZSkge1xuICAgICAgICByZXR1cm4gX3QoXCIlKG1lbWJlcnMpcyBhbmQgbW9yZVwiLCB7XG4gICAgICAgICAgICBtZW1iZXJzOiBtZW1iZXJzLmpvaW4oXCIsIFwiKSxcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChtZW1iZXJzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgcmV0dXJuIF90KFwiJShtZW1iZXJzKXMgYW5kICUobGFzdClzXCIsIHtcbiAgICAgICAgICAgIGxhc3Q6IG1lbWJlcnMucG9wKCksXG4gICAgICAgICAgICBtZW1iZXJzOiBtZW1iZXJzLmpvaW4oXCIsIFwiKSxcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChtZW1iZXJzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gbWVtYmVyc1swXTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBSZWFkUmVjZWlwdEdyb3VwKFxuICAgIHsgcmVhZFJlY2VpcHRzLCByZWFkUmVjZWlwdE1hcCwgY2hlY2tVbm1vdW50aW5nLCBzdXBwcmVzc0FuaW1hdGlvbiwgaXNUd2VsdmVIb3VyIH06IFByb3BzLFxuKSB7XG4gICAgY29uc3QgW21lbnVEaXNwbGF5ZWQsIGJ1dHRvbiwgb3Blbk1lbnUsIGNsb3NlTWVudV0gPSB1c2VDb250ZXh0TWVudSgpO1xuXG4gICAgLy8gSWYgd2UgYXJlIGFib3ZlIE1BWF9SRUFEX0FWQVRBUlMsIHdl4oCZbGwgaGF2ZSB0byByZW1vdmUgYSBmZXcgdG8gaGF2ZSBzcGFjZSBmb3IgdGhlICtuIGNvdW50LlxuICAgIGNvbnN0IGhhc01vcmUgPSByZWFkUmVjZWlwdHMubGVuZ3RoID4gTUFYX1JFQURfQVZBVEFSUztcbiAgICBjb25zdCBtYXhBdmF0YXJzID0gaGFzTW9yZVxuICAgICAgICA/IE1BWF9SRUFEX0FWQVRBUlNfUExVU19OXG4gICAgICAgIDogTUFYX1JFQURfQVZBVEFSUztcblxuICAgIGNvbnN0IHRvb2x0aXBNZW1iZXJzOiBzdHJpbmdbXSA9IHJlYWRSZWNlaXB0cy5zbGljZSgwLCBtYXhBdmF0YXJzKVxuICAgICAgICAubWFwKGl0ID0+IGl0LnJvb21NZW1iZXI/Lm5hbWUgPz8gaXQudXNlcklkKTtcbiAgICBjb25zdCB0b29sdGlwVGV4dCA9IHJlYWRSZWNlaXB0VG9vbHRpcCh0b29sdGlwTWVtYmVycywgaGFzTW9yZSk7XG5cbiAgICBjb25zdCBbeyBzaG93VG9vbHRpcCwgaGlkZVRvb2x0aXAgfSwgdG9vbHRpcF0gPSB1c2VUb29sdGlwKHtcbiAgICAgICAgbGFiZWw6IChcbiAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Ub29sdGlwX3RpdGxlXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJTZWVuIGJ5ICUoY291bnQpcyBwZW9wbGVcIiwgeyBjb3VudDogcmVhZFJlY2VpcHRzLmxlbmd0aCB9KSB9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Ub29sdGlwX3N1YlwiPlxuICAgICAgICAgICAgICAgICAgICB7IHRvb2x0aXBUZXh0IH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvPlxuICAgICAgICApLFxuICAgICAgICBhbGlnbm1lbnQ6IEFsaWdubWVudC5Ub3BSaWdodCxcbiAgICB9KTtcblxuICAgIC8vIHJldHVybiBlYXJseSBpZiB0aGVyZSBhcmUgbm8gcmVhZCByZWNlaXB0c1xuICAgIGlmIChyZWFkUmVjZWlwdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIC8vIFdlIGN1cnJlbnRseSBtdXN0IGluY2x1ZGUgYG14X1JlYWRSZWNlaXB0R3JvdXBfY29udGFpbmVyYCBpblxuICAgICAgICAvLyB0aGUgRE9NIG9mIGFsbCBldmVudHMsIGFzIGl0IGlzIHRoZSBwb3NpdGlvbmVkIHBhcmVudCBvZiB0aGVcbiAgICAgICAgLy8gYW5pbWF0ZWQgcmVhZCByZWNlaXB0cy4gV2UgY2FuJ3QgbGV0IGl0IHVubW91bnQgd2hlbiBhIHJlY2VpcHRcbiAgICAgICAgLy8gbW92ZXMgZXZlbnRzLCBzbyBmb3Igbm93IHdlIG1vdW50IGl0IGZvciBhbGwgZXZlbnRzLiBXaXRob3V0XG4gICAgICAgIC8vIGl0LCB0aGUgYW5pbWF0aW9uIHdpbGwgc3RhcnQgZnJvbSB0aGUgdG9wIG9mIHRoZSB0aW1lbGluZVxuICAgICAgICAvLyAoYmVjYXVzZSBpdCBsb3N0IGl0cyBjb250YWluZXIpLlxuICAgICAgICAvLyBTZWUgYWxzbyBodHRwczovL2dpdGh1Yi5jb20vdmVjdG9yLWltL2VsZW1lbnQtd2ViL2lzc3Vlcy8xNzU2MVxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9FdmVudFRpbGVfbXNnT3B0aW9uXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9SZWFkUmVjZWlwdEdyb3VwXCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUmVhZFJlY2VpcHRHcm91cF9idXR0b25cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1JlYWRSZWNlaXB0R3JvdXBfY29udGFpbmVyXCIgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBhdmF0YXJzID0gcmVhZFJlY2VpcHRzLm1hcCgocmVjZWlwdCwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgeyBoaWRkZW4sIHBvc2l0aW9uIH0gPSBkZXRlcm1pbmVBdmF0YXJQb3NpdGlvbihpbmRleCwgbWF4QXZhdGFycyk7XG5cbiAgICAgICAgY29uc3QgdXNlcklkID0gcmVjZWlwdC51c2VySWQ7XG4gICAgICAgIGxldCByZWFkUmVjZWlwdEluZm86IElSZWFkUmVjZWlwdEluZm87XG5cbiAgICAgICAgaWYgKHJlYWRSZWNlaXB0TWFwKSB7XG4gICAgICAgICAgICByZWFkUmVjZWlwdEluZm8gPSByZWFkUmVjZWlwdE1hcFt1c2VySWRdO1xuICAgICAgICAgICAgaWYgKCFyZWFkUmVjZWlwdEluZm8pIHtcbiAgICAgICAgICAgICAgICByZWFkUmVjZWlwdEluZm8gPSB7fTtcbiAgICAgICAgICAgICAgICByZWFkUmVjZWlwdE1hcFt1c2VySWRdID0gcmVhZFJlY2VpcHRJbmZvO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxSZWFkUmVjZWlwdE1hcmtlclxuICAgICAgICAgICAgICAgIGtleT17dXNlcklkfVxuICAgICAgICAgICAgICAgIG1lbWJlcj17cmVjZWlwdC5yb29tTWVtYmVyfVxuICAgICAgICAgICAgICAgIGZhbGxiYWNrVXNlcklkPXt1c2VySWR9XG4gICAgICAgICAgICAgICAgb2Zmc2V0PXtwb3NpdGlvbiAqIFJFQURfQVZBVEFSX09GRlNFVH1cbiAgICAgICAgICAgICAgICBoaWRkZW49e2hpZGRlbn1cbiAgICAgICAgICAgICAgICByZWFkUmVjZWlwdEluZm89e3JlYWRSZWNlaXB0SW5mb31cbiAgICAgICAgICAgICAgICBjaGVja1VubW91bnRpbmc9e2NoZWNrVW5tb3VudGluZ31cbiAgICAgICAgICAgICAgICBzdXBwcmVzc0FuaW1hdGlvbj17c3VwcHJlc3NBbmltYXRpb259XG4gICAgICAgICAgICAgICAgdGltZXN0YW1wPXtyZWNlaXB0LnRzfVxuICAgICAgICAgICAgICAgIHNob3dUd2VsdmVIb3VyPXtpc1R3ZWx2ZUhvdXJ9XG4gICAgICAgICAgICAvPlxuICAgICAgICApO1xuICAgIH0pLnJldmVyc2UoKTtcblxuICAgIGxldCByZW1UZXh0OiBKU1guRWxlbWVudDtcbiAgICBjb25zdCByZW1haW5kZXIgPSByZWFkUmVjZWlwdHMubGVuZ3RoIC0gbWF4QXZhdGFycztcbiAgICBpZiAocmVtYWluZGVyID4gMCkge1xuICAgICAgICByZW1UZXh0ID0gKFxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfUmVhZFJlY2VpcHRHcm91cF9yZW1haW5kZXJcIiBhcmlhLWxpdmU9XCJvZmZcIj5cbiAgICAgICAgICAgICAgICAreyByZW1haW5kZXIgfVxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICApO1xuICAgIH1cblxuICAgIGxldCBjb250ZXh0TWVudTtcbiAgICBpZiAobWVudURpc3BsYXllZCkge1xuICAgICAgICBjb25zdCBidXR0b25SZWN0ID0gYnV0dG9uLmN1cnJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIGNvbnRleHRNZW51ID0gKFxuICAgICAgICAgICAgPENvbnRleHRNZW51XG4gICAgICAgICAgICAgICAgbWVudUNsYXNzTmFtZT1cIm14X1JlYWRSZWNlaXB0R3JvdXBfcG9wdXBcIlxuICAgICAgICAgICAgICAgIG9uRmluaXNoZWQ9e2Nsb3NlTWVudX1cbiAgICAgICAgICAgICAgICB7Li4uYWJvdmVMZWZ0T2YoYnV0dG9uUmVjdCl9PlxuICAgICAgICAgICAgICAgIDxBdXRvSGlkZVNjcm9sbGJhcj5cbiAgICAgICAgICAgICAgICAgICAgPFNlY3Rpb25IZWFkZXIgY2xhc3NOYW1lPVwibXhfUmVhZFJlY2VpcHRHcm91cF90aXRsZVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIlNlZW4gYnkgJShjb3VudClzIHBlb3BsZVwiLCB7IGNvdW50OiByZWFkUmVjZWlwdHMubGVuZ3RoIH0pIH1cbiAgICAgICAgICAgICAgICAgICAgPC9TZWN0aW9uSGVhZGVyPlxuICAgICAgICAgICAgICAgICAgICB7IHJlYWRSZWNlaXB0cy5tYXAocmVjZWlwdCA9PiAoXG4gICAgICAgICAgICAgICAgICAgICAgICA8UmVhZFJlY2VpcHRQZXJzb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk9e3JlY2VpcHQudXNlcklkfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsuLi5yZWNlaXB0fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVHdlbHZlSG91cj17aXNUd2VsdmVIb3VyfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQWZ0ZXJDbGljaz17Y2xvc2VNZW51fVxuICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgKSkgfVxuICAgICAgICAgICAgICAgIDwvQXV0b0hpZGVTY3JvbGxiYXI+XG4gICAgICAgICAgICA8L0NvbnRleHRNZW51PlxuICAgICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfRXZlbnRUaWxlX21zZ09wdGlvblwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9SZWFkUmVjZWlwdEdyb3VwXCIgcm9sZT1cImdyb3VwXCIgYXJpYS1sYWJlbD17X3QoXCJSZWFkIHJlY2VpcHRzXCIpfT5cbiAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9SZWFkUmVjZWlwdEdyb3VwX2J1dHRvblwiXG4gICAgICAgICAgICAgICAgICAgIGlucHV0UmVmPXtidXR0b259XG4gICAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e3Rvb2x0aXBUZXh0fVxuICAgICAgICAgICAgICAgICAgICBhcmlhLWhhc3BvcHVwPVwidHJ1ZVwiXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e29wZW5NZW51fVxuICAgICAgICAgICAgICAgICAgICBvbk1vdXNlT3Zlcj17c2hvd1Rvb2x0aXB9XG4gICAgICAgICAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17aGlkZVRvb2x0aXB9XG4gICAgICAgICAgICAgICAgICAgIG9uRm9jdXM9e3Nob3dUb29sdGlwfVxuICAgICAgICAgICAgICAgICAgICBvbkJsdXI9e2hpZGVUb29sdGlwfT5cbiAgICAgICAgICAgICAgICAgICAgeyByZW1UZXh0IH1cbiAgICAgICAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1JlYWRSZWNlaXB0R3JvdXBfY29udGFpbmVyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IE1hdGgubWluKG1heEF2YXRhcnMsIHJlYWRSZWNlaXB0cy5sZW5ndGgpICogUkVBRF9BVkFUQVJfT0ZGU0VUICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUkVBRF9BVkFUQVJfU0laRSAtIFJFQURfQVZBVEFSX09GRlNFVCxcbiAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgYXZhdGFycyB9XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgeyB0b29sdGlwIH1cbiAgICAgICAgICAgICAgICB7IGNvbnRleHRNZW51IH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICApO1xufVxuXG5pbnRlcmZhY2UgUmVhZFJlY2VpcHRQZXJzb25Qcm9wcyBleHRlbmRzIElSZWFkUmVjZWlwdFByb3BzIHtcbiAgICBpc1R3ZWx2ZUhvdXI6IGJvb2xlYW47XG4gICAgb25BZnRlckNsaWNrPzogKCkgPT4gdm9pZDtcbn1cblxuZnVuY3Rpb24gUmVhZFJlY2VpcHRQZXJzb24oeyB1c2VySWQsIHJvb21NZW1iZXIsIHRzLCBpc1R3ZWx2ZUhvdXIsIG9uQWZ0ZXJDbGljayB9OiBSZWFkUmVjZWlwdFBlcnNvblByb3BzKSB7XG4gICAgY29uc3QgW3sgc2hvd1Rvb2x0aXAsIGhpZGVUb29sdGlwIH0sIHRvb2x0aXBdID0gdXNlVG9vbHRpcCh7XG4gICAgICAgIGFsaWdubWVudDogQWxpZ25tZW50LlRvcCxcbiAgICAgICAgdG9vbHRpcENsYXNzTmFtZTogXCJteF9SZWFkUmVjZWlwdEdyb3VwX3BlcnNvbi0tdG9vbHRpcFwiLFxuICAgICAgICBsYWJlbDogKFxuICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1Rvb2x0aXBfdGl0bGVcIj5cbiAgICAgICAgICAgICAgICAgICAgeyByb29tTWVtYmVyPy5yYXdEaXNwbGF5TmFtZSA/PyB1c2VySWQgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfVG9vbHRpcF9zdWJcIj5cbiAgICAgICAgICAgICAgICAgICAgeyB1c2VySWQgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC8+XG4gICAgICAgICksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgICA8TWVudUl0ZW1cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1JlYWRSZWNlaXB0R3JvdXBfcGVyc29uXCJcbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICBkaXMuZGlzcGF0Y2goe1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IEFjdGlvbi5WaWV3VXNlcixcbiAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBXZSBzaG91bGQgYmUgdXNpbmcgYSByZWFsIG1lbWJlciBvYmplY3QgYW5kIG5vdCBhc3N1bWluZyB3aGF0IHRoZSByZWNlaXZlciB3YW50cy5cbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIFZpZXdVc2VyIGFjdGlvbiBsZWFkcyB0byB0aGUgUmlnaHRQYW5lbFN0b3JlLCBhbmQgUmlnaHRQYW5lbFN0b3JlSVBhbmVsU3RhdGUgZGVmaW5lcyB0aGVcbiAgICAgICAgICAgICAgICAgICAgLy8gbWVtYmVyIHByb3BlcnR5IG9mIElSaWdodFBhbmVsQ2FyZFN0YXRlIGFzIGBSb29tTWVtYmVyIHwgVXNlcmAsIHNvIHdl4oCZcmUgZmluZSBmb3Igbm93LCBidXQgd2VcbiAgICAgICAgICAgICAgICAgICAgLy8gc2hvdWxkIGRlZmluaXRlbHkgY2xlYW4gdGhpcyB1cCBsYXRlclxuICAgICAgICAgICAgICAgICAgICBtZW1iZXI6IHJvb21NZW1iZXIgPz8geyB1c2VySWQgfSBhcyBVc2VyLFxuICAgICAgICAgICAgICAgICAgICBwdXNoOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBvbkFmdGVyQ2xpY2s/LigpO1xuICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIG9uTW91c2VPdmVyPXtzaG93VG9vbHRpcH1cbiAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17aGlkZVRvb2x0aXB9XG4gICAgICAgICAgICBvbkZvY3VzPXtzaG93VG9vbHRpcH1cbiAgICAgICAgICAgIG9uQmx1cj17aGlkZVRvb2x0aXB9XG4gICAgICAgICAgICBvbldoZWVsPXtoaWRlVG9vbHRpcH1cbiAgICAgICAgPlxuICAgICAgICAgICAgPE1lbWJlckF2YXRhclxuICAgICAgICAgICAgICAgIG1lbWJlcj17cm9vbU1lbWJlcn1cbiAgICAgICAgICAgICAgICBmYWxsYmFja1VzZXJJZD17dXNlcklkfVxuICAgICAgICAgICAgICAgIHdpZHRoPXsyNH1cbiAgICAgICAgICAgICAgICBoZWlnaHQ9ezI0fVxuICAgICAgICAgICAgICAgIGFyaWEtaGlkZGVuPVwidHJ1ZVwiXG4gICAgICAgICAgICAgICAgYXJpYS1saXZlPVwib2ZmXCJcbiAgICAgICAgICAgICAgICByZXNpemVNZXRob2Q9XCJjcm9wXCJcbiAgICAgICAgICAgICAgICBoaWRlVGl0bGVcbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1JlYWRSZWNlaXB0R3JvdXBfbmFtZVwiPlxuICAgICAgICAgICAgICAgIDxwPnsgcm9vbU1lbWJlcj8ubmFtZSA/PyB1c2VySWQgfTwvcD5cbiAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJteF9SZWFkUmVjZWlwdEdyb3VwX3NlY29uZGFyeVwiPlxuICAgICAgICAgICAgICAgICAgICB7IGZvcm1hdERhdGUobmV3IERhdGUodHMpLCBpc1R3ZWx2ZUhvdXIpIH1cbiAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIHsgdG9vbHRpcCB9XG4gICAgICAgIDwvTWVudUl0ZW0+XG4gICAgKTtcbn1cblxuaW50ZXJmYWNlIElTZWN0aW9uSGVhZGVyUHJvcHMge1xuICAgIGNsYXNzTmFtZT86IHN0cmluZztcbn1cblxuZnVuY3Rpb24gU2VjdGlvbkhlYWRlcih7IGNsYXNzTmFtZSwgY2hpbGRyZW4gfTogUHJvcHNXaXRoQ2hpbGRyZW48SVNlY3Rpb25IZWFkZXJQcm9wcz4pIHtcbiAgICBjb25zdCByZWYgPSB1c2VSZWY8SFRNTEhlYWRpbmdFbGVtZW50PigpO1xuICAgIGNvbnN0IFtvbkZvY3VzXSA9IHVzZVJvdmluZ1RhYkluZGV4KHJlZik7XG5cbiAgICByZXR1cm4gKFxuICAgICAgICA8aDNcbiAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lfVxuICAgICAgICAgICAgcm9sZT1cIm1lbnVpdGVtXCJcbiAgICAgICAgICAgIG9uRm9jdXM9e29uRm9jdXN9XG4gICAgICAgICAgICB0YWJJbmRleD17LTF9XG4gICAgICAgICAgICByZWY9e3JlZn1cbiAgICAgICAgPlxuICAgICAgICAgICAgeyBjaGlsZHJlbiB9XG4gICAgICAgIDwvaDM+XG4gICAgKTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFnQkE7O0FBR0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQS9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFtQkE7QUFDQSxNQUFNQSx1QkFBdUIsR0FBRyxDQUFoQyxDLENBQ0E7O0FBQ0EsTUFBTUMsZ0JBQWdCLEdBQUdELHVCQUF1QixHQUFHLENBQW5EO0FBRUEsTUFBTUUsa0JBQWtCLEdBQUcsRUFBM0I7QUFDTyxNQUFNQyxnQkFBZ0IsR0FBRyxFQUF6Qjs7O0FBZUEsU0FBU0MsdUJBQVQsQ0FBaUNDLEtBQWpDLEVBQWdEQyxHQUFoRCxFQUE4RTtFQUNqRixJQUFJRCxLQUFLLEdBQUdDLEdBQVosRUFBaUI7SUFDYixPQUFPO01BQ0hDLE1BQU0sRUFBRSxLQURMO01BRUhDLFFBQVEsRUFBRUg7SUFGUCxDQUFQO0VBSUgsQ0FMRCxNQUtPO0lBQ0gsT0FBTztNQUNIRSxNQUFNLEVBQUUsSUFETDtNQUVIQyxRQUFRLEVBQUU7SUFGUCxDQUFQO0VBSUg7QUFDSjs7QUFFTSxTQUFTQyxrQkFBVCxDQUE0QkMsT0FBNUIsRUFBK0NDLE9BQS9DLEVBQWdGO0VBQ25GLElBQUlBLE9BQUosRUFBYTtJQUNULE9BQU8sSUFBQUMsbUJBQUEsRUFBRyxzQkFBSCxFQUEyQjtNQUM5QkYsT0FBTyxFQUFFQSxPQUFPLENBQUNHLElBQVIsQ0FBYSxJQUFiO0lBRHFCLENBQTNCLENBQVA7RUFHSCxDQUpELE1BSU8sSUFBSUgsT0FBTyxDQUFDSSxNQUFSLEdBQWlCLENBQXJCLEVBQXdCO0lBQzNCLE9BQU8sSUFBQUYsbUJBQUEsRUFBRywwQkFBSCxFQUErQjtNQUNsQ0csSUFBSSxFQUFFTCxPQUFPLENBQUNNLEdBQVIsRUFENEI7TUFFbENOLE9BQU8sRUFBRUEsT0FBTyxDQUFDRyxJQUFSLENBQWEsSUFBYjtJQUZ5QixDQUEvQixDQUFQO0VBSUgsQ0FMTSxNQUtBLElBQUlILE9BQU8sQ0FBQ0ksTUFBWixFQUFvQjtJQUN2QixPQUFPSixPQUFPLENBQUMsQ0FBRCxDQUFkO0VBQ0gsQ0FGTSxNQUVBO0lBQ0gsT0FBTyxJQUFQO0VBQ0g7QUFDSjs7QUFFTSxTQUFTTyxnQkFBVCxPQUVMO0VBQUEsSUFERTtJQUFFQyxZQUFGO0lBQWdCQyxjQUFoQjtJQUFnQ0MsZUFBaEM7SUFBaURDLGlCQUFqRDtJQUFvRUM7RUFBcEUsQ0FDRjtFQUNFLE1BQU0sQ0FBQ0MsYUFBRCxFQUFnQkMsTUFBaEIsRUFBd0JDLFFBQXhCLEVBQWtDQyxTQUFsQyxJQUErQyxJQUFBQywyQkFBQSxHQUFyRCxDQURGLENBR0U7O0VBQ0EsTUFBTWhCLE9BQU8sR0FBR08sWUFBWSxDQUFDSixNQUFiLEdBQXNCYixnQkFBdEM7RUFDQSxNQUFNMkIsVUFBVSxHQUFHakIsT0FBTyxHQUNwQlgsdUJBRG9CLEdBRXBCQyxnQkFGTjtFQUlBLE1BQU00QixjQUF3QixHQUFHWCxZQUFZLENBQUNZLEtBQWIsQ0FBbUIsQ0FBbkIsRUFBc0JGLFVBQXRCLEVBQzVCRyxHQUQ0QixDQUN4QkMsRUFBRSxJQUFJQSxFQUFFLENBQUNDLFVBQUgsRUFBZUMsSUFBZixJQUF1QkYsRUFBRSxDQUFDRyxNQURSLENBQWpDO0VBRUEsTUFBTUMsV0FBVyxHQUFHM0Isa0JBQWtCLENBQUNvQixjQUFELEVBQWlCbEIsT0FBakIsQ0FBdEM7RUFFQSxNQUFNLENBQUM7SUFBRTBCLFdBQUY7SUFBZUM7RUFBZixDQUFELEVBQStCQyxPQUEvQixJQUEwQyxJQUFBQyxzQkFBQSxFQUFXO0lBQ3ZEQyxLQUFLLGVBQ0QseUVBQ0k7TUFBSyxTQUFTLEVBQUM7SUFBZixHQUNNLElBQUE3QixtQkFBQSxFQUFHLDBCQUFILEVBQStCO01BQUU4QixLQUFLLEVBQUV4QixZQUFZLENBQUNKO0lBQXRCLENBQS9CLENBRE4sQ0FESixlQUlJO01BQUssU0FBUyxFQUFDO0lBQWYsR0FDTXNCLFdBRE4sQ0FKSixDQUZtRDtJQVd2RE8sU0FBUyxFQUFFQyxrQkFBQSxDQUFVQztFQVhrQyxDQUFYLENBQWhELENBYkYsQ0EyQkU7O0VBQ0EsSUFBSTNCLFlBQVksQ0FBQ0osTUFBYixLQUF3QixDQUE1QixFQUErQjtJQUMzQjtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBLG9CQUNJO01BQUssU0FBUyxFQUFDO0lBQWYsZ0JBQ0k7TUFBSyxTQUFTLEVBQUM7SUFBZixnQkFDSTtNQUFLLFNBQVMsRUFBQztJQUFmLGdCQUNJO01BQU0sU0FBUyxFQUFDO0lBQWhCLEVBREosQ0FESixDQURKLENBREo7RUFTSDs7RUFFRCxNQUFNZ0MsT0FBTyxHQUFHNUIsWUFBWSxDQUFDYSxHQUFiLENBQWlCLENBQUNnQixPQUFELEVBQVUxQyxLQUFWLEtBQW9CO0lBQ2pELE1BQU07TUFBRUUsTUFBRjtNQUFVQztJQUFWLElBQXVCSix1QkFBdUIsQ0FBQ0MsS0FBRCxFQUFRdUIsVUFBUixDQUFwRDtJQUVBLE1BQU1PLE1BQU0sR0FBR1ksT0FBTyxDQUFDWixNQUF2QjtJQUNBLElBQUlhLGVBQUo7O0lBRUEsSUFBSTdCLGNBQUosRUFBb0I7TUFDaEI2QixlQUFlLEdBQUc3QixjQUFjLENBQUNnQixNQUFELENBQWhDOztNQUNBLElBQUksQ0FBQ2EsZUFBTCxFQUFzQjtRQUNsQkEsZUFBZSxHQUFHLEVBQWxCO1FBQ0E3QixjQUFjLENBQUNnQixNQUFELENBQWQsR0FBeUJhLGVBQXpCO01BQ0g7SUFDSjs7SUFFRCxvQkFDSSw2QkFBQywwQkFBRDtNQUNJLEdBQUcsRUFBRWIsTUFEVDtNQUVJLE1BQU0sRUFBRVksT0FBTyxDQUFDZCxVQUZwQjtNQUdJLGNBQWMsRUFBRUUsTUFIcEI7TUFJSSxNQUFNLEVBQUUzQixRQUFRLEdBQUdOLGtCQUp2QjtNQUtJLE1BQU0sRUFBRUssTUFMWjtNQU1JLGVBQWUsRUFBRXlDLGVBTnJCO01BT0ksZUFBZSxFQUFFNUIsZUFQckI7TUFRSSxpQkFBaUIsRUFBRUMsaUJBUnZCO01BU0ksU0FBUyxFQUFFMEIsT0FBTyxDQUFDRSxFQVR2QjtNQVVJLGNBQWMsRUFBRTNCO0lBVnBCLEVBREo7RUFjSCxDQTVCZSxFQTRCYjRCLE9BNUJhLEVBQWhCO0VBOEJBLElBQUlDLE9BQUo7RUFDQSxNQUFNQyxTQUFTLEdBQUdsQyxZQUFZLENBQUNKLE1BQWIsR0FBc0JjLFVBQXhDOztFQUNBLElBQUl3QixTQUFTLEdBQUcsQ0FBaEIsRUFBbUI7SUFDZkQsT0FBTyxnQkFDSDtNQUFNLFNBQVMsRUFBQywrQkFBaEI7TUFBZ0QsYUFBVTtJQUExRCxRQUNPQyxTQURQLENBREo7RUFLSDs7RUFFRCxJQUFJQyxXQUFKOztFQUNBLElBQUk5QixhQUFKLEVBQW1CO0lBQ2YsTUFBTStCLFVBQVUsR0FBRzlCLE1BQU0sQ0FBQytCLE9BQVAsQ0FBZUMscUJBQWYsRUFBbkI7SUFDQUgsV0FBVyxnQkFDUCw2QkFBQyxvQkFBRDtNQUNJLGFBQWEsRUFBQywyQkFEbEI7TUFFSSxVQUFVLEVBQUUzQjtJQUZoQixHQUdRLElBQUErQix3QkFBQSxFQUFZSCxVQUFaLENBSFIsZ0JBSUksNkJBQUMsMEJBQUQscUJBQ0ksNkJBQUMsYUFBRDtNQUFlLFNBQVMsRUFBQztJQUF6QixHQUNNLElBQUExQyxtQkFBQSxFQUFHLDBCQUFILEVBQStCO01BQUU4QixLQUFLLEVBQUV4QixZQUFZLENBQUNKO0lBQXRCLENBQS9CLENBRE4sQ0FESixFQUlNSSxZQUFZLENBQUNhLEdBQWIsQ0FBaUJnQixPQUFPLGlCQUN0Qiw2QkFBQyxpQkFBRDtNQUNJLEdBQUcsRUFBRUEsT0FBTyxDQUFDWjtJQURqQixHQUVRWSxPQUZSO01BR0ksWUFBWSxFQUFFekIsWUFIbEI7TUFJSSxZQUFZLEVBQUVJO0lBSmxCLEdBREYsQ0FKTixDQUpKLENBREo7RUFvQkg7O0VBRUQsb0JBQ0k7SUFBSyxTQUFTLEVBQUM7RUFBZixnQkFDSTtJQUFLLFNBQVMsRUFBQyxxQkFBZjtJQUFxQyxJQUFJLEVBQUMsT0FBMUM7SUFBa0QsY0FBWSxJQUFBZCxtQkFBQSxFQUFHLGVBQUg7RUFBOUQsZ0JBQ0ksNkJBQUMseUJBQUQ7SUFDSSxTQUFTLEVBQUMsNEJBRGQ7SUFFSSxRQUFRLEVBQUVZLE1BRmQ7SUFHSSxjQUFZWSxXQUhoQjtJQUlJLGlCQUFjLE1BSmxCO0lBS0ksT0FBTyxFQUFFWCxRQUxiO0lBTUksV0FBVyxFQUFFWSxXQU5qQjtJQU9JLFlBQVksRUFBRUMsV0FQbEI7SUFRSSxPQUFPLEVBQUVELFdBUmI7SUFTSSxNQUFNLEVBQUVDO0VBVFosR0FVTWEsT0FWTixlQVdJO0lBQ0ksU0FBUyxFQUFDLCtCQURkO0lBRUksS0FBSyxFQUFFO01BQ0hPLEtBQUssRUFBRUMsSUFBSSxDQUFDQyxHQUFMLENBQVNoQyxVQUFULEVBQXFCVixZQUFZLENBQUNKLE1BQWxDLElBQTRDWixrQkFBNUMsR0FDSEMsZ0JBREcsR0FDZ0JEO0lBRnBCO0VBRlgsR0FPTTRDLE9BUE4sQ0FYSixDQURKLEVBc0JNUCxPQXRCTixFQXVCTWMsV0F2Qk4sQ0FESixDQURKO0FBNkJIOztBQU9ELFNBQVNRLGlCQUFULFFBQTJHO0VBQUEsSUFBaEY7SUFBRTFCLE1BQUY7SUFBVUYsVUFBVjtJQUFzQmdCLEVBQXRCO0lBQTBCM0IsWUFBMUI7SUFBd0N3QztFQUF4QyxDQUFnRjtFQUN2RyxNQUFNLENBQUM7SUFBRXpCLFdBQUY7SUFBZUM7RUFBZixDQUFELEVBQStCQyxPQUEvQixJQUEwQyxJQUFBQyxzQkFBQSxFQUFXO0lBQ3ZERyxTQUFTLEVBQUVDLGtCQUFBLENBQVVtQixHQURrQztJQUV2REMsZ0JBQWdCLEVBQUUscUNBRnFDO0lBR3ZEdkIsS0FBSyxlQUNELHlFQUNJO01BQUssU0FBUyxFQUFDO0lBQWYsR0FDTVIsVUFBVSxFQUFFZ0MsY0FBWixJQUE4QjlCLE1BRHBDLENBREosZUFJSTtNQUFLLFNBQVMsRUFBQztJQUFmLEdBQ01BLE1BRE4sQ0FKSjtFQUptRCxDQUFYLENBQWhEO0VBZUEsb0JBQ0ksNkJBQUMscUJBQUQ7SUFDSSxTQUFTLEVBQUMsNEJBRGQ7SUFFSSxPQUFPLEVBQUUsTUFBTTtNQUNYK0IsbUJBQUEsQ0FBSUMsUUFBSixDQUFhO1FBQ1RDLE1BQU0sRUFBRUMsZUFBQSxDQUFPQyxRQUROO1FBRVQ7UUFDQTtRQUNBO1FBQ0E7UUFDQUMsTUFBTSxFQUFFdEMsVUFBVSxJQUFJO1VBQUVFO1FBQUYsQ0FOYjtRQU9UcUMsSUFBSSxFQUFFO01BUEcsQ0FBYjs7TUFTQVYsWUFBWTtJQUNmLENBYkw7SUFjSSxXQUFXLEVBQUV6QixXQWRqQjtJQWVJLFlBQVksRUFBRUMsV0FmbEI7SUFnQkksT0FBTyxFQUFFRCxXQWhCYjtJQWlCSSxNQUFNLEVBQUVDLFdBakJaO0lBa0JJLE9BQU8sRUFBRUE7RUFsQmIsZ0JBb0JJLDZCQUFDLHFCQUFEO0lBQ0ksTUFBTSxFQUFFTCxVQURaO0lBRUksY0FBYyxFQUFFRSxNQUZwQjtJQUdJLEtBQUssRUFBRSxFQUhYO0lBSUksTUFBTSxFQUFFLEVBSlo7SUFLSSxlQUFZLE1BTGhCO0lBTUksYUFBVSxLQU5kO0lBT0ksWUFBWSxFQUFDLE1BUGpCO0lBUUksU0FBUztFQVJiLEVBcEJKLGVBOEJJO0lBQUssU0FBUyxFQUFDO0VBQWYsZ0JBQ0ksd0NBQUtGLFVBQVUsRUFBRUMsSUFBWixJQUFvQkMsTUFBekIsQ0FESixlQUVJO0lBQUcsU0FBUyxFQUFDO0VBQWIsR0FDTSxJQUFBc0MscUJBQUEsRUFBVyxJQUFJQyxJQUFKLENBQVN6QixFQUFULENBQVgsRUFBeUIzQixZQUF6QixDQUROLENBRkosQ0E5QkosRUFvQ01pQixPQXBDTixDQURKO0FBd0NIOztBQU1ELFNBQVNvQyxhQUFULFFBQXdGO0VBQUEsSUFBakU7SUFBRUMsU0FBRjtJQUFhQztFQUFiLENBQWlFO0VBQ3BGLE1BQU1DLEdBQUcsR0FBRyxJQUFBQyxhQUFBLEdBQVo7RUFDQSxNQUFNLENBQUNDLE9BQUQsSUFBWSxJQUFBQyxpQ0FBQSxFQUFrQkgsR0FBbEIsQ0FBbEI7RUFFQSxvQkFDSTtJQUNJLFNBQVMsRUFBRUYsU0FEZjtJQUVJLElBQUksRUFBQyxVQUZUO0lBR0ksT0FBTyxFQUFFSSxPQUhiO0lBSUksUUFBUSxFQUFFLENBQUMsQ0FKZjtJQUtJLEdBQUcsRUFBRUY7RUFMVCxHQU9NRCxRQVBOLENBREo7QUFXSCJ9
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireDefault(require("react"));

var _lodash = require("lodash");

var _classnames = _interopRequireDefault(require("classnames"));

var _PlatformPeg = _interopRequireDefault(require("../../../PlatformPeg"));

var _AccessibleButton = _interopRequireDefault(require("./AccessibleButton"));

var _languageHandler = require("../../../languageHandler");

var _Login = require("../../../Login");

var _AccessibleTooltipButton = _interopRequireDefault(require("./AccessibleTooltipButton"));

var _Media = require("../../../customisations/Media");

var _PosthogAnalytics = require("../../../PosthogAnalytics");

const _excluded = ["matrixClient", "loginType", "fragmentAfterLogin", "idp", "primary", "mini"];

const getIcon = brand => {
  switch (brand) {
    case _Login.IdentityProviderBrand.Apple:
      return require(`../../../../res/img/element-icons/brands/apple.svg`).default;

    case _Login.IdentityProviderBrand.Facebook:
      return require(`../../../../res/img/element-icons/brands/facebook.svg`).default;

    case _Login.IdentityProviderBrand.Github:
      return require(`../../../../res/img/element-icons/brands/github.svg`).default;

    case _Login.IdentityProviderBrand.Gitlab:
      return require(`../../../../res/img/element-icons/brands/gitlab.svg`).default;

    case _Login.IdentityProviderBrand.Google:
      return require(`../../../../res/img/element-icons/brands/google.svg`).default;

    case _Login.IdentityProviderBrand.Twitter:
      return require(`../../../../res/img/element-icons/brands/twitter.svg`).default;

    default:
      return null;
  }
};

const getAuthenticationType = brand => {
  switch (brand) {
    case _Login.IdentityProviderBrand.Apple:
      return "Apple";

    case _Login.IdentityProviderBrand.Facebook:
      return "Facebook";

    case _Login.IdentityProviderBrand.Github:
      return "GitHub";

    case _Login.IdentityProviderBrand.Gitlab:
      return "GitLab";

    case _Login.IdentityProviderBrand.Google:
      return "Google";
    // Not supported on the analytics SDK at the moment.
    // case IdentityProviderBrand.Twitter:
    //     return "Twitter";

    default:
      return "SSO";
  }
};

const SSOButton = _ref => {
  let {
    matrixClient,
    loginType,
    fragmentAfterLogin,
    idp,
    primary,
    mini
  } = _ref,
      props = (0, _objectWithoutProperties2.default)(_ref, _excluded);
  const label = idp ? (0, _languageHandler._t)("Continue with %(provider)s", {
    provider: idp.name
  }) : (0, _languageHandler._t)("Sign in with single sign-on");

  const onClick = () => {
    const authenticationType = getAuthenticationType(idp?.brand ?? "");

    _PosthogAnalytics.PosthogAnalytics.instance.setAuthenticationType(authenticationType);

    _PlatformPeg.default.get().startSingleSignOn(matrixClient, loginType, fragmentAfterLogin, idp?.id);
  };

  let icon;
  let brandClass;
  const brandIcon = idp ? getIcon(idp.brand) : null;

  if (brandIcon) {
    const brandName = idp.brand.split(".").pop();
    brandClass = `mx_SSOButton_brand_${brandName}`;
    icon = /*#__PURE__*/_react.default.createElement("img", {
      src: brandIcon,
      height: "24",
      width: "24",
      alt: brandName
    });
  } else if (typeof idp?.icon === "string" && idp.icon.startsWith("mxc://")) {
    const src = (0, _Media.mediaFromMxc)(idp.icon, matrixClient).getSquareThumbnailHttp(24);
    icon = /*#__PURE__*/_react.default.createElement("img", {
      src: src,
      height: "24",
      width: "24",
      alt: idp.name
    });
  }

  const classes = (0, _classnames.default)("mx_SSOButton", {
    [brandClass]: brandClass,
    mx_SSOButton_mini: mini,
    mx_SSOButton_default: !idp,
    mx_SSOButton_primary: primary
  });

  if (mini) {
    // TODO fallback icon
    return /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, (0, _extends2.default)({}, props, {
      title: label,
      className: classes,
      onClick: onClick
    }), icon);
  }

  return /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, (0, _extends2.default)({}, props, {
    className: classes,
    onClick: onClick
  }), icon, label);
};

const MAX_PER_ROW = 6;

const SSOButtons = _ref2 => {
  let {
    matrixClient,
    flow,
    loginType,
    fragmentAfterLogin,
    primary
  } = _ref2;
  const providers = flow.identity_providers || [];

  if (providers.length < 2) {
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SSOButtons"
    }, /*#__PURE__*/_react.default.createElement(SSOButton, {
      matrixClient: matrixClient,
      loginType: loginType,
      fragmentAfterLogin: fragmentAfterLogin,
      idp: providers[0],
      primary: primary
    }));
  }

  const rows = Math.ceil(providers.length / MAX_PER_ROW);
  const size = Math.ceil(providers.length / rows);
  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_SSOButtons"
  }, (0, _lodash.chunk)(providers, size).map(chunk => /*#__PURE__*/_react.default.createElement("div", {
    key: chunk[0].id,
    className: "mx_SSOButtons_row"
  }, chunk.map(idp => /*#__PURE__*/_react.default.createElement(SSOButton, {
    key: idp.id,
    matrixClient: matrixClient,
    loginType: loginType,
    fragmentAfterLogin: fragmentAfterLogin,
    idp: idp,
    mini: true,
    primary: primary
  })))));
};

var _default = SSOButtons;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZXRJY29uIiwiYnJhbmQiLCJJZGVudGl0eVByb3ZpZGVyQnJhbmQiLCJBcHBsZSIsInJlcXVpcmUiLCJkZWZhdWx0IiwiRmFjZWJvb2siLCJHaXRodWIiLCJHaXRsYWIiLCJHb29nbGUiLCJUd2l0dGVyIiwiZ2V0QXV0aGVudGljYXRpb25UeXBlIiwiU1NPQnV0dG9uIiwibWF0cml4Q2xpZW50IiwibG9naW5UeXBlIiwiZnJhZ21lbnRBZnRlckxvZ2luIiwiaWRwIiwicHJpbWFyeSIsIm1pbmkiLCJwcm9wcyIsImxhYmVsIiwiX3QiLCJwcm92aWRlciIsIm5hbWUiLCJvbkNsaWNrIiwiYXV0aGVudGljYXRpb25UeXBlIiwiUG9zdGhvZ0FuYWx5dGljcyIsImluc3RhbmNlIiwic2V0QXV0aGVudGljYXRpb25UeXBlIiwiUGxhdGZvcm1QZWciLCJnZXQiLCJzdGFydFNpbmdsZVNpZ25PbiIsImlkIiwiaWNvbiIsImJyYW5kQ2xhc3MiLCJicmFuZEljb24iLCJicmFuZE5hbWUiLCJzcGxpdCIsInBvcCIsInN0YXJ0c1dpdGgiLCJzcmMiLCJtZWRpYUZyb21NeGMiLCJnZXRTcXVhcmVUaHVtYm5haWxIdHRwIiwiY2xhc3NlcyIsImNsYXNzTmFtZXMiLCJteF9TU09CdXR0b25fbWluaSIsIm14X1NTT0J1dHRvbl9kZWZhdWx0IiwibXhfU1NPQnV0dG9uX3ByaW1hcnkiLCJNQVhfUEVSX1JPVyIsIlNTT0J1dHRvbnMiLCJmbG93IiwicHJvdmlkZXJzIiwiaWRlbnRpdHlfcHJvdmlkZXJzIiwibGVuZ3RoIiwicm93cyIsIk1hdGgiLCJjZWlsIiwic2l6ZSIsImNodW5rIiwibWFwIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvdmlld3MvZWxlbWVudHMvU1NPQnV0dG9ucy50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIwIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgY2h1bmsgfSBmcm9tIFwibG9kYXNoXCI7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tIFwiY2xhc3NuYW1lc1wiO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2NsaWVudFwiO1xuaW1wb3J0IHsgU2lnbnVwIH0gZnJvbSBcIkBtYXRyaXgtb3JnL2FuYWx5dGljcy1ldmVudHMvdHlwZXMvdHlwZXNjcmlwdC9TaWdudXBcIjtcblxuaW1wb3J0IFBsYXRmb3JtUGVnIGZyb20gXCIuLi8uLi8uLi9QbGF0Zm9ybVBlZ1wiO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4vQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5pbXBvcnQgeyBJZGVudGl0eVByb3ZpZGVyQnJhbmQsIElJZGVudGl0eVByb3ZpZGVyLCBJU1NPRmxvdyB9IGZyb20gXCIuLi8uLi8uLi9Mb2dpblwiO1xuaW1wb3J0IEFjY2Vzc2libGVUb29sdGlwQnV0dG9uIGZyb20gXCIuL0FjY2Vzc2libGVUb29sdGlwQnV0dG9uXCI7XG5pbXBvcnQgeyBtZWRpYUZyb21NeGMgfSBmcm9tIFwiLi4vLi4vLi4vY3VzdG9taXNhdGlvbnMvTWVkaWFcIjtcbmltcG9ydCB7IFBvc3Rob2dBbmFseXRpY3MgfSBmcm9tIFwiLi4vLi4vLi4vUG9zdGhvZ0FuYWx5dGljc1wiO1xuXG5pbnRlcmZhY2UgSVNTT0J1dHRvblByb3BzIGV4dGVuZHMgT21pdDxJUHJvcHMsIFwiZmxvd1wiPiB7XG4gICAgaWRwPzogSUlkZW50aXR5UHJvdmlkZXI7XG4gICAgbWluaT86IGJvb2xlYW47XG59XG5cbmNvbnN0IGdldEljb24gPSAoYnJhbmQ6IElkZW50aXR5UHJvdmlkZXJCcmFuZCB8IHN0cmluZykgPT4ge1xuICAgIHN3aXRjaCAoYnJhbmQpIHtcbiAgICAgICAgY2FzZSBJZGVudGl0eVByb3ZpZGVyQnJhbmQuQXBwbGU6XG4gICAgICAgICAgICByZXR1cm4gcmVxdWlyZShgLi4vLi4vLi4vLi4vcmVzL2ltZy9lbGVtZW50LWljb25zL2JyYW5kcy9hcHBsZS5zdmdgKS5kZWZhdWx0O1xuICAgICAgICBjYXNlIElkZW50aXR5UHJvdmlkZXJCcmFuZC5GYWNlYm9vazpcbiAgICAgICAgICAgIHJldHVybiByZXF1aXJlKGAuLi8uLi8uLi8uLi9yZXMvaW1nL2VsZW1lbnQtaWNvbnMvYnJhbmRzL2ZhY2Vib29rLnN2Z2ApLmRlZmF1bHQ7XG4gICAgICAgIGNhc2UgSWRlbnRpdHlQcm92aWRlckJyYW5kLkdpdGh1YjpcbiAgICAgICAgICAgIHJldHVybiByZXF1aXJlKGAuLi8uLi8uLi8uLi9yZXMvaW1nL2VsZW1lbnQtaWNvbnMvYnJhbmRzL2dpdGh1Yi5zdmdgKS5kZWZhdWx0O1xuICAgICAgICBjYXNlIElkZW50aXR5UHJvdmlkZXJCcmFuZC5HaXRsYWI6XG4gICAgICAgICAgICByZXR1cm4gcmVxdWlyZShgLi4vLi4vLi4vLi4vcmVzL2ltZy9lbGVtZW50LWljb25zL2JyYW5kcy9naXRsYWIuc3ZnYCkuZGVmYXVsdDtcbiAgICAgICAgY2FzZSBJZGVudGl0eVByb3ZpZGVyQnJhbmQuR29vZ2xlOlxuICAgICAgICAgICAgcmV0dXJuIHJlcXVpcmUoYC4uLy4uLy4uLy4uL3Jlcy9pbWcvZWxlbWVudC1pY29ucy9icmFuZHMvZ29vZ2xlLnN2Z2ApLmRlZmF1bHQ7XG4gICAgICAgIGNhc2UgSWRlbnRpdHlQcm92aWRlckJyYW5kLlR3aXR0ZXI6XG4gICAgICAgICAgICByZXR1cm4gcmVxdWlyZShgLi4vLi4vLi4vLi4vcmVzL2ltZy9lbGVtZW50LWljb25zL2JyYW5kcy90d2l0dGVyLnN2Z2ApLmRlZmF1bHQ7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59O1xuXG5jb25zdCBnZXRBdXRoZW50aWNhdGlvblR5cGUgPSAoYnJhbmQ6IElkZW50aXR5UHJvdmlkZXJCcmFuZCB8IHN0cmluZyk6IFNpZ251cFtcImF1dGhlbnRpY2F0aW9uVHlwZVwiXSA9PiB7XG4gICAgc3dpdGNoIChicmFuZCkge1xuICAgICAgICBjYXNlIElkZW50aXR5UHJvdmlkZXJCcmFuZC5BcHBsZTpcbiAgICAgICAgICAgIHJldHVybiBcIkFwcGxlXCI7XG4gICAgICAgIGNhc2UgSWRlbnRpdHlQcm92aWRlckJyYW5kLkZhY2Vib29rOlxuICAgICAgICAgICAgcmV0dXJuIFwiRmFjZWJvb2tcIjtcbiAgICAgICAgY2FzZSBJZGVudGl0eVByb3ZpZGVyQnJhbmQuR2l0aHViOlxuICAgICAgICAgICAgcmV0dXJuIFwiR2l0SHViXCI7XG4gICAgICAgIGNhc2UgSWRlbnRpdHlQcm92aWRlckJyYW5kLkdpdGxhYjpcbiAgICAgICAgICAgIHJldHVybiBcIkdpdExhYlwiO1xuICAgICAgICBjYXNlIElkZW50aXR5UHJvdmlkZXJCcmFuZC5Hb29nbGU6XG4gICAgICAgICAgICByZXR1cm4gXCJHb29nbGVcIjtcbiAgICAgICAgLy8gTm90IHN1cHBvcnRlZCBvbiB0aGUgYW5hbHl0aWNzIFNESyBhdCB0aGUgbW9tZW50LlxuICAgICAgICAvLyBjYXNlIElkZW50aXR5UHJvdmlkZXJCcmFuZC5Ud2l0dGVyOlxuICAgICAgICAvLyAgICAgcmV0dXJuIFwiVHdpdHRlclwiO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIFwiU1NPXCI7XG4gICAgfVxufTtcblxuY29uc3QgU1NPQnV0dG9uOiBSZWFjdC5GQzxJU1NPQnV0dG9uUHJvcHM+ID0gKHtcbiAgICBtYXRyaXhDbGllbnQsXG4gICAgbG9naW5UeXBlLFxuICAgIGZyYWdtZW50QWZ0ZXJMb2dpbixcbiAgICBpZHAsXG4gICAgcHJpbWFyeSxcbiAgICBtaW5pLFxuICAgIC4uLnByb3BzXG59KSA9PiB7XG4gICAgY29uc3QgbGFiZWwgPSBpZHAgPyBfdChcIkNvbnRpbnVlIHdpdGggJShwcm92aWRlcilzXCIsIHsgcHJvdmlkZXI6IGlkcC5uYW1lIH0pIDogX3QoXCJTaWduIGluIHdpdGggc2luZ2xlIHNpZ24tb25cIik7XG5cbiAgICBjb25zdCBvbkNsaWNrID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBhdXRoZW50aWNhdGlvblR5cGUgPSBnZXRBdXRoZW50aWNhdGlvblR5cGUoaWRwPy5icmFuZCA/PyBcIlwiKTtcbiAgICAgICAgUG9zdGhvZ0FuYWx5dGljcy5pbnN0YW5jZS5zZXRBdXRoZW50aWNhdGlvblR5cGUoYXV0aGVudGljYXRpb25UeXBlKTtcbiAgICAgICAgUGxhdGZvcm1QZWcuZ2V0KCkuc3RhcnRTaW5nbGVTaWduT24obWF0cml4Q2xpZW50LCBsb2dpblR5cGUsIGZyYWdtZW50QWZ0ZXJMb2dpbiwgaWRwPy5pZCk7XG4gICAgfTtcblxuICAgIGxldCBpY29uO1xuICAgIGxldCBicmFuZENsYXNzO1xuICAgIGNvbnN0IGJyYW5kSWNvbiA9IGlkcCA/IGdldEljb24oaWRwLmJyYW5kKSA6IG51bGw7XG4gICAgaWYgKGJyYW5kSWNvbikge1xuICAgICAgICBjb25zdCBicmFuZE5hbWUgPSBpZHAuYnJhbmQuc3BsaXQoXCIuXCIpLnBvcCgpO1xuICAgICAgICBicmFuZENsYXNzID0gYG14X1NTT0J1dHRvbl9icmFuZF8ke2JyYW5kTmFtZX1gO1xuICAgICAgICBpY29uID0gPGltZyBzcmM9e2JyYW5kSWNvbn0gaGVpZ2h0PVwiMjRcIiB3aWR0aD1cIjI0XCIgYWx0PXticmFuZE5hbWV9IC8+O1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGlkcD8uaWNvbiA9PT0gXCJzdHJpbmdcIiAmJiBpZHAuaWNvbi5zdGFydHNXaXRoKFwibXhjOi8vXCIpKSB7XG4gICAgICAgIGNvbnN0IHNyYyA9IG1lZGlhRnJvbU14YyhpZHAuaWNvbiwgbWF0cml4Q2xpZW50KS5nZXRTcXVhcmVUaHVtYm5haWxIdHRwKDI0KTtcbiAgICAgICAgaWNvbiA9IDxpbWcgc3JjPXtzcmN9IGhlaWdodD1cIjI0XCIgd2lkdGg9XCIyNFwiIGFsdD17aWRwLm5hbWV9IC8+O1xuICAgIH1cblxuICAgIGNvbnN0IGNsYXNzZXMgPSBjbGFzc05hbWVzKFwibXhfU1NPQnV0dG9uXCIsIHtcbiAgICAgICAgW2JyYW5kQ2xhc3NdOiBicmFuZENsYXNzLFxuICAgICAgICBteF9TU09CdXR0b25fbWluaTogbWluaSxcbiAgICAgICAgbXhfU1NPQnV0dG9uX2RlZmF1bHQ6ICFpZHAsXG4gICAgICAgIG14X1NTT0J1dHRvbl9wcmltYXJ5OiBwcmltYXJ5LFxuICAgIH0pO1xuXG4gICAgaWYgKG1pbmkpIHtcbiAgICAgICAgLy8gVE9ETyBmYWxsYmFjayBpY29uXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QWNjZXNzaWJsZVRvb2x0aXBCdXR0b24gey4uLnByb3BzfSB0aXRsZT17bGFiZWx9IGNsYXNzTmFtZT17Y2xhc3Nlc30gb25DbGljaz17b25DbGlja30+XG4gICAgICAgICAgICAgICAgeyBpY29uIH1cbiAgICAgICAgICAgIDwvQWNjZXNzaWJsZVRvb2x0aXBCdXR0b24+XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gey4uLnByb3BzfSBjbGFzc05hbWU9e2NsYXNzZXN9IG9uQ2xpY2s9e29uQ2xpY2t9PlxuICAgICAgICAgICAgeyBpY29uIH1cbiAgICAgICAgICAgIHsgbGFiZWwgfVxuICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgKTtcbn07XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIG1hdHJpeENsaWVudDogTWF0cml4Q2xpZW50O1xuICAgIGZsb3c6IElTU09GbG93O1xuICAgIGxvZ2luVHlwZT86IFwic3NvXCIgfCBcImNhc1wiO1xuICAgIGZyYWdtZW50QWZ0ZXJMb2dpbj86IHN0cmluZztcbiAgICBwcmltYXJ5PzogYm9vbGVhbjtcbn1cblxuY29uc3QgTUFYX1BFUl9ST1cgPSA2O1xuXG5jb25zdCBTU09CdXR0b25zOiBSZWFjdC5GQzxJUHJvcHM+ID0gKHsgbWF0cml4Q2xpZW50LCBmbG93LCBsb2dpblR5cGUsIGZyYWdtZW50QWZ0ZXJMb2dpbiwgcHJpbWFyeSB9KSA9PiB7XG4gICAgY29uc3QgcHJvdmlkZXJzID0gZmxvdy5pZGVudGl0eV9wcm92aWRlcnMgfHwgW107XG4gICAgaWYgKHByb3ZpZGVycy5sZW5ndGggPCAyKSB7XG4gICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cIm14X1NTT0J1dHRvbnNcIj5cbiAgICAgICAgICAgIDxTU09CdXR0b25cbiAgICAgICAgICAgICAgICBtYXRyaXhDbGllbnQ9e21hdHJpeENsaWVudH1cbiAgICAgICAgICAgICAgICBsb2dpblR5cGU9e2xvZ2luVHlwZX1cbiAgICAgICAgICAgICAgICBmcmFnbWVudEFmdGVyTG9naW49e2ZyYWdtZW50QWZ0ZXJMb2dpbn1cbiAgICAgICAgICAgICAgICBpZHA9e3Byb3ZpZGVyc1swXX1cbiAgICAgICAgICAgICAgICBwcmltYXJ5PXtwcmltYXJ5fVxuICAgICAgICAgICAgLz5cbiAgICAgICAgPC9kaXY+O1xuICAgIH1cblxuICAgIGNvbnN0IHJvd3MgPSBNYXRoLmNlaWwocHJvdmlkZXJzLmxlbmd0aCAvIE1BWF9QRVJfUk9XKTtcbiAgICBjb25zdCBzaXplID0gTWF0aC5jZWlsKHByb3ZpZGVycy5sZW5ndGggLyByb3dzKTtcblxuICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cIm14X1NTT0J1dHRvbnNcIj5cbiAgICAgICAgeyBjaHVuayhwcm92aWRlcnMsIHNpemUpLm1hcChjaHVuayA9PiAoXG4gICAgICAgICAgICA8ZGl2IGtleT17Y2h1bmtbMF0uaWR9IGNsYXNzTmFtZT1cIm14X1NTT0J1dHRvbnNfcm93XCI+XG4gICAgICAgICAgICAgICAgeyBjaHVuay5tYXAoaWRwID0+IChcbiAgICAgICAgICAgICAgICAgICAgPFNTT0J1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAga2V5PXtpZHAuaWR9XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRyaXhDbGllbnQ9e21hdHJpeENsaWVudH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luVHlwZT17bG9naW5UeXBlfVxuICAgICAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnRBZnRlckxvZ2luPXtmcmFnbWVudEFmdGVyTG9naW59XG4gICAgICAgICAgICAgICAgICAgICAgICBpZHA9e2lkcH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbmk9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmltYXJ5PXtwcmltYXJ5fVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICkpIH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApKSB9XG4gICAgPC9kaXY+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
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireDefault(require("react"));

var _AccessibleButton = _interopRequireDefault(require("./AccessibleButton"));

var _languageHandler = require("../../../languageHandler");

var _TextWithTooltip = _interopRequireDefault(require("./TextWithTooltip"));

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _ServerPickerDialog = _interopRequireDefault(require("../dialogs/ServerPickerDialog"));

var _InfoDialog = _interopRequireDefault(require("../dialogs/InfoDialog"));

/*
Copyright 2020-2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const showPickerDialog = (title, serverConfig, onFinished) => {
  _Modal.default.createDialog(_ServerPickerDialog.default, {
    title,
    serverConfig,
    onFinished
  });
};

const onHelpClick = () => {
  const brand = _SdkConfig.default.get().brand;

  _Modal.default.createDialog(_InfoDialog.default, {
    title: (0, _languageHandler._t)("Server Options"),
    description: (0, _languageHandler._t)("You can use the custom server options to sign into other Matrix servers by specifying " + "a different homeserver URL. This allows you to use %(brand)s with an existing Matrix account on " + "a different homeserver.", {
      brand
    }),
    button: (0, _languageHandler._t)("Dismiss"),
    hasCloseButton: false,
    fixedWidth: false
  }, "mx_ServerPicker_helpDialog");
};

const ServerPicker = _ref => {
  let {
    title,
    dialogTitle,
    serverConfig,
    onServerConfigChange
  } = _ref;

  const disableCustomUrls = _SdkConfig.default.get("disable_custom_urls");

  let editBtn;

  if (!disableCustomUrls && onServerConfigChange) {
    const onClick = () => {
      showPickerDialog(dialogTitle, serverConfig, config => {
        if (config) {
          onServerConfigChange(config);
        }
      });
    };

    editBtn = /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      className: "mx_ServerPicker_change",
      kind: "link",
      onClick: onClick
    }, (0, _languageHandler._t)("Edit"));
  }

  let serverName = serverConfig.isNameResolvable ? serverConfig.hsName : serverConfig.hsUrl;

  if (serverConfig.hsNameIsDifferent) {
    serverName = /*#__PURE__*/_react.default.createElement(_TextWithTooltip.default, {
      class: "mx_Login_underlinedServerName",
      tooltip: serverConfig.hsUrl
    }, serverConfig.hsName);
  }

  let desc;

  if (serverConfig.hsName === "matrix.org") {
    desc = /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_ServerPicker_desc"
    }, (0, _languageHandler._t)("Join millions for free on the largest public server"));
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_ServerPicker"
  }, /*#__PURE__*/_react.default.createElement("h2", null, title || (0, _languageHandler._t)("Homeserver")), !disableCustomUrls ? /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
    className: "mx_ServerPicker_help",
    onClick: onHelpClick,
    "aria-label": (0, _languageHandler._t)("Help")
  }) : null, /*#__PURE__*/_react.default.createElement("span", {
    className: "mx_ServerPicker_server",
    title: typeof serverName === "string" ? serverName : undefined
  }, serverName), editBtn, desc);
};

var _default = ServerPicker;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzaG93UGlja2VyRGlhbG9nIiwidGl0bGUiLCJzZXJ2ZXJDb25maWciLCJvbkZpbmlzaGVkIiwiTW9kYWwiLCJjcmVhdGVEaWFsb2ciLCJTZXJ2ZXJQaWNrZXJEaWFsb2ciLCJvbkhlbHBDbGljayIsImJyYW5kIiwiU2RrQ29uZmlnIiwiZ2V0IiwiSW5mb0RpYWxvZyIsIl90IiwiZGVzY3JpcHRpb24iLCJidXR0b24iLCJoYXNDbG9zZUJ1dHRvbiIsImZpeGVkV2lkdGgiLCJTZXJ2ZXJQaWNrZXIiLCJkaWFsb2dUaXRsZSIsIm9uU2VydmVyQ29uZmlnQ2hhbmdlIiwiZGlzYWJsZUN1c3RvbVVybHMiLCJlZGl0QnRuIiwib25DbGljayIsImNvbmZpZyIsInNlcnZlck5hbWUiLCJpc05hbWVSZXNvbHZhYmxlIiwiaHNOYW1lIiwiaHNVcmwiLCJoc05hbWVJc0RpZmZlcmVudCIsImRlc2MiLCJ1bmRlZmluZWQiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy92aWV3cy9lbGVtZW50cy9TZXJ2ZXJQaWNrZXIudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAyMC0yMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4vQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IHsgVmFsaWRhdGVkU2VydmVyQ29uZmlnIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvVmFsaWRhdGVkU2VydmVyQ29uZmlnJztcbmltcG9ydCB7IF90IH0gZnJvbSBcIi4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IFRleHRXaXRoVG9vbHRpcCBmcm9tIFwiLi9UZXh0V2l0aFRvb2x0aXBcIjtcbmltcG9ydCBTZGtDb25maWcgZnJvbSBcIi4uLy4uLy4uL1Nka0NvbmZpZ1wiO1xuaW1wb3J0IE1vZGFsIGZyb20gXCIuLi8uLi8uLi9Nb2RhbFwiO1xuaW1wb3J0IFNlcnZlclBpY2tlckRpYWxvZyBmcm9tIFwiLi4vZGlhbG9ncy9TZXJ2ZXJQaWNrZXJEaWFsb2dcIjtcbmltcG9ydCBJbmZvRGlhbG9nIGZyb20gXCIuLi9kaWFsb2dzL0luZm9EaWFsb2dcIjtcblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgdGl0bGU/OiBzdHJpbmc7XG4gICAgZGlhbG9nVGl0bGU/OiBzdHJpbmc7XG4gICAgc2VydmVyQ29uZmlnOiBWYWxpZGF0ZWRTZXJ2ZXJDb25maWc7XG4gICAgb25TZXJ2ZXJDb25maWdDaGFuZ2U/KGNvbmZpZzogVmFsaWRhdGVkU2VydmVyQ29uZmlnKTogdm9pZDtcbn1cblxuY29uc3Qgc2hvd1BpY2tlckRpYWxvZyA9IChcbiAgICB0aXRsZTogc3RyaW5nLFxuICAgIHNlcnZlckNvbmZpZzogVmFsaWRhdGVkU2VydmVyQ29uZmlnLFxuICAgIG9uRmluaXNoZWQ6IChjb25maWc6IFZhbGlkYXRlZFNlcnZlckNvbmZpZykgPT4gdm9pZCxcbikgPT4ge1xuICAgIE1vZGFsLmNyZWF0ZURpYWxvZyhTZXJ2ZXJQaWNrZXJEaWFsb2csIHsgdGl0bGUsIHNlcnZlckNvbmZpZywgb25GaW5pc2hlZCB9KTtcbn07XG5cbmNvbnN0IG9uSGVscENsaWNrID0gKCkgPT4ge1xuICAgIGNvbnN0IGJyYW5kID0gU2RrQ29uZmlnLmdldCgpLmJyYW5kO1xuICAgIE1vZGFsLmNyZWF0ZURpYWxvZyhJbmZvRGlhbG9nLCB7XG4gICAgICAgIHRpdGxlOiBfdChcIlNlcnZlciBPcHRpb25zXCIpLFxuICAgICAgICBkZXNjcmlwdGlvbjogX3QoXCJZb3UgY2FuIHVzZSB0aGUgY3VzdG9tIHNlcnZlciBvcHRpb25zIHRvIHNpZ24gaW50byBvdGhlciBNYXRyaXggc2VydmVycyBieSBzcGVjaWZ5aW5nIFwiICtcbiAgICAgICAgICAgIFwiYSBkaWZmZXJlbnQgaG9tZXNlcnZlciBVUkwuIFRoaXMgYWxsb3dzIHlvdSB0byB1c2UgJShicmFuZClzIHdpdGggYW4gZXhpc3RpbmcgTWF0cml4IGFjY291bnQgb24gXCIgK1xuICAgICAgICAgICAgXCJhIGRpZmZlcmVudCBob21lc2VydmVyLlwiLCB7IGJyYW5kIH0pLFxuICAgICAgICBidXR0b246IF90KFwiRGlzbWlzc1wiKSxcbiAgICAgICAgaGFzQ2xvc2VCdXR0b246IGZhbHNlLFxuICAgICAgICBmaXhlZFdpZHRoOiBmYWxzZSxcbiAgICB9LCBcIm14X1NlcnZlclBpY2tlcl9oZWxwRGlhbG9nXCIpO1xufTtcblxuY29uc3QgU2VydmVyUGlja2VyID0gKHsgdGl0bGUsIGRpYWxvZ1RpdGxlLCBzZXJ2ZXJDb25maWcsIG9uU2VydmVyQ29uZmlnQ2hhbmdlIH06IElQcm9wcykgPT4ge1xuICAgIGNvbnN0IGRpc2FibGVDdXN0b21VcmxzID0gU2RrQ29uZmlnLmdldChcImRpc2FibGVfY3VzdG9tX3VybHNcIik7XG5cbiAgICBsZXQgZWRpdEJ0bjtcbiAgICBpZiAoIWRpc2FibGVDdXN0b21VcmxzICYmIG9uU2VydmVyQ29uZmlnQ2hhbmdlKSB7XG4gICAgICAgIGNvbnN0IG9uQ2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICBzaG93UGlja2VyRGlhbG9nKGRpYWxvZ1RpdGxlLCBzZXJ2ZXJDb25maWcsIChjb25maWc/OiBWYWxpZGF0ZWRTZXJ2ZXJDb25maWcpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIG9uU2VydmVyQ29uZmlnQ2hhbmdlKGNvbmZpZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGVkaXRCdG4gPSA8QWNjZXNzaWJsZUJ1dHRvbiBjbGFzc05hbWU9XCJteF9TZXJ2ZXJQaWNrZXJfY2hhbmdlXCIga2luZD1cImxpbmtcIiBvbkNsaWNrPXtvbkNsaWNrfT5cbiAgICAgICAgICAgIHsgX3QoXCJFZGl0XCIpIH1cbiAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPjtcbiAgICB9XG5cbiAgICBsZXQgc2VydmVyTmFtZTogUmVhY3QuUmVhY3ROb2RlID0gc2VydmVyQ29uZmlnLmlzTmFtZVJlc29sdmFibGUgPyBzZXJ2ZXJDb25maWcuaHNOYW1lIDogc2VydmVyQ29uZmlnLmhzVXJsO1xuICAgIGlmIChzZXJ2ZXJDb25maWcuaHNOYW1lSXNEaWZmZXJlbnQpIHtcbiAgICAgICAgc2VydmVyTmFtZSA9IDxUZXh0V2l0aFRvb2x0aXAgY2xhc3M9XCJteF9Mb2dpbl91bmRlcmxpbmVkU2VydmVyTmFtZVwiIHRvb2x0aXA9e3NlcnZlckNvbmZpZy5oc1VybH0+XG4gICAgICAgICAgICB7IHNlcnZlckNvbmZpZy5oc05hbWUgfVxuICAgICAgICA8L1RleHRXaXRoVG9vbHRpcD47XG4gICAgfVxuXG4gICAgbGV0IGRlc2M7XG4gICAgaWYgKHNlcnZlckNvbmZpZy5oc05hbWUgPT09IFwibWF0cml4Lm9yZ1wiKSB7XG4gICAgICAgIGRlc2MgPSA8c3BhbiBjbGFzc05hbWU9XCJteF9TZXJ2ZXJQaWNrZXJfZGVzY1wiPlxuICAgICAgICAgICAgeyBfdChcIkpvaW4gbWlsbGlvbnMgZm9yIGZyZWUgb24gdGhlIGxhcmdlc3QgcHVibGljIHNlcnZlclwiKSB9XG4gICAgICAgIDwvc3Bhbj47XG4gICAgfVxuXG4gICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwibXhfU2VydmVyUGlja2VyXCI+XG4gICAgICAgIDxoMj57IHRpdGxlIHx8IF90KFwiSG9tZXNlcnZlclwiKSB9PC9oMj5cbiAgICAgICAgeyAhZGlzYWJsZUN1c3RvbVVybHMgPyAoXG4gICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1NlcnZlclBpY2tlcl9oZWxwXCJcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXtvbkhlbHBDbGlja31cbiAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPXtfdChcIkhlbHBcIil9XG4gICAgICAgICAgICAvPik6IG51bGwgfVxuICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJteF9TZXJ2ZXJQaWNrZXJfc2VydmVyXCIgdGl0bGU9e3R5cGVvZiBzZXJ2ZXJOYW1lID09PSBcInN0cmluZ1wiID8gc2VydmVyTmFtZSA6IHVuZGVmaW5lZH0+XG4gICAgICAgICAgICB7IHNlcnZlck5hbWUgfVxuICAgICAgICA8L3NwYW4+XG4gICAgICAgIHsgZWRpdEJ0biB9XG4gICAgICAgIHsgZGVzYyB9XG4gICAgPC9kaXY+O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgU2VydmVyUGlja2VyO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFnQkE7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBekJBO0FBQ0E7QUFDQTtB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
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _languageHandler = require("../../../languageHandler");

var _ToggleSwitch = _interopRequireDefault(require("./ToggleSwitch"));

var _StyledCheckbox = _interopRequireDefault(require("./StyledCheckbox"));

/*
Copyright 2017 Travis Ralston
Copyright 2019 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class SettingsFlag extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "onChange", async checked => {
      await this.save(checked);
      this.setState({
        value: checked
      });
      if (this.props.onChange) this.props.onChange(checked);
    });
    (0, _defineProperty2.default)(this, "checkBoxOnChange", e => {
      this.onChange(e.target.checked);
    });
    (0, _defineProperty2.default)(this, "save", async val => {
      await _SettingsStore.default.setValue(this.props.name, this.props.roomId, this.props.level, val !== undefined ? val : this.state.value);
    });
    this.state = {
      value: _SettingsStore.default.getValueAt(this.props.level, this.props.name, this.props.roomId, this.props.isExplicit)
    };
  }

  render() {
    const canChange = _SettingsStore.default.canSetValue(this.props.name, this.props.roomId, this.props.level);

    if (!canChange && this.props.hideIfCannotSet) return null;
    const label = this.props.label ? (0, _languageHandler._t)(this.props.label) : _SettingsStore.default.getDisplayName(this.props.name, this.props.level);

    const description = _SettingsStore.default.getDescription(this.props.name);

    let disabledDescription;

    if (this.props.disabled && this.props.disabledDescription) {
      disabledDescription = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SettingsFlag_microcopy"
      }, this.props.disabledDescription);
    }

    if (this.props.useCheckbox) {
      return /*#__PURE__*/_react.default.createElement(_StyledCheckbox.default, {
        checked: this.state.value,
        onChange: this.checkBoxOnChange,
        disabled: this.props.disabled || !canChange
      }, label);
    } else {
      return /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SettingsFlag"
      }, /*#__PURE__*/_react.default.createElement("label", {
        className: "mx_SettingsFlag_label"
      }, /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_SettingsFlag_labelText"
      }, label), description && /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SettingsFlag_microcopy"
      }, description), disabledDescription), /*#__PURE__*/_react.default.createElement(_ToggleSwitch.default, {
        checked: this.state.value,
        onChange: this.onChange,
        disabled: this.props.disabled || !canChange,
        "aria-label": label
      }));
    }
  }

}

exports.default = SettingsFlag;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTZXR0aW5nc0ZsYWciLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJjaGVja2VkIiwic2F2ZSIsInNldFN0YXRlIiwidmFsdWUiLCJvbkNoYW5nZSIsImUiLCJ0YXJnZXQiLCJ2YWwiLCJTZXR0aW5nc1N0b3JlIiwic2V0VmFsdWUiLCJuYW1lIiwicm9vbUlkIiwibGV2ZWwiLCJ1bmRlZmluZWQiLCJzdGF0ZSIsImdldFZhbHVlQXQiLCJpc0V4cGxpY2l0IiwicmVuZGVyIiwiY2FuQ2hhbmdlIiwiY2FuU2V0VmFsdWUiLCJoaWRlSWZDYW5ub3RTZXQiLCJsYWJlbCIsIl90IiwiZ2V0RGlzcGxheU5hbWUiLCJkZXNjcmlwdGlvbiIsImdldERlc2NyaXB0aW9uIiwiZGlzYWJsZWREZXNjcmlwdGlvbiIsImRpc2FibGVkIiwidXNlQ2hlY2tib3giLCJjaGVja0JveE9uQ2hhbmdlIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvdmlld3MvZWxlbWVudHMvU2V0dGluZ3NGbGFnLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTcgVHJhdmlzIFJhbHN0b25cbkNvcHlyaWdodCAyMDE5IFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiO1xuXG5pbXBvcnQgU2V0dGluZ3NTdG9yZSBmcm9tIFwiLi4vLi4vLi4vc2V0dGluZ3MvU2V0dGluZ3NTdG9yZVwiO1xuaW1wb3J0IHsgX3QgfSBmcm9tICcuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IFRvZ2dsZVN3aXRjaCBmcm9tIFwiLi9Ub2dnbGVTd2l0Y2hcIjtcbmltcG9ydCBTdHlsZWRDaGVja2JveCBmcm9tIFwiLi9TdHlsZWRDaGVja2JveFwiO1xuaW1wb3J0IHsgU2V0dGluZ0xldmVsIH0gZnJvbSBcIi4uLy4uLy4uL3NldHRpbmdzL1NldHRpbmdMZXZlbFwiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICAvLyBUaGUgc2V0dGluZyBtdXN0IGJlIGEgYm9vbGVhblxuICAgIG5hbWU6IHN0cmluZztcbiAgICBsZXZlbDogU2V0dGluZ0xldmVsO1xuICAgIHJvb21JZD86IHN0cmluZzsgLy8gZm9yIHBlci1yb29tIHNldHRpbmdzXG4gICAgbGFiZWw/OiBzdHJpbmc7IC8vIHVudHJhbnNsYXRlZFxuICAgIGlzRXhwbGljaXQ/OiBib29sZWFuO1xuICAgIC8vIFhYWDogb25jZSBkZXNpZ24gcmVwbGFjZXMgYWxsIHRvZ2dsZXMgbWFrZSB0aGlzIHRoZSBkZWZhdWx0XG4gICAgdXNlQ2hlY2tib3g/OiBib29sZWFuO1xuICAgIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgICBkaXNhYmxlZERlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIGhpZGVJZkNhbm5vdFNldD86IGJvb2xlYW47XG4gICAgb25DaGFuZ2U/KGNoZWNrZWQ6IGJvb2xlYW4pOiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICB2YWx1ZTogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2V0dGluZ3NGbGFnIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHZhbHVlOiBTZXR0aW5nc1N0b3JlLmdldFZhbHVlQXQoXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5sZXZlbCxcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLm5hbWUsXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5yb29tSWQsXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5pc0V4cGxpY2l0LFxuICAgICAgICAgICAgKSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uQ2hhbmdlID0gYXN5bmMgKGNoZWNrZWQ6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlKGNoZWNrZWQpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IGNoZWNrZWQgfSk7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uQ2hhbmdlKSB0aGlzLnByb3BzLm9uQ2hhbmdlKGNoZWNrZWQpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIGNoZWNrQm94T25DaGFuZ2UgPSAoZTogUmVhY3QuQ2hhbmdlRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICAgICAgdGhpcy5vbkNoYW5nZShlLnRhcmdldC5jaGVja2VkKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBzYXZlID0gYXN5bmMgKHZhbD86IGJvb2xlYW4pID0+IHtcbiAgICAgICAgYXdhaXQgU2V0dGluZ3NTdG9yZS5zZXRWYWx1ZShcbiAgICAgICAgICAgIHRoaXMucHJvcHMubmFtZSxcbiAgICAgICAgICAgIHRoaXMucHJvcHMucm9vbUlkLFxuICAgICAgICAgICAgdGhpcy5wcm9wcy5sZXZlbCxcbiAgICAgICAgICAgIHZhbCAhPT0gdW5kZWZpbmVkID8gdmFsIDogdGhpcy5zdGF0ZS52YWx1ZSxcbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgcHVibGljIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgY2FuQ2hhbmdlID0gU2V0dGluZ3NTdG9yZS5jYW5TZXRWYWx1ZSh0aGlzLnByb3BzLm5hbWUsIHRoaXMucHJvcHMucm9vbUlkLCB0aGlzLnByb3BzLmxldmVsKTtcblxuICAgICAgICBpZiAoIWNhbkNoYW5nZSAmJiB0aGlzLnByb3BzLmhpZGVJZkNhbm5vdFNldCkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgY29uc3QgbGFiZWwgPSB0aGlzLnByb3BzLmxhYmVsXG4gICAgICAgICAgICA/IF90KHRoaXMucHJvcHMubGFiZWwpXG4gICAgICAgICAgICA6IFNldHRpbmdzU3RvcmUuZ2V0RGlzcGxheU5hbWUodGhpcy5wcm9wcy5uYW1lLCB0aGlzLnByb3BzLmxldmVsKTtcbiAgICAgICAgY29uc3QgZGVzY3JpcHRpb24gPSBTZXR0aW5nc1N0b3JlLmdldERlc2NyaXB0aW9uKHRoaXMucHJvcHMubmFtZSk7XG5cbiAgICAgICAgbGV0IGRpc2FibGVkRGVzY3JpcHRpb246IEpTWC5FbGVtZW50O1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5kaXNhYmxlZCAmJiB0aGlzLnByb3BzLmRpc2FibGVkRGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIGRpc2FibGVkRGVzY3JpcHRpb24gPSA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzRmxhZ19taWNyb2NvcHlcIj5cbiAgICAgICAgICAgICAgICB7IHRoaXMucHJvcHMuZGlzYWJsZWREZXNjcmlwdGlvbiB9XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5wcm9wcy51c2VDaGVja2JveCkge1xuICAgICAgICAgICAgcmV0dXJuIDxTdHlsZWRDaGVja2JveFxuICAgICAgICAgICAgICAgIGNoZWNrZWQ9e3RoaXMuc3RhdGUudmFsdWV9XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuY2hlY2tCb3hPbkNoYW5nZX1cbiAgICAgICAgICAgICAgICBkaXNhYmxlZD17dGhpcy5wcm9wcy5kaXNhYmxlZCB8fCAhY2FuQ2hhbmdlfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHsgbGFiZWwgfVxuICAgICAgICAgICAgPC9TdHlsZWRDaGVja2JveD47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NGbGFnXCI+XG4gICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9XCJteF9TZXR0aW5nc0ZsYWdfbGFiZWxcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzRmxhZ19sYWJlbFRleHRcIj57IGxhYmVsIH08L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IGRlc2NyaXB0aW9uICYmIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NGbGFnX21pY3JvY29weVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgZGVzY3JpcHRpb24gfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgZGlzYWJsZWREZXNjcmlwdGlvbiB9XG4gICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICAgIDxUb2dnbGVTd2l0Y2hcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e3RoaXMuc3RhdGUudmFsdWV9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vbkNoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnByb3BzLmRpc2FibGVkIHx8ICFjYW5DaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPXtsYWJlbH1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBaUJBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQXRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTZCZSxNQUFNQSxZQUFOLFNBQTJCQyxjQUFBLENBQU1DLFNBQWpDLENBQTJEO0VBQ3RFQyxXQUFXLENBQUNDLEtBQUQsRUFBZ0I7SUFDdkIsTUFBTUEsS0FBTjtJQUR1QixnREFhUixNQUFPQyxPQUFQLElBQTRCO01BQzNDLE1BQU0sS0FBS0MsSUFBTCxDQUFVRCxPQUFWLENBQU47TUFDQSxLQUFLRSxRQUFMLENBQWM7UUFBRUMsS0FBSyxFQUFFSDtNQUFULENBQWQ7TUFDQSxJQUFJLEtBQUtELEtBQUwsQ0FBV0ssUUFBZixFQUF5QixLQUFLTCxLQUFMLENBQVdLLFFBQVgsQ0FBb0JKLE9BQXBCO0lBQzVCLENBakIwQjtJQUFBLHdEQW1CQ0ssQ0FBRCxJQUE0QztNQUNuRSxLQUFLRCxRQUFMLENBQWNDLENBQUMsQ0FBQ0MsTUFBRixDQUFTTixPQUF2QjtJQUNILENBckIwQjtJQUFBLDRDQXVCWixNQUFPTyxHQUFQLElBQXlCO01BQ3BDLE1BQU1DLHNCQUFBLENBQWNDLFFBQWQsQ0FDRixLQUFLVixLQUFMLENBQVdXLElBRFQsRUFFRixLQUFLWCxL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
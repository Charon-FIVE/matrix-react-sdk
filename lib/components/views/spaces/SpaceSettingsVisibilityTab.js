"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireWildcard(require("react"));

var _event = require("matrix-js-sdk/src/@types/event");

var _partials = require("matrix-js-sdk/src/@types/partials");

var _languageHandler = require("../../../languageHandler");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _AliasSettings = _interopRequireDefault(require("../room_settings/AliasSettings"));

var _useStateToggle = require("../../../hooks/useStateToggle");

var _LabelledToggleSwitch = _interopRequireDefault(require("../elements/LabelledToggleSwitch"));

var _useLocalEcho = require("../../../hooks/useLocalEcho");

var _JoinRuleSettings = _interopRequireDefault(require("../settings/JoinRuleSettings"));

var _useRoomState = require("../../../hooks/useRoomState");

var _SettingsFieldset = _interopRequireDefault(require("../settings/SettingsFieldset"));

var _useAsyncMemo = require("../../../hooks/useAsyncMemo");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const SpaceSettingsVisibilityTab = _ref => {
  let {
    matrixClient: cli,
    space,
    closeSettingsFn
  } = _ref;
  const [error, setError] = (0, _react.useState)("");
  const serverSupportsExploringSpaces = (0, _useAsyncMemo.useAsyncMemo)(async () => {
    return cli.doesServerSupportUnstableFeature("org.matrix.msc3827.stable");
  }, [cli], false);
  const userId = cli.getUserId();
  const joinRule = (0, _useRoomState.useRoomState)(space, state => state.getJoinRule());
  const [guestAccessEnabled, setGuestAccessEnabled] = (0, _useLocalEcho.useLocalEcho)(() => space.currentState.getStateEvents(_event.EventType.RoomGuestAccess, "")?.getContent()?.guest_access === _partials.GuestAccess.CanJoin, guestAccessEnabled => cli.sendStateEvent(space.roomId, _event.EventType.RoomGuestAccess, {
    guest_access: guestAccessEnabled ? _partials.GuestAccess.CanJoin : _partials.GuestAccess.Forbidden
  }, ""), () => setError((0, _languageHandler._t)("Failed to update the guest access of this space")));
  const [historyVisibility, setHistoryVisibility] = (0, _useLocalEcho.useLocalEcho)(() => space.currentState.getStateEvents(_event.EventType.RoomHistoryVisibility, "")?.getContent()?.history_visibility || _partials.HistoryVisibility.Shared, historyVisibility => cli.sendStateEvent(space.roomId, _event.EventType.RoomHistoryVisibility, {
    history_visibility: historyVisibility
  }, ""), () => setError((0, _languageHandler._t)("Failed to update the history visibility of this space")));
  const [showAdvancedSection, toggleAdvancedSection] = (0, _useStateToggle.useStateToggle)();
  const canSetGuestAccess = space.currentState.maySendStateEvent(_event.EventType.RoomGuestAccess, userId);
  const canSetHistoryVisibility = space.currentState.maySendStateEvent(_event.EventType.RoomHistoryVisibility, userId);
  const canSetCanonical = space.currentState.mayClientSendStateEvent(_event.EventType.RoomCanonicalAlias, cli);
  const canonicalAliasEv = space.currentState.getStateEvents(_event.EventType.RoomCanonicalAlias, "");
  let advancedSection;

  if (joinRule === _partials.JoinRule.Public) {
    advancedSection = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      "data-test-id": "toggle-guest-access-btn",
      onClick: toggleAdvancedSection,
      kind: "link",
      className: "mx_SettingsTab_showAdvanced"
    }, showAdvancedSection ? (0, _languageHandler._t)("Hide advanced") : (0, _languageHandler._t)("Show advanced")), showAdvancedSection && /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_toggleWithDescription"
    }, /*#__PURE__*/_react.default.createElement(_LabelledToggleSwitch.default, {
      value: guestAccessEnabled,
      onChange: setGuestAccessEnabled,
      disabled: !canSetGuestAccess,
      label: (0, _languageHandler._t)("Enable guest access")
    }), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Guests can join a space without having an account."), /*#__PURE__*/_react.default.createElement("br", null), (0, _languageHandler._t)("This may be useful for public spaces."))));
  }

  let addressesSection;

  if (space.getJoinRule() === _partials.JoinRule.Public) {
    addressesSection = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Address")), /*#__PURE__*/_react.default.createElement(_AliasSettings.default, {
      roomId: space.roomId,
      canSetCanonicalAlias: canSetCanonical,
      canSetAliases: true,
      canonicalAliasEvent: canonicalAliasEv,
      hidePublishSetting: !serverSupportsExploringSpaces
    }));
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_SettingsTab"
  }, /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_SettingsTab_heading"
  }, (0, _languageHandler._t)("Visibility")), error && /*#__PURE__*/_react.default.createElement("div", {
    "data-test-id": "space-settings-error",
    className: "mx_SpaceRoomView_errorText"
  }, error), /*#__PURE__*/_react.default.createElement(_SettingsFieldset.default, {
    "data-test-id": "access-fieldset",
    legend: (0, _languageHandler._t)("Access"),
    description: (0, _languageHandler._t)("Decide who can view and join %(spaceName)s.", {
      spaceName: space.name
    })
  }, /*#__PURE__*/_react.default.createElement(_JoinRuleSettings.default, {
    room: space,
    onError: () => setError((0, _languageHandler._t)("Failed to update the visibility of this space")),
    closeSettingsFn: closeSettingsFn
  }), advancedSection, /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_SettingsTab_toggleWithDescription"
  }, /*#__PURE__*/_react.default.createElement(_LabelledToggleSwitch.default, {
    value: historyVisibility === _partials.HistoryVisibility.WorldReadable,
    onChange: checked => {
      setHistoryVisibility(checked ? _partials.HistoryVisibility.WorldReadable : _partials.HistoryVisibility.Shared);
    },
    disabled: !canSetHistoryVisibility,
    label: (0, _languageHandler._t)("Preview Space")
  }), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Allow people to preview your space before they join."), /*#__PURE__*/_react.default.createElement("br", null), /*#__PURE__*/_react.default.createElement("b", null, (0, _languageHandler._t)("Recommended for public spaces."))))), addressesSection);
};

var _default = SpaceSettingsVisibilityTab;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTcGFjZVNldHRpbmdzVmlzaWJpbGl0eVRhYiIsIm1hdHJpeENsaWVudCIsImNsaSIsInNwYWNlIiwiY2xvc2VTZXR0aW5nc0ZuIiwiZXJyb3IiLCJzZXRFcnJvciIsInVzZVN0YXRlIiwic2VydmVyU3VwcG9ydHNFeHBsb3JpbmdTcGFjZXMiLCJ1c2VBc3luY01lbW8iLCJkb2VzU2VydmVyU3VwcG9ydFVuc3RhYmxlRmVhdHVyZSIsInVzZXJJZCIsImdldFVzZXJJZCIsImpvaW5SdWxlIiwidXNlUm9vbVN0YXRlIiwic3RhdGUiLCJnZXRKb2luUnVsZSIsImd1ZXN0QWNjZXNzRW5hYmxlZCIsInNldEd1ZXN0QWNjZXNzRW5hYmxlZCIsInVzZUxvY2FsRWNobyIsImN1cnJlbnRTdGF0ZSIsImdldFN0YXRlRXZlbnRzIiwiRXZlbnRUeXBlIiwiUm9vbUd1ZXN0QWNjZXNzIiwiZ2V0Q29udGVudCIsImd1ZXN0X2FjY2VzcyIsIkd1ZXN0QWNjZXNzIiwiQ2FuSm9pbiIsInNlbmRTdGF0ZUV2ZW50Iiwicm9vbUlkIiwiRm9yYmlkZGVuIiwiX3QiLCJoaXN0b3J5VmlzaWJpbGl0eSIsInNldEhpc3RvcnlWaXNpYmlsaXR5IiwiUm9vbUhpc3RvcnlWaXNpYmlsaXR5IiwiaGlzdG9yeV92aXNpYmlsaXR5IiwiSGlzdG9yeVZpc2liaWxpdHkiLCJTaGFyZWQiLCJzaG93QWR2YW5jZWRTZWN0aW9uIiwidG9nZ2xlQWR2YW5jZWRTZWN0aW9uIiwidXNlU3RhdGVUb2dnbGUiLCJjYW5TZXRHdWVzdEFjY2VzcyIsIm1heVNlbmRTdGF0ZUV2ZW50IiwiY2FuU2V0SGlzdG9yeVZpc2liaWxpdHkiLCJjYW5TZXRDYW5vbmljYWwiLCJtYXlDbGllbnRTZW5kU3RhdGVFdmVudCIsIlJvb21DYW5vbmljYWxBbGlhcyIsImNhbm9uaWNhbEFsaWFzRXYiLCJhZHZhbmNlZFNlY3Rpb24iLCJKb2luUnVsZSIsIlB1YmxpYyIsImFkZHJlc3Nlc1NlY3Rpb24iLCJzcGFjZU5hbWUiLCJuYW1lIiwiV29ybGRSZWFkYWJsZSIsImNoZWNrZWQiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy92aWV3cy9zcGFjZXMvU3BhY2VTZXR0aW5nc1Zpc2liaWxpdHlUYWIudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAyMSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgUm9vbSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvcm9vbVwiO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2NsaWVudFwiO1xuaW1wb3J0IHsgRXZlbnRUeXBlIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL0B0eXBlcy9ldmVudFwiO1xuaW1wb3J0IHsgR3Vlc3RBY2Nlc3MsIEhpc3RvcnlWaXNpYmlsaXR5LCBKb2luUnVsZSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9AdHlwZXMvcGFydGlhbHNcIjtcblxuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tIFwiLi4vZWxlbWVudHMvQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IEFsaWFzU2V0dGluZ3MgZnJvbSBcIi4uL3Jvb21fc2V0dGluZ3MvQWxpYXNTZXR0aW5nc1wiO1xuaW1wb3J0IHsgdXNlU3RhdGVUb2dnbGUgfSBmcm9tIFwiLi4vLi4vLi4vaG9va3MvdXNlU3RhdGVUb2dnbGVcIjtcbmltcG9ydCBMYWJlbGxlZFRvZ2dsZVN3aXRjaCBmcm9tIFwiLi4vZWxlbWVudHMvTGFiZWxsZWRUb2dnbGVTd2l0Y2hcIjtcbmltcG9ydCB7IHVzZUxvY2FsRWNobyB9IGZyb20gXCIuLi8uLi8uLi9ob29rcy91c2VMb2NhbEVjaG9cIjtcbmltcG9ydCBKb2luUnVsZVNldHRpbmdzIGZyb20gXCIuLi9zZXR0aW5ncy9Kb2luUnVsZVNldHRpbmdzXCI7XG5pbXBvcnQgeyB1c2VSb29tU3RhdGUgfSBmcm9tIFwiLi4vLi4vLi4vaG9va3MvdXNlUm9vbVN0YXRlXCI7XG5pbXBvcnQgU2V0dGluZ3NGaWVsZHNldCBmcm9tIFwiLi4vc2V0dGluZ3MvU2V0dGluZ3NGaWVsZHNldFwiO1xuaW1wb3J0IHsgdXNlQXN5bmNNZW1vIH0gZnJvbSBcIi4uLy4uLy4uL2hvb2tzL3VzZUFzeW5jTWVtb1wiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICBtYXRyaXhDbGllbnQ6IE1hdHJpeENsaWVudDtcbiAgICBzcGFjZTogUm9vbTtcbiAgICBjbG9zZVNldHRpbmdzRm4oKTogdm9pZDtcbn1cblxuY29uc3QgU3BhY2VTZXR0aW5nc1Zpc2liaWxpdHlUYWIgPSAoeyBtYXRyaXhDbGllbnQ6IGNsaSwgc3BhY2UsIGNsb3NlU2V0dGluZ3NGbiB9OiBJUHJvcHMpID0+IHtcbiAgICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlKFwiXCIpO1xuICAgIGNvbnN0IHNlcnZlclN1cHBvcnRzRXhwbG9yaW5nU3BhY2VzID0gdXNlQXN5bmNNZW1vPGJvb2xlYW4+KGFzeW5jICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGNsaS5kb2VzU2VydmVyU3VwcG9ydFVuc3RhYmxlRmVhdHVyZShcIm9yZy5tYXRyaXgubXNjMzgyNy5zdGFibGVcIik7XG4gICAgfSwgW2NsaV0sIGZhbHNlKTtcblxuICAgIGNvbnN0IHVzZXJJZCA9IGNsaS5nZXRVc2VySWQoKTtcblxuICAgIGNvbnN0IGpvaW5SdWxlID0gdXNlUm9vbVN0YXRlKHNwYWNlLCBzdGF0ZSA9PiBzdGF0ZS5nZXRKb2luUnVsZSgpKTtcbiAgICBjb25zdCBbZ3Vlc3RBY2Nlc3NFbmFibGVkLCBzZXRHdWVzdEFjY2Vzc0VuYWJsZWRdID0gdXNlTG9jYWxFY2hvPGJvb2xlYW4+KFxuICAgICAgICAoKSA9PiBzcGFjZS5jdXJyZW50U3RhdGUuZ2V0U3RhdGVFdmVudHMoRXZlbnRUeXBlLlJvb21HdWVzdEFjY2VzcywgXCJcIilcbiAgICAgICAgICAgID8uZ2V0Q29udGVudCgpPy5ndWVzdF9hY2Nlc3MgPT09IEd1ZXN0QWNjZXNzLkNhbkpvaW4sXG4gICAgICAgIGd1ZXN0QWNjZXNzRW5hYmxlZCA9PiBjbGkuc2VuZFN0YXRlRXZlbnQoc3BhY2Uucm9vbUlkLCBFdmVudFR5cGUuUm9vbUd1ZXN0QWNjZXNzLCB7XG4gICAgICAgICAgICBndWVzdF9hY2Nlc3M6IGd1ZXN0QWNjZXNzRW5hYmxlZCA/IEd1ZXN0QWNjZXNzLkNhbkpvaW4gOiBHdWVzdEFjY2Vzcy5Gb3JiaWRkZW4sXG4gICAgICAgIH0sIFwiXCIpLFxuICAgICAgICAoKSA9PiBzZXRFcnJvcihfdChcIkZhaWxlZCB0byB1cGRhdGUgdGhlIGd1ZXN0IGFjY2VzcyBvZiB0aGlzIHNwYWNlXCIpKSxcbiAgICApO1xuICAgIGNvbnN0IFtoaXN0b3J5VmlzaWJpbGl0eSwgc2V0SGlzdG9yeVZpc2liaWxpdHldID0gdXNlTG9jYWxFY2hvPEhpc3RvcnlWaXNpYmlsaXR5PihcbiAgICAgICAgKCkgPT4gc3BhY2UuY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKEV2ZW50VHlwZS5Sb29tSGlzdG9yeVZpc2liaWxpdHksIFwiXCIpXG4gICAgICAgICAgICA/LmdldENvbnRlbnQoKT8uaGlzdG9yeV92aXNpYmlsaXR5IHx8IEhpc3RvcnlWaXNpYmlsaXR5LlNoYXJlZCxcbiAgICAgICAgaGlzdG9yeVZpc2liaWxpdHkgPT4gY2xpLnNlbmRTdGF0ZUV2ZW50KHNwYWNlLnJvb21JZCwgRXZlbnRUeXBlLlJvb21IaXN0b3J5VmlzaWJpbGl0eSwge1xuICAgICAgICAgICAgaGlzdG9yeV92aXNpYmlsaXR5OiBoaXN0b3J5VmlzaWJpbGl0eSxcbiAgICAgICAgfSwgXCJcIiksXG4gICAgICAgICgpID0+IHNldEVycm9yKF90KFwiRmFpbGVkIHRvIHVwZGF0ZSB0aGUgaGlzdG9yeSB2aXNpYmlsaXR5IG9mIHRoaXMgc3BhY2VcIikpLFxuICAgICk7XG5cbiAgICBjb25zdCBbc2hvd0FkdmFuY2VkU2VjdGlvbiwgdG9nZ2xlQWR2YW5jZWRTZWN0aW9uXSA9IHVzZVN0YXRlVG9nZ2xlKCk7XG5cbiAgICBjb25zdCBjYW5TZXRHdWVzdEFjY2VzcyA9IHNwYWNlLmN1cnJlbnRTdGF0ZS5tYXlTZW5kU3RhdGVFdmVudChFdmVudFR5cGUuUm9vbUd1ZXN0QWNjZXNzLCB1c2VySWQpO1xuICAgIGNvbnN0IGNhblNldEhpc3RvcnlWaXNpYmlsaXR5ID0gc3BhY2UuY3VycmVudFN0YXRlLm1heVNlbmRTdGF0ZUV2ZW50KEV2ZW50VHlwZS5Sb29tSGlzdG9yeVZpc2liaWxpdHksIHVzZXJJZCk7XG4gICAgY29uc3QgY2FuU2V0Q2Fub25pY2FsID0gc3BhY2UuY3VycmVudFN0YXRlLm1heUNsaWVudFNlbmRTdGF0ZUV2ZW50KEV2ZW50VHlwZS5Sb29tQ2Fub25pY2FsQWxpYXMsIGNsaSk7XG4gICAgY29uc3QgY2Fub25pY2FsQWxpYXNFdiA9IHNwYWNlLmN1cnJlbnRTdGF0ZS5nZXRTdGF0ZUV2ZW50cyhFdmVudFR5cGUuUm9vbUNhbm9uaWNhbEFsaWFzLCBcIlwiKTtcblxuICAgIGxldCBhZHZhbmNlZFNlY3Rpb247XG4gICAgaWYgKGpvaW5SdWxlID09PSBKb2luUnVsZS5QdWJsaWMpIHtcbiAgICAgICAgYWR2YW5jZWRTZWN0aW9uID0gPGRpdj5cbiAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgICAgICAgICAgZGF0YS10ZXN0LWlkPSd0b2dnbGUtZ3Vlc3QtYWNjZXNzLWJ0bidcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXt0b2dnbGVBZHZhbmNlZFNlY3Rpb259XG4gICAgICAgICAgICAgICAga2luZD1cImxpbmtcIlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3Nob3dBZHZhbmNlZFwiPlxuICAgICAgICAgICAgICAgIHsgc2hvd0FkdmFuY2VkU2VjdGlvbiA/IF90KFwiSGlkZSBhZHZhbmNlZFwiKSA6IF90KFwiU2hvdyBhZHZhbmNlZFwiKSB9XG4gICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG5cbiAgICAgICAgICAgIHsgc2hvd0FkdmFuY2VkU2VjdGlvbiAmJiA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3RvZ2dsZVdpdGhEZXNjcmlwdGlvblwiPlxuICAgICAgICAgICAgICAgIDxMYWJlbGxlZFRvZ2dsZVN3aXRjaFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZT17Z3Vlc3RBY2Nlc3NFbmFibGVkfVxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17c2V0R3Vlc3RBY2Nlc3NFbmFibGVkfVxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17IWNhblNldEd1ZXN0QWNjZXNzfVxuICAgICAgICAgICAgICAgICAgICBsYWJlbD17X3QoXCJFbmFibGUgZ3Vlc3QgYWNjZXNzXCIpfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPHA+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJHdWVzdHMgY2FuIGpvaW4gYSBzcGFjZSB3aXRob3V0IGhhdmluZyBhbiBhY2NvdW50LlwiKSB9XG4gICAgICAgICAgICAgICAgICAgIDxiciAvPlxuICAgICAgICAgICAgICAgICAgICB7IF90KFwiVGhpcyBtYXkgYmUgdXNlZnVsIGZvciBwdWJsaWMgc3BhY2VzLlwiKSB9XG4gICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICB9XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG5cbiAgICBsZXQgYWRkcmVzc2VzU2VjdGlvbjtcbiAgICBpZiAoc3BhY2UuZ2V0Sm9pblJ1bGUoKSA9PT0gSm9pblJ1bGUuUHVibGljKSB7XG4gICAgICAgIGFkZHJlc3Nlc1NlY3Rpb24gPSA8PlxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc3ViaGVhZGluZ1wiPnsgX3QoXCJBZGRyZXNzXCIpIH08L3NwYW4+XG4gICAgICAgICAgICA8QWxpYXNTZXR0aW5nc1xuICAgICAgICAgICAgICAgIHJvb21JZD17c3BhY2Uucm9vbUlkfVxuICAgICAgICAgICAgICAgIGNhblNldENhbm9uaWNhbEFsaWFzPXtjYW5TZXRDYW5vbmljYWx9XG4gICAgICAgICAgICAgICAgY2FuU2V0QWxpYXNlcz17dHJ1ZX1cbiAgICAgICAgICAgICAgICBjYW5vbmljYWxBbGlhc0V2ZW50PXtjYW5vbmljYWxBbGlhc0V2fVxuICAgICAgICAgICAgICAgIGhpZGVQdWJsaXNoU2V0dGluZz17IXNlcnZlclN1cHBvcnRzRXhwbG9yaW5nU3BhY2VzfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgPC8+O1xuICAgIH1cblxuICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiXCI+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfaGVhZGluZ1wiPnsgX3QoXCJWaXNpYmlsaXR5XCIpIH08L2Rpdj5cblxuICAgICAgICB7IGVycm9yICYmIDxkaXYgZGF0YS10ZXN0LWlkPSdzcGFjZS1zZXR0aW5ncy1lcnJvcicgY2xhc3NOYW1lPVwibXhfU3BhY2VSb29tVmlld19lcnJvclRleHRcIj57IGVycm9yIH08L2Rpdj4gfVxuXG4gICAgICAgIDxTZXR0aW5nc0ZpZWxkc2V0XG4gICAgICAgICAgICBkYXRhLXRlc3QtaWQ9J2FjY2Vzcy1maWVsZHNldCdcbiAgICAgICAgICAgIGxlZ2VuZD17X3QoXCJBY2Nlc3NcIil9XG4gICAgICAgICAgICBkZXNjcmlwdGlvbj17X3QoXCJEZWNpZGUgd2hvIGNhbiB2aWV3IGFuZCBqb2luICUoc3BhY2VOYW1lKXMuXCIsIHsgc3BhY2VOYW1lOiBzcGFjZS5uYW1lIH0pfVxuICAgICAgICA+XG4gICAgICAgICAgICA8Sm9pblJ1bGVTZXR0aW5nc1xuICAgICAgICAgICAgICAgIHJvb209e3NwYWNlfVxuICAgICAgICAgICAgICAgIG9uRXJyb3I9eygpID0+IHNldEVycm9yKF90KFwiRmFpbGVkIHRvIHVwZGF0ZSB0aGUgdmlzaWJpbGl0eSBvZiB0aGlzIHNwYWNlXCIpKX1cbiAgICAgICAgICAgICAgICBjbG9zZVNldHRpbmdzRm49e2Nsb3NlU2V0dGluZ3NGbn1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICB7IGFkdmFuY2VkU2VjdGlvbiB9XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3RvZ2dsZVdpdGhEZXNjcmlwdGlvblwiPlxuICAgICAgICAgICAgICAgIDxMYWJlbGxlZFRvZ2dsZVN3aXRjaFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZT17aGlzdG9yeVZpc2liaWxpdHkgPT09IEhpc3RvcnlWaXNpYmlsaXR5LldvcmxkUmVhZGFibGV9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoY2hlY2tlZDogYm9vbGVhbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0SGlzdG9yeVZpc2liaWxpdHkoY2hlY2tlZCA/IEhpc3RvcnlWaXNpYmlsaXR5LldvcmxkUmVhZGFibGUgOiBIaXN0b3J5VmlzaWJpbGl0eS5TaGFyZWQpO1xuICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17IWNhblNldEhpc3RvcnlWaXNpYmlsaXR5fVxuICAgICAgICAgICAgICAgICAgICBsYWJlbD17X3QoXCJQcmV2aWV3IFNwYWNlXCIpfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPHA+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJBbGxvdyBwZW9wbGUgdG8gcHJldmlldyB5b3VyIHNwYWNlIGJlZm9yZSB0aGV5IGpvaW4uXCIpIH08YnIgLz5cbiAgICAgICAgICAgICAgICAgICAgPGI+eyBfdChcIlJlY29tbWVuZGVkIGZvciBwdWJsaWMgc3BhY2VzLlwiKSB9PC9iPlxuICAgICAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L1NldHRpbmdzRmllbGRzZXQ+XG5cbiAgICAgICAgeyBhZGRyZXNzZXNTZWN0aW9uIH1cbiAgICA8L2Rpdj47XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTcGFjZVNldHRpbmdzVmlzaWJpbGl0eVRhYjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBZ0JBOztBQUdBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUEvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _room = require("matrix-js-sdk/src/models/room");

var _BaseCard = _interopRequireDefault(require("./BaseCard"));

var _MessageComposer = _interopRequireDefault(require("../rooms/MessageComposer"));

var _Layout = require("../../../settings/enums/Layout");

var _TimelinePanel = _interopRequireDefault(require("../../structures/TimelinePanel"));

var _EditorStateTransfer = _interopRequireDefault(require("../../../utils/EditorStateTransfer"));

var _RoomContext = _interopRequireDefault(require("../../../contexts/RoomContext"));

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _languageHandler = require("../../../languageHandler");

var _actions = require("../../../dispatcher/actions");

var _RoomViewStore = require("../../../stores/RoomViewStore");

var _ContentMessages = _interopRequireDefault(require("../../../ContentMessages"));

var _UploadBar = _interopRequireDefault(require("../../structures/UploadBar"));

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _JumpToBottomButton = _interopRequireDefault(require("../rooms/JumpToBottomButton"));

var _Measured = _interopRequireDefault(require("../elements/Measured"));

var _Heading = _interopRequireDefault(require("../typography/Heading"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

class TimelineCard extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "dispatcherRef", void 0);
    (0, _defineProperty2.default)(this, "layoutWatcherRef", void 0);
    (0, _defineProperty2.default)(this, "timelinePanel", /*#__PURE__*/_react.default.createRef());
    (0, _defineProperty2.default)(this, "card", /*#__PURE__*/_react.default.createRef());
    (0, _defineProperty2.default)(this, "roomStoreToken", void 0);
    (0, _defineProperty2.default)(this, "readReceiptsSettingWatcher", void 0);
    (0, _defineProperty2.default)(this, "onRoomViewStoreUpdate", async initial => {
      const newState = {
        // roomLoading: RoomViewStore.instance.isRoomLoading(),
        // roomLoadError: RoomViewStore.instance.getRoomLoadError(),
        initialEventId: _RoomViewStore.RoomViewStore.instance.getInitialEventId(),
        isInitialEventHighlighted: _RoomViewStore.RoomViewStore.instance.isInitialEventHighlighted(),
        replyToEvent: _RoomViewStore.RoomViewStore.instance.getQuotingEvent()
      };
      this.setState(newState);
    });
    (0, _defineProperty2.default)(this, "onAction", payload => {
      switch (payload.action) {
        case _actions.Action.EditEvent:
          this.setState({
            editState: payload.event ? new _EditorStateTransfer.default(payload.event) : null
          }, () => {
            if (payload.event) {
              this.timelinePanel.current?.scrollToEventIfNeeded(payload.event.getId());
            }
          });
          break;

        default:
          break;
      }
    });
    (0, _defineProperty2.default)(this, "onScroll", () => {
      const timelinePanel = this.timelinePanel.current;
      if (!timelinePanel) return;

      if (timelinePanel.isAtEndOfLiveTimeline()) {
        this.setState({
          atEndOfLiveTimeline: true
        });
      } else {
        this.setState({
          atEndOfLiveTimeline: false
        });
      }

      if (this.state.initialEventId && this.state.isInitialEventHighlighted) {
        _dispatcher.default.dispatch({
          action: _actions.Action.ViewRoom,
          room_id: this.props.room.roomId,
          event_id: this.state.initialEventId,
          highlighted: false,
          replyingToEvent: this.state.replyToEvent,
          metricsTrigger: undefined // room doesn't change

        });
      }
    });
    (0, _defineProperty2.default)(this, "onMeasurement", narrow => {
      this.setState({
        narrow
      });
    });
    (0, _defineProperty2.default)(this, "jumpToLiveTimeline", () => {
      if (this.state.initialEventId && this.state.isInitialEventHighlighted) {
        // If we were viewing a highlighted event, firing view_room without
        // an event will take care of both clearing the URL fragment and
        // jumping to the bottom
        _dispatcher.default.dispatch({
          action: _actions.Action.ViewRoom,
          room_id: this.props.room.roomId
        });
      } else {
        // Otherwise we have to jump manually
        this.timelinePanel.current?.jumpToLiveTimeline();

        _dispatcher.default.fire(_actions.Action.FocusSendMessageComposer);
      }
    });
    (0, _defineProperty2.default)(this, "renderTimelineCardHeader", () => {
      return /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_BaseCard_header_title"
      }, /*#__PURE__*/_react.default.createElement(_Heading.default, {
        size: "h4",
        className: "mx_BaseCard_header_title_heading"
      }, (0, _languageHandler._t)("Chat")));
    });
    this.state = {
      showReadReceipts: _SettingsStore.default.getValue("showReadReceipts", props.room.roomId),
      layout: _SettingsStore.default.getValue("layout"),
      atEndOfLiveTimeline: true,
      narrow: false
    };
    this.readReceiptsSettingWatcher = null;
  }

  componentDidMount() {
    var _this = this;

    this.roomStoreToken = _RoomViewStore.RoomViewStore.instance.addListener(this.onRoomViewStoreUpdate);
    this.dispatcherRef = _dispatcher.default.register(this.onAction);
    this.readReceiptsSettingWatcher = _SettingsStore.default.watchSetting("showReadReceipts", null, function () {
      for (var _len = arguments.length, _ref = new Array(_len), _key = 0; _key < _len; _key++) {
        _ref[_key] = arguments[_key];
      }

      let [,,, value] = _ref;
      return _this.setState({
        showReadReceipts: value
      });
    });
    this.layoutWatcherRef = _SettingsStore.default.watchSetting("layout", null, function () {
      for (var _len2 = arguments.length, _ref2 = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        _ref2[_key2] = arguments[_key2];
      }

      let [,,, value] = _ref2;
      return _this.setState({
        layout: value
      });
    });
  }

  componentWillUnmount() {
    // Remove RoomStore listener
    this.roomStoreToken?.remove();

    if (this.readReceiptsSettingWatcher) {
      _SettingsStore.default.unwatchSetting(this.readReceiptsSettingWatcher);
    }

    if (this.layoutWatcherRef) {
      _SettingsStore.default.unwatchSetting(this.layoutWatcherRef);
    }

    _dispatcher.default.unregister(this.dispatcherRef);
  }

  render() {
    const highlightedEventId = this.state.isInitialEventHighlighted ? this.state.initialEventId : null;
    let jumpToBottom;

    if (!this.state.atEndOfLiveTimeline) {
      jumpToBottom = /*#__PURE__*/_react.default.createElement(_JumpToBottomButton.default, {
        highlight: this.props.room.getUnreadNotificationCount(_room.NotificationCountType.Highlight) > 0,
        onScrollToBottomClick: this.jumpToLiveTimeline
      });
    }

    const isUploading = _ContentMessages.default.sharedInstance().getCurrentUploads(this.props.composerRelation).length > 0;
    const myMembership = this.props.room.getMyMembership();
    const showComposer = myMembership === "join";
    return /*#__PURE__*/_react.default.createElement(_RoomContext.default.Provider, {
      value: _objectSpread(_objectSpread({}, this.context), {}, {
        timelineRenderingType: this.props.timelineRenderingType ?? this.context.timelineRenderingType,
        liveTimeline: this.props.timelineSet.getLiveTimeline(),
        narrow: this.state.narrow
      })
    }, /*#__PURE__*/_react.default.createElement(_BaseCard.default, {
      className: this.props.classNames,
      onClose: this.props.onClose,
      withoutScrollContainer: true,
      header: this.renderTimelineCardHeader(),
      ref: this.card
    }, /*#__PURE__*/_react.default.createElement(_Measured.default, {
      sensor: this.card.current,
      onMeasurement: this.onMeasurement
    }), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_TimelineCard_timeline"
    }, jumpToBottom, /*#__PURE__*/_react.default.createElement(_TimelinePanel.default, {
      ref: this.timelinePanel,
      showReadReceipts: this.state.showReadReceipts,
      manageReadReceipts: true,
      manageReadMarkers: false // No RM support in the TimelineCard
      ,
      sendReadReceiptOnLoad: true,
      timelineSet: this.props.timelineSet,
      showUrlPreview: this.context.showUrlPreview // The right panel timeline (and therefore threads) don't support IRC layout at this time
      ,
      layout: this.state.layout === _Layout.Layout.Bubble ? _Layout.Layout.Bubble : _Layout.Layout.Group,
      hideThreadedMessages: false,
      hidden: false,
      showReactions: true,
      className: "mx_RoomView_messagePanel",
      permalinkCreator: this.props.permalinkCreator,
      membersLoaded: true,
      editState: this.state.editState,
      eventId: this.state.initialEventId,
      resizeNotifier: this.props.resizeNotifier,
      highlightedEventId: highlightedEventId,
      onScroll: this.onScroll
    })), isUploading && /*#__PURE__*/_react.default.createElement(_UploadBar.default, {
      room: this.props.room,
      relation: this.props.composerRelation
    }), showComposer && /*#__PURE__*/_react.default.createElement(_MessageComposer.default, {
      room: this.props.room,
      relation: this.props.composerRelation,
      resizeNotifier: this.props.resizeNotifier,
      replyToEvent: this.state.replyToEvent,
      permalinkCreator: this.props.permalinkCreator,
      e2eStatus: this.props.e2eStatus,
      compact: true
    })));
  }

}

exports.default = TimelineCard;
(0, _defineProperty2.default)(TimelineCard, "contextType", _RoomContext.default);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJUaW1lbGluZUNhcmQiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJjcmVhdGVSZWYiLCJpbml0aWFsIiwibmV3U3RhdGUiLCJpbml0aWFsRXZlbnRJZCIsIlJvb21WaWV3U3RvcmUiLCJpbnN0YW5jZSIsImdldEluaXRpYWxFdmVudElkIiwiaXNJbml0aWFsRXZlbnRIaWdobGlnaHRlZCIsInJlcGx5VG9FdmVudCIsImdldFF1b3RpbmdFdmVudCIsInNldFN0YXRlIiwicGF5bG9hZCIsImFjdGlvbiIsIkFjdGlvbiIsIkVkaXRFdmVudCIsImVkaXRTdGF0ZSIsImV2ZW50IiwiRWRpdG9yU3RhdGVUcmFuc2ZlciIsInRpbWVsaW5lUGFuZWwiLCJjdXJyZW50Iiwic2Nyb2xsVG9FdmVudElmTmVlZGVkIiwiZ2V0SWQiLCJpc0F0RW5kT2ZMaXZlVGltZWxpbmUiLCJhdEVuZE9mTGl2ZVRpbWVsaW5lIiwic3RhdGUiLCJkaXMiLCJkaXNwYXRjaCIsIlZpZXdSb29tIiwicm9vbV9pZCIsInJvb20iLCJyb29tSWQiLCJldmVudF9pZCIsImhpZ2hsaWdodGVkIiwicmVwbHlpbmdUb0V2ZW50IiwibWV0cmljc1RyaWdnZXIiLCJ1bmRlZmluZWQiLCJuYXJyb3ciLCJqdW1wVG9MaXZlVGltZWxpbmUiLCJmaXJlIiwiRm9jdXNTZW5kTWVzc2FnZUNvbXBvc2VyIiwiX3QiLCJzaG93UmVhZFJlY2VpcHRzIiwiU2V0dGluZ3NTdG9yZSIsImdldFZhbHVlIiwibGF5b3V0IiwicmVhZFJlY2VpcHRzU2V0dGluZ1dhdGNoZXIiLCJjb21wb25lbnREaWRNb3VudCIsInJvb21TdG9yZVRva2VuIiwiYWRkTGlzdGVuZXIiLCJvblJvb21WaWV3U3RvcmVVcGRhdGUiLCJkaXNwYXRjaGVyUmVmIiwicmVnaXN0ZXIiLCJvbkFjdGlvbiIsIndhdGNoU2V0dGluZyIsInZhbHVlIiwibGF5b3V0V2F0Y2hlclJlZiIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVtb3ZlIiwidW53YXRjaFNldHRpbmciLCJ1bnJlZ2lzdGVyIiwicmVuZGVyIiwiaGlnaGxpZ2h0ZWRFdmVudElkIiwianVtcFRvQm90dG9tIiwiZ2V0VW5yZWFkTm90aWZpY2F0aW9uQ291bnQiLCJOb3RpZmljYXRpb25Db3VudFR5cGUiLCJIaWdobGlnaHQiLCJpc1VwbG9hZGluZyIsIkNvbnRlbnRNZXNzYWdlcyIsInNoYXJlZEluc3RhbmNlIiwiZ2V0Q3VycmVudFVwbG9hZHMiLCJjb21wb3NlclJlbGF0aW9uIiwibGVuZ3RoIiwibXlNZW1iZXJzaGlwIiwiZ2V0TXlNZW1iZXJzaGlwIiwic2hvd0NvbXBvc2VyIiwiY29udGV4dCIsInRpbWVsaW5lUmVuZGVyaW5nVHlwZSIsImxpdmVUaW1lbGluZSIsInRpbWVsaW5lU2V0IiwiZ2V0TGl2ZVRpbWVsaW5lIiwiY2xhc3NOYW1lcyIsIm9uQ2xvc2UiLCJyZW5kZXJUaW1lbGluZUNhcmRIZWFkZXIiLCJjYXJkIiwib25NZWFzdXJlbWVudCIsInNob3dVcmxQcmV2aWV3IiwiTGF5b3V0IiwiQnViYmxlIiwiR3JvdXAiLCJwZXJtYWxpbmtDcmVhdG9yIiwicmVzaXplTm90aWZpZXIiLCJvblNjcm9sbCIsImUyZVN0YXR1cyIsIlJvb21Db250ZXh0Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvdmlld3MvcmlnaHRfcGFuZWwvVGltZWxpbmVDYXJkLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMjEgLSAyMDIyIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEV2ZW50U3Vic2NyaXB0aW9uIH0gZnJvbSBcImZiZW1pdHRlclwiO1xuaW1wb3J0IHsgSUV2ZW50UmVsYXRpb24sIE1hdHJpeEV2ZW50IH0gZnJvbSAnbWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL2V2ZW50JztcbmltcG9ydCB7IEV2ZW50VGltZWxpbmVTZXQgfSBmcm9tICdtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvZXZlbnQtdGltZWxpbmUtc2V0JztcbmltcG9ydCB7IE5vdGlmaWNhdGlvbkNvdW50VHlwZSwgUm9vbSB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tJztcbmltcG9ydCB7IFRocmVhZCB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL21vZGVscy90aHJlYWQnO1xuXG5pbXBvcnQgQmFzZUNhcmQgZnJvbSBcIi4vQmFzZUNhcmRcIjtcbmltcG9ydCBSZXNpemVOb3RpZmllciBmcm9tICcuLi8uLi8uLi91dGlscy9SZXNpemVOb3RpZmllcic7XG5pbXBvcnQgTWVzc2FnZUNvbXBvc2VyIGZyb20gJy4uL3Jvb21zL01lc3NhZ2VDb21wb3Nlcic7XG5pbXBvcnQgeyBSb29tUGVybWFsaW5rQ3JlYXRvciB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3Blcm1hbGlua3MvUGVybWFsaW5rcyc7XG5pbXBvcnQgeyBMYXlvdXQgfSBmcm9tICcuLi8uLi8uLi9zZXR0aW5ncy9lbnVtcy9MYXlvdXQnO1xuaW1wb3J0IFRpbWVsaW5lUGFuZWwgZnJvbSAnLi4vLi4vc3RydWN0dXJlcy9UaW1lbGluZVBhbmVsJztcbmltcG9ydCB7IEUyRVN0YXR1cyB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL1NoaWVsZFV0aWxzJztcbmltcG9ydCBFZGl0b3JTdGF0ZVRyYW5zZmVyIGZyb20gJy4uLy4uLy4uL3V0aWxzL0VkaXRvclN0YXRlVHJhbnNmZXInO1xuaW1wb3J0IFJvb21Db250ZXh0LCB7IFRpbWVsaW5lUmVuZGVyaW5nVHlwZSB9IGZyb20gJy4uLy4uLy4uL2NvbnRleHRzL1Jvb21Db250ZXh0JztcbmltcG9ydCBkaXMgZnJvbSAnLi4vLi4vLi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyJztcbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCB7IEFjdGlvblBheWxvYWQgfSBmcm9tICcuLi8uLi8uLi9kaXNwYXRjaGVyL3BheWxvYWRzJztcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gJy4uLy4uLy4uL2Rpc3BhdGNoZXIvYWN0aW9ucyc7XG5pbXBvcnQgeyBSb29tVmlld1N0b3JlIH0gZnJvbSAnLi4vLi4vLi4vc3RvcmVzL1Jvb21WaWV3U3RvcmUnO1xuaW1wb3J0IENvbnRlbnRNZXNzYWdlcyBmcm9tICcuLi8uLi8uLi9Db250ZW50TWVzc2FnZXMnO1xuaW1wb3J0IFVwbG9hZEJhciBmcm9tICcuLi8uLi9zdHJ1Y3R1cmVzL1VwbG9hZEJhcic7XG5pbXBvcnQgU2V0dGluZ3NTdG9yZSBmcm9tICcuLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlJztcbmltcG9ydCBKdW1wVG9Cb3R0b21CdXR0b24gZnJvbSAnLi4vcm9vbXMvSnVtcFRvQm90dG9tQnV0dG9uJztcbmltcG9ydCB7IFZpZXdSb29tUGF5bG9hZCB9IGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL3BheWxvYWRzL1ZpZXdSb29tUGF5bG9hZFwiO1xuaW1wb3J0IE1lYXN1cmVkIGZyb20gJy4uL2VsZW1lbnRzL01lYXN1cmVkJztcbmltcG9ydCBIZWFkaW5nIGZyb20gJy4uL3R5cG9ncmFwaHkvSGVhZGluZyc7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIHJvb206IFJvb207XG4gICAgb25DbG9zZTogKCkgPT4gdm9pZDtcbiAgICByZXNpemVOb3RpZmllcjogUmVzaXplTm90aWZpZXI7XG4gICAgcGVybWFsaW5rQ3JlYXRvcj86IFJvb21QZXJtYWxpbmtDcmVhdG9yO1xuICAgIGUyZVN0YXR1cz86IEUyRVN0YXR1cztcbiAgICBjbGFzc05hbWVzPzogc3RyaW5nO1xuICAgIHRpbWVsaW5lU2V0PzogRXZlbnRUaW1lbGluZVNldDtcbiAgICB0aW1lbGluZVJlbmRlcmluZ1R5cGU/OiBUaW1lbGluZVJlbmRlcmluZ1R5cGU7XG4gICAgc2hvd0NvbXBvc2VyPzogYm9vbGVhbjtcbiAgICBjb21wb3NlclJlbGF0aW9uPzogSUV2ZW50UmVsYXRpb247XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIHRocmVhZD86IFRocmVhZDtcbiAgICBlZGl0U3RhdGU/OiBFZGl0b3JTdGF0ZVRyYW5zZmVyO1xuICAgIHJlcGx5VG9FdmVudD86IE1hdHJpeEV2ZW50O1xuICAgIGluaXRpYWxFdmVudElkPzogc3RyaW5nO1xuICAgIGlzSW5pdGlhbEV2ZW50SGlnaGxpZ2h0ZWQ/OiBib29sZWFuO1xuICAgIGxheW91dDogTGF5b3V0O1xuICAgIGF0RW5kT2ZMaXZlVGltZWxpbmU6IGJvb2xlYW47XG4gICAgbmFycm93OiBib29sZWFuO1xuXG4gICAgLy8gc2V0dGluZ3M6XG4gICAgc2hvd1JlYWRSZWNlaXB0cz86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRpbWVsaW5lQ2FyZCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHN0YXRpYyBjb250ZXh0VHlwZSA9IFJvb21Db250ZXh0O1xuXG4gICAgcHJpdmF0ZSBkaXNwYXRjaGVyUmVmOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBsYXlvdXRXYXRjaGVyUmVmOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSB0aW1lbGluZVBhbmVsID0gUmVhY3QuY3JlYXRlUmVmPFRpbWVsaW5lUGFuZWw+KCk7XG4gICAgcHJpdmF0ZSBjYXJkID0gUmVhY3QuY3JlYXRlUmVmPEhUTUxEaXZFbGVtZW50PigpO1xuICAgIHByaXZhdGUgcm9vbVN0b3JlVG9rZW46IEV2ZW50U3Vic2NyaXB0aW9uO1xuICAgIHByaXZhdGUgcmVhZFJlY2VpcHRzU2V0dGluZ1dhdGNoZXI6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgc2hvd1JlYWRSZWNlaXB0czogU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcInNob3dSZWFkUmVjZWlwdHNcIiwgcHJvcHMucm9vbS5yb29tSWQpLFxuICAgICAgICAgICAgbGF5b3V0OiBTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFwibGF5b3V0XCIpLFxuICAgICAgICAgICAgYXRFbmRPZkxpdmVUaW1lbGluZTogdHJ1ZSxcbiAgICAgICAgICAgIG5hcnJvdzogZmFsc2UsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVhZFJlY2VpcHRzU2V0dGluZ1dhdGNoZXIgPSBudWxsO1xuICAgIH1cblxuICAgIHB1YmxpYyBjb21wb25lbnREaWRNb3VudCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yb29tU3RvcmVUb2tlbiA9IFJvb21WaWV3U3RvcmUuaW5zdGFuY2UuYWRkTGlzdGVuZXIodGhpcy5vblJvb21WaWV3U3RvcmVVcGRhdGUpO1xuICAgICAgICB0aGlzLmRpc3BhdGNoZXJSZWYgPSBkaXMucmVnaXN0ZXIodGhpcy5vbkFjdGlvbik7XG4gICAgICAgIHRoaXMucmVhZFJlY2VpcHRzU2V0dGluZ1dhdGNoZXIgPSBTZXR0aW5nc1N0b3JlLndhdGNoU2V0dGluZyhcInNob3dSZWFkUmVjZWlwdHNcIiwgbnVsbCwgKC4uLlssLCwgdmFsdWVdKSA9PlxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3dSZWFkUmVjZWlwdHM6IHZhbHVlIGFzIGJvb2xlYW4gfSksXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMubGF5b3V0V2F0Y2hlclJlZiA9IFNldHRpbmdzU3RvcmUud2F0Y2hTZXR0aW5nKFwibGF5b3V0XCIsIG51bGwsICguLi5bLCwsIHZhbHVlXSkgPT5cbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBsYXlvdXQ6IHZhbHVlIGFzIExheW91dCB9KSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50V2lsbFVubW91bnQoKTogdm9pZCB7XG4gICAgICAgIC8vIFJlbW92ZSBSb29tU3RvcmUgbGlzdGVuZXJcblxuICAgICAgICB0aGlzLnJvb21TdG9yZVRva2VuPy5yZW1vdmUoKTtcblxuICAgICAgICBpZiAodGhpcy5yZWFkUmVjZWlwdHNTZXR0aW5nV2F0Y2hlcikge1xuICAgICAgICAgICAgU2V0dGluZ3NTdG9yZS51bndhdGNoU2V0dGluZyh0aGlzLnJlYWRSZWNlaXB0c1NldHRpbmdXYXRjaGVyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5sYXlvdXRXYXRjaGVyUmVmKSB7XG4gICAgICAgICAgICBTZXR0aW5nc1N0b3JlLnVud2F0Y2hTZXR0aW5nKHRoaXMubGF5b3V0V2F0Y2hlclJlZik7XG4gICAgICAgIH1cblxuICAgICAgICBkaXMudW5yZWdpc3Rlcih0aGlzLmRpc3BhdGNoZXJSZWYpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25Sb29tVmlld1N0b3JlVXBkYXRlID0gYXN5bmMgKGluaXRpYWw/OiBib29sZWFuKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgICAgIGNvbnN0IG5ld1N0YXRlOiBQaWNrPElTdGF0ZSwgYW55PiA9IHtcbiAgICAgICAgICAgIC8vIHJvb21Mb2FkaW5nOiBSb29tVmlld1N0b3JlLmluc3RhbmNlLmlzUm9vbUxvYWRpbmcoKSxcbiAgICAgICAgICAgIC8vIHJvb21Mb2FkRXJyb3I6IFJvb21WaWV3U3RvcmUuaW5zdGFuY2UuZ2V0Um9vbUxvYWRFcnJvcigpLFxuXG4gICAgICAgICAgICBpbml0aWFsRXZlbnRJZDogUm9vbVZpZXdTdG9yZS5pbnN0YW5jZS5nZXRJbml0aWFsRXZlbnRJZCgpLFxuICAgICAgICAgICAgaXNJbml0aWFsRXZlbnRIaWdobGlnaHRlZDogUm9vbVZpZXdTdG9yZS5pbnN0YW5jZS5pc0luaXRpYWxFdmVudEhpZ2hsaWdodGVkKCksXG4gICAgICAgICAgICByZXBseVRvRXZlbnQ6IFJvb21WaWV3U3RvcmUuaW5zdGFuY2UuZ2V0UXVvdGluZ0V2ZW50KCksXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZShuZXdTdGF0ZSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25BY3Rpb24gPSAocGF5bG9hZDogQWN0aW9uUGF5bG9hZCk6IHZvaWQgPT4ge1xuICAgICAgICBzd2l0Y2ggKHBheWxvYWQuYWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIEFjdGlvbi5FZGl0RXZlbnQ6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRTdGF0ZTogcGF5bG9hZC5ldmVudCA/IG5ldyBFZGl0b3JTdGF0ZVRyYW5zZmVyKHBheWxvYWQuZXZlbnQpIDogbnVsbCxcbiAgICAgICAgICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkLmV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbWVsaW5lUGFuZWwuY3VycmVudD8uc2Nyb2xsVG9FdmVudElmTmVlZGVkKHBheWxvYWQuZXZlbnQuZ2V0SWQoKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblNjcm9sbCA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3QgdGltZWxpbmVQYW5lbCA9IHRoaXMudGltZWxpbmVQYW5lbC5jdXJyZW50O1xuICAgICAgICBpZiAoIXRpbWVsaW5lUGFuZWwpIHJldHVybjtcbiAgICAgICAgaWYgKHRpbWVsaW5lUGFuZWwuaXNBdEVuZE9mTGl2ZVRpbWVsaW5lKCkpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGF0RW5kT2ZMaXZlVGltZWxpbmU6IHRydWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGF0RW5kT2ZMaXZlVGltZWxpbmU6IGZhbHNlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5pbml0aWFsRXZlbnRJZCAmJiB0aGlzLnN0YXRlLmlzSW5pdGlhbEV2ZW50SGlnaGxpZ2h0ZWQpIHtcbiAgICAgICAgICAgIGRpcy5kaXNwYXRjaDxWaWV3Um9vbVBheWxvYWQ+KHtcbiAgICAgICAgICAgICAgICBhY3Rpb246IEFjdGlvbi5WaWV3Um9vbSxcbiAgICAgICAgICAgICAgICByb29tX2lkOiB0aGlzLnByb3BzLnJvb20ucm9vbUlkLFxuICAgICAgICAgICAgICAgIGV2ZW50X2lkOiB0aGlzLnN0YXRlLmluaXRpYWxFdmVudElkLFxuICAgICAgICAgICAgICAgIGhpZ2hsaWdodGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICByZXBseWluZ1RvRXZlbnQ6IHRoaXMuc3RhdGUucmVwbHlUb0V2ZW50LFxuICAgICAgICAgICAgICAgIG1ldHJpY3NUcmlnZ2VyOiB1bmRlZmluZWQsIC8vIHJvb20gZG9lc24ndCBjaGFuZ2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25NZWFzdXJlbWVudCA9IChuYXJyb3c6IGJvb2xlYW4pOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG5hcnJvdyB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBqdW1wVG9MaXZlVGltZWxpbmUgPSAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmluaXRpYWxFdmVudElkICYmIHRoaXMuc3RhdGUuaXNJbml0aWFsRXZlbnRIaWdobGlnaHRlZCkge1xuICAgICAgICAgICAgLy8gSWYgd2Ugd2VyZSB2aWV3aW5nIGEgaGlnaGxpZ2h0ZWQgZXZlbnQsIGZpcmluZyB2aWV3X3Jvb20gd2l0aG91dFxuICAgICAgICAgICAgLy8gYW4gZXZlbnQgd2lsbCB0YWtlIGNhcmUgb2YgYm90aCBjbGVhcmluZyB0aGUgVVJMIGZyYWdtZW50IGFuZFxuICAgICAgICAgICAgLy8ganVtcGluZyB0byB0aGUgYm90dG9tXG4gICAgICAgICAgICBkaXMuZGlzcGF0Y2goe1xuICAgICAgICAgICAgICAgIGFjdGlvbjogQWN0aW9uLlZpZXdSb29tLFxuICAgICAgICAgICAgICAgIHJvb21faWQ6IHRoaXMucHJvcHMucm9vbS5yb29tSWQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIE90aGVyd2lzZSB3ZSBoYXZlIHRvIGp1bXAgbWFudWFsbHlcbiAgICAgICAgICAgIHRoaXMudGltZWxpbmVQYW5lbC5jdXJyZW50Py5qdW1wVG9MaXZlVGltZWxpbmUoKTtcbiAgICAgICAgICAgIGRpcy5maXJlKEFjdGlvbi5Gb2N1c1NlbmRNZXNzYWdlQ29tcG9zZXIpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgcmVuZGVyVGltZWxpbmVDYXJkSGVhZGVyID0gKCk6IEpTWC5FbGVtZW50ID0+IHtcbiAgICAgICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwibXhfQmFzZUNhcmRfaGVhZGVyX3RpdGxlXCI+XG4gICAgICAgICAgICA8SGVhZGluZyBzaXplPVwiaDRcIiBjbGFzc05hbWU9XCJteF9CYXNlQ2FyZF9oZWFkZXJfdGl0bGVfaGVhZGluZ1wiPnsgX3QoXCJDaGF0XCIpIH08L0hlYWRpbmc+XG4gICAgICAgIDwvZGl2PjtcbiAgICB9O1xuXG4gICAgcHVibGljIHJlbmRlcigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGNvbnN0IGhpZ2hsaWdodGVkRXZlbnRJZCA9IHRoaXMuc3RhdGUuaXNJbml0aWFsRXZlbnRIaWdobGlnaHRlZFxuICAgICAgICAgICAgPyB0aGlzLnN0YXRlLmluaXRpYWxFdmVudElkXG4gICAgICAgICAgICA6IG51bGw7XG5cbiAgICAgICAgbGV0IGp1bXBUb0JvdHRvbTtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmF0RW5kT2ZMaXZlVGltZWxpbmUpIHtcbiAgICAgICAgICAgIGp1bXBUb0JvdHRvbSA9ICg8SnVtcFRvQm90dG9tQnV0dG9uXG4gICAgICAgICAgICAgICAgaGlnaGxpZ2h0PXt0aGlzLnByb3BzLnJvb20uZ2V0VW5yZWFkTm90aWZpY2F0aW9uQ291bnQoTm90aWZpY2F0aW9uQ291bnRUeXBlLkhpZ2hsaWdodCkgPiAwfVxuICAgICAgICAgICAgICAgIG9uU2Nyb2xsVG9Cb3R0b21DbGljaz17dGhpcy5qdW1wVG9MaXZlVGltZWxpbmV9XG4gICAgICAgICAgICAvPik7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpc1VwbG9hZGluZyA9IENvbnRlbnRNZXNzYWdlcy5zaGFyZWRJbnN0YW5jZSgpLmdldEN1cnJlbnRVcGxvYWRzKHRoaXMucHJvcHMuY29tcG9zZXJSZWxhdGlvbikubGVuZ3RoID4gMDtcblxuICAgICAgICBjb25zdCBteU1lbWJlcnNoaXAgPSB0aGlzLnByb3BzLnJvb20uZ2V0TXlNZW1iZXJzaGlwKCk7XG4gICAgICAgIGNvbnN0IHNob3dDb21wb3NlciA9IG15TWVtYmVyc2hpcCA9PT0gXCJqb2luXCI7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxSb29tQ29udGV4dC5Qcm92aWRlciB2YWx1ZT17e1xuICAgICAgICAgICAgICAgIC4uLnRoaXMuY29udGV4dCxcbiAgICAgICAgICAgICAgICB0aW1lbGluZVJlbmRlcmluZ1R5cGU6IHRoaXMucHJvcHMudGltZWxpbmVSZW5kZXJpbmdUeXBlID8/IHRoaXMuY29udGV4dC50aW1lbGluZVJlbmRlcmluZ1R5cGUsXG4gICAgICAgICAgICAgICAgbGl2ZVRpbWVsaW5lOiB0aGlzLnByb3BzLnRpbWVsaW5lU2V0LmdldExpdmVUaW1lbGluZSgpLFxuICAgICAgICAgICAgICAgIG5hcnJvdzogdGhpcy5zdGF0ZS5uYXJyb3csXG4gICAgICAgICAgICB9fT5cbiAgICAgICAgICAgICAgICA8QmFzZUNhcmRcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXt0aGlzLnByb3BzLmNsYXNzTmFtZXN9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U9e3RoaXMucHJvcHMub25DbG9zZX1cbiAgICAgICAgICAgICAgICAgICAgd2l0aG91dFNjcm9sbENvbnRhaW5lcj17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyPXt0aGlzLnJlbmRlclRpbWVsaW5lQ2FyZEhlYWRlcigpfVxuICAgICAgICAgICAgICAgICAgICByZWY9e3RoaXMuY2FyZH1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIDxNZWFzdXJlZFxuICAgICAgICAgICAgICAgICAgICAgICAgc2Vuc29yPXt0aGlzLmNhcmQuY3VycmVudH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uTWVhc3VyZW1lbnQ9e3RoaXMub25NZWFzdXJlbWVudH1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9UaW1lbGluZUNhcmRfdGltZWxpbmVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsganVtcFRvQm90dG9tIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDxUaW1lbGluZVBhbmVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmPXt0aGlzLnRpbWVsaW5lUGFuZWx9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1JlYWRSZWNlaXB0cz17dGhpcy5zdGF0ZS5zaG93UmVhZFJlY2VpcHRzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hbmFnZVJlYWRSZWNlaXB0cz17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYW5hZ2VSZWFkTWFya2Vycz17ZmFsc2V9IC8vIE5vIFJNIHN1cHBvcnQgaW4gdGhlIFRpbWVsaW5lQ2FyZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRSZWFkUmVjZWlwdE9uTG9hZD17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lbGluZVNldD17dGhpcy5wcm9wcy50aW1lbGluZVNldH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93VXJsUHJldmlldz17dGhpcy5jb250ZXh0LnNob3dVcmxQcmV2aWV3fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSByaWdodCBwYW5lbCB0aW1lbGluZSAoYW5kIHRoZXJlZm9yZSB0aHJlYWRzKSBkb24ndCBzdXBwb3J0IElSQyBsYXlvdXQgYXQgdGhpcyB0aW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0PXt0aGlzLnN0YXRlLmxheW91dCA9PT0gTGF5b3V0LkJ1YmJsZSA/IExheW91dC5CdWJibGUgOiBMYXlvdXQuR3JvdXB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlkZVRocmVhZGVkTWVzc2FnZXM9e2ZhbHNlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZGRlbj17ZmFsc2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1JlYWN0aW9ucz17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9Sb29tVmlld19tZXNzYWdlUGFuZWxcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcm1hbGlua0NyZWF0b3I9e3RoaXMucHJvcHMucGVybWFsaW5rQ3JlYXRvcn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW1iZXJzTG9hZGVkPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRTdGF0ZT17dGhpcy5zdGF0ZS5lZGl0U3RhdGV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRJZD17dGhpcy5zdGF0ZS5pbml0aWFsRXZlbnRJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNpemVOb3RpZmllcj17dGhpcy5wcm9wcy5yZXNpemVOb3RpZmllcn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRlZEV2ZW50SWQ9e2hpZ2hsaWdodGVkRXZlbnRJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblNjcm9sbD17dGhpcy5vblNjcm9sbH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgIHsgaXNVcGxvYWRpbmcgJiYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgPFVwbG9hZEJhciByb29tPXt0aGlzLnByb3BzLnJvb219IHJlbGF0aW9uPXt0aGlzLnByb3BzLmNvbXBvc2VyUmVsYXRpb259IC8+XG4gICAgICAgICAgICAgICAgICAgICkgfVxuXG4gICAgICAgICAgICAgICAgICAgIHsgc2hvd0NvbXBvc2VyICYmIChcbiAgICAgICAgICAgICAgICAgICAgICAgIDxNZXNzYWdlQ29tcG9zZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb29tPXt0aGlzLnByb3BzLnJvb219XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpb249e3RoaXMucHJvcHMuY29tcG9zZXJSZWxhdGlvbn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNpemVOb3RpZmllcj17dGhpcy5wcm9wcy5yZXNpemVOb3RpZmllcn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBseVRvRXZlbnQ9e3RoaXMuc3RhdGUucmVwbHlUb0V2ZW50fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcm1hbGlua0NyZWF0b3I9e3RoaXMucHJvcHMucGVybWFsaW5rQ3JlYXRvcn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlMmVTdGF0dXM9e3RoaXMucHJvcHMuZTJlU3RhdHVzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhY3Q9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICApIH1cbiAgICAgICAgICAgICAgICA8L0Jhc2VDYXJkPlxuICAgICAgICAgICAgPC9Sb29tQ29udGV4dC5Qcm92aWRlcj5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBZ0JBOztBQUlBOztBQUdBOztBQUVBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOzs7Ozs7QUE2QmUsTUFBTUEsWUFBTixTQUEyQkMsY0FBQSxDQUFNQyxTQUFqQyxDQUEyRDtFQVV0RUMsV0FBVyxDQUFDQyxLQUFELEVBQWdCO0lBQ3ZCLE1BQU1BLEtBQU47SUFE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
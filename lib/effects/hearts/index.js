"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.DefaultOptions = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _arrays = require("../../utils/arrays");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

const DefaultOptions = {
  maxCount: 120,
  gravity: 3.2,
  maxDrift: 5,
  maxRot: 5
};
exports.DefaultOptions = DefaultOptions;
const KEY_FRAME_INTERVAL = 15; // 15ms, roughly

class Hearts {
  constructor(options) {
    var _this = this;

    (0, _defineProperty2.default)(this, "options", void 0);
    (0, _defineProperty2.default)(this, "context", null);
    (0, _defineProperty2.default)(this, "particles", []);
    (0, _defineProperty2.default)(this, "lastAnimationTime", void 0);
    (0, _defineProperty2.default)(this, "colours", ['rgba(194,210,224,1)', 'rgba(235,214,219,1)', 'rgba(255,211,45,1)', 'rgba(255,190,174,1)', 'rgba(255,173,226,1)', 'rgba(242,114,171,1)', 'rgba(228,55,116,1)', 'rgba(255,86,130,1)', 'rgba(244,36,57,1)', 'rgba(247,126,157,1)', 'rgba(243,142,140,1)', 'rgba(252,116,183,1)']);
    (0, _defineProperty2.default)(this, "isRunning", void 0);
    (0, _defineProperty2.default)(this, "start", async function (canvas) {
      let timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3000;

      if (!canvas) {
        return;
      }

      _this.context = canvas.getContext('2d');
      _this.particles = [];
      const count = _this.options.maxCount;

      while (_this.particles.length < count) {
        _this.particles.push(_this.resetParticle({}, canvas.width, canvas.height));
      }

      _this.isRunning = true;
      requestAnimationFrame(_this.renderLoop);

      if (timeout) {
        window.setTimeout(_this.stop, timeout);
      }
    });
    (0, _defineProperty2.default)(this, "stop", async () => {
      this.isRunning = false;
    });
    (0, _defineProperty2.default)(this, "resetParticle", (particle, width, height) => {
      particle.color = this.colours[Math.random() * this.colours.length | 0];
      particle.x = Math.random() * width;
      particle.y = Math.random() * height + height;
      particle.xCol = particle.x;
      particle.scale = Math.random() * 0.07 + 0.04;
      particle.maximumDrift = Math.random() * this.options.maxDrift + 3.5;
      particle.maximumRot = Math.random() * this.options.maxRot + 3.5;
      particle.gravity = this.options.gravity + Math.random() * 4.8;
      return particle;
    });
    (0, _defineProperty2.default)(this, "renderLoop", () => {
      if (!this.context || !this.context.canvas) {
        return;
      }

      if (this.particles.length === 0) {
        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);
      } else {
        const timeDelta = Date.now() - this.lastAnimationTime;

        if (timeDelta >= KEY_FRAME_INTERVAL || !this.lastAnimationTime) {
          // Clear the screen first
          this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);
          this.lastAnimationTime = Date.now();
          this.animateAndRenderHearts();
        }

        requestAnimationFrame(this.renderLoop);
      }
    });
    this.options = _objectSpread(_objectSpread({}, DefaultOptions), options);
  }

  animateAndRenderHearts() {
    if (!this.context || !this.context.canvas) {
      return;
    }

    for (const particle of (0, _arrays.arrayFastClone)(this.particles)) {
      particle.y -= particle.gravity; // We treat the drift as a sine function to have a more fluid-like movement instead
      // of a pong-like movement off walls of the X column. This means that for
      // $x=A\sin(\frac{2\pi}{P}y)$ we use the `maximumDrift` as the amplitude (A) and a
      // large multiplier to create a very long waveform through P.

      const peakDistance = 75 * particle.maximumDrift;
      const PI2 = Math.PI * 2;
      particle.x = 6 * particle.maximumDrift * Math.sin(0.7 * (PI2 / peakDistance) * particle.y);
      particle.x += particle.xCol; // bring the particle to the right place

      const posScale = 1 / particle.scale;
      const x = particle.x * posScale;
      const y = particle.y * posScale;
      this.context.save();
      this.context.scale(particle.scale, particle.scale);
      this.context.beginPath(); // Rotate the heart about its centre.
      // The tilt of the heart is modelled similarly to its horizontal drift,
      // using a sine function.

      this.context.translate(248 + x, 215 + y);
      this.context.rotate(1 / 10 * particle.maximumRot * Math.sin(PI2 / peakDistance * particle.y * 0.8));
      this.context.translate(-248 - x, -215 - y); // Use bezier curves to draw a heart using pre-calculated coordinates.

      this.context.moveTo(140 + x, 20 + y);
      this.context.bezierCurveTo(73 + x, 20 + y, 20 + x, 74 + y, 20 + x, 140 + y);
      this.context.bezierCurveTo(20 + x, 275 + y, 156 + x, 310 + y, 248 + x, 443 + y);
      this.context.bezierCurveTo(336 + x, 311 + y, 477 + x, 270 + y, 477 + x, 140 + y);
      this.context.bezierCurveTo(477 + x, 74 + y, 423 + x, 20 + y, 357 + x, 20 + y);
      this.context.bezierCurveTo(309 + x, 20 + y, 267 + x, 48 + y, 248 + x, 89 + y);
      this.context.bezierCurveTo(229 + x, 48 + y, 188 + x, 20 + y, 140 + x, 20 + y);
      this.context.closePath();
      this.context.fillStyle = particle.color;
      this.context.fill();
      this.context.restore(); // Remove any dead hearts after a 100px wide margin.

      if (particle.y < -100) {
        const idx = this.particles.indexOf(particle);
        this.particles.splice(idx, 1);
      }
    }
  }

}

exports.default = Hearts;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZWZhdWx0T3B0aW9ucyIsIm1heENvdW50IiwiZ3Jhdml0eSIsIm1heERyaWZ0IiwibWF4Um90IiwiS0VZX0ZSQU1FX0lOVEVSVkFMIiwiSGVhcnRzIiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwiY2FudmFzIiwidGltZW91dCIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwicGFydGljbGVzIiwiY291bnQiLCJsZW5ndGgiLCJwdXNoIiwicmVzZXRQYXJ0aWNsZSIsIndpZHRoIiwiaGVpZ2h0IiwiaXNSdW5uaW5nIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwicmVuZGVyTG9vcCIsIndpbmRvdyIsInNldFRpbWVvdXQiLCJzdG9wIiwicGFydGljbGUiLCJjb2xvciIsImNvbG91cnMiLCJNYXRoIiwicmFuZG9tIiwieCIsInkiLCJ4Q29sIiwic2NhbGUiLCJtYXhpbXVtRHJpZnQiLCJtYXhpbXVtUm90IiwiY2xlYXJSZWN0IiwidGltZURlbHRhIiwiRGF0ZSIsIm5vdyIsImxhc3RBbmltYXRpb25UaW1lIiwiYW5pbWF0ZUFuZFJlbmRlckhlYXJ0cyIsImFycmF5RmFzdENsb25lIiwicGVha0Rpc3RhbmNlIiwiUEkyIiwiUEkiLCJzaW4iLCJwb3NTY2FsZSIsInNhdmUiLCJiZWdpblBhdGgiLCJ0cmFuc2xhdGUiLCJyb3RhdGUiLCJtb3ZlVG8iLCJiZXppZXJDdXJ2ZVRvIiwiY2xvc2VQYXRoIiwiZmlsbFN0eWxlIiwiZmlsbCIsInJlc3RvcmUiLCJpZHgiLCJpbmRleE9mIiwic3BsaWNlIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2VmZmVjdHMvaGVhcnRzL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG4gQ29weXJpZ2h0IDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cbiBDb3B5cmlnaHQgMjAyMiBBcnNlbnkgVXNrb3ZcblxuIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cbiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IElDYW52YXNFZmZlY3QgZnJvbSAnLi4vSUNhbnZhc0VmZmVjdCc7XG5pbXBvcnQgeyBhcnJheUZhc3RDbG9uZSB9IGZyb20gXCIuLi8uLi91dGlscy9hcnJheXNcIjtcblxuZXhwb3J0IHR5cGUgSGVhcnRPcHRpb25zID0ge1xuICAgIC8qKlxuICAgICAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiBoZWFydHMgdG8gcmVuZGVyIGF0IGEgZ2l2ZW4gdGltZVxuICAgICAqL1xuICAgIG1heENvdW50OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogVGhlIGFtb3VudCBvZiBncmF2aXR5IHRvIGFwcGx5IHRvIHRoZSBoZWFydHNcbiAgICAgKi9cbiAgICBncmF2aXR5OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogVGhlIG1heGltdW0gYW1vdW50IG9mIGRyaWZ0IChob3Jpem9udGFsIHN3YXkpIHRvIGFwcGx5IHRvIHRoZSBoZWFydHMuIEVhY2ggaGVhcnQgdmFyaWVzLlxuICAgICAqL1xuICAgIG1heERyaWZ0OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogVGhlIG1heGltdW0gYW1vdW50IG9mIHRpbHQgdG8gYXBwbHkgdG8gdGhlIGhlYXJ0LiBFYWNoIGhlYXJ0IHZhcmllcy5cbiAgICAgKi9cbiAgICBtYXhSb3Q6IG51bWJlcjtcbn07XG5cbnR5cGUgSGVhcnQgPSB7XG4gICAgeDogbnVtYmVyO1xuICAgIHk6IG51bWJlcjtcbiAgICB4Q29sOiBudW1iZXI7XG4gICAgc2NhbGU6IG51bWJlcjtcbiAgICBtYXhpbXVtRHJpZnQ6IG51bWJlcjtcbiAgICBtYXhpbXVtUm90OiBudW1iZXI7XG4gICAgZ3Jhdml0eTogbnVtYmVyO1xuICAgIGNvbG9yOiBzdHJpbmc7XG59O1xuXG5leHBvcnQgY29uc3QgRGVmYXVsdE9wdGlvbnM6IEhlYXJ0T3B0aW9ucyA9IHtcbiAgICBtYXhDb3VudDogMTIwLFxuICAgIGdyYXZpdHk6IDMuMixcbiAgICBtYXhEcmlmdDogNSxcbiAgICBtYXhSb3Q6IDUsXG59O1xuXG5jb25zdCBLRVlfRlJBTUVfSU5URVJWQUwgPSAxNTsgLy8gMTVtcywgcm91Z2hseVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBIZWFydHMgaW1wbGVtZW50cyBJQ2FudmFzRWZmZWN0IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IG9wdGlvbnM6IEhlYXJ0T3B0aW9ucztcblxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IHsgW2tleTogc3RyaW5nXTogYW55IH0pIHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0geyAuLi5EZWZhdWx0T3B0aW9ucywgLi4ub3B0aW9ucyB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIHwgbnVsbCA9IG51bGw7XG4gICAgcHJpdmF0ZSBwYXJ0aWNsZXM6IEFycmF5PEhlYXJ0PiA9IFtdO1xuICAgIHByaXZhdGUgbGFzdEFuaW1hdGlvblRpbWU6IG51bWJlcjtcblxuICAgIHByaXZhdGUgY29sb3VycyA9IFtcbiAgICAgICAgJ3JnYmEoMTk0LDIxMCwyMjQsMSknLFxuICAgICAgICAncmdiYSgyMzUsMjE0LDIxOSwxKScsXG4gICAgICAgICdyZ2JhKDI1NSwyMTEsNDUsMSknLFxuICAgICAgICAncmdiYSgyNTUsMTkwLDE3NCwxKScsXG4gICAgICAgICdyZ2JhKDI1NSwxNzMsMjI2LDEpJyxcbiAgICAgICAgJ3JnYmEoMjQyLDExNCwxNzEsMSknLFxuICAgICAgICAncmdiYSgyMjgsNTUsMTE2LDEpJyxcbiAgICAgICAgJ3JnYmEoMjU1LDg2LDEzMCwxKScsXG4gICAgICAgICdyZ2JhKDI0NCwzNiw1NywxKScsXG4gICAgICAgICdyZ2JhKDI0NywxMjYsMTU3LDEpJyxcbiAgICAgICAgJ3JnYmEoMjQzLDE0MiwxNDAsMSknLFxuICAgICAgICAncmdiYSgyNTIsMTE2LDE4MywxKSddO1xuXG4gICAgcHVibGljIGlzUnVubmluZzogYm9vbGVhbjtcblxuICAgIHB1YmxpYyBzdGFydCA9IGFzeW5jIChjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LCB0aW1lb3V0ID0gMzAwMCkgPT4ge1xuICAgICAgICBpZiAoIWNhbnZhcykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICB0aGlzLnBhcnRpY2xlcyA9IFtdO1xuICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMub3B0aW9ucy5tYXhDb3VudDtcbiAgICAgICAgd2hpbGUgKHRoaXMucGFydGljbGVzLmxlbmd0aCA8IGNvdW50KSB7XG4gICAgICAgICAgICB0aGlzLnBhcnRpY2xlcy5wdXNoKHRoaXMucmVzZXRQYXJ0aWNsZSh7fSBhcyBIZWFydCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pc1J1bm5pbmcgPSB0cnVlO1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5yZW5kZXJMb29wKTtcbiAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KHRoaXMuc3RvcCwgdGltZW91dCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHVibGljIHN0b3AgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRoaXMuaXNSdW5uaW5nID0gZmFsc2U7XG4gICAgfTtcblxuICAgIHByaXZhdGUgcmVzZXRQYXJ0aWNsZSA9IChwYXJ0aWNsZTogSGVhcnQsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKTogSGVhcnQgPT4ge1xuICAgICAgICBwYXJ0aWNsZS5jb2xvciA9IHRoaXMuY29sb3Vyc1soTWF0aC5yYW5kb20oKSAqIHRoaXMuY29sb3Vycy5sZW5ndGgpIHwgMF07XG4gICAgICAgIHBhcnRpY2xlLnggPSBNYXRoLnJhbmRvbSgpICogd2lkdGg7XG4gICAgICAgIHBhcnRpY2xlLnkgPSBNYXRoLnJhbmRvbSgpICogaGVpZ2h0ICsgaGVpZ2h0O1xuICAgICAgICBwYXJ0aWNsZS54Q29sID0gcGFydGljbGUueDtcbiAgICAgICAgcGFydGljbGUuc2NhbGUgPSAoTWF0aC5yYW5kb20oKSAqIDAuMDcpICsgMC4wNDtcbiAgICAgICAgcGFydGljbGUubWF4aW11bURyaWZ0ID0gKE1hdGgucmFuZG9tKCkgKiB0aGlzLm9wdGlvbnMubWF4RHJpZnQpICsgMy41O1xuICAgICAgICBwYXJ0aWNsZS5tYXhpbXVtUm90ID0gKE1hdGgucmFuZG9tKCkgKiB0aGlzLm9wdGlvbnMubWF4Um90KSArIDMuNTtcbiAgICAgICAgcGFydGljbGUuZ3Jhdml0eSA9IHRoaXMub3B0aW9ucy5ncmF2aXR5ICsgKE1hdGgucmFuZG9tKCkgKiA0LjgpO1xuICAgICAgICByZXR1cm4gcGFydGljbGU7XG4gICAgfTtcblxuICAgIHByaXZhdGUgcmVuZGVyTG9vcCA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLmNvbnRleHQgfHwgIXRoaXMuY29udGV4dC5jYW52YXMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wYXJ0aWNsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY29udGV4dC5jYW52YXMud2lkdGgsIHRoaXMuY29udGV4dC5jYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHRpbWVEZWx0YSA9IERhdGUubm93KCkgLSB0aGlzLmxhc3RBbmltYXRpb25UaW1lO1xuICAgICAgICAgICAgaWYgKHRpbWVEZWx0YSA+PSBLRVlfRlJBTUVfSU5URVJWQUwgfHwgIXRoaXMubGFzdEFuaW1hdGlvblRpbWUpIHtcbiAgICAgICAgICAgICAgICAvLyBDbGVhciB0aGUgc2NyZWVuIGZpcnN0XG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNvbnRleHQuY2FudmFzLndpZHRoLCB0aGlzLmNvbnRleHQuY2FudmFzLmhlaWdodCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RBbmltYXRpb25UaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGVBbmRSZW5kZXJIZWFydHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnJlbmRlckxvb3ApO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgYW5pbWF0ZUFuZFJlbmRlckhlYXJ0cygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNvbnRleHQgfHwgIXRoaXMuY29udGV4dC5jYW52YXMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IHBhcnRpY2xlIG9mIGFycmF5RmFzdENsb25lKHRoaXMucGFydGljbGVzKSkge1xuICAgICAgICAgICAgcGFydGljbGUueSAtPSBwYXJ0aWNsZS5ncmF2aXR5O1xuXG4gICAgICAgICAgICAvLyBXZSB0cmVhdCB0aGUgZHJpZnQgYXMgYSBzaW5lIGZ1bmN0aW9uIHRvIGhhdmUgYSBtb3JlIGZsdWlkLWxpa2UgbW92ZW1lbnQgaW5zdGVhZFxuICAgICAgICAgICAgLy8gb2YgYSBwb25nLWxpa2UgbW92ZW1lbnQgb2ZmIHdhbGxzIG9mIHRoZSBYIGNvbHVtbi4gVGhpcyBtZWFucyB0aGF0IGZvclxuICAgICAgICAgICAgLy8gJHg9QVxcc2luKFxcZnJhY3syXFxwaX17UH15KSQgd2UgdXNlIHRoZSBgbWF4aW11bURyaWZ0YCBhcyB0aGUgYW1wbGl0dWRlIChBKSBhbmQgYVxuICAgICAgICAgICAgLy8gbGFyZ2UgbXVsdGlwbGllciB0byBjcmVhdGUgYSB2ZXJ5IGxvbmcgd2F2ZWZvcm0gdGhyb3VnaCBQLlxuICAgICAgICAgICAgY29uc3QgcGVha0Rpc3RhbmNlID0gNzUgKiBwYXJ0aWNsZS5tYXhpbXVtRHJpZnQ7XG4gICAgICAgICAgICBjb25zdCBQSTIgPSBNYXRoLlBJICogMjtcbiAgICAgICAgICAgIHBhcnRpY2xlLnggPSA2ICogcGFydGljbGUubWF4aW11bURyaWZ0ICogTWF0aC5zaW4oMC43ICogKFBJMiAvIHBlYWtEaXN0YW5jZSkgKiBwYXJ0aWNsZS55KTtcbiAgICAgICAgICAgIHBhcnRpY2xlLnggKz0gcGFydGljbGUueENvbDsgLy8gYnJpbmcgdGhlIHBhcnRpY2xlIHRvIHRoZSByaWdodCBwbGFjZVxuXG4gICAgICAgICAgICBjb25zdCBwb3NTY2FsZSA9IDEgLyBwYXJ0aWNsZS5zY2FsZTtcbiAgICAgICAgICAgIGNvbnN0IHggPSBwYXJ0aWNsZS54ICogcG9zU2NhbGU7XG4gICAgICAgICAgICBjb25zdCB5ID0gcGFydGljbGUueSAqIHBvc1NjYWxlO1xuXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQuc2F2ZSgpO1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0LnNjYWxlKHBhcnRpY2xlLnNjYWxlLCBwYXJ0aWNsZS5zY2FsZSk7XG4gICAgICAgICAgICB0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XG5cbiAgICAgICAgICAgIC8vIFJvdGF0ZSB0aGUgaGVhcnQgYWJvdXQgaXRzIGNlbnRyZS5cbiAgICAgICAgICAgIC8vIFRoZSB0aWx0IG9mIHRoZSBoZWFydCBpcyBtb2RlbGxlZCBzaW1pbGFybHkgdG8gaXRzIGhvcml6b250YWwgZHJpZnQsXG4gICAgICAgICAgICAvLyB1c2luZyBhIHNpbmUgZnVuY3Rpb24uXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQudHJhbnNsYXRlKDI0OCArIHgsIDIxNSArIHkpO1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0LnJvdGF0ZSgoMSAvIDEwKSAqIHBhcnRpY2xlLm1heGltdW1Sb3QgKiBNYXRoLnNpbigoUEkyIC8gcGVha0Rpc3RhbmNlKSAqIHBhcnRpY2xlLnkgKiAwLjgpKTtcbiAgICAgICAgICAgIHRoaXMuY29udGV4dC50cmFuc2xhdGUoLTI0OCAtIHgsIC0yMTUgLSB5KTtcblxuICAgICAgICAgICAgLy8gVXNlIGJlemllciBjdXJ2ZXMgdG8gZHJhdyBhIGhlYXJ0IHVzaW5nIHByZS1jYWxjdWxhdGVkIGNvb3JkaW5hdGVzLlxuICAgICAgICAgICAgdGhpcy5jb250ZXh0Lm1vdmVUbygxNDAgKyB4LCAyMCArIHkpO1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0LmJlemllckN1cnZlVG8oNzMgKyB4LCAyMCArIHksIDIwICsgeCwgNzQgKyB5LCAyMCArIHgsIDE0MCArIHkpO1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0LmJlemllckN1cnZlVG8oMjAgKyB4LCAyNzUgKyB5LCAxNTYgKyB4LCAzMTAgKyB5LCAyNDggKyB4LCA0NDMgKyB5KTtcbiAgICAgICAgICAgIHRoaXMuY29udGV4dC5iZXppZXJDdXJ2ZVRvKDMzNiArIHgsIDMxMSArIHksIDQ3NyArIHgsIDI3MCArIHksIDQ3NyArIHgsIDE0MCArIHkpO1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0LmJlemllckN1cnZlVG8oNDc3ICsgeCwgNzQgKyB5LCA0MjMgKyB4LCAyMCArIHksIDM1NyArIHgsIDIwICsgeSk7XG4gICAgICAgICAgICB0aGlzLmNvbnRleHQuYmV6aWVyQ3VydmVUbygzMDkgKyB4LCAyMCArIHksIDI2NyArIHgsIDQ4ICsgeSwgMjQ4ICsgeCwgODkgKyB5KTtcbiAgICAgICAgICAgIHRoaXMuY29udGV4dC5iZXppZXJDdXJ2ZVRvKDIyOSArIHgsIDQ4ICsgeSwgMTg4ICsgeCwgMjAgKyB5LCAxNDAgKyB4LCAyMCArIHkpO1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0LmNsb3NlUGF0aCgpO1xuXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQuZmlsbFN0eWxlID0gcGFydGljbGUuY29sb3I7XG4gICAgICAgICAgICB0aGlzLmNvbnRleHQuZmlsbCgpO1xuXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQucmVzdG9yZSgpO1xuXG4gICAgICAgICAgICAvLyBSZW1vdmUgYW55IGRlYWQgaGVhcnRzIGFmdGVyIGEgMTAwcHggd2lkZSBtYXJnaW4uXG4gICAgICAgICAgICBpZiAocGFydGljbGUueSA8IC0xMDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpZHggPSB0aGlzLnBhcnRpY2xlcy5pbmRleE9mKHBhcnRpY2xlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2xlcy5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpQkE7Ozs7OztBQWdDTyxNQUFNQSxjQUE0QixHQUFHO0VBQ3hDQyxRQUFRLEVBQUUsR0FEOEI7RUFFeENDLE9BQU8sRUFBRSxHQUYrQjtFQUd4Q0MsUUFBUSxFQUFFLENBSDhCO0VBSXhDQyxNQUFNLEVBQUU7QUFKZ0MsQ0FBckM7O0FBT1AsTUFBTUMsa0JBQWtC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
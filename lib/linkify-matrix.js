"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.options = exports.linkify = exports._linkifyString = exports._linkifyElement = exports.Type = exports.ELEMENT_URL_PATTERN = void 0;

var linkifyjs = _interopRequireWildcard(require("linkifyjs"));

var _linkifyElement2 = _interopRequireDefault(require("linkify-element"));

var _linkifyString2 = _interopRequireDefault(require("linkify-string"));

var _roomMember = require("matrix-js-sdk/src/models/room-member");

var _Permalinks = require("./utils/permalinks/Permalinks");

var _dispatcher = _interopRequireDefault(require("./dispatcher/dispatcher"));

var _actions = require("./dispatcher/actions");

var _group_helpers = require("./group_helpers");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2015, 2016 OpenMarket Ltd
Copyright 2019 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
let Type; // Linkify stuff doesn't type scanner/parser/utils properly :/

exports.Type = Type;

(function (Type) {
  Type["URL"] = "url";
  Type["UserId"] = "userid";
  Type["RoomAlias"] = "roomalias";
  Type["GroupId"] = "groupid";
})(Type || (exports.Type = Type = {}));

function matrixOpaqueIdLinkifyParser(_ref) {
  let {
    scanner,
    parser,
    utils,
    token,
    name
  } = _ref;
  const {
    DOT,
    // IPV4 necessity
    NUM,
    TLD,
    COLON,
    SYM,
    HYPHEN,
    UNDERSCORE,
    // because 'localhost' is tokenised to the localhost token,
    // usernames @localhost:foo.com are otherwise not matched!
    LOCALHOST,
    domain
  } = scanner.tokens;
  const S_START = parser.start;
  const matrixSymbol = utils.createTokenClass(name, {
    isLink: true
  });
  const localpartTokens = [domain, TLD, LOCALHOST, SYM, UNDERSCORE, HYPHEN];
  const domainpartTokens = [domain, TLD, LOCALHOST, HYPHEN];
  const INITIAL_STATE = S_START.tt(token);
  const LOCALPART_STATE = INITIAL_STATE.tt(domain);

  for (const token of localpartTokens) {
    INITIAL_STATE.tt(token, LOCALPART_STATE);
    LOCALPART_STATE.tt(token, LOCALPART_STATE);
  }

  const LOCALPART_STATE_DOT = LOCALPART_STATE.tt(DOT);

  for (const token of localpartTokens) {
    LOCALPART_STATE_DOT.tt(token, LOCALPART_STATE);
  }

  const DOMAINPART_STATE_DOT = LOCALPART_STATE.tt(COLON);
  const DOMAINPART_STATE = DOMAINPART_STATE_DOT.tt(domain);
  DOMAINPART_STATE.tt(DOT, DOMAINPART_STATE_DOT);

  for (const token of domainpartTokens) {
    DOMAINPART_STATE.tt(token, DOMAINPART_STATE); // we are done if we have a domain

    DOMAINPART_STATE.tt(token, matrixSymbol);
  } // accept repeated TLDs (e.g .org.uk) but do not accept double dots: ..


  for (const token of domainpartTokens) {
    DOMAINPART_STATE_DOT.tt(token, DOMAINPART_STATE);
  }

  const PORT_STATE = DOMAINPART_STATE.tt(COLON);
  PORT_STATE.tt(NUM, matrixSymbol);
}

function onUserClick(event, userId) {
  event.preventDefault();
  const member = new _roomMember.RoomMember(null, userId);

  if (!member) {
    return;
  }

  _dispatcher.default.dispatch({
    action: _actions.Action.ViewUser,
    member: member
  });
}

function onGroupClick(event, groupId) {
  event.preventDefault();
  (0, _group_helpers.showGroupReplacedWithSpacesDialog)(groupId);
}

function onAliasClick(event, roomAlias) {
  event.preventDefault();

  _dispatcher.default.dispatch({
    action: _actions.Action.ViewRoom,
    room_alias: roomAlias,
    metricsTrigger: "Timeline",
    metricsViaKeyboard: false
  });
}

const escapeRegExp = function (s) {
  return s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
}; // Recognise URLs from both our local and official Element deployments.
// Anyone else really should be using matrix.to. vector:// allowed to support Element Desktop relative links.


const ELEMENT_URL_PATTERN = "^(?:vector://|https?://)?(?:" + escapeRegExp(window.location.host + window.location.pathname) + "|" + "(?:www\\.)?(?:riot|vector)\\.im/(?:app|beta|staging|develop)/|" + "(?:app|beta|staging|develop)\\.element\\.io/" + ")(#.*)";
exports.ELEMENT_URL_PATTERN = ELEMENT_URL_PATTERN;
const options = {
  events: function (href, type) {
    switch (type) {
      case Type.URL:
        {
          // intercept local permalinks to users and show them like userids (in userinfo of current room)
          try {
            const permalink = (0, _Permalinks.parsePermalink)(href);

            if (permalink?.userId) {
              return {
                // @ts-ignore see https://linkify.js.org/docs/options.html
                click: function (e) {
                  onUserClick(e, permalink.userId);
                }
              };
            } else {
              // for events, rooms etc. (anything other than users)
              const localHref = (0, _Permalinks.tryTransformPermalinkToLocalHref)(href);

              if (localHref !== href) {
                // it could be converted to a localHref -> therefore handle locally
                return {
                  // @ts-ignore see https://linkify.js.org/docs/options.html
                  click: function (e) {
                    e.preventDefault();
                    window.location.hash = localHref;
                  }
                };
              }
            }
          } catch (e) {// OK fine, it's not actually a permalink
          }

          break;
        }

      case Type.UserId:
        return {
          // @ts-ignore see https://linkify.js.org/docs/options.html
          click: function (e) {
            const userId = (0, _Permalinks.parsePermalink)(href).userId;
            onUserClick(e, userId);
          }
        };

      case Type.RoomAlias:
        return {
          // @ts-ignore see https://linkify.js.org/docs/options.html
          click: function (e) {
            const alias = (0, _Permalinks.parsePermalink)(href).roomIdOrAlias;
            onAliasClick(e, alias);
          }
        };

      case Type.GroupId:
        return {
          // @ts-ignore see https://linkify.js.org/docs/options.html
          click: function (e) {
            const groupId = (0, _Permalinks.parsePermalink)(href).groupId;
            onGroupClick(e, groupId);
          }
        };
    }
  },
  formatHref: function (href, type) {
    switch (type) {
      case Type.RoomAlias:
      case Type.UserId:
      case Type.GroupId:
      default:
        {
          return (0, _Permalinks.tryTransformEntityToPermalink)(href);
        }
    }
  },
  attributes: {
    rel: 'noreferrer noopener'
  },
  ignoreTags: ['pre', 'code'],
  className: 'linkified',
  target: function (href, type) {
    if (type === Type.URL) {
      try {
        const transformed = (0, _Permalinks.tryTransformPermalinkToLocalHref)(href);

        if (transformed !== href || // if it could be converted to handle locally for matrix symbols e.g. @user:server.tdl and matrix.to
        decodeURIComponent(href).match(ELEMENT_URL_PATTERN) // for https links to Element domains
        ) {
          return null;
        } else {
          return '_blank';
        }
      } catch (e) {// malformed URI
      }
    }

    return null;
  }
}; // Run the plugins

exports.options = options;
(0, linkifyjs.registerPlugin)(Type.RoomAlias, _ref2 => {
  let {
    scanner,
    parser,
    utils
  } = _ref2;
  const token = scanner.tokens.POUND;
  matrixOpaqueIdLinkifyParser({
    scanner,
    parser,
    utils,
    token,
    name: Type.RoomAlias
  });
});
(0, linkifyjs.registerPlugin)(Type.GroupId, _ref3 => {
  let {
    scanner,
    parser,
    utils
  } = _ref3;
  const token = scanner.tokens.PLUS;
  matrixOpaqueIdLinkifyParser({
    scanner,
    parser,
    utils,
    token,
    name: Type.GroupId
  });
});
(0, linkifyjs.registerPlugin)(Type.UserId, _ref4 => {
  let {
    scanner,
    parser,
    utils
  } = _ref4;
  const token = scanner.tokens.AT;
  matrixOpaqueIdLinkifyParser({
    scanner,
    parser,
    utils,
    token,
    name: Type.UserId
  });
});
(0, linkifyjs.registerCustomProtocol)("matrix", true);
const linkify = linkifyjs;
exports.linkify = linkify;
const _linkifyElement = _linkifyElement2.default;
exports._linkifyElement = _linkifyElement;
const _linkifyString = _linkifyString2.default;
exports._linkifyString = _linkifyString;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJUeXBlIiwibWF0cml4T3BhcXVlSWRMaW5raWZ5UGFyc2VyIiwic2Nhbm5lciIsInBhcnNlciIsInV0aWxzIiwidG9rZW4iLCJuYW1lIiwiRE9UIiwiTlVNIiwiVExEIiwiQ09MT04iLCJTWU0iLCJIWVBIRU4iLCJVTkRFUlNDT1JFIiwiTE9DQUxIT1NUIiwiZG9tYWluIiwidG9rZW5zIiwiU19TVEFSVCIsInN0YXJ0IiwibWF0cml4U3ltYm9sIiwiY3JlYXRlVG9rZW5DbGFzcyIsImlzTGluayIsImxvY2FscGFydFRva2VucyIsImRvbWFpbnBhcnRUb2tlbnMiLCJJTklUSUFMX1NUQVRFIiwidHQiLCJMT0NBTFBBUlRfU1RBVEUiLCJMT0NBTFBBUlRfU1RBVEVfRE9UIiwiRE9NQUlOUEFSVF9TVEFURV9ET1QiLCJET01BSU5QQVJUX1NUQVRFIiwiUE9SVF9TVEFURSIsIm9uVXNlckNsaWNrIiwiZXZlbnQiLCJ1c2VySWQiLCJwcmV2ZW50RGVmYXVsdCIsIm1lbWJlciIsIlJvb21NZW1iZXIiLCJkaXMiLCJkaXNwYXRjaCIsImFjdGlvbiIsIkFjdGlvbiIsIlZpZXdVc2VyIiwib25Hcm91cENsaWNrIiwiZ3JvdXBJZCIsInNob3dHcm91cFJlcGxhY2VkV2l0aFNwYWNlc0RpYWxvZyIsIm9uQWxpYXNDbGljayIsInJvb21BbGlhcyIsIlZpZXdSb29tIiwicm9vbV9hbGlhcyIsIm1ldHJpY3NUcmlnZ2VyIiwibWV0cmljc1ZpYUtleWJvYXJkIiwiZXNjYXBlUmVnRXhwIiwicyIsInJlcGxhY2UiLCJFTEVNRU5UX1VSTF9QQVRURVJOIiwid2luZG93IiwibG9jYXRpb24iLCJob3N0IiwicGF0aG5hbWUiLCJvcHRpb25zIiwiZXZlbnRzIiwiaHJlZiIsInR5cGUiLCJVUkwiLCJwZXJtYWxpbmsiLCJwYXJzZVBlcm1hbGluayIsImNsaWNrIiwiZSIsImxvY2FsSHJlZiIsInRyeVRyYW5zZm9ybVBlcm1hbGlua1RvTG9jYWxIcmVmIiwiaGFzaCIsIlVzZXJJZCIsIlJvb21BbGlhcyIsImFsaWFzIiwicm9vbUlkT3JBbGlhcyIsIkdyb3VwSWQiLCJmb3JtYXRIcmVmIiwidHJ5VHJhbnNmb3JtRW50aXR5VG9QZXJtYWxpbmsiLCJhdHRyaWJ1dGVzIiwicmVsIiwiaWdub3JlVGFncyIsImNsYXNzTmFtZSIsInRhcmdldCIsInRyYW5zZm9ybWVkIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwibWF0Y2giLCJyZWdpc3RlclBsdWdpbiIsIlBPVU5EIiwiUExVUyIsIkFUIiwicmVnaXN0ZXJDdXN0b21Qcm90b2NvbCIsImxpbmtpZnkiLCJsaW5raWZ5anMiLCJfbGlua2lmeUVsZW1lbnQiLCJsaW5raWZ5RWxlbWVudCIsIl9saW5raWZ5U3RyaW5nIiwibGlua2lmeVN0cmluZyJdLCJzb3VyY2VzIjpbIi4uL3NyYy9saW5raWZ5LW1hdHJpeC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTUsIDIwMTYgT3Blbk1hcmtldCBMdGRcbkNvcHlyaWdodCAyMDE5IFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0ICogYXMgbGlua2lmeWpzIGZyb20gJ2xpbmtpZnlqcyc7XG5pbXBvcnQgeyByZWdpc3RlckN1c3RvbVByb3RvY29sLCByZWdpc3RlclBsdWdpbiB9IGZyb20gJ2xpbmtpZnlqcyc7XG5pbXBvcnQgbGlua2lmeUVsZW1lbnQgZnJvbSAnbGlua2lmeS1lbGVtZW50JztcbmltcG9ydCBsaW5raWZ5U3RyaW5nIGZyb20gJ2xpbmtpZnktc3RyaW5nJztcbmltcG9ydCB7IFJvb21NZW1iZXIgfSBmcm9tICdtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvcm9vbS1tZW1iZXInO1xuXG5pbXBvcnQge1xuICAgIHBhcnNlUGVybWFsaW5rLFxuICAgIHRyeVRyYW5zZm9ybUVudGl0eVRvUGVybWFsaW5rLFxuICAgIHRyeVRyYW5zZm9ybVBlcm1hbGlua1RvTG9jYWxIcmVmLFxufSBmcm9tIFwiLi91dGlscy9wZXJtYWxpbmtzL1Blcm1hbGlua3NcIjtcbmltcG9ydCBkaXMgZnJvbSAnLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXInO1xuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSAnLi9kaXNwYXRjaGVyL2FjdGlvbnMnO1xuaW1wb3J0IHsgVmlld1VzZXJQYXlsb2FkIH0gZnJvbSAnLi9kaXNwYXRjaGVyL3BheWxvYWRzL1ZpZXdVc2VyUGF5bG9hZCc7XG5pbXBvcnQgeyBWaWV3Um9vbVBheWxvYWQgfSBmcm9tIFwiLi9kaXNwYXRjaGVyL3BheWxvYWRzL1ZpZXdSb29tUGF5bG9hZFwiO1xuaW1wb3J0IHsgc2hvd0dyb3VwUmVwbGFjZWRXaXRoU3BhY2VzRGlhbG9nIH0gZnJvbSBcIi4vZ3JvdXBfaGVscGVyc1wiO1xuXG5leHBvcnQgZW51bSBUeXBlIHtcbiAgICBVUkwgPSBcInVybFwiLFxuICAgIFVzZXJJZCA9IFwidXNlcmlkXCIsXG4gICAgUm9vbUFsaWFzID0gXCJyb29tYWxpYXNcIixcbiAgICBHcm91cElkID0gXCJncm91cGlkXCIsXG59XG5cbi8vIExpbmtpZnkgc3R1ZmYgZG9lc24ndCB0eXBlIHNjYW5uZXIvcGFyc2VyL3V0aWxzIHByb3Blcmx5IDovXG5mdW5jdGlvbiBtYXRyaXhPcGFxdWVJZExpbmtpZnlQYXJzZXIoe1xuICAgIHNjYW5uZXIsXG4gICAgcGFyc2VyLFxuICAgIHV0aWxzLFxuICAgIHRva2VuLFxuICAgIG5hbWUsXG59OiB7XG4gICAgc2Nhbm5lcjogYW55O1xuICAgIHBhcnNlcjogYW55O1xuICAgIHV0aWxzOiBhbnk7XG4gICAgdG9rZW46ICcjJyB8ICcrJyB8ICdAJztcbiAgICBuYW1lOiBUeXBlO1xufSkge1xuICAgIGNvbnN0IHtcbiAgICAgICAgRE9ULFxuICAgICAgICAvLyBJUFY0IG5lY2Vzc2l0eVxuICAgICAgICBOVU0sXG4gICAgICAgIFRMRCxcbiAgICAgICAgQ09MT04sXG4gICAgICAgIFNZTSxcbiAgICAgICAgSFlQSEVOLFxuICAgICAgICBVTkRFUlNDT1JFLFxuICAgICAgICAvLyBiZWNhdXNlICdsb2NhbGhvc3QnIGlzIHRva2VuaXNlZCB0byB0aGUgbG9jYWxob3N0IHRva2VuLFxuICAgICAgICAvLyB1c2VybmFtZXMgQGxvY2FsaG9zdDpmb28uY29tIGFyZSBvdGhlcndpc2Ugbm90IG1hdGNoZWQhXG4gICAgICAgIExPQ0FMSE9TVCxcbiAgICAgICAgZG9tYWluLFxuICAgIH0gPSBzY2FubmVyLnRva2VucztcblxuICAgIGNvbnN0IFNfU1RBUlQgPSBwYXJzZXIuc3RhcnQ7XG4gICAgY29uc3QgbWF0cml4U3ltYm9sID0gdXRpbHMuY3JlYXRlVG9rZW5DbGFzcyhuYW1lLCB7IGlzTGluazogdHJ1ZSB9KTtcblxuICAgIGNvbnN0IGxvY2FscGFydFRva2VucyA9IFtkb21haW4sIFRMRCwgTE9DQUxIT1NULCBTWU0sIFVOREVSU0NPUkUsIEhZUEhFTl07XG4gICAgY29uc3QgZG9tYWlucGFydFRva2VucyA9IFtkb21haW4sIFRMRCwgTE9DQUxIT1NULCBIWVBIRU5dO1xuXG4gICAgY29uc3QgSU5JVElBTF9TVEFURSA9IFNfU1RBUlQudHQodG9rZW4pO1xuXG4gICAgY29uc3QgTE9DQUxQQVJUX1NUQVRFID0gSU5JVElBTF9TVEFURS50dChkb21haW4pO1xuICAgIGZvciAoY29uc3QgdG9rZW4gb2YgbG9jYWxwYXJ0VG9rZW5zKSB7XG4gICAgICAgIElOSVRJQUxfU1RBVEUudHQodG9rZW4sIExPQ0FMUEFSVF9TVEFURSk7XG4gICAgICAgIExPQ0FMUEFSVF9TVEFURS50dCh0b2tlbiwgTE9DQUxQQVJUX1NUQVRFKTtcbiAgICB9XG4gICAgY29uc3QgTE9DQUxQQVJUX1NUQVRFX0RPVCA9IExPQ0FMUEFSVF9TVEFURS50dChET1QpO1xuICAgIGZvciAoY29uc3QgdG9rZW4gb2YgbG9jYWxwYXJ0VG9rZW5zKSB7XG4gICAgICAgIExPQ0FMUEFSVF9TVEFURV9ET1QudHQodG9rZW4sIExPQ0FMUEFSVF9TVEFURSk7XG4gICAgfVxuXG4gICAgY29uc3QgRE9NQUlOUEFSVF9TVEFURV9ET1QgPSBMT0NBTFBBUlRfU1RBVEUudHQoQ09MT04pO1xuICAgIGNvbnN0IERPTUFJTlBBUlRfU1RBVEUgPSBET01BSU5QQVJUX1NUQVRFX0RPVC50dChkb21haW4pO1xuICAgIERPTUFJTlBBUlRfU1RBVEUudHQoRE9ULCBET01BSU5QQVJUX1NUQVRFX0RPVCk7XG4gICAgZm9yIChjb25zdCB0b2tlbiBvZiBkb21haW5wYXJ0VG9rZW5zKSB7XG4gICAgICAgIERPTUFJTlBBUlRfU1RBVEUudHQodG9rZW4sIERPTUFJTlBBUlRfU1RBVEUpO1xuICAgICAgICAvLyB3ZSBhcmUgZG9uZSBpZiB3ZSBoYXZlIGEgZG9tYWluXG4gICAgICAgIERPTUFJTlBBUlRfU1RBVEUudHQodG9rZW4sIG1hdHJpeFN5bWJvbCk7XG4gICAgfVxuXG4gICAgLy8gYWNjZXB0IHJlcGVhdGVkIFRMRHMgKGUuZyAub3JnLnVrKSBidXQgZG8gbm90IGFjY2VwdCBkb3VibGUgZG90czogLi5cbiAgICBmb3IgKGNvbnN0IHRva2VuIG9mIGRvbWFpbnBhcnRUb2tlbnMpIHtcbiAgICAgICAgRE9NQUlOUEFSVF9TVEFURV9ET1QudHQodG9rZW4sIERPTUFJTlBBUlRfU1RBVEUpO1xuICAgIH1cblxuICAgIGNvbnN0IFBPUlRfU1RBVEUgPSBET01BSU5QQVJUX1NUQVRFLnR0KENPTE9OKTtcblxuICAgIFBPUlRfU1RBVEUudHQoTlVNLCBtYXRyaXhTeW1ib2wpO1xufVxuXG5mdW5jdGlvbiBvblVzZXJDbGljayhldmVudDogTW91c2VFdmVudCwgdXNlcklkOiBzdHJpbmcpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IG1lbWJlciA9IG5ldyBSb29tTWVtYmVyKG51bGwsIHVzZXJJZCk7XG4gICAgaWYgKCFtZW1iZXIpIHsgcmV0dXJuOyB9XG4gICAgZGlzLmRpc3BhdGNoPFZpZXdVc2VyUGF5bG9hZD4oe1xuICAgICAgICBhY3Rpb246IEFjdGlvbi5WaWV3VXNlcixcbiAgICAgICAgbWVtYmVyOiBtZW1iZXIsXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIG9uR3JvdXBDbGljayhldmVudDogTW91c2VFdmVudCwgZ3JvdXBJZDogc3RyaW5nKSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBzaG93R3JvdXBSZXBsYWNlZFdpdGhTcGFjZXNEaWFsb2coZ3JvdXBJZCk7XG59XG5cbmZ1bmN0aW9uIG9uQWxpYXNDbGljayhldmVudDogTW91c2VFdmVudCwgcm9vbUFsaWFzOiBzdHJpbmcpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGRpcy5kaXNwYXRjaDxWaWV3Um9vbVBheWxvYWQ+KHtcbiAgICAgICAgYWN0aW9uOiBBY3Rpb24uVmlld1Jvb20sXG4gICAgICAgIHJvb21fYWxpYXM6IHJvb21BbGlhcyxcbiAgICAgICAgbWV0cmljc1RyaWdnZXI6IFwiVGltZWxpbmVcIixcbiAgICAgICAgbWV0cmljc1ZpYUtleWJvYXJkOiBmYWxzZSxcbiAgICB9KTtcbn1cblxuY29uc3QgZXNjYXBlUmVnRXhwID0gZnVuY3Rpb24oczogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gcy5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgXCJcXFxcJCZcIik7XG59O1xuXG4vLyBSZWNvZ25pc2UgVVJMcyBmcm9tIGJvdGggb3VyIGxvY2FsIGFuZCBvZmZpY2lhbCBFbGVtZW50IGRlcGxveW1lbnRzLlxuLy8gQW55b25lIGVsc2UgcmVhbGx5IHNob3VsZCBiZSB1c2luZyBtYXRyaXgudG8uIHZlY3RvcjovLyBhbGxvd2VkIHRvIHN1cHBvcnQgRWxlbWVudCBEZXNrdG9wIHJlbGF0aXZlIGxpbmtzLlxuZXhwb3J0IGNvbnN0IEVMRU1FTlRfVVJMX1BBVFRFUk4gPVxuICAgIFwiXig/OnZlY3RvcjovL3xodHRwcz86Ly8pPyg/OlwiICtcbiAgICAgICAgZXNjYXBlUmVnRXhwKHdpbmRvdy5sb2NhdGlvbi5ob3N0ICsgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lKSArIFwifFwiICtcbiAgICAgICAgXCIoPzp3d3dcXFxcLik/KD86cmlvdHx2ZWN0b3IpXFxcXC5pbS8oPzphcHB8YmV0YXxzdGFnaW5nfGRldmVsb3ApL3xcIiArXG4gICAgICAgIFwiKD86YXBwfGJldGF8c3RhZ2luZ3xkZXZlbG9wKVxcXFwuZWxlbWVudFxcXFwuaW8vXCIgK1xuICAgIFwiKSgjLiopXCI7XG5cbmV4cG9ydCBjb25zdCBvcHRpb25zID0ge1xuICAgIGV2ZW50czogZnVuY3Rpb24oaHJlZjogc3RyaW5nLCB0eXBlOiBUeXBlIHwgc3RyaW5nKTogUGFydGlhbDxHbG9iYWxFdmVudEhhbmRsZXJzPiB7XG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgY2FzZSBUeXBlLlVSTDoge1xuICAgICAgICAgICAgICAgIC8vIGludGVyY2VwdCBsb2NhbCBwZXJtYWxpbmtzIHRvIHVzZXJzIGFuZCBzaG93IHRoZW0gbGlrZSB1c2VyaWRzIChpbiB1c2VyaW5mbyBvZiBjdXJyZW50IHJvb20pXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGVybWFsaW5rID0gcGFyc2VQZXJtYWxpbmsoaHJlZik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwZXJtYWxpbms/LnVzZXJJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlIHNlZSBodHRwczovL2xpbmtpZnkuanMub3JnL2RvY3Mvb3B0aW9ucy5odG1sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKGU6IE1vdXNlRXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Vc2VyQ2xpY2soZSwgcGVybWFsaW5rLnVzZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBmb3IgZXZlbnRzLCByb29tcyBldGMuIChhbnl0aGluZyBvdGhlciB0aGFuIHVzZXJzKVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9jYWxIcmVmID0gdHJ5VHJhbnNmb3JtUGVybWFsaW5rVG9Mb2NhbEhyZWYoaHJlZik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9jYWxIcmVmICE9PSBocmVmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXQgY291bGQgYmUgY29udmVydGVkIHRvIGEgbG9jYWxIcmVmIC0+IHRoZXJlZm9yZSBoYW5kbGUgbG9jYWxseVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZSBzZWUgaHR0cHM6Ly9saW5raWZ5LmpzLm9yZy9kb2NzL29wdGlvbnMuaHRtbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24oZTogTW91c2VFdmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBsb2NhbEhyZWY7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT0sgZmluZSwgaXQncyBub3QgYWN0dWFsbHkgYSBwZXJtYWxpbmtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFR5cGUuVXNlcklkOlxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUgc2VlIGh0dHBzOi8vbGlua2lmeS5qcy5vcmcvZG9jcy9vcHRpb25zLmh0bWxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKGU6IE1vdXNlRXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJJZCA9IHBhcnNlUGVybWFsaW5rKGhyZWYpLnVzZXJJZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uVXNlckNsaWNrKGUsIHVzZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhc2UgVHlwZS5Sb29tQWxpYXM6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZSBzZWUgaHR0cHM6Ly9saW5raWZ5LmpzLm9yZy9kb2NzL29wdGlvbnMuaHRtbFxuICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24oZTogTW91c2VFdmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxpYXMgPSBwYXJzZVBlcm1hbGluayhocmVmKS5yb29tSWRPckFsaWFzO1xuICAgICAgICAgICAgICAgICAgICAgICAgb25BbGlhc0NsaWNrKGUsIGFsaWFzKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjYXNlIFR5cGUuR3JvdXBJZDpcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlIHNlZSBodHRwczovL2xpbmtpZnkuanMub3JnL2RvY3Mvb3B0aW9ucy5odG1sXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbihlOiBNb3VzZUV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBncm91cElkID0gcGFyc2VQZXJtYWxpbmsoaHJlZikuZ3JvdXBJZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uR3JvdXBDbGljayhlLCBncm91cElkKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGZvcm1hdEhyZWY6IGZ1bmN0aW9uKGhyZWY6IHN0cmluZywgdHlwZTogVHlwZSB8IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgY2FzZSBUeXBlLlJvb21BbGlhczpcbiAgICAgICAgICAgIGNhc2UgVHlwZS5Vc2VySWQ6XG4gICAgICAgICAgICBjYXNlIFR5cGUuR3JvdXBJZDpcbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ5VHJhbnNmb3JtRW50aXR5VG9QZXJtYWxpbmsoaHJlZik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYXR0cmlidXRlczoge1xuICAgICAgICByZWw6ICdub3JlZmVycmVyIG5vb3BlbmVyJyxcbiAgICB9LFxuXG4gICAgaWdub3JlVGFnczogWydwcmUnLCAnY29kZSddLFxuXG4gICAgY2xhc3NOYW1lOiAnbGlua2lmaWVkJyxcblxuICAgIHRhcmdldDogZnVuY3Rpb24oaHJlZjogc3RyaW5nLCB0eXBlOiBUeXBlIHwgc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHR5cGUgPT09IFR5cGUuVVJMKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gdHJ5VHJhbnNmb3JtUGVybWFsaW5rVG9Mb2NhbEhyZWYoaHJlZik7XG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lZCAhPT0gaHJlZiB8fCAvLyBpZiBpdCBjb3VsZCBiZSBjb252ZXJ0ZWQgdG8gaGFuZGxlIGxvY2FsbHkgZm9yIG1hdHJpeCBzeW1ib2xzIGUuZy4gQHVzZXI6c2VydmVyLnRkbCBhbmQgbWF0cml4LnRvXG4gICAgICAgICAgICAgICAgICAgIGRlY29kZVVSSUNvbXBvbmVudChocmVmKS5tYXRjaChFTEVNRU5UX1VSTF9QQVRURVJOKSAvLyBmb3IgaHR0cHMgbGlua3MgdG8gRWxlbWVudCBkb21haW5zXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnX2JsYW5rJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgLy8gbWFsZm9ybWVkIFVSSVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG59O1xuXG4vLyBSdW4gdGhlIHBsdWdpbnNcbnJlZ2lzdGVyUGx1Z2luKFR5cGUuUm9vbUFsaWFzLCAoeyBzY2FubmVyLCBwYXJzZXIsIHV0aWxzIH0pID0+IHtcbiAgICBjb25zdCB0b2tlbiA9IHNjYW5uZXIudG9rZW5zLlBPVU5EIGFzICcjJztcbiAgICBtYXRyaXhPcGFxdWVJZExpbmtpZnlQYXJzZXIoe1xuICAgICAgICBzY2FubmVyLFxuICAgICAgICBwYXJzZXIsXG4gICAgICAgIHV0aWxzLFxuICAgICAgICB0b2tlbixcbiAgICAgICAgbmFtZTogVHlwZS5Sb29tQWxpYXMsXG4gICAgfSk7XG59KTtcblxucmVnaXN0ZXJQbHVnaW4oVHlwZS5Hcm91cElkLCAoeyBzY2FubmVyLCBwYXJzZXIsIHV0aWxzIH0pID0+IHtcbiAgICBjb25zdCB0b2tlbiA9IHNjYW5uZXIudG9rZW5zLlBMVVMgYXMgJysnO1xuICAgIG1hdHJpeE9wYXF1ZUlkTGlua2lmeVBhcnNlcih7XG4gICAgICAgIHNjYW5uZXIsXG4gICAgICAgIHBhcnNlcixcbiAgICAgICAgdXRpbHMsXG4gICAgICAgIHRva2VuLFxuICAgICAgICBuYW1lOiBUeXBlLkdyb3VwSWQsXG4gICAgfSk7XG59KTtcblxucmVnaXN0ZXJQbHVnaW4oVHlwZS5Vc2VySWQsICh7IHNjYW5uZXIsIHBhcnNlciwgdXRpbHMgfSkgPT4ge1xuICAgIGNvbnN0IHRva2VuID0gc2Nhbm5lci50b2tlbnMuQVQgYXMgJ0AnO1xuICAgIG1hdHJpeE9wYXF1ZUlkTGlua2lmeVBhcnNlcih7XG4gICAgICAgIHNjYW5uZXIsXG4gICAgICAgIHBhcnNlcixcbiAgICAgICAgdXRpbHMsXG4gICAgICAgIHRva2VuLFxuICAgICAgICBuYW1lOiBUeXBlLlVzZXJJZCxcbiAgICB9KTtcbn0pO1xuXG5yZWdpc3RlckN1c3RvbVByb3RvY29sKFwibWF0cml4XCIsIHRydWUpO1xuXG5leHBvcnQgY29uc3QgbGlua2lmeSA9IGxpbmtpZnlqcztcbmV4cG9ydCBjb25zdCBfbGlua2lmeUVsZW1lbnQgPSBsaW5raWZ5RWxlbWVudDtcbmV4cG9ydCBjb25zdCBfbGlua2lmeVN0cmluZyA9IGxpbmtpZnlTdHJpbmc7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQWlCQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFLQTs7QUFDQTs7QUFHQTs7Ozs7O0FBaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0lBbUJZQSxJLEVBT1o7Ozs7V0FQWUEsSTtFQUFBQSxJO0VBQUFBLEk7RUFBQUEsSTtFQUFBQSxJO0dBQUFBLEksb0JBQUFBLEk7O0FBUVosU0FBU0MsMkJBQVQsT0FZRztFQUFBLElBWmtDO0lBQ2pDQyxPQURpQztJQUVqQ0MsTUFGaUM7SUFHakNDLEtBSGlDO0lBSWpDQyxLQUppQztJQUtqQ0M7RUFMaUMsQ0FZbEM7RUFDQyxNQUFNO0lBQ0ZDLEdBREU7SUFFRjtJQUNBQyxHQUhFO0lBSUZDLEdBSkU7SUFLRkMsS0FMRTtJQU1GQyxHQU5FO0lBT0ZDLE1BUEU7SUFRRkMsVUFSRTtJQVNGO0lBQ0E7SUFDQUMsU0FYRTtJQVlGQztFQVpFLElBYUZiLE9BQU8sQ0FBQ2MsTUFiWjtFQWVBLE1BQU1DLE9BQU8sR0FBR2QsTUFBTSxDQUFDZSxLQUF2QjtFQUNBLE1BQU1DLFlBQVksR0FBR2YsS0FBSyxDQUFDZ0IsZ0JBQU4sQ0FBdUJkLElBQXZCLEVBQTZCO0lBQUVlLE1BQU0sRUFBRTtFQUFWLENBQTdCLENBQXJCO0VBRUEsTUFBTUMsZUFBZSxHQUFHLENBQUNQLE1BQUQsRUFBU04sR0FBVCxFQUFjSyxTQUFkLEVBQXlCSCxHQUF6QixFQUE4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
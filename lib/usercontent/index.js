"use strict";

/*
Copyright 2022 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
let hasCalled = false;

function remoteRender(event) {
  const data = event.data; // If we're handling secondary calls, start from scratch

  if (hasCalled) {
    document.body.replaceWith(document.createElement("BODY"));
  }

  hasCalled = true;
  const img = document.createElement("span"); // we'll mask it as an image

  img.id = "img";
  const a = document.createElement("a");
  a.id = "a";
  a.rel = "noreferrer noopener";
  a.download = data.download; // @ts-ignore

  a.style = data.style;
  a.style.fontFamily = "Arial, Helvetica, Sans-Serif";
  a.href = window.URL.createObjectURL(data.blob);
  a.appendChild(img);
  a.appendChild(document.createTextNode(data.textContent)); // Apply image style after so we can steal the anchor's colour.
  // Style copied from a rendered version of mx_MFileBody_download_icon

  if (data.imgStyle) {
    // @ts-ignore
    img.style = data.imgStyle;
  } else {
    img.style.width = "12px";
    img.style.height = "12px";
    img.style.webkitMaskSize = "12px";
    img.style.webkitMaskPosition = "center";
    img.style.webkitMaskRepeat = "no-repeat";
    img.style.display = "inline-block";
    img.style.webkitMaskImage = `url('${data.imgSrc}')`;
    img.style.backgroundColor = `${a.style.color}`;
  }

  const body = document.body; // Don't display scrollbars if the link takes more than one line to display.

  body.style.margin = "0px";
  body.style.overflow = "hidden";
  body.appendChild(a);

  if (event.data.auto) {
    a.click(); // try to trigger download automatically
  }
}

window.onmessage = function (e) {
  if (e.origin === window.location.origin) {
    if (e.data.blob) remoteRender(e);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJoYXNDYWxsZWQiLCJyZW1vdGVSZW5kZXIiLCJldmVudCIsImRhdGEiLCJkb2N1bWVudCIsImJvZHkiLCJyZXBsYWNlV2l0aCIsImNyZWF0ZUVsZW1lbnQiLCJpbWciLCJpZCIsImEiLCJyZWwiLCJkb3dubG9hZCIsInN0eWxlIiwiZm9udEZhbWlseSIsImhyZWYiLCJ3aW5kb3ciLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJibG9iIiwiYXBwZW5kQ2hpbGQiLCJjcmVhdGVUZXh0Tm9kZSIsInRleHRDb250ZW50IiwiaW1nU3R5bGUiLCJ3aWR0aCIsImhlaWdodCIsIndlYmtpdE1hc2tTaXplIiwid2Via2l0TWFza1Bvc2l0aW9uIiwid2Via2l0TWFza1JlcGVhdCIsImRpc3BsYXkiLCJ3ZWJraXRNYXNrSW1hZ2UiLCJpbWdTcmMiLCJiYWNrZ3JvdW5kQ29sb3IiLCJjb2xvciIsIm1hcmdpbiIsIm92ZXJmbG93IiwiYXV0byIsImNsaWNrIiwib25tZXNzYWdlIiwiZSIsIm9yaWdpbiIsImxvY2F0aW9uIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL3VzZXJjb250ZW50L2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAyMiBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmxldCBoYXNDYWxsZWQgPSBmYWxzZTtcbmZ1bmN0aW9uIHJlbW90ZVJlbmRlcihldmVudDogTWVzc2FnZUV2ZW50KTogdm9pZCB7XG4gICAgY29uc3QgZGF0YSA9IGV2ZW50LmRhdGE7XG5cbiAgICAvLyBJZiB3ZSdyZSBoYW5kbGluZyBzZWNvbmRhcnkgY2FsbHMsIHN0YXJ0IGZyb20gc2NyYXRjaFxuICAgIGlmIChoYXNDYWxsZWQpIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZXBsYWNlV2l0aChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiQk9EWVwiKSk7XG4gICAgfVxuICAgIGhhc0NhbGxlZCA9IHRydWU7XG5cbiAgICBjb25zdCBpbWc6IEhUTUxTcGFuRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpOyAvLyB3ZSdsbCBtYXNrIGl0IGFzIGFuIGltYWdlXG4gICAgaW1nLmlkID0gXCJpbWdcIjtcblxuICAgIGNvbnN0IGE6IEhUTUxBbmNob3JFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XG4gICAgYS5pZCA9IFwiYVwiO1xuICAgIGEucmVsID0gXCJub3JlZmVycmVyIG5vb3BlbmVyXCI7XG4gICAgYS5kb3dubG9hZCA9IGRhdGEuZG93bmxvYWQ7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGEuc3R5bGUgPSBkYXRhLnN0eWxlO1xuICAgIGEuc3R5bGUuZm9udEZhbWlseSA9IFwiQXJpYWwsIEhlbHZldGljYSwgU2Fucy1TZXJpZlwiO1xuICAgIGEuaHJlZiA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGRhdGEuYmxvYik7XG4gICAgYS5hcHBlbmRDaGlsZChpbWcpO1xuICAgIGEuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZGF0YS50ZXh0Q29udGVudCkpO1xuXG4gICAgLy8gQXBwbHkgaW1hZ2Ugc3R5bGUgYWZ0ZXIgc28gd2UgY2FuIHN0ZWFsIHRoZSBhbmNob3IncyBjb2xvdXIuXG4gICAgLy8gU3R5bGUgY29waWVkIGZyb20gYSByZW5kZXJlZCB2ZXJzaW9uIG9mIG14X01GaWxlQm9keV9kb3dubG9hZF9pY29uXG4gICAgaWYgKGRhdGEuaW1nU3R5bGUpIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBpbWcuc3R5bGUgPSBkYXRhLmltZ1N0eWxlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGltZy5zdHlsZS53aWR0aCA9IFwiMTJweFwiO1xuICAgICAgICBpbWcuc3R5bGUuaGVpZ2h0ID0gXCIxMnB4XCI7XG4gICAgICAgIGltZy5zdHlsZS53ZWJraXRNYXNrU2l6ZSA9IFwiMTJweFwiO1xuICAgICAgICBpbWcuc3R5bGUud2Via2l0TWFza1Bvc2l0aW9uID0gXCJjZW50ZXJcIjtcbiAgICAgICAgaW1nLnN0eWxlLndlYmtpdE1hc2tSZXBlYXQgPSBcIm5vLXJlcGVhdFwiO1xuICAgICAgICBpbWcuc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XG4gICAgICAgIGltZy5zdHlsZS53ZWJraXRNYXNrSW1hZ2UgPSBgdXJsKCcke2RhdGEuaW1nU3JjfScpYDtcbiAgICAgICAgaW1nLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGAke2Euc3R5bGUuY29sb3J9YDtcbiAgICB9XG5cbiAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQuYm9keTtcbiAgICAvLyBEb24ndCBkaXNwbGF5IHNjcm9sbGJhcnMgaWYgdGhlIGxpbmsgdGFrZXMgbW9yZSB0aGFuIG9uZSBsaW5lIHRvIGRpc3BsYXkuXG4gICAgYm9keS5zdHlsZSAubWFyZ2luID0gXCIwcHhcIjtcbiAgICBib2R5LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcbiAgICBib2R5LmFwcGVuZENoaWxkKGEpO1xuXG4gICAgaWYgKGV2ZW50LmRhdGEuYXV0bykge1xuICAgICAgICBhLmNsaWNrKCk7IC8vIHRyeSB0byB0cmlnZ2VyIGRvd25sb2FkIGF1dG9tYXRpY2FsbHlcbiAgICB9XG59XG5cbndpbmRvdy5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlOiBNZXNzYWdlRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAoZS5vcmlnaW4gPT09IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4pIHtcbiAgICAgICAgaWYgKGUuZGF0YS5ibG9iKSByZW1vdGVSZW5kZXIoZSk7XG4gICAgfVxufTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxJQUFJQSxTQUFTLEdBQUcsS0FBaEI7O0FBQ0EsU0FBU0MsWUFBVCxDQUFzQkMsS0FBdEIsRUFBaUQ7RUFDN0MsTUFBTUMsSUFBSSxHQUFHRCxLQUFLLENBQUNDLElBQW5CLENBRDZDLENBRzdDOztFQUNBLElBQUlILFNBQUosRUFBZTtJQUNYSSxRQUFRLENBQUNDLElBQVQsQ0FBY0MsV0FBZCxDQUEwQkYsUUFBUSxDQUFDRyxhQUFULENBQXVCLE1BQXZCLENBQTFCO0VBQ0g7O0VBQ0RQLFNBQVMsR0FBRyxJQUFaO0VBRUEsTUFBTVEsR0FBb0IsR0FBR0osUUFBUSxDQUFDRyxhQUFULENBQXVCLE1BQXZCLENBQTdCLENBVDZDLENBU2dCOztFQUM3REMsR0FBRyxDQUFDQyxFQUFKLEdBQVMsS0FBVDtFQUVBLE1BQU1DLENBQW9CLEdBQUdOLFFBQVEsQ0FBQ0csYUFBVCxDQUF1QixHQUF2QixDQUE3QjtFQUNBRyxDQUFDLENBQUNELEVBQUYsR0FBTyxHQUFQO0VBQ0FDLENBQUMsQ0FBQ0MsR0FBRixHQUFRLHFCQUFSO0VBQ0FELENBQUMsQ0FBQ0UsUUFBRixHQUFhVCxJQUFJLENBQUNTLFFBQWxCLENBZjZDLENBZ0I3Qzs7RUFDQUYsQ0FBQyxDQUFDRyxLQUFGLEdBQVVWLElBQUksQ0FBQ1UsS0FBZjtFQUNBSCxDQUFDLENBQUNHLEtBQUYsQ0FBUUMsVUFBUixHQUFxQiw4QkFBckI7RUFDQUosQ0FBQyxDQUFDSyxJQUFGLEdBQVNDLE1BQU0sQ0FBQ0MsR0FBUCxDQUFXQyxlQUFYLENBQTJCZixJQUFJLENBQUNnQixJQUFoQyxDQUFUO0VBQ0FULENBQUMsQ0FBQ1UsV0FBRixDQUFjWixHQUFkO0VBQ0FFLENBQUMsQ0FBQ1UsV0FBRixDQUFjaEIsUUFBUSxDQUFDaUIsY0FBVCxDQUF3QmxCLElBQUksQ0FBQ21CLFdBQTdCLENBQWQsRUFyQjZDLENBdUI3QztFQUNBOztFQUNBLElBQUluQixJQUFJLENBQUNvQixRQUFULEVBQW1CO0lBQ2Y7SUFDQWYsR0FBRyxDQUFDSyxLQUFKLEdBQVlWLElBQUksQ0FBQ29CLFFBQWpCO0VBQ0gsQ0FIRCxNQUdPO0lBQ0hmLEdBQUcsQ0FBQ0ssS0FBSixDQUFVVyxLQUFWLEdBQWtCLE1BQWxCO0lBQ0FoQixHQUFHLENBQUNLLEtBQUosQ0FBVVksTUFBVixHQUFtQixNQUFuQjtJQUNBakIsR0FBRyxDQUFDSyxLQUFKLENBQVVhLGNBQVYsR0FBMkIsTUFBM0I7SUFDQWxCLEdBQUcsQ0FBQ0ssS0FBSixDQUFVYyxrQkFBVixHQUErQixRQUEvQjtJQUNBbkIsR0FBRyxDQUFDSyxLQUFKLENBQVVlLGdCQUFWLEdBQTZCLFdBQTdCO0lBQ0FwQixHQUFHLENBQUNLLEtBQUosQ0FBVWdCLE9BQVYsR0FBb0IsY0FBcEI7SUFDQXJCLEdBQUcsQ0FBQ0ssS0FBSixDQUFVaUIsZUFBVixHQUE2QixRQUFPM0IsSUFBSSxDQUFDNEIsTUFBTyxJQUFoRDtJQUNBdkIsR0FBRyxDQUFDSyxLQUFKLENBQVVtQixlQUFWLEdBQTZCLEdBQUV0QixDQUFDLENBQUNHLEtBQUYsQ0FBUW9CLEtBQU0sRUFBN0M7RUFDSDs7RUFFRCxNQUFNNUIsSUFBSSxHQUFHRCxRQUFRLENBQUNDLElBQXRCLENBdkM2QyxDQXdDN0M7O0VBQ0FBLElBQUksQ0FBQ1EsS0FBTCxDQUFZcUIsTUFBWixHQUFxQixLQUFyQjtFQUNBN0IsSUFBSSxDQUFDUSxLQUFMLENBQVdzQixRQUFYLEdBQXNCLFFBQXRCO0VBQ0E5QixJQUFJLENBQUNlLFdBQUwsQ0FBaUJWLENBQWpCOztFQUVBLElBQUlSLEtBQUssQ0FBQ0MsSUFBTixDQUFXaUMsSUFBZixFQUFxQjtJQUNqQjFCLENBQUMsQ0FBQzJCLEtBQUYsR0FEaUIsQ0FDTjtFQUNkO0FBQ0o7O0FBRURyQixNQUFNLENBQUNzQixTQUFQLEdBQW1CLFVBQVNDLENBQVQsRUFBZ0M7RUFDL0MsSUFBSUEsQ0FBQyxDQUFDQyxNQUFGLEtBQWF4QixNQUFNLENBQUN5QixRQUFQLENBQWdCRCxNQUFqQyxFQUF5QztJQUNyQyxJQUFJRCxDQUFDLENBQUNwQyxJQUFGLENBQU9nQixJQUFYLEVBQWlCbEIsWUFBWSxDQUFDc0MsQ0FBRCxDQUFaO0VBQ3BCO0FBQ0osQ0FKRCJ9
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.legacyVerifyUser = legacyVerifyUser;
exports.pendingVerificationRequestForUser = pendingVerificationRequestForUser;
exports.verifyDevice = verifyDevice;
exports.verifyUser = verifyUser;

var _crypto = require("matrix-js-sdk/src/crypto");

var _MatrixClientPeg = require("./MatrixClientPeg");

var _dispatcher = _interopRequireDefault(require("./dispatcher/dispatcher"));

var _Modal = _interopRequireDefault(require("./Modal"));

var _RightPanelStorePhases = require("./stores/right-panel/RightPanelStorePhases");

var _SecurityManager = require("./SecurityManager");

var _UntrustedDeviceDialog = _interopRequireDefault(require("./components/views/dialogs/UntrustedDeviceDialog"));

var _ManualDeviceKeyVerificationDialog = _interopRequireDefault(require("./components/views/dialogs/ManualDeviceKeyVerificationDialog"));

var _RightPanelStore = _interopRequireDefault(require("./stores/right-panel/RightPanelStore"));

var _findDMForUser = require("./utils/dm/findDMForUser");

/*
Copyright 2019, 2020, 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
async function enable4SIfNeeded() {
  const cli = _MatrixClientPeg.MatrixClientPeg.get();

  if (!cli.isCryptoEnabled()) {
    return false;
  }

  const usk = cli.getCrossSigningId("user_signing");

  if (!usk) {
    await (0, _SecurityManager.accessSecretStorage)();
    return false;
  }

  return true;
}

async function verifyDevice(user, device) {
  const cli = _MatrixClientPeg.MatrixClientPeg.get();

  if (cli.isGuest()) {
    _dispatcher.default.dispatch({
      action: 'require_registration'
    });

    return;
  } // if cross-signing is not explicitly disabled, check if it should be enabled first.


  if (cli.getCryptoTrustCrossSignedDevices()) {
    if (!(await enable4SIfNeeded())) {
      return;
    }
  }

  _Modal.default.createDialog(_UntrustedDeviceDialog.default, {
    user,
    device,
    onFinished: async action => {
      if (action === "sas") {
        const verificationRequestPromise = cli.legacyDeviceVerification(user.userId, device.deviceId, _crypto.verificationMethods.SAS);
        setRightPanel({
          member: user,
          verificationRequestPromise
        });
      } else if (action === "legacy") {
        _Modal.default.createDialog(_ManualDeviceKeyVerificationDialog.default, {
          userId: user.userId,
          device
        });
      }
    }
  });
}

async function legacyVerifyUser(user) {
  const cli = _MatrixClientPeg.MatrixClientPeg.get();

  if (cli.isGuest()) {
    _dispatcher.default.dispatch({
      action: 'require_registration'
    });

    return;
  } // if cross-signing is not explicitly disabled, check if it should be enabled first.


  if (cli.getCryptoTrustCrossSignedDevices()) {
    if (!(await enable4SIfNeeded())) {
      return;
    }
  }

  const verificationRequestPromise = cli.requestVerification(user.userId);
  setRightPanel({
    member: user,
    verificationRequestPromise
  });
}

async function verifyUser(user) {
  const cli = _MatrixClientPeg.MatrixClientPeg.get();

  if (cli.isGuest()) {
    _dispatcher.default.dispatch({
      action: 'require_registration'
    });

    return;
  }

  if (!(await enable4SIfNeeded())) {
    return;
  }

  const existingRequest = pendingVerificationRequestForUser(user);
  setRightPanel({
    member: user,
    verificationRequest: existingRequest
  });
}

function setRightPanel(state) {
  if (_RightPanelStore.default.instance.roomPhaseHistory.some(card => card.phase == _RightPanelStorePhases.RightPanelPhases.RoomSummary)) {
    _RightPanelStore.default.instance.pushCard({
      phase: _RightPanelStorePhases.RightPanelPhases.EncryptionPanel,
      state
    });
  } else {
    _RightPanelStore.default.instance.setCards([{
      phase: _RightPanelStorePhases.RightPanelPhases.RoomSummary
    }, {
      phase: _RightPanelStorePhases.RightPanelPhases.RoomMemberInfo,
      state: {
        member: state.member
      }
    }, {
      phase: _RightPanelStorePhases.RightPanelPhases.EncryptionPanel,
      state
    }]);
  }
}

function pendingVerificationRequestForUser(user) {
  const cli = _MatrixClientPeg.MatrixClientPeg.get();

  const dmRoom = (0, _findDMForUser.findDMForUser)(cli, user.userId);

  if (dmRoom) {
    return cli.findVerificationRequestDMInProgress(dmRoom.roomId);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJlbmFibGU0U0lmTmVlZGVkIiwiY2xpIiwiTWF0cml4Q2xpZW50UGVnIiwiZ2V0IiwiaXNDcnlwdG9FbmFibGVkIiwidXNrIiwiZ2V0Q3Jvc3NTaWduaW5nSWQiLCJhY2Nlc3NTZWNyZXRTdG9yYWdlIiwidmVyaWZ5RGV2aWNlIiwidXNlciIsImRldmljZSIsImlzR3Vlc3QiLCJkaXMiLCJkaXNwYXRjaCIsImFjdGlvbiIsImdldENyeXB0b1RydXN0Q3Jvc3NTaWduZWREZXZpY2VzIiwiTW9kYWwiLCJjcmVhdGVEaWFsb2ciLCJVbnRydXN0ZWREZXZpY2VEaWFsb2ciLCJvbkZpbmlzaGVkIiwidmVyaWZpY2F0aW9uUmVxdWVzdFByb21pc2UiLCJsZWdhY3lEZXZpY2VWZXJpZmljYXRpb24iLCJ1c2VySWQiLCJkZXZpY2VJZCIsIlZlcmlmaWNhdGlvbk1ldGhvZHMiLCJTQVMiLCJzZXRSaWdodFBhbmVsIiwibWVtYmVyIiwiTWFudWFsRGV2aWNlS2V5VmVyaWZpY2F0aW9uRGlhbG9nIiwibGVnYWN5VmVyaWZ5VXNlciIsInJlcXVlc3RWZXJpZmljYXRpb24iLCJ2ZXJpZnlVc2VyIiwiZXhpc3RpbmdSZXF1ZXN0IiwicGVuZGluZ1ZlcmlmaWNhdGlvblJlcXVlc3RGb3JVc2VyIiwidmVyaWZpY2F0aW9uUmVxdWVzdCIsInN0YXRlIiwiUmlnaHRQYW5lbFN0b3JlIiwiaW5zdGFuY2UiLCJyb29tUGhhc2VIaXN0b3J5Iiwic29tZSIsImNhcmQiLCJwaGFzZSIsIlJpZ2h0UGFuZWxQaGFzZXMiLCJSb29tU3VtbWFyeSIsInB1c2hDYXJkIiwiRW5jcnlwdGlvblBhbmVsIiwic2V0Q2FyZHMiLCJSb29tTWVtYmVySW5mbyIsImRtUm9vbSIsImZpbmRETUZvclVzZXIiLCJmaW5kVmVyaWZpY2F0aW9uUmVxdWVzdERNSW5Qcm9ncmVzcyIsInJvb21JZCJdLCJzb3VyY2VzIjpbIi4uL3NyYy92ZXJpZmljYXRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5LCAyMDIwLCAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IHsgVXNlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvdXNlclwiO1xuaW1wb3J0IHsgdmVyaWZpY2F0aW9uTWV0aG9kcyBhcyBWZXJpZmljYXRpb25NZXRob2RzIH0gZnJvbSAnbWF0cml4LWpzLXNkay9zcmMvY3J5cHRvJztcbmltcG9ydCB7IFJvb21NZW1iZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbWF0cml4XCI7XG5cbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gJy4vTWF0cml4Q2xpZW50UGVnJztcbmltcG9ydCBkaXMgZnJvbSBcIi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyXCI7XG5pbXBvcnQgTW9kYWwgZnJvbSAnLi9Nb2RhbCc7XG5pbXBvcnQgeyBSaWdodFBhbmVsUGhhc2VzIH0gZnJvbSBcIi4vc3RvcmVzL3JpZ2h0LXBhbmVsL1JpZ2h0UGFuZWxTdG9yZVBoYXNlc1wiO1xuaW1wb3J0IHsgYWNjZXNzU2VjcmV0U3RvcmFnZSB9IGZyb20gJy4vU2VjdXJpdHlNYW5hZ2VyJztcbmltcG9ydCBVbnRydXN0ZWREZXZpY2VEaWFsb2cgZnJvbSBcIi4vY29tcG9uZW50cy92aWV3cy9kaWFsb2dzL1VudHJ1c3RlZERldmljZURpYWxvZ1wiO1xuaW1wb3J0IHsgSURldmljZSB9IGZyb20gXCIuL2NvbXBvbmVudHMvdmlld3MvcmlnaHRfcGFuZWwvVXNlckluZm9cIjtcbmltcG9ydCBNYW51YWxEZXZpY2VLZXlWZXJpZmljYXRpb25EaWFsb2cgZnJvbSBcIi4vY29tcG9uZW50cy92aWV3cy9kaWFsb2dzL01hbnVhbERldmljZUtleVZlcmlmaWNhdGlvbkRpYWxvZ1wiO1xuaW1wb3J0IFJpZ2h0UGFuZWxTdG9yZSBmcm9tIFwiLi9zdG9yZXMvcmlnaHQtcGFuZWwvUmlnaHRQYW5lbFN0b3JlXCI7XG5pbXBvcnQgeyBJUmlnaHRQYW5lbENhcmRTdGF0ZSB9IGZyb20gXCIuL3N0b3Jlcy9yaWdodC1wYW5lbC9SaWdodFBhbmVsU3RvcmVJUGFuZWxTdGF0ZVwiO1xuaW1wb3J0IHsgZmluZERNRm9yVXNlciB9IGZyb20gXCIuL3V0aWxzL2RtL2ZpbmRETUZvclVzZXJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZW5hYmxlNFNJZk5lZWRlZCgpIHtcbiAgICBjb25zdCBjbGkgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCk7XG4gICAgaWYgKCFjbGkuaXNDcnlwdG9FbmFibGVkKCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCB1c2sgPSBjbGkuZ2V0Q3Jvc3NTaWduaW5nSWQoXCJ1c2VyX3NpZ25pbmdcIik7XG4gICAgaWYgKCF1c2spIHtcbiAgICAgICAgYXdhaXQgYWNjZXNzU2VjcmV0U3RvcmFnZSgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlEZXZpY2UodXNlcjogVXNlciwgZGV2aWNlOiBJRGV2aWNlKSB7XG4gICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgIGlmIChjbGkuaXNHdWVzdCgpKSB7XG4gICAgICAgIGRpcy5kaXNwYXRjaCh7IGFjdGlvbjogJ3JlcXVpcmVfcmVnaXN0cmF0aW9uJyB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBpZiBjcm9zcy1zaWduaW5nIGlzIG5vdCBleHBsaWNpdGx5IGRpc2FibGVkLCBjaGVjayBpZiBpdCBzaG91bGQgYmUgZW5hYmxlZCBmaXJzdC5cbiAgICBpZiAoY2xpLmdldENyeXB0b1RydXN0Q3Jvc3NTaWduZWREZXZpY2VzKCkpIHtcbiAgICAgICAgaWYgKCEoYXdhaXQgZW5hYmxlNFNJZk5lZWRlZCgpKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgTW9kYWwuY3JlYXRlRGlhbG9nKFVudHJ1c3RlZERldmljZURpYWxvZywge1xuICAgICAgICB1c2VyLFxuICAgICAgICBkZXZpY2UsXG4gICAgICAgIG9uRmluaXNoZWQ6IGFzeW5jIChhY3Rpb24pID0+IHtcbiAgICAgICAgICAgIGlmIChhY3Rpb24gPT09IFwic2FzXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB2ZXJpZmljYXRpb25SZXF1ZXN0UHJvbWlzZSA9IGNsaS5sZWdhY3lEZXZpY2VWZXJpZmljYXRpb24oXG4gICAgICAgICAgICAgICAgICAgIHVzZXIudXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBkZXZpY2UuZGV2aWNlSWQsXG4gICAgICAgICAgICAgICAgICAgIFZlcmlmaWNhdGlvbk1ldGhvZHMuU0FTLFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgc2V0UmlnaHRQYW5lbCh7IG1lbWJlcjogdXNlciwgdmVyaWZpY2F0aW9uUmVxdWVzdFByb21pc2UgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJsZWdhY3lcIikge1xuICAgICAgICAgICAgICAgIE1vZGFsLmNyZWF0ZURpYWxvZyhNYW51YWxEZXZpY2VLZXlWZXJpZmljYXRpb25EaWFsb2csIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiB1c2VyLnVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbGVnYWN5VmVyaWZ5VXNlcih1c2VyOiBVc2VyKSB7XG4gICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgIGlmIChjbGkuaXNHdWVzdCgpKSB7XG4gICAgICAgIGRpcy5kaXNwYXRjaCh7IGFjdGlvbjogJ3JlcXVpcmVfcmVnaXN0cmF0aW9uJyB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBpZiBjcm9zcy1zaWduaW5nIGlzIG5vdCBleHBsaWNpdGx5IGRpc2FibGVkLCBjaGVjayBpZiBpdCBzaG91bGQgYmUgZW5hYmxlZCBmaXJzdC5cbiAgICBpZiAoY2xpLmdldENyeXB0b1RydXN0Q3Jvc3NTaWduZWREZXZpY2VzKCkpIHtcbiAgICAgICAgaWYgKCEoYXdhaXQgZW5hYmxlNFNJZk5lZWRlZCgpKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHZlcmlmaWNhdGlvblJlcXVlc3RQcm9taXNlID0gY2xpLnJlcXVlc3RWZXJpZmljYXRpb24odXNlci51c2VySWQpO1xuICAgIHNldFJpZ2h0UGFuZWwoeyBtZW1iZXI6IHVzZXIsIHZlcmlmaWNhdGlvblJlcXVlc3RQcm9taXNlIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5VXNlcih1c2VyOiBVc2VyKSB7XG4gICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgIGlmIChjbGkuaXNHdWVzdCgpKSB7XG4gICAgICAgIGRpcy5kaXNwYXRjaCh7IGFjdGlvbjogJ3JlcXVpcmVfcmVnaXN0cmF0aW9uJyB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIShhd2FpdCBlbmFibGU0U0lmTmVlZGVkKCkpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZXhpc3RpbmdSZXF1ZXN0ID0gcGVuZGluZ1ZlcmlmaWNhdGlvblJlcXVlc3RGb3JVc2VyKHVzZXIpO1xuICAgIHNldFJpZ2h0UGFuZWwoeyBtZW1iZXI6IHVzZXIsIHZlcmlmaWNhdGlvblJlcXVlc3Q6IGV4aXN0aW5nUmVxdWVzdCB9KTtcbn1cblxuZnVuY3Rpb24gc2V0UmlnaHRQYW5lbChzdGF0ZTogSVJpZ2h0UGFuZWxDYXJkU3RhdGUpIHtcbiAgICBpZiAoUmlnaHRQYW5lbFN0b3JlLmluc3RhbmNlLnJvb21QaGFzZUhpc3Rvcnkuc29tZSgoY2FyZCkgPT4gKGNhcmQucGhhc2UgPT0gUmlnaHRQYW5lbFBoYXNlcy5Sb29tU3VtbWFyeSkpKSB7XG4gICAgICAgIFJpZ2h0UGFuZWxTdG9yZS5pbnN0YW5jZS5wdXNoQ2FyZChcbiAgICAgICAgICAgIHsgcGhhc2U6IFJpZ2h0UGFuZWxQaGFzZXMuRW5jcnlwdGlvblBhbmVsLCBzdGF0ZSB9LFxuICAgICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIFJpZ2h0UGFuZWxTdG9yZS5pbnN0YW5jZS5zZXRDYXJkcyhbXG4gICAgICAgICAgICB7IHBoYXNlOiBSaWdodFBhbmVsUGhhc2VzLlJvb21TdW1tYXJ5IH0sXG4gICAgICAgICAgICB7IHBoYXNlOiBSaWdodFBhbmVsUGhhc2VzLlJvb21NZW1iZXJJbmZvLCBzdGF0ZTogeyBtZW1iZXI6IHN0YXRlLm1lbWJlciB9IH0sXG4gICAgICAgICAgICB7IHBoYXNlOiBSaWdodFBhbmVsUGhhc2VzLkVuY3J5cHRpb25QYW5lbCwgc3RhdGUgfSxcbiAgICAgICAgXSk7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcGVuZGluZ1ZlcmlmaWNhdGlvblJlcXVlc3RGb3JVc2VyKHVzZXI6IFVzZXIgfCBSb29tTWVtYmVyKSB7XG4gICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgIGNvbnN0IGRtUm9vbSA9IGZpbmRETUZvclVzZXIoY2xpLCB1c2VyLnVzZXJJZCk7XG4gICAgaWYgKGRtUm9vbSkge1xuICAgICAgICByZXR1cm4gY2xpLmZpbmRWZXJpZmljYXRpb25SZXF1ZXN0RE1JblByb2dyZXNzKGRtUm9vbS5yb29tSWQpO1xuICAgIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBaUJBOztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUVBOztBQTlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFrQkEsZUFBZUEsZ0JBQWYsR0FBa0M7RUFDOUIsTUFBTUMsR0FBRyxHQUFHQyxnQ0FBQSxDQUFnQkMsR0FBaEIsRUFBWjs7RUFDQSxJQUFJLENBQUNGLEdBQUcsQ0FBQ0csZUFBSixFQUFMLEVBQTRCO0lBQ3hCLE9BQU8sS0FBUDtFQUNIOztFQUNELE1BQU1DLEdBQUcsR0FBR0osR0FBRyxDQUFDSyxpQkFBSixDQUFzQixjQUF0QixDQUFaOztFQUNBLElBQUksQ0FBQ0QsR0FBTCxFQUFVO0lBQ04sTUFBTSxJQUFBRSxvQ0FBQSxHQUFOO0lBQ0EsT0FBTyxLQUFQO0VBQ0g7O0VBRUQsT0FBTyxJQUFQO0FBQ0g7O0FBRU0sZUFBZUMsWUFBZixDQUE0QkMsSUFBNUIsRUFBd0NDLE1BQXhDLEVBQXlEO0VBQzVELE1BQU1ULEdB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
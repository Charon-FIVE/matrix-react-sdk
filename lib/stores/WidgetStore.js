"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _logger = require("matrix-js-sdk/src/logger");

var _client = require("matrix-js-sdk/src/client");

var _roomState = require("matrix-js-sdk/src/models/room-state");

var _AsyncStoreWithClient = require("./AsyncStoreWithClient");

var _dispatcher = _interopRequireDefault(require("../dispatcher/dispatcher"));

var _WidgetEchoStore = _interopRequireDefault(require("../stores/WidgetEchoStore"));

var _ActiveWidgetStore = _interopRequireDefault(require("../stores/ActiveWidgetStore"));

var _WidgetUtils = _interopRequireDefault(require("../utils/WidgetUtils"));

var _WidgetType = require("../widgets/WidgetType");

var _AsyncStore = require("./AsyncStore");

/*
Copyright 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
// TODO consolidate WidgetEchoStore into this
// TODO consolidate ActiveWidgetStore into this
class WidgetStore extends _AsyncStoreWithClient.AsyncStoreWithClient {
  // Key is widget Unique ID (UID)
  // Key is room ID
  constructor() {
    var _this;

    super(_dispatcher.default, {});
    _this = this;
    (0, _defineProperty2.default)(this, "widgetMap", new Map());
    (0, _defineProperty2.default)(this, "roomMap", new Map());
    (0, _defineProperty2.default)(this, "onWidgetEchoStoreUpdate", (roomId, widgetId) => {
      this.initRoom(roomId);
      this.loadRoomWidgets(this.matrixClient.getRoom(roomId));
      this.emit(_AsyncStore.UPDATE_EVENT, roomId);
    });
    (0, _defineProperty2.default)(this, "onRoom", room => {
      this.initRoom(room.roomId);
      this.loadRoomWidgets(room);
      this.emit(_AsyncStore.UPDATE_EVENT, room.roomId);
    });
    (0, _defineProperty2.default)(this, "onRoomStateEvents", ev => {
      if (ev.getType() !== "im.vector.modular.widgets") return; // TODO: Support m.widget too

      const roomId = ev.getRoomId();
      this.initRoom(roomId);
      this.loadRoomWidgets(this.matrixClient.getRoom(roomId));
      this.emit(_AsyncStore.UPDATE_EVENT, roomId);
    });
    (0, _defineProperty2.default)(this, "getRoom", function (roomId) {
      let initIfNeeded = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
      if (initIfNeeded) _this.initRoom(roomId); // internally handles "if needed"

      return _this.roomMap.get(roomId);
    });

    _WidgetEchoStore.default.on("update", this.onWidgetEchoStoreUpdate);
  }

  static get instance() {
    return WidgetStore.internalInstance;
  }

  initRoom(roomId) {
    if (!this.roomMap.has(roomId)) {
      this.roomMap.set(roomId, {
        widgets: []
      });
    }
  }

  async onReady() {
    this.matrixClient.on(_client.ClientEvent.Room, this.onRoom);
    this.matrixClient.on(_roomState.RoomStateEvent.Events, this.onRoomStateEvents);
    this.matrixClient.getRooms().forEach(room => {
      this.loadRoomWidgets(room);
    });
    this.emit(_AsyncStore.UPDATE_EVENT, null); // emit for all rooms
  }

  async onNotReady() {
    this.matrixClient.off(_client.ClientEvent.Room, this.onRoom);
    this.matrixClient.off(_roomState.RoomStateEvent.Events, this.onRoomStateEvents);
    this.widgetMap = new Map();
    this.roomMap = new Map();
    await this.reset({});
  } // We don't need this, but our contract says we do.


  async onAction(payload) {
    return;
  }

  generateApps(room) {
    return _WidgetEchoStore.default.getEchoedRoomWidgets(room.roomId, _WidgetUtils.default.getRoomWidgets(room)).map(ev => {
      return _WidgetUtils.default.makeAppConfig(ev.getStateKey(), ev.getContent(), ev.getSender(), ev.getRoomId(), ev.getId());
    });
  }

  loadRoomWidgets(room) {
    if (!room) return;
    const roomInfo = this.roomMap.get(room.roomId) || {};
    roomInfo.widgets = []; // first clean out old widgets from the map which originate from this room
    // otherwise we are out of sync with the rest of the app with stale widget events during removal

    Array.from(this.widgetMap.values()).forEach(app => {
      if (app.roomId !== room.roomId) return; // skip - wrong room

      this.widgetMap.delete(_WidgetUtils.default.getWidgetUid(app));
    });
    let edited = false;
    this.generateApps(room).forEach(app => {
      // Sanity check for https://github.com/vector-im/element-web/issues/15705
      const existingApp = this.widgetMap.get(_WidgetUtils.default.getWidgetUid(app));

      if (existingApp) {
        _logger.logger.warn(`Possible widget ID conflict for ${app.id} - wants to store in room ${app.roomId} ` + `but is currently stored as ${existingApp.roomId} - letting the want win`);
      }

      this.widgetMap.set(_WidgetUtils.default.getWidgetUid(app), app);
      roomInfo.widgets.push(app);
      edited = true;
    });

    if (edited && !this.roomMap.has(room.roomId)) {
      this.roomMap.set(room.roomId, roomInfo);
    } // If a persistent widget is active, check to see if it's just been removed.
    // If it has, it needs to destroyed otherwise unmounting the node won't kill it


    const persistentWidgetId = _ActiveWidgetStore.default.instance.getPersistentWidgetId();

    if (persistentWidgetId && _ActiveWidgetStore.default.instance.getPersistentRoomId() === room.roomId && !roomInfo.widgets.some(w => w.id === persistentWidgetId)) {
      _logger.logger.log(`Persistent widget ${persistentWidgetId} removed from room ${room.roomId}: destroying.`);

      _ActiveWidgetStore.default.instance.destroyPersistentWidget(persistentWidgetId, room.roomId);
    }

    this.emit(room.roomId);
  }

  getApps(roomId) {
    const roomInfo = this.getRoom(roomId);
    return roomInfo?.widgets || [];
  }

  doesRoomHaveConference(room) {
    const roomInfo = this.getRoom(room.roomId);
    if (!roomInfo) return false;
    const currentWidgets = roomInfo.widgets.filter(w => _WidgetType.WidgetType.JITSI.matches(w.type));

    const hasPendingWidgets = _WidgetEchoStore.default.roomHasPendingWidgetsOfType(room.roomId, [], _WidgetType.WidgetType.JITSI);

    return currentWidgets.length > 0 || hasPendingWidgets;
  }

  isJoinedToConferenceIn(room) {
    const roomInfo = this.getRoom(room.roomId);
    if (!roomInfo) return false; // A persistent conference widget indicates that we're participating

    const widgets = roomInfo.widgets.filter(w => _WidgetType.WidgetType.JITSI.matches(w.type));
    return widgets.some(w => _ActiveWidgetStore.default.instance.getWidgetPersistence(w.id, room.roomId));
  }

}

exports.default = WidgetStore;
(0, _defineProperty2.default)(WidgetStore, "internalInstance", (() => {
  const instance = new WidgetStore();
  instance.start();
  return instance;
})());
window.mxWidgetStore = WidgetStore.instance;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJXaWRnZXRTdG9yZSIsIkFzeW5jU3RvcmVXaXRoQ2xpZW50IiwiY29uc3RydWN0b3IiLCJkZWZhdWx0RGlzcGF0Y2hlciIsIk1hcCIsInJvb21JZCIsIndpZGdldElkIiwiaW5pdFJvb20iLCJsb2FkUm9vbVdpZGdldHMiLCJtYXRyaXhDbGllbnQiLCJnZXRSb29tIiwiZW1pdCIsIlVQREFURV9FVkVOVCIsInJvb20iLCJldiIsImdldFR5cGUiLCJnZXRSb29tSWQiLCJpbml0SWZOZWVkZWQiLCJyb29tTWFwIiwiZ2V0IiwiV2lkZ2V0RWNob1N0b3JlIiwib24iLCJvbldpZGdldEVjaG9TdG9yZVVwZGF0ZSIsImluc3RhbmNlIiwiaW50ZXJuYWxJbnN0YW5jZSIsImhhcyIsInNldCIsIndpZGdldHMiLCJvblJlYWR5IiwiQ2xpZW50RXZlbnQiLCJSb29tIiwib25Sb29tIiwiUm9vbVN0YXRlRXZlbnQiLCJFdmVudHMiLCJvblJvb21TdGF0ZUV2ZW50cyIsImdldFJvb21zIiwiZm9yRWFjaCIsIm9uTm90UmVhZHkiLCJvZmYiLCJ3aWRnZXRNYXAiLCJyZXNldCIsIm9uQWN0aW9uIiwicGF5bG9hZCIsImdlbmVyYXRlQXBwcyIsImdldEVjaG9lZFJvb21XaWRnZXRzIiwiV2lkZ2V0VXRpbHMiLCJnZXRSb29tV2lkZ2V0cyIsIm1hcCIsIm1ha2VBcHBDb25maWciLCJnZXRTdGF0ZUtleSIsImdldENvbnRlbnQiLCJnZXRTZW5kZXIiLCJnZXRJZCIsInJvb21JbmZvIiwiQXJyYXkiLCJmcm9tIiwidmFsdWVzIiwiYXBwIiwiZGVsZXRlIiwiZ2V0V2lkZ2V0VWlkIiwiZWRpdGVkIiwiZXhpc3RpbmdBcHAiLCJsb2dnZXIiLCJ3YXJuIiwiaWQiLCJwdXNoIiwicGVyc2lzdGVudFdpZGdldElkIiwiQWN0aXZlV2lkZ2V0U3RvcmUiLCJnZXRQZXJzaXN0ZW50V2lkZ2V0SWQiLCJnZXRQZXJzaXN0ZW50Um9vbUlkIiwic29tZSIsInciLCJsb2ciLCJkZXN0cm95UGVyc2lzdGVudFdpZGdldCIsImdldEFwcHMiLCJkb2VzUm9vbUhhdmVDb25mZXJlbmNlIiwiY3VycmVudFdpZGdldHMiLCJmaWx0ZXIiLCJXaWRnZXRUeXBlIiwiSklUU0kiLCJtYXRjaGVzIiwidHlwZSIsImhhc1BlbmRpbmdXaWRnZXRzIiwicm9vbUhhc1BlbmRpbmdXaWRnZXRzT2ZUeXBlIiwibGVuZ3RoIiwiaXNKb2luZWRUb0NvbmZlcmVuY2VJbiIsImdldFdpZGdldFBlcnNpc3RlbmNlIiwic3RhcnQiLCJ3aW5kb3ciLCJteFdpZGdldFN0b3JlIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL3N0b3Jlcy9XaWRnZXRTdG9yZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMjAgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tXCI7XG5pbXBvcnQgeyBNYXRyaXhFdmVudCB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvZXZlbnRcIjtcbmltcG9ydCB7IElXaWRnZXQgfSBmcm9tIFwibWF0cml4LXdpZGdldC1hcGlcIjtcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9sb2dnZXJcIjtcbmltcG9ydCB7IENsaWVudEV2ZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2NsaWVudFwiO1xuaW1wb3J0IHsgUm9vbVN0YXRlRXZlbnQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb20tc3RhdGVcIjtcblxuaW1wb3J0IHsgQWN0aW9uUGF5bG9hZCB9IGZyb20gXCIuLi9kaXNwYXRjaGVyL3BheWxvYWRzXCI7XG5pbXBvcnQgeyBBc3luY1N0b3JlV2l0aENsaWVudCB9IGZyb20gXCIuL0FzeW5jU3RvcmVXaXRoQ2xpZW50XCI7XG5pbXBvcnQgZGVmYXVsdERpc3BhdGNoZXIgZnJvbSBcIi4uL2Rpc3BhdGNoZXIvZGlzcGF0Y2hlclwiO1xuaW1wb3J0IFdpZGdldEVjaG9TdG9yZSBmcm9tIFwiLi4vc3RvcmVzL1dpZGdldEVjaG9TdG9yZVwiO1xuaW1wb3J0IEFjdGl2ZVdpZGdldFN0b3JlIGZyb20gXCIuLi9zdG9yZXMvQWN0aXZlV2lkZ2V0U3RvcmVcIjtcbmltcG9ydCBXaWRnZXRVdGlscyBmcm9tIFwiLi4vdXRpbHMvV2lkZ2V0VXRpbHNcIjtcbmltcG9ydCB7IFdpZGdldFR5cGUgfSBmcm9tIFwiLi4vd2lkZ2V0cy9XaWRnZXRUeXBlXCI7XG5pbXBvcnQgeyBVUERBVEVfRVZFTlQgfSBmcm9tIFwiLi9Bc3luY1N0b3JlXCI7XG5cbmludGVyZmFjZSBJU3RhdGUge31cblxuZXhwb3J0IGludGVyZmFjZSBJQXBwIGV4dGVuZHMgSVdpZGdldCB7XG4gICAgcm9vbUlkOiBzdHJpbmc7XG4gICAgZXZlbnRJZDogc3RyaW5nO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2VcbiAgICBhdmF0YXJfdXJsPzogc3RyaW5nOyAvLyBNU0MyNzY1IGh0dHBzOi8vZ2l0aHViLmNvbS9tYXRyaXgtb3JnL21hdHJpeC1kb2MvcHVsbC8yNzY1XG59XG5cbmludGVyZmFjZSBJUm9vbVdpZGdldHMge1xuICAgIHdpZGdldHM6IElBcHBbXTtcbn1cblxuLy8gVE9ETyBjb25zb2xpZGF0ZSBXaWRnZXRFY2hvU3RvcmUgaW50byB0aGlzXG4vLyBUT0RPIGNvbnNvbGlkYXRlIEFjdGl2ZVdpZGdldFN0b3JlIGludG8gdGhpc1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgV2lkZ2V0U3RvcmUgZXh0ZW5kcyBBc3luY1N0b3JlV2l0aENsaWVudDxJU3RhdGU+IHtcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBpbnRlcm5hbEluc3RhbmNlID0gKCgpID0+IHtcbiAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBuZXcgV2lkZ2V0U3RvcmUoKTtcbiAgICAgICAgaW5zdGFuY2Uuc3RhcnQoKTtcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xuICAgIH0pKCk7XG5cbiAgICBwcml2YXRlIHdpZGdldE1hcCA9IG5ldyBNYXA8c3RyaW5nLCBJQXBwPigpOyAvLyBLZXkgaXMgd2lkZ2V0IFVuaXF1ZSBJRCAoVUlEKVxuICAgIHByaXZhdGUgcm9vbU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBJUm9vbVdpZGdldHM+KCk7IC8vIEtleSBpcyByb29tIElEXG5cbiAgICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcihkZWZhdWx0RGlzcGF0Y2hlciwge30pO1xuXG4gICAgICAgIFdpZGdldEVjaG9TdG9yZS5vbihcInVwZGF0ZVwiLCB0aGlzLm9uV2lkZ2V0RWNob1N0b3JlVXBkYXRlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGdldCBpbnN0YW5jZSgpOiBXaWRnZXRTdG9yZSB7XG4gICAgICAgIHJldHVybiBXaWRnZXRTdG9yZS5pbnRlcm5hbEluc3RhbmNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgaW5pdFJvb20ocm9vbUlkOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKCF0aGlzLnJvb21NYXAuaGFzKHJvb21JZCkpIHtcbiAgICAgICAgICAgIHRoaXMucm9vbU1hcC5zZXQocm9vbUlkLCB7XG4gICAgICAgICAgICAgICAgd2lkZ2V0czogW10sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBhc3luYyBvblJlYWR5KCk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIHRoaXMubWF0cml4Q2xpZW50Lm9uKENsaWVudEV2ZW50LlJvb20sIHRoaXMub25Sb29tKTtcbiAgICAgICAgdGhpcy5tYXRyaXhDbGllbnQub24oUm9vbVN0YXRlRXZlbnQuRXZlbnRzLCB0aGlzLm9uUm9vbVN0YXRlRXZlbnRzKTtcbiAgICAgICAgdGhpcy5tYXRyaXhDbGllbnQuZ2V0Um9vbXMoKS5mb3JFYWNoKChyb29tOiBSb29tKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvYWRSb29tV2lkZ2V0cyhyb29tKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZW1pdChVUERBVEVfRVZFTlQsIG51bGwpOyAvLyBlbWl0IGZvciBhbGwgcm9vbXNcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYXN5bmMgb25Ob3RSZWFkeSgpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICB0aGlzLm1hdHJpeENsaWVudC5vZmYoQ2xpZW50RXZlbnQuUm9vbSwgdGhpcy5vblJvb20pO1xuICAgICAgICB0aGlzLm1hdHJpeENsaWVudC5vZmYoUm9vbVN0YXRlRXZlbnQuRXZlbnRzLCB0aGlzLm9uUm9vbVN0YXRlRXZlbnRzKTtcbiAgICAgICAgdGhpcy53aWRnZXRNYXAgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMucm9vbU1hcCA9IG5ldyBNYXAoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5yZXNldCh7fSk7XG4gICAgfVxuXG4gICAgLy8gV2UgZG9uJ3QgbmVlZCB0aGlzLCBidXQgb3VyIGNvbnRyYWN0IHNheXMgd2UgZG8uXG4gICAgcHJvdGVjdGVkIGFzeW5jIG9uQWN0aW9uKHBheWxvYWQ6IEFjdGlvblBheWxvYWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25XaWRnZXRFY2hvU3RvcmVVcGRhdGUgPSAocm9vbUlkOiBzdHJpbmcsIHdpZGdldElkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgdGhpcy5pbml0Um9vbShyb29tSWQpO1xuICAgICAgICB0aGlzLmxvYWRSb29tV2lkZ2V0cyh0aGlzLm1hdHJpeENsaWVudC5nZXRSb29tKHJvb21JZCkpO1xuICAgICAgICB0aGlzLmVtaXQoVVBEQVRFX0VWRU5ULCByb29tSWQpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIGdlbmVyYXRlQXBwcyhyb29tOiBSb29tKTogSUFwcFtdIHtcbiAgICAgICAgcmV0dXJuIFdpZGdldEVjaG9TdG9yZS5nZXRFY2hvZWRSb29tV2lkZ2V0cyhyb29tLnJvb21JZCwgV2lkZ2V0VXRpbHMuZ2V0Um9vbVdpZGdldHMocm9vbSkpLm1hcCgoZXYpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBXaWRnZXRVdGlscy5tYWtlQXBwQ29uZmlnKFxuICAgICAgICAgICAgICAgIGV2LmdldFN0YXRlS2V5KCksIGV2LmdldENvbnRlbnQoKSwgZXYuZ2V0U2VuZGVyKCksIGV2LmdldFJvb21JZCgpLCBldi5nZXRJZCgpLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBsb2FkUm9vbVdpZGdldHMocm9vbTogUm9vbSkge1xuICAgICAgICBpZiAoIXJvb20pIHJldHVybjtcbiAgICAgICAgY29uc3Qgcm9vbUluZm8gPSB0aGlzLnJvb21NYXAuZ2V0KHJvb20ucm9vbUlkKSB8fCA8SVJvb21XaWRnZXRzPnt9O1xuICAgICAgICByb29tSW5mby53aWRnZXRzID0gW107XG5cbiAgICAgICAgLy8gZmlyc3QgY2xlYW4gb3V0IG9sZCB3aWRnZXRzIGZyb20gdGhlIG1hcCB3aGljaCBvcmlnaW5hdGUgZnJvbSB0aGlzIHJvb21cbiAgICAgICAgLy8gb3RoZXJ3aXNlIHdlIGFyZSBvdXQgb2Ygc3luYyB3aXRoIHRoZSByZXN0IG9mIHRoZSBhcHAgd2l0aCBzdGFsZSB3aWRnZXQgZXZlbnRzIGR1cmluZyByZW1vdmFsXG4gICAgICAgIEFycmF5LmZyb20odGhpcy53aWRnZXRNYXAudmFsdWVzKCkpLmZvckVhY2goYXBwID0+IHtcbiAgICAgICAgICAgIGlmIChhcHAucm9vbUlkICE9PSByb29tLnJvb21JZCkgcmV0dXJuOyAvLyBza2lwIC0gd3Jvbmcgcm9vbVxuICAgICAgICAgICAgdGhpcy53aWRnZXRNYXAuZGVsZXRlKFdpZGdldFV0aWxzLmdldFdpZGdldFVpZChhcHApKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IGVkaXRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmdlbmVyYXRlQXBwcyhyb29tKS5mb3JFYWNoKGFwcCA9PiB7XG4gICAgICAgICAgICAvLyBTYW5pdHkgY2hlY2sgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS92ZWN0b3ItaW0vZWxlbWVudC13ZWIvaXNzdWVzLzE1NzA1XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FwcCA9IHRoaXMud2lkZ2V0TWFwLmdldChXaWRnZXRVdGlscy5nZXRXaWRnZXRVaWQoYXBwKSk7XG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBcHApIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIud2FybihcbiAgICAgICAgICAgICAgICAgICAgYFBvc3NpYmxlIHdpZGdldCBJRCBjb25mbGljdCBmb3IgJHthcHAuaWR9IC0gd2FudHMgdG8gc3RvcmUgaW4gcm9vbSAke2FwcC5yb29tSWR9IGAgK1xuICAgICAgICAgICAgICAgICAgICBgYnV0IGlzIGN1cnJlbnRseSBzdG9yZWQgYXMgJHtleGlzdGluZ0FwcC5yb29tSWR9IC0gbGV0dGluZyB0aGUgd2FudCB3aW5gLFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMud2lkZ2V0TWFwLnNldChXaWRnZXRVdGlscy5nZXRXaWRnZXRVaWQoYXBwKSwgYXBwKTtcbiAgICAgICAgICAgIHJvb21JbmZvLndpZGdldHMucHVzaChhcHApO1xuICAgICAgICAgICAgZWRpdGVkID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChlZGl0ZWQgJiYgIXRoaXMucm9vbU1hcC5oYXMocm9vbS5yb29tSWQpKSB7XG4gICAgICAgICAgICB0aGlzLnJvb21NYXAuc2V0KHJvb20ucm9vbUlkLCByb29tSW5mbyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiBhIHBlcnNpc3RlbnQgd2lkZ2V0IGlzIGFjdGl2ZSwgY2hlY2sgdG8gc2VlIGlmIGl0J3MganVzdCBiZWVuIHJlbW92ZWQuXG4gICAgICAgIC8vIElmIGl0IGhhcywgaXQgbmVlZHMgdG8gZGVzdHJveWVkIG90aGVyd2lzZSB1bm1vdW50aW5nIHRoZSBub2RlIHdvbid0IGtpbGwgaXRcbiAgICAgICAgY29uc3QgcGVyc2lzdGVudFdpZGdldElkID0gQWN0aXZlV2lkZ2V0U3RvcmUuaW5zdGFuY2UuZ2V0UGVyc2lzdGVudFdpZGdldElkKCk7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHBlcnNpc3RlbnRXaWRnZXRJZCAmJlxuICAgICAgICAgICAgQWN0aXZlV2lkZ2V0U3RvcmUuaW5zdGFuY2UuZ2V0UGVyc2lzdGVudFJvb21JZCgpID09PSByb29tLnJvb21JZCAmJlxuICAgICAgICAgICAgIXJvb21JbmZvLndpZGdldHMuc29tZSh3ID0+IHcuaWQgPT09IHBlcnNpc3RlbnRXaWRnZXRJZClcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBsb2dnZXIubG9nKGBQZXJzaXN0ZW50IHdpZGdldCAke3BlcnNpc3RlbnRXaWRnZXRJZH0gcmVtb3ZlZCBmcm9tIHJvb20gJHtyb29tLnJvb21JZH06IGRlc3Ryb3lpbmcuYCk7XG4gICAgICAgICAgICBBY3RpdmVXaWRnZXRTdG9yZS5pbnN0YW5jZS5kZXN0cm95UGVyc2lzdGVudFdpZGdldChwZXJzaXN0ZW50V2lkZ2V0SWQsIHJvb20ucm9vbUlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZW1pdChyb29tLnJvb21JZCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblJvb20gPSAocm9vbTogUm9vbSkgPT4ge1xuICAgICAgICB0aGlzLmluaXRSb29tKHJvb20ucm9vbUlkKTtcbiAgICAgICAgdGhpcy5sb2FkUm9vbVdpZGdldHMocm9vbSk7XG4gICAgICAgIHRoaXMuZW1pdChVUERBVEVfRVZFTlQsIHJvb20ucm9vbUlkKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblJvb21TdGF0ZUV2ZW50cyA9IChldjogTWF0cml4RXZlbnQpID0+IHtcbiAgICAgICAgaWYgKGV2LmdldFR5cGUoKSAhPT0gXCJpbS52ZWN0b3IubW9kdWxhci53aWRnZXRzXCIpIHJldHVybjsgLy8gVE9ETzogU3VwcG9ydCBtLndpZGdldCB0b29cbiAgICAgICAgY29uc3Qgcm9vbUlkID0gZXYuZ2V0Um9vbUlkKCk7XG4gICAgICAgIHRoaXMuaW5pdFJvb20ocm9vbUlkKTtcbiAgICAgICAgdGhpcy5sb2FkUm9vbVdpZGdldHModGhpcy5tYXRyaXhDbGllbnQuZ2V0Um9vbShyb29tSWQpKTtcbiAgICAgICAgdGhpcy5lbWl0KFVQREFURV9FVkVOVCwgcm9vbUlkKTtcbiAgICB9O1xuXG4gICAgcHVibGljIGdldFJvb20gPSAocm9vbUlkOiBzdHJpbmcsIGluaXRJZk5lZWRlZCA9IGZhbHNlKSA9PiB7XG4gICAgICAgIGlmIChpbml0SWZOZWVkZWQpIHRoaXMuaW5pdFJvb20ocm9vbUlkKTsgLy8gaW50ZXJuYWxseSBoYW5kbGVzIFwiaWYgbmVlZGVkXCJcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vbU1hcC5nZXQocm9vbUlkKTtcbiAgICB9O1xuXG4gICAgcHVibGljIGdldEFwcHMocm9vbUlkOiBzdHJpbmcpOiBJQXBwW10ge1xuICAgICAgICBjb25zdCByb29tSW5mbyA9IHRoaXMuZ2V0Um9vbShyb29tSWQpO1xuICAgICAgICByZXR1cm4gcm9vbUluZm8/LndpZGdldHMgfHwgW107XG4gICAgfVxuXG4gICAgcHVibGljIGRvZXNSb29tSGF2ZUNvbmZlcmVuY2Uocm9vbTogUm9vbSk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCByb29tSW5mbyA9IHRoaXMuZ2V0Um9vbShyb29tLnJvb21JZCk7XG4gICAgICAgIGlmICghcm9vbUluZm8pIHJldHVybiBmYWxzZTtcblxuICAgICAgICBjb25zdCBjdXJyZW50V2lkZ2V0cyA9IHJvb21JbmZvLndpZGdldHMuZmlsdGVyKHcgPT4gV2lkZ2V0VHlwZS5KSVRTSS5tYXRjaGVzKHcudHlwZSkpO1xuICAgICAgICBjb25zdCBoYXNQZW5kaW5nV2lkZ2V0cyA9IFdpZGdldEVjaG9TdG9yZS5yb29tSGFzUGVuZGluZ1dpZGdldHNPZlR5cGUocm9vbS5yb29tSWQsIFtdLCBXaWRnZXRUeXBlLkpJVFNJKTtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRXaWRnZXRzLmxlbmd0aCA+IDAgfHwgaGFzUGVuZGluZ1dpZGdldHM7XG4gICAgfVxuXG4gICAgcHVibGljIGlzSm9pbmVkVG9Db25mZXJlbmNlSW4ocm9vbTogUm9vbSk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCByb29tSW5mbyA9IHRoaXMuZ2V0Um9vbShyb29tLnJvb21JZCk7XG4gICAgICAgIGlmICghcm9vbUluZm8pIHJldHVybiBmYWxzZTtcblxuICAgICAgICAvLyBBIHBlcnNpc3RlbnQgY29uZmVyZW5jZSB3aWRnZXQgaW5kaWNhdGVzIHRoYXQgd2UncmUgcGFydGljaXBhdGluZ1xuICAgICAgICBjb25zdCB3aWRnZXRzID0gcm9vbUluZm8ud2lkZ2V0cy5maWx0ZXIodyA9PiBXaWRnZXRUeXBlLkpJVFNJLm1hdGNoZXMody50eXBlKSk7XG4gICAgICAgIHJldHVybiB3aWRnZXRzLnNvbWUodyA9PiBBY3RpdmVXaWRnZXRTdG9yZS5pbnN0YW5jZS5nZXRXaWRnZXRQZXJzaXN0ZW5jZSh3LmlkLCByb29tLnJvb21JZCkpO1xuICAgIH1cbn1cblxud2luZG93Lm14V2lkZ2V0U3RvcmUgPSBXaWRnZXRTdG9yZS5pbnN0YW5jZTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFtQkE7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQStCQTtBQUNBO0FBQ2UsTUFBTUEsV0FBTixTQUEwQkMsMENBQTFCLENBQXVEO0VBT3JCO0VBQ007RUFFM0NDLFdBQVcsR0FBRztJQUFBOztJQUNsQixNQUFNQyxtQkFBTixFQUF5QixFQUF6QixDQURrQjtJQUFBO0lBQUEsaURBSEYsSUFBSUMsR0FBSixFQUdFO0lBQUEsK0NBRkosSUFBSUEsR0FBSixFQUVJO0lBQUEsK0RBd0NZLENBQUNDLE1BQUQsRUFBaUJDLFFBQWpCLEtBQXNDO01BQ3BFLEtBQUtDLFFBQUwsQ0FBY0YsTUFBZDtNQUNBLEtBQUtHLGVBQUwsQ0FBcUIsS0FBS0MsWUFBTCxDQUFrQkMsT0FBbEIsQ0FBMEJMLE1BQTFCLENBQXJCO01BQ0EsS0FBS00sSUFBTCxDQUFVQyx3QkFBVixFQUF3QlAsTUFBeEI7SUFDSCxDQTVDcUI7SUFBQSw4Q0FvR0pRLElBQUQsSUFBZ0I7TUFDN0IsS0FBS04sUUFBTCxDQUFjTSxJQUFJLENBQUNSLE1BQW5CO01BQ0EsS0FBS0csZUFBTCxDQUFxQkssSUFBckI7TUFDQSxLQUFLRixJQUFMLENBQVVDLHdCQUFWLEVBQXdCQyxJQUFJLENBQUNSLE1BQTdCO0lBQ0gsQ0F4R3FCO0lBQUEseURBMEdP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
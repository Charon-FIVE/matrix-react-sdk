"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.UI_EVENTS = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _events = _interopRequireDefault(require("events"));

/*
Copyright 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
let UI_EVENTS;
exports.UI_EVENTS = UI_EVENTS;

(function (UI_EVENTS) {
  UI_EVENTS["Resize"] = "resize";
})(UI_EVENTS || (exports.UI_EVENTS = UI_EVENTS = {}));

class UIStore extends _events.default {
  constructor() {
    super(); // eslint-disable-next-line no-restricted-properties

    (0, _defineProperty2.default)(this, "resizeObserver", void 0);
    (0, _defineProperty2.default)(this, "uiElementDimensions", new Map());
    (0, _defineProperty2.default)(this, "trackedUiElements", new Map());
    (0, _defineProperty2.default)(this, "windowWidth", void 0);
    (0, _defineProperty2.default)(this, "windowHeight", void 0);
    (0, _defineProperty2.default)(this, "resizeObserverCallback", entries => {
      const windowEntry = entries.find(entry => entry.target === document.body);

      if (windowEntry) {
        this.windowWidth = windowEntry.contentRect.width;
        this.windowHeight = windowEntry.contentRect.height;
      }

      entries.forEach(entry => {
        const trackedElementName = this.trackedUiElements.get(entry.target);

        if (trackedElementName) {
          this.uiElementDimensions.set(trackedElementName, entry.contentRect);
          this.emit(trackedElementName, UI_EVENTS.Resize, entry);
        }
      });
      this.emit(UI_EVENTS.Resize, entries);
    });
    this.windowWidth = window.innerWidth; // eslint-disable-next-line no-restricted-properties

    this.windowHeight = window.innerHeight;
    this.resizeObserver = new ResizeObserver(this.resizeObserverCallback);
    this.resizeObserver.observe(document.body);
  }

  static get instance() {
    if (!UIStore._instance) {
      UIStore._instance = new UIStore();
    }

    return UIStore._instance;
  }

  static destroy() {
    if (UIStore._instance) {
      UIStore._instance.resizeObserver.disconnect();

      UIStore._instance.removeAllListeners();

      UIStore._instance = null;
    }
  }

  getElementDimensions(name) {
    return this.uiElementDimensions.get(name);
  }

  trackElementDimensions(name, element) {
    this.trackedUiElements.set(element, name);
    this.resizeObserver.observe(element);
  }

  stopTrackingElementDimensions(name) {
    let trackedElement;
    this.trackedUiElements.forEach((trackedElementName, element) => {
      if (trackedElementName === name) {
        trackedElement = element;
      }
    });

    if (trackedElement) {
      this.resizeObserver.unobserve(trackedElement);
      this.uiElementDimensions.delete(name);
      this.trackedUiElements.delete(trackedElement);
    }
  }

  isTrackingElementDimensions(name) {
    return this.uiElementDimensions.has(name);
  }

}

exports.default = UIStore;
(0, _defineProperty2.default)(UIStore, "_instance", null);
window.mxUIStore = UIStore.instance;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVSV9FVkVOVFMiLCJVSVN0b3JlIiwiRXZlbnRFbWl0dGVyIiwiY29uc3RydWN0b3IiLCJNYXAiLCJlbnRyaWVzIiwid2luZG93RW50cnkiLCJmaW5kIiwiZW50cnkiLCJ0YXJnZXQiLCJkb2N1bWVudCIsImJvZHkiLCJ3aW5kb3dXaWR0aCIsImNvbnRlbnRSZWN0Iiwid2lkdGgiLCJ3aW5kb3dIZWlnaHQiLCJoZWlnaHQiLCJmb3JFYWNoIiwidHJhY2tlZEVsZW1lbnROYW1lIiwidHJhY2tlZFVpRWxlbWVudHMiLCJnZXQiLCJ1aUVsZW1lbnREaW1lbnNpb25zIiwic2V0IiwiZW1pdCIsIlJlc2l6ZSIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsInJlc2l6ZU9ic2VydmVyIiwiUmVzaXplT2JzZXJ2ZXIiLCJyZXNpemVPYnNlcnZlckNhbGxiYWNrIiwib2JzZXJ2ZSIsImluc3RhbmNlIiwiX2luc3RhbmNlIiwiZGVzdHJveSIsImRpc2Nvbm5lY3QiLCJyZW1vdmVBbGxMaXN0ZW5lcnMiLCJnZXRFbGVtZW50RGltZW5zaW9ucyIsIm5hbWUiLCJ0cmFja0VsZW1lbnREaW1lbnNpb25zIiwiZWxlbWVudCIsInN0b3BUcmFja2luZ0VsZW1lbnREaW1lbnNpb25zIiwidHJhY2tlZEVsZW1lbnQiLCJ1bm9ic2VydmUiLCJkZWxldGUiLCJpc1RyYWNraW5nRWxlbWVudERpbWVuc2lvbnMiLCJoYXMiLCJteFVJU3RvcmUiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvc3RvcmVzL1VJU3RvcmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IEV2ZW50RW1pdHRlciBmcm9tIFwiZXZlbnRzXCI7XG5cbmV4cG9ydCBlbnVtIFVJX0VWRU5UUyB7XG4gICAgUmVzaXplID0gXCJyZXNpemVcIlxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBVSVN0b3JlIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgICBwcml2YXRlIHN0YXRpYyBfaW5zdGFuY2U6IFVJU3RvcmUgPSBudWxsO1xuXG4gICAgcHJpdmF0ZSByZXNpemVPYnNlcnZlcjogUmVzaXplT2JzZXJ2ZXI7XG5cbiAgICBwcml2YXRlIHVpRWxlbWVudERpbWVuc2lvbnMgPSBuZXcgTWFwPHN0cmluZywgRE9NUmVjdFJlYWRPbmx5PigpO1xuICAgIHByaXZhdGUgdHJhY2tlZFVpRWxlbWVudHMgPSBuZXcgTWFwPEVsZW1lbnQsIHN0cmluZz4oKTtcblxuICAgIHB1YmxpYyB3aW5kb3dXaWR0aDogbnVtYmVyO1xuICAgIHB1YmxpYyB3aW5kb3dIZWlnaHQ6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXByb3BlcnRpZXNcbiAgICAgICAgdGhpcy53aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1wcm9wZXJ0aWVzXG4gICAgICAgIHRoaXMud2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuXG4gICAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIodGhpcy5yZXNpemVPYnNlcnZlckNhbGxiYWNrKTtcbiAgICAgICAgdGhpcy5yZXNpemVPYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0IGluc3RhbmNlKCk6IFVJU3RvcmUge1xuICAgICAgICBpZiAoIVVJU3RvcmUuX2luc3RhbmNlKSB7XG4gICAgICAgICAgICBVSVN0b3JlLl9pbnN0YW5jZSA9IG5ldyBVSVN0b3JlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFVJU3RvcmUuX2luc3RhbmNlO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKFVJU3RvcmUuX2luc3RhbmNlKSB7XG4gICAgICAgICAgICBVSVN0b3JlLl9pbnN0YW5jZS5yZXNpemVPYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICBVSVN0b3JlLl9pbnN0YW5jZS5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgICAgICAgICAgIFVJU3RvcmUuX2luc3RhbmNlID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBnZXRFbGVtZW50RGltZW5zaW9ucyhuYW1lOiBzdHJpbmcpOiBET01SZWN0UmVhZE9ubHkge1xuICAgICAgICByZXR1cm4gdGhpcy51aUVsZW1lbnREaW1lbnNpb25zLmdldChuYW1lKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdHJhY2tFbGVtZW50RGltZW5zaW9ucyhuYW1lOiBzdHJpbmcsIGVsZW1lbnQ6IEVsZW1lbnQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50cmFja2VkVWlFbGVtZW50cy5zZXQoZWxlbWVudCwgbmFtZSk7XG4gICAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZShlbGVtZW50KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RvcFRyYWNraW5nRWxlbWVudERpbWVuc2lvbnMobmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGxldCB0cmFja2VkRWxlbWVudDogRWxlbWVudDtcbiAgICAgICAgdGhpcy50cmFja2VkVWlFbGVtZW50cy5mb3JFYWNoKCh0cmFja2VkRWxlbWVudE5hbWUsIGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGlmICh0cmFja2VkRWxlbWVudE5hbWUgPT09IG5hbWUpIHtcbiAgICAgICAgICAgICAgICB0cmFja2VkRWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodHJhY2tlZEVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIudW5vYnNlcnZlKHRyYWNrZWRFbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMudWlFbGVtZW50RGltZW5zaW9ucy5kZWxldGUobmFtZSk7XG4gICAgICAgICAgICB0aGlzLnRyYWNrZWRVaUVsZW1lbnRzLmRlbGV0ZSh0cmFja2VkRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgaXNUcmFja2luZ0VsZW1lbnREaW1lbnNpb25zKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy51aUVsZW1lbnREaW1lbnNpb25zLmhhcyhuYW1lKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlc2l6ZU9ic2VydmVyQ2FsbGJhY2sgPSAoZW50cmllczogUmVzaXplT2JzZXJ2ZXJFbnRyeVtdKSA9PiB7XG4gICAgICAgIGNvbnN0IHdpbmRvd0VudHJ5ID0gZW50cmllcy5maW5kKGVudHJ5ID0+IGVudHJ5LnRhcmdldCA9PT0gZG9jdW1lbnQuYm9keSk7XG5cbiAgICAgICAgaWYgKHdpbmRvd0VudHJ5KSB7XG4gICAgICAgICAgICB0aGlzLndpbmRvd1dpZHRoID0gd2luZG93RW50cnkuY29udGVudFJlY3Qud2lkdGg7XG4gICAgICAgICAgICB0aGlzLndpbmRvd0hlaWdodCA9IHdpbmRvd0VudHJ5LmNvbnRlbnRSZWN0LmhlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICAgIGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0cmFja2VkRWxlbWVudE5hbWUgPSB0aGlzLnRyYWNrZWRVaUVsZW1lbnRzLmdldChlbnRyeS50YXJnZXQpO1xuICAgICAgICAgICAgaWYgKHRyYWNrZWRFbGVtZW50TmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudWlFbGVtZW50RGltZW5zaW9ucy5zZXQodHJhY2tlZEVsZW1lbnROYW1lLCBlbnRyeS5jb250ZW50UmVjdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KHRyYWNrZWRFbGVtZW50TmFtZSwgVUlfRVZFTlRTLlJlc2l6ZSwgZW50cnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmVtaXQoVUlfRVZFTlRTLlJlc2l6ZSwgZW50cmllcyk7XG4gICAgfTtcbn1cblxud2luZG93Lm14VUlTdG9yZSA9IFVJU3RvcmUuaW5zdGFuY2U7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBZ0JBOztBQWhCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7SUFJWUEsUzs7O1dBQUFBLFM7RUFBQUEsUztHQUFBQSxTLHlCQUFBQSxTOztBQUlHLE1BQU1DLE9BQU4s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
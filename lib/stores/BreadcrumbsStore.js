"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.BreadcrumbsStore = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _room = require("matrix-js-sdk/src/models/room");

var _utils = require("matrix-js-sdk/src/utils");

var _client = require("matrix-js-sdk/src/client");

var _SettingsStore = _interopRequireDefault(require("../settings/SettingsStore"));

var _AsyncStoreWithClient = require("./AsyncStoreWithClient");

var _dispatcher = _interopRequireDefault(require("../dispatcher/dispatcher"));

var _arrays = require("../utils/arrays");

var _SettingLevel = require("../settings/SettingLevel");

var _actions = require("../dispatcher/actions");

/*
Copyright 2020 - 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const MAX_ROOMS = 20; // arbitrary

const AUTOJOIN_WAIT_THRESHOLD_MS = 90000; // 90s, the time we wait for an autojoined room to show up

class BreadcrumbsStore extends _AsyncStoreWithClient.AsyncStoreWithClient {
  constructor() {
    super(_dispatcher.default);
    (0, _defineProperty2.default)(this, "waitingRooms", []);
    (0, _defineProperty2.default)(this, "onMyMembership", async room => {
      // Only turn on breadcrumbs is the user hasn't explicitly turned it off again.
      const settingValueRaw = _SettingsStore.default.getValue("breadcrumbs", null,
      /*excludeDefault=*/
      true);

      if (this.meetsRoomRequirement && (0, _utils.isNullOrUndefined)(settingValueRaw)) {
        await _SettingsStore.default.setValue("breadcrumbs", null, _SettingLevel.SettingLevel.ACCOUNT, true);
      }
    });
    (0, _defineProperty2.default)(this, "onRoom", async room => {
      const waitingRoom = this.waitingRooms.find(r => r.roomId === room.roomId);
      if (!waitingRoom) return;
      this.waitingRooms.splice(this.waitingRooms.indexOf(waitingRoom), 1);
      if (Date.now() - waitingRoom.addedTs > AUTOJOIN_WAIT_THRESHOLD_MS) return; // Too long ago.

      await this.appendRoom(room);
    });

    _SettingsStore.default.monitorSetting("breadcrumb_rooms", null);

    _SettingsStore.default.monitorSetting("breadcrumbs", null);

    _SettingsStore.default.monitorSetting("feature_breadcrumbs_v2", null);
  }

  static get instance() {
    return BreadcrumbsStore.internalInstance;
  }

  get rooms() {
    return this.state.rooms || [];
  }

  get visible() {
    return this.state.enabled && this.meetsRoomRequirement;
  }

  get meetsRoomRequirement() {
    if (_SettingsStore.default.getValue("feature_breadcrumbs_v2")) return true;
    return this.matrixClient?.getVisibleRooms().length >= 20;
  }

  async onAction(payload) {
    if (!this.matrixClient) return;

    if (payload.action === _actions.Action.SettingUpdated) {
      if (payload.settingName === 'breadcrumb_rooms') {
        await this.updateRooms();
      } else if (payload.settingName === 'breadcrumbs' || payload.settingName === 'feature_breadcrumbs_v2') {
        await this.updateState({
          enabled: _SettingsStore.default.getValue("breadcrumbs", null)
        });
      }
    } else if (payload.action === _actions.Action.ViewRoom) {
      if (payload.auto_join && !this.matrixClient.getRoom(payload.room_id)) {
        // Queue the room instead of pushing it immediately. We're probably just
        // waiting for a room join to complete.
        this.waitingRooms.push({
          roomId: payload.room_id,
          addedTs: Date.now()
        });
      } else {
        // The tests might not result in a valid room object.
        const room = this.matrixClient.getRoom(payload.room_id);
        const membership = room?.getMyMembership();
        if (room && membership === "join") await this.appendRoom(room);
      }
    } else if (payload.action === _actions.Action.JoinRoom) {
      const room = this.matrixClient.getRoom(payload.roomId);
      if (room) await this.appendRoom(room);
    }
  }

  async onReady() {
    await this.updateRooms();
    await this.updateState({
      enabled: _SettingsStore.default.getValue("breadcrumbs", null)
    });
    this.matrixClient.on(_room.RoomEvent.MyMembership, this.onMyMembership);
    this.matrixClient.on(_client.ClientEvent.Room, this.onRoom);
  }

  async onNotReady() {
    this.matrixClient.removeListener(_room.RoomEvent.MyMembership, this.onMyMembership);
    this.matrixClient.removeListener(_client.ClientEvent.Room, this.onRoom);
  }

  async updateRooms() {
    let roomIds = _SettingsStore.default.getValue("breadcrumb_rooms");

    if (!roomIds || roomIds.length === 0) roomIds = [];
    const rooms = roomIds.map(r => this.matrixClient.getRoom(r)).filter(r => !!r);
    const currentRooms = this.state.rooms || [];
    if (!(0, _arrays.arrayHasDiff)(rooms, currentRooms)) return; // no change (probably echo)

    await this.updateState({
      rooms
    });
  }

  async appendRoom(room) {
    let updated = false;
    const rooms = (this.state.rooms || []).slice(); // cheap clone
    // If the room is upgraded, use that room instead. We'll also splice out
    // any children of the room.

    const history = this.matrixClient.getRoomUpgradeHistory(room.roomId);

    if (history.length > 1) {
      room = history[history.length - 1]; // Last room is most recent in history
      // Take out any room that isn't the most recent room

      for (let i = 0; i < history.length - 1; i++) {
        const idx = rooms.findIndex(r => r.roomId === history[i].roomId);

        if (idx !== -1) {
          rooms.splice(idx, 1);
          updated = true;
        }
      }
    } // Remove the existing room, if it is present


    const existingIdx = rooms.findIndex(r => r.roomId === room.roomId); // If we're focusing on the first room no-op

    if (existingIdx !== 0) {
      if (existingIdx !== -1) {
        rooms.splice(existingIdx, 1);
      } // Splice the room to the start of the list


      rooms.splice(0, 0, room);
      updated = true;
    }

    if (rooms.length > MAX_ROOMS) {
      // This looks weird, but it's saying to start at the MAX_ROOMS point in the
      // list and delete everything after it.
      rooms.splice(MAX_ROOMS, rooms.length - MAX_ROOMS);
      updated = true;
    }

    if (updated) {
      // Update the breadcrumbs
      await this.updateState({
        rooms
      });
      const roomIds = rooms.map(r => r.roomId);

      if (roomIds.length > 0) {
        await _SettingsStore.default.setValue("breadcrumb_rooms", null, _SettingLevel.SettingLevel.ACCOUNT, roomIds);
      }
    }
  }

}

exports.BreadcrumbsStore = BreadcrumbsStore;
(0, _defineProperty2.default)(BreadcrumbsStore, "internalInstance", (() => {
  const instance = new BreadcrumbsStore();
  instance.start();
  return instance;
})());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNQVhfUk9PTVMiLCJBVVRPSk9JTl9XQUlUX1RIUkVTSE9MRF9NUyIsIkJyZWFkY3J1bWJzU3RvcmUiLCJBc3luY1N0b3JlV2l0aENsaWVudCIsImNvbnN0cnVjdG9yIiwiZGVmYXVsdERpc3BhdGNoZXIiLCJyb29tIiwic2V0dGluZ1ZhbHVlUmF3IiwiU2V0dGluZ3NTdG9yZSIsImdldFZhbHVlIiwibWVldHNSb29tUmVxdWlyZW1lbnQiLCJpc051bGxPclVuZGVmaW5lZCIsInNldFZhbHVlIiwiU2V0dGluZ0xldmVsIiwiQUNDT1VOVCIsIndhaXRpbmdSb29tIiwid2FpdGluZ1Jvb21zIiwiZmluZCIsInIiLCJyb29tSWQiLCJzcGxpY2UiLCJpbmRleE9mIiwiRGF0ZSIsIm5vdyIsImFkZGVkVHMiLCJhcHBlbmRSb29tIiwibW9uaXRvclNldHRpbmciLCJpbnN0YW5jZSIsImludGVybmFsSW5zdGFuY2UiLCJyb29tcyIsInN0YXRlIiwidmlzaWJsZSIsImVuYWJsZWQiLCJtYXRyaXhDbGllbnQiLCJnZXRWaXNpYmxlUm9vbXMiLCJsZW5ndGgiLCJvbkFjdGlvbiIsInBheWxvYWQiLCJhY3Rpb24iLCJBY3Rpb24iLCJTZXR0aW5nVXBkYXRlZCIsInNldHRpbmdOYW1lIiwidXBkYXRlUm9vbXMiLCJ1cGRhdGVTdGF0ZSIsIlZpZXdSb29tIiwiYXV0b19qb2luIiwiZ2V0Um9vbSIsInJvb21faWQiLCJwdXNoIiwibWVtYmVyc2hpcCIsImdldE15TWVtYmVyc2hpcCIsIkpvaW5Sb29tIiwib25SZWFkeSIsIm9uIiwiUm9vbUV2ZW50IiwiTXlNZW1iZXJzaGlwIiwib25NeU1lbWJlcnNoaXAiLCJDbGllbnRFdmVudCIsIlJvb20iLCJvblJvb20iLCJvbk5vdFJlYWR5IiwicmVtb3ZlTGlzdGVuZXIiLCJyb29tSWRzIiwibWFwIiwiZmlsdGVyIiwiY3VycmVudFJvb21zIiwiYXJyYXlIYXNEaWZmIiwidXBkYXRlZCIsInNsaWNlIiwiaGlzdG9yeSIsImdldFJvb21VcGdyYWRlSGlzdG9yeSIsImkiLCJpZHgiLCJmaW5kSW5kZXgiLCJleGlzdGluZ0lkeCIsInN0YXJ0Il0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL3N0b3Jlcy9CcmVhZGNydW1ic1N0b3JlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAyMCAtIDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgeyBSb29tLCBSb29tRXZlbnQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb21cIjtcbmltcG9ydCB7IGlzTnVsbE9yVW5kZWZpbmVkIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL3V0aWxzXCI7XG5pbXBvcnQgeyBDbGllbnRFdmVudCB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9jbGllbnRcIjtcblxuaW1wb3J0IFNldHRpbmdzU3RvcmUgZnJvbSBcIi4uL3NldHRpbmdzL1NldHRpbmdzU3RvcmVcIjtcbmltcG9ydCB7IEFzeW5jU3RvcmVXaXRoQ2xpZW50IH0gZnJvbSBcIi4vQXN5bmNTdG9yZVdpdGhDbGllbnRcIjtcbmltcG9ydCBkZWZhdWx0RGlzcGF0Y2hlciBmcm9tIFwiLi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyXCI7XG5pbXBvcnQgeyBhcnJheUhhc0RpZmYgfSBmcm9tIFwiLi4vdXRpbHMvYXJyYXlzXCI7XG5pbXBvcnQgeyBTZXR0aW5nTGV2ZWwgfSBmcm9tIFwiLi4vc2V0dGluZ3MvU2V0dGluZ0xldmVsXCI7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tIFwiLi4vZGlzcGF0Y2hlci9hY3Rpb25zXCI7XG5pbXBvcnQgeyBTZXR0aW5nVXBkYXRlZFBheWxvYWQgfSBmcm9tIFwiLi4vZGlzcGF0Y2hlci9wYXlsb2Fkcy9TZXR0aW5nVXBkYXRlZFBheWxvYWRcIjtcbmltcG9ydCB7IFZpZXdSb29tUGF5bG9hZCB9IGZyb20gXCIuLi9kaXNwYXRjaGVyL3BheWxvYWRzL1ZpZXdSb29tUGF5bG9hZFwiO1xuaW1wb3J0IHsgSm9pblJvb21QYXlsb2FkIH0gZnJvbSBcIi4uL2Rpc3BhdGNoZXIvcGF5bG9hZHMvSm9pblJvb21QYXlsb2FkXCI7XG5cbmNvbnN0IE1BWF9ST09NUyA9IDIwOyAvLyBhcmJpdHJhcnlcbmNvbnN0IEFVVE9KT0lOX1dBSVRfVEhSRVNIT0xEX01TID0gOTAwMDA7IC8vIDkwcywgdGhlIHRpbWUgd2Ugd2FpdCBmb3IgYW4gYXV0b2pvaW5lZCByb29tIHRvIHNob3cgdXBcblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgZW5hYmxlZD86IGJvb2xlYW47XG4gICAgcm9vbXM/OiBSb29tW107XG59XG5cbmV4cG9ydCBjbGFzcyBCcmVhZGNydW1ic1N0b3JlIGV4dGVuZHMgQXN5bmNTdG9yZVdpdGhDbGllbnQ8SVN0YXRlPiB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgaW50ZXJuYWxJbnN0YW5jZSA9ICgoKSA9PiB7XG4gICAgICAgIGNvbnN0IGluc3RhbmNlID0gbmV3IEJyZWFkY3J1bWJzU3RvcmUoKTtcbiAgICAgICAgaW5zdGFuY2Uuc3RhcnQoKTtcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xuICAgIH0pKCk7XG5cbiAgICBwcml2YXRlIHdhaXRpbmdSb29tczogeyByb29tSWQ6IHN0cmluZywgYWRkZWRUczogbnVtYmVyIH1bXSA9IFtdO1xuXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoZGVmYXVsdERpc3BhdGNoZXIpO1xuXG4gICAgICAgIFNldHRpbmdzU3RvcmUubW9uaXRvclNldHRpbmcoXCJicmVhZGNydW1iX3Jvb21zXCIsIG51bGwpO1xuICAgICAgICBTZXR0aW5nc1N0b3JlLm1vbml0b3JTZXR0aW5nKFwiYnJlYWRjcnVtYnNcIiwgbnVsbCk7XG4gICAgICAgIFNldHRpbmdzU3RvcmUubW9uaXRvclNldHRpbmcoXCJmZWF0dXJlX2JyZWFkY3J1bWJzX3YyXCIsIG51bGwpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0IGluc3RhbmNlKCk6IEJyZWFkY3J1bWJzU3RvcmUge1xuICAgICAgICByZXR1cm4gQnJlYWRjcnVtYnNTdG9yZS5pbnRlcm5hbEluc3RhbmNlO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgcm9vbXMoKTogUm9vbVtdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUucm9vbXMgfHwgW107XG4gICAgfVxuXG4gICAgcHVibGljIGdldCB2aXNpYmxlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5lbmFibGVkICYmIHRoaXMubWVldHNSb29tUmVxdWlyZW1lbnQ7XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBtZWV0c1Jvb21SZXF1aXJlbWVudCgpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJmZWF0dXJlX2JyZWFkY3J1bWJzX3YyXCIpKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4Q2xpZW50Py5nZXRWaXNpYmxlUm9vbXMoKS5sZW5ndGggPj0gMjA7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFzeW5jIG9uQWN0aW9uKHBheWxvYWQ6IFNldHRpbmdVcGRhdGVkUGF5bG9hZCB8IFZpZXdSb29tUGF5bG9hZCB8IEpvaW5Sb29tUGF5bG9hZCkge1xuICAgICAgICBpZiAoIXRoaXMubWF0cml4Q2xpZW50KSByZXR1cm47XG4gICAgICAgIGlmIChwYXlsb2FkLmFjdGlvbiA9PT0gQWN0aW9uLlNldHRpbmdVcGRhdGVkKSB7XG4gICAgICAgICAgICBpZiAocGF5bG9hZC5zZXR0aW5nTmFtZSA9PT0gJ2JyZWFkY3J1bWJfcm9vbXMnKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVSb29tcygpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXlsb2FkLnNldHRpbmdOYW1lID09PSAnYnJlYWRjcnVtYnMnIHx8XG4gICAgICAgICAgICAgICAgcGF5bG9hZC5zZXR0aW5nTmFtZSA9PT0gJ2ZlYXR1cmVfYnJlYWRjcnVtYnNfdjInXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZVN0YXRlKHsgZW5hYmxlZDogU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcImJyZWFkY3J1bWJzXCIsIG51bGwpIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHBheWxvYWQuYWN0aW9uID09PSBBY3Rpb24uVmlld1Jvb20pIHtcbiAgICAgICAgICAgIGlmIChwYXlsb2FkLmF1dG9fam9pbiAmJiAhdGhpcy5tYXRyaXhDbGllbnQuZ2V0Um9vbShwYXlsb2FkLnJvb21faWQpKSB7XG4gICAgICAgICAgICAgICAgLy8gUXVldWUgdGhlIHJvb20gaW5zdGVhZCBvZiBwdXNoaW5nIGl0IGltbWVkaWF0ZWx5LiBXZSdyZSBwcm9iYWJseSBqdXN0XG4gICAgICAgICAgICAgICAgLy8gd2FpdGluZyBmb3IgYSByb29tIGpvaW4gdG8gY29tcGxldGUuXG4gICAgICAgICAgICAgICAgdGhpcy53YWl0aW5nUm9vbXMucHVzaCh7IHJvb21JZDogcGF5bG9hZC5yb29tX2lkLCBhZGRlZFRzOiBEYXRlLm5vdygpIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgdGVzdHMgbWlnaHQgbm90IHJlc3VsdCBpbiBhIHZhbGlkIHJvb20gb2JqZWN0LlxuICAgICAgICAgICAgICAgIGNvbnN0IHJvb20gPSB0aGlzLm1hdHJpeENsaWVudC5nZXRSb29tKHBheWxvYWQucm9vbV9pZCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbWVtYmVyc2hpcCA9IHJvb20/LmdldE15TWVtYmVyc2hpcCgpO1xuICAgICAgICAgICAgICAgIGlmIChyb29tICYmIG1lbWJlcnNoaXA9PT1cImpvaW5cIikgYXdhaXQgdGhpcy5hcHBlbmRSb29tKHJvb20pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHBheWxvYWQuYWN0aW9uID09PSBBY3Rpb24uSm9pblJvb20pIHtcbiAgICAgICAgICAgIGNvbnN0IHJvb20gPSB0aGlzLm1hdHJpeENsaWVudC5nZXRSb29tKHBheWxvYWQucm9vbUlkKTtcbiAgICAgICAgICAgIGlmIChyb29tKSBhd2FpdCB0aGlzLmFwcGVuZFJvb20ocm9vbSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYXN5bmMgb25SZWFkeSgpIHtcbiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVSb29tcygpO1xuICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZVN0YXRlKHsgZW5hYmxlZDogU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcImJyZWFkY3J1bWJzXCIsIG51bGwpIH0pO1xuXG4gICAgICAgIHRoaXMubWF0cml4Q2xpZW50Lm9uKFJvb21FdmVudC5NeU1lbWJlcnNoaXAsIHRoaXMub25NeU1lbWJlcnNoaXApO1xuICAgICAgICB0aGlzLm1hdHJpeENsaWVudC5vbihDbGllbnRFdmVudC5Sb29tLCB0aGlzLm9uUm9vbSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFzeW5jIG9uTm90UmVhZHkoKSB7XG4gICAgICAgIHRoaXMubWF0cml4Q2xpZW50LnJlbW92ZUxpc3RlbmVyKFJvb21FdmVudC5NeU1lbWJlcnNoaXAsIHRoaXMub25NeU1lbWJlcnNoaXApO1xuICAgICAgICB0aGlzLm1hdHJpeENsaWVudC5yZW1vdmVMaXN0ZW5lcihDbGllbnRFdmVudC5Sb29tLCB0aGlzLm9uUm9vbSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbk15TWVtYmVyc2hpcCA9IGFzeW5jIChyb29tOiBSb29tKSA9PiB7XG4gICAgICAgIC8vIE9ubHkgdHVybiBvbiBicmVhZGNydW1icyBpcyB0aGUgdXNlciBoYXNuJ3QgZXhwbGljaXRseSB0dXJuZWQgaXQgb2ZmIGFnYWluLlxuICAgICAgICBjb25zdCBzZXR0aW5nVmFsdWVSYXcgPSBTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFwiYnJlYWRjcnVtYnNcIiwgbnVsbCwgLypleGNsdWRlRGVmYXVsdD0qL3RydWUpO1xuICAgICAgICBpZiAodGhpcy5tZWV0c1Jvb21SZXF1aXJlbWVudCAmJiBpc051bGxPclVuZGVmaW5lZChzZXR0aW5nVmFsdWVSYXcpKSB7XG4gICAgICAgICAgICBhd2FpdCBTZXR0aW5nc1N0b3JlLnNldFZhbHVlKFwiYnJlYWRjcnVtYnNcIiwgbnVsbCwgU2V0dGluZ0xldmVsLkFDQ09VTlQsIHRydWUpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Sb29tID0gYXN5bmMgKHJvb206IFJvb20pID0+IHtcbiAgICAgICAgY29uc3Qgd2FpdGluZ1Jvb20gPSB0aGlzLndhaXRpbmdSb29tcy5maW5kKHIgPT4gci5yb29tSWQgPT09IHJvb20ucm9vbUlkKTtcbiAgICAgICAgaWYgKCF3YWl0aW5nUm9vbSkgcmV0dXJuO1xuICAgICAgICB0aGlzLndhaXRpbmdSb29tcy5zcGxpY2UodGhpcy53YWl0aW5nUm9vbXMuaW5kZXhPZih3YWl0aW5nUm9vbSksIDEpO1xuXG4gICAgICAgIGlmICgoRGF0ZS5ub3coKSAtIHdhaXRpbmdSb29tLmFkZGVkVHMpID4gQVVUT0pPSU5fV0FJVF9USFJFU0hPTERfTVMpIHJldHVybjsgLy8gVG9vIGxvbmcgYWdvLlxuICAgICAgICBhd2FpdCB0aGlzLmFwcGVuZFJvb20ocm9vbSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgYXN5bmMgdXBkYXRlUm9vbXMoKSB7XG4gICAgICAgIGxldCByb29tSWRzID0gU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcImJyZWFkY3J1bWJfcm9vbXNcIik7XG4gICAgICAgIGlmICghcm9vbUlkcyB8fCByb29tSWRzLmxlbmd0aCA9PT0gMCkgcm9vbUlkcyA9IFtdO1xuXG4gICAgICAgIGNvbnN0IHJvb21zID0gcm9vbUlkcy5tYXAociA9PiB0aGlzLm1hdHJpeENsaWVudC5nZXRSb29tKHIpKS5maWx0ZXIociA9PiAhIXIpO1xuICAgICAgICBjb25zdCBjdXJyZW50Um9vbXMgPSB0aGlzLnN0YXRlLnJvb21zIHx8IFtdO1xuICAgICAgICBpZiAoIWFycmF5SGFzRGlmZihyb29tcywgY3VycmVudFJvb21zKSkgcmV0dXJuOyAvLyBubyBjaGFuZ2UgKHByb2JhYmx5IGVjaG8pXG4gICAgICAgIGF3YWl0IHRoaXMudXBkYXRlU3RhdGUoeyByb29tcyB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIGFwcGVuZFJvb20ocm9vbTogUm9vbSkge1xuICAgICAgICBsZXQgdXBkYXRlZCA9IGZhbHNlO1xuICAgICAgICBjb25zdCByb29tcyA9ICh0aGlzLnN0YXRlLnJvb21zIHx8IFtdKS5zbGljZSgpOyAvLyBjaGVhcCBjbG9uZVxuXG4gICAgICAgIC8vIElmIHRoZSByb29tIGlzIHVwZ3JhZGVkLCB1c2UgdGhhdCByb29tIGluc3RlYWQuIFdlJ2xsIGFsc28gc3BsaWNlIG91dFxuICAgICAgICAvLyBhbnkgY2hpbGRyZW4gb2YgdGhlIHJvb20uXG4gICAgICAgIGNvbnN0IGhpc3RvcnkgPSB0aGlzLm1hdHJpeENsaWVudC5nZXRSb29tVXBncmFkZUhpc3Rvcnkocm9vbS5yb29tSWQpO1xuICAgICAgICBpZiAoaGlzdG9yeS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICByb29tID0gaGlzdG9yeVtoaXN0b3J5Lmxlbmd0aCAtIDFdOyAvLyBMYXN0IHJvb20gaXMgbW9zdCByZWNlbnQgaW4gaGlzdG9yeVxuXG4gICAgICAgICAgICAvLyBUYWtlIG91dCBhbnkgcm9vbSB0aGF0IGlzbid0IHRoZSBtb3N0IHJlY2VudCByb29tXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhpc3RvcnkubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaWR4ID0gcm9vbXMuZmluZEluZGV4KHIgPT4gci5yb29tSWQgPT09IGhpc3RvcnlbaV0ucm9vbUlkKTtcbiAgICAgICAgICAgICAgICBpZiAoaWR4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByb29tcy5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmVtb3ZlIHRoZSBleGlzdGluZyByb29tLCBpZiBpdCBpcyBwcmVzZW50XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nSWR4ID0gcm9vbXMuZmluZEluZGV4KHIgPT4gci5yb29tSWQgPT09IHJvb20ucm9vbUlkKTtcblxuICAgICAgICAvLyBJZiB3ZSdyZSBmb2N1c2luZyBvbiB0aGUgZmlyc3Qgcm9vbSBuby1vcFxuICAgICAgICBpZiAoZXhpc3RpbmdJZHggIT09IDApIHtcbiAgICAgICAgICAgIGlmIChleGlzdGluZ0lkeCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICByb29tcy5zcGxpY2UoZXhpc3RpbmdJZHgsIDEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTcGxpY2UgdGhlIHJvb20gdG8gdGhlIHN0YXJ0IG9mIHRoZSBsaXN0XG4gICAgICAgICAgICByb29tcy5zcGxpY2UoMCwgMCwgcm9vbSk7XG4gICAgICAgICAgICB1cGRhdGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyb29tcy5sZW5ndGggPiBNQVhfUk9PTVMpIHtcbiAgICAgICAgICAgIC8vIFRoaXMgbG9va3Mgd2VpcmQsIGJ1dCBpdCdzIHNheWluZyB0byBzdGFydCBhdCB0aGUgTUFYX1JPT01TIHBvaW50IGluIHRoZVxuICAgICAgICAgICAgLy8gbGlzdCBhbmQgZGVsZXRlIGV2ZXJ5dGhpbmcgYWZ0ZXIgaXQuXG4gICAgICAgICAgICByb29tcy5zcGxpY2UoTUFYX1JPT01TLCByb29tcy5sZW5ndGggLSBNQVhfUk9PTVMpO1xuICAgICAgICAgICAgdXBkYXRlZCA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodXBkYXRlZCkge1xuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBicmVhZGNydW1ic1xuICAgICAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVTdGF0ZSh7IHJvb21zIH0pO1xuICAgICAgICAgICAgY29uc3Qgcm9vbUlkcyA9IHJvb21zLm1hcChyID0+IHIucm9vbUlkKTtcbiAgICAgICAgICAgIGlmIChyb29tSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBTZXR0aW5nc1N0b3JlLnNldFZhbHVlKFwiYnJlYWRjcnVtYl9yb29tc1wiLCBudWxsLCBTZXR0aW5nTGV2ZWwuQUNDT1VOVCwgcm9vbUlkcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBZ0JBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQXpCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFnQkEsTUFBTUEsU0FBUyxHQUFHLEVBQWxCLEMsQ0FBc0I7O0FBQ3RCLE1BQU1DLDBCQUEwQixHQUFHLEtBQW5DLEMsQ0FBMEM7O0FBT25DLE1BQU1DLGdCQUFOLFNBQStCQywwQ0FBL0IsQ0FBNEQ7RUFTdkRDLFdBQVcsR0FBRztJQUNsQixNQUFNQyxtQkFBTjtJQURrQixvREFGd0MsRUFFeEM7SUFBQSxzREFpRUcsTUFBT0MsSUFBUCxJQUFzQjtNQUMzQztNQUNBLE1BQU1DLGVBQWUsR0FBR0Msc0JBQUEsQ0FBY0MsUUFBZCxDQUF1QixhQUF2QixFQUFzQyxJQUF0QztNQUE0QztNQUFtQixJQUEvRCxDQUF4Qjs7TUFDQSxJQUFJLEtBQUtDLG9CQUFMLElBQTZCLElBQUFDLHdCQUFBLEVBQWtCSixlQUFsQixDQUFqQyxFQUFxRTtRQUNqRSxNQUFNQyxzQkFBQSxDQUFjSSxRQUFkLENBQXVCLGFBQXZCLEVBQXNDLElBQXRDLEVBQTRDQywwQkFBQSxDQUFhQyxPQUF6RCxFQUFrRSxJQUFsRSxDQUFOO01BQ0g7SUFDSixDQXZFcUI7SUFBQSw4Q0F5RUwsTUFBT1IsSUFBUCxJQUFzQjtNQUNuQyxNQUFNUyxXQUFXLEdBQUcsS0FBS0MsWUFBTCxDQUFrQkMsSUFBbEIsQ0FBdUJDLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxNQUFGLEtBQWFiLElBQUksQ0FBQ2EsTUFBOUMsQ0FBcEI7TUFDQSxJQUFJLENBQUNKLFdBQUwsRUFBa0I7TUFDbEIsS0FBS0MsWUFBTCxDQUFrQkksTUFBbEIsQ0FBeUIsS0FBS0osWUFBTCxDQUFrQkssT0FBbEIsQ0FBMEJOLFdBQTFCLENBQXpCLEVBQWlFLENBQWpFO01BRUEsSUFBS08sSUFBSSxDQUFDQyxHQUFMLEtBQWFSLFdBQVcsQ0FBQ1MsT0FBMUIsR0FBcUN2QiwwQkFBekMsRUFBcUUsT0FMbEMsQ0FLMEM7O01BQzdFLE1BQU0sS0FBS3dCLFVBQUwsQ0FBZ0JuQixJQUFoQixDQUFOO0lBQ0gsQ0FoRnFCOztJQUdsQkUsc0JBQUEsQ0FBY2tCLGNBQWQsQ0FBNkIsa0JBQTdCLEVBQWlELElBQWpEOztJQUNBbEIsc0JBQUEsQ0FBY2tCLGNBQWQsQ0FBNkIsYUFBN0IsRUFBNEMsSUFBNUM7O0lBQ0FsQixzQkFBQSxDQUFja0IsY0FBZCxDQUE2Qix3QkFBN0IsRUFBdUQsSUFBdkQ7RUFDSDs7RUFFeUIsV0FBUkMsUUFBUSxHQUFxQjtJQUMzQyxPQUFPekIsZ0JBQWdCLENBQUMwQixnQkFBeEI7RUFDSDs7RUFFZSxJQUFMQyxLQUFLLEdBQVc7SUFDdkIsT0FBTyxLQUFLQyxLQUFMLENBQVdELEtBQVgsSUFBb0IsRUFBM0I7RUFDSDs7RUFFaUIsSUFBUEUsT0FBTyxHQUFZO0lBQzFCLE9BQU8sS0FBS0QsS0FBTCxDQUFXRSxPQUFYLElBQXNCLEtBQUt0QixvQkFBbEM7RUFDSDs7RUFFOEIsSUFBcEJBLG9CQUFvQixHQUFZO0lBQ3ZDLElBQUlGLHNCQUFBLENBQWNDLFFBQWQsQ0FBdUIsd0JBQXZCLENBQUosRUFBc0QsT0FBTyxJQUFQO0lBQ3RELE9BQU8sS0FBS3dCLFlBQUwsRUFBbUJDLGVBQW5CLEdBQXFDQyxNQUFyQyxJQUErQyxFQUF0RDtFQUNIOztFQUV1QixNQUFSQyxRQUFRLENBQUNDLE9BQUQsRUFBcUU7SUFDekYsSUFBSSxDQUFDLEtBQUtKLFlBQVYsRUFBd0I7O0lBQ3hCLElBQUlJLE9BQU8sQ0FBQ0MsTUFBUixLQUFtQkMsZUFBQSxDQUFPQyxjQUE5QixFQUE4QztNQUMxQyxJQUFJSCxPQUFPLENBQUNJLFdBQVIsS0FBd0Isa0JBQTVCLEVBQWdEO1FBQzVDLE1BQU0sS0FBS0MsV0FBTCxFQUFOO01BQ0gsQ0FGRCxNQUVPLElBQUlMLE9BQU8sQ0FBQ0ksV0FBUixLQUF3QixhQUF4QixJQUNQSixPQUFPLENBQUNJLFdBQVIsS0FBd0Isd0JBRHJCLEVBRUw7UUFDRSxNQUFNLEtBQUtFLFdBQUwsQ0FBaUI7VUFBRVgsT0FBTyxFQUFFeEIsc0JBQUEsQ0FBY0MsUUFBZCxDQUF1QixhQUF2QixFQUFzQyxJQUF0QztRQUFYLENBQWpCLENBQU47TUFDSDtJQUNKLENBUkQsTUFRTyxJQUFJNEIsT0FBTyxDQUFDQyxNQUFSLEtBQW1CQyxlQUFBLENBQU9LLFFBQTlCLEVBQXdDO01BQzNDLElBQUlQLE9BQU8sQ0FBQ1EsU0FBUixJQUFxQixDQUFDLEtBQUtaLFlBQUwsQ0FBa0JhLE9BQWxCLENBQTBCVCxPQUFPLENBQUNVLE9BQWxDLENBQTFCLEVBQXNFO1FBQ2xFO1FBQ0E7UUFDQSxLQUFLL0IsWUFBTCxDQUFrQmdDLElBQWxCLENBQXVCO1VBQUU3QixNQUFNLEVBQUVrQixPQUFPLENBQUNVLE9BQWxCO1VBQTJCdkIsT0FBTyxFQUFFRixJQUFJLENBQUNDLEdBQUw7UUFBcEMsQ0FBdkI7TUFDSCxDQUpELE1BSU87UUFDSDtRQUNBLE1BQU1qQixJQUFJLEdBQUcsS0FBSzJCLFlBQUwsQ0FBa0JhLE9BQWxCLENBQTBCVCxPQUFPLENBQUNVLE9BQWxDLENBQWI7UUFDQSxNQUFNRSxVQUFVLEdBQUczQyxJQUFJLEVBQUU0QyxlQUFOLEVBQW5CO1FBQ0EsSUFBSTVDLElBQUksSUFBSTJDLFVBQVUsS0FBRyxNQUF6QixFQUFpQyxNQUFNLEtBQUt4QixVQUFMLENBQWdCbkIsSUFBaEIsQ0FBTjtNQUNwQztJQUNKLENBWE0sTUFXQSxJQUFJK0IsT0FBTyxDQUFDQyxNQUFSLEtBQW1CQyxlQUFBLENBQU9ZLFFBQTlCLEVBQXdDO01BQzNDLE1BQU03QyxJQUFJLEdBQUcsS0FBSzJCLFlBQUwsQ0FBa0JhLE9BQWxCLENBQTBCVCxPQUFPLENBQUNsQixNQUFsQyxDQUFiO01BQ0EsSUFBSWIsSUFBSixFQUFVLE1BQU0sS0FBS21CLFVBQUwsQ0FBZ0JuQixJQUFoQixDQUFOO0lBQ2I7RUFDSjs7RUFFc0IsTUFBUDhDLE9BQU8sR0FBRztJQUN0QixNQUFNLEtBQUtWLFdBQUwsRUFBTjtJQUNBLE1BQU0sS0FBS0MsV0FBTCxDQUFpQjtNQUFFWCxPQUFPLEVBQUV4QixzQkFBQSxDQUFjQyxRQUFkLENBQXVCLGFBQXZCLEVBQXNDLElBQXRDO0lBQVgsQ0FBakIsQ0FBTjtJQUVBLEtBQUt3QixZQUFMLENBQWtCb0IsRUFBbEIsQ0FBcUJDLGVBQUEsQ0FBVUMsWUFBL0IsRUFBNkMsS0FBS0MsY0FBbEQ7SUFDQSxLQUFLdkIsWUFBTCxDQUFrQm9CLEVBQWxCLENBQXFCSSxtQkFBQSxDQUFZQyxJQUFqQyxFQUF1QyxLQUFLQyxNQUE1QztFQUNIOztFQUV5QixNQUFWQyxVQUFVLEdBQUc7SUFDekIsS0FBSzNCLFlBQUwsQ0FBa0I0QixjQUFsQixDQUFpQ1AsZUFBQSxDQUFVQyxZQUEzQyxFQUF5RCxLQUFLQyxjQUE5RDtJQUNBLEtBQUt2QixZQUFMLENBQWtCNEIsY0FBbEIsQ0FBaUNKLG1CQUFBLENBQVlDLElBQTdDLEVBQW1ELEtBQUtDLE1BQXhEO0VBQ0g7O0VBbUJ3QixNQUFYakIsV0FBVyxHQUFHO0lBQ3hCLElBQUlvQixPQUFPLEdBQUd0RCxzQkFBQSxDQUFjQyxRQUFkLENBQXVCLGtCQUF2QixDQUFkOztJQUNBLElBQUksQ0FBQ3FELE9BQUQsSUFBWUEsT0FBTyxDQUFDM0IsTUFBUixLQUFtQixDQUFuQyxFQUFzQzJCLE9BQU8sR0FBRyxFQUFWO0lBRXRDLE1BQU1qQyxLQUFLLEdBQUdpQyxPQUFPLENBQUNDLEdBQVIsQ0FBWTdDLENBQUMsSUFBSSxLQUFLZSxZQUFMLENBQWtCYSxPQUFsQixDQUEwQjVCLENBQTFCLENBQWpCLEVBQStDOEMsTUFBL0MsQ0FBc0Q5QyxDQUFDLElBQUksQ0FBQyxDQUFDQSxDQUE3RCxDQUFkO0lBQ0EsTUFBTStDLFlBQVksR0FBRyxLQUFLbkMsS0FBTCxDQUFXRCxLQUFYLElBQW9CLEVBQXpDO0lBQ0EsSUFBSSxDQUFDLElBQUFxQyxvQkFBQSxFQUFhckMsS0FBYixFQUFvQm9DLFlBQXBCLENBQUwsRUFBd0MsT0FOaEIsQ0FNd0I7O0lBQ2hELE1BQU0sS0FBS3RCLFdBQUwsQ0FBaUI7TUFBRWQ7SUFBRixDQUFqQixDQUFOO0VBQ0g7O0VBRXVCLE1BQVZKLFVBQVUsQ0FBQ25CLElBQUQsRUFBYTtJQUNqQyxJQUFJNkQsT0FBTyxHQUFHLEtBQWQ7SUFDQSxNQUFNdEMsS0FBSyxHQUFHLENBQUMsS0FBS0MsS0FBTCxDQUFXRCxLQUFYLElBQW9CLEVBQXJCLEVBQXlCdUMsS0FBekIsRUFBZCxDQUZpQyxDQUVlO0lBRWhEO0lBQ0E7O0lBQ0EsTUFBTUMsT0FBTyxHQUFHLEtBQUtwQyxZQUFMLENBQWtCcUMscUJBQWxCLENBQXdDaEUsSUFBSSxDQUFDYSxNQUE3QyxDQUFoQjs7SUFDQSxJQUFJa0QsT0FBTyxDQUFDbEMsTUFBUixHQUFpQixDQUFyQixFQUF3QjtNQUNwQjdCLElBQUksR0FBRytELE9BQU8sQ0FBQ0EsT0FBTyxDQUFDbEMsTUFBUixHQUFpQixDQUFsQixDQUFkLENBRG9CLENBQ2dCO01BRXBDOztNQUNBLEtBQUssSUFBSW9DLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdGLE9BQU8sQ0FBQ2xDLE1BQVIsR0FBaUIsQ0FBckMsRUFBd0NvQyxDQUFDLEVBQXpDLEVBQTZDO1FBQ3pDLE1BQU1DLEdBQUcsR0FBRzNDLEtBQUssQ0FBQzRDLFNBQU4sQ0FBZ0J2RCxDQUFDLElBQUlBLENBQUMsQ0FBQ0MsTUFBRixLQUFha0QsT0FBTyxDQUFDRSxDQUFELENBQVAsQ0FBV3BELE1BQTdDLENBQVo7O1FBQ0EsSUFBSXFELEdBQUcsS0FBSyxDQUFDLENBQWIsRUFBZ0I7VUFDWjNDLEtBQUssQ0FBQ1QsTUFBTixDQUFhb0QsR0FBYixFQUFrQixDQUFsQjtVQUNBTCxPQUFPLEdBQUcsSUFBVjtRQUNIO01BQ0o7SUFDSixDQWxCZ0MsQ0FvQmpDOzs7SUFDQSxNQUFNTyxXQUFXLEdBQUc3QyxLQUFLLENBQUM0QyxTQUFOLENBQWdCdkQsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLE1BQUYsS0FBYWIsSUFBSSxDQUFDYSxNQUF2QyxDQUFwQixDQXJCaUMsQ0F1QmpDOztJQUNBLElBQUl1RCxXQUFXLEtBQUssQ0FBcEIsRUFBdUI7TUFDbkIsSUFBSUEsV0FBVyxLQUFLLENBQUMsQ0FBckIsRUFBd0I7UUFDcEI3QyxLQUFLLENBQUNULE1BQU4sQ0FBYXNELFdBQWIsRUFBMEIsQ0FBMUI7TUFDSCxDQUhrQixDQUtuQjs7O01BQ0E3QyxLQUFLLENBQUNULE1BQU4sQ0FBYSxDQUFiLEVBQWdCLENBQWhCLEVBQW1CZCxJQUFuQjtNQUNBNkQsT0FBTyxHQUFHLElBQVY7SUFDSDs7SUFFRCxJQUFJdEMsS0FBSyxDQUFDTSxNQUFOLEdBQWVuQyxTQUFuQixFQUE4QjtNQUMxQjtNQUNBO01BQ0E2QixLQUFLLENBQUNULE1BQU4sQ0FBYXBCLFNBQWIsRUFBd0I2QixLQUFLLENBQUNNLE1BQU4sR0FBZW5DLFNBQXZDO01BQ0FtRSxPQUFPLEdBQUcsSUFBVjtJQUNIOztJQUVELElBQUlBLE9BQUosRUFBYTtNQUNUO01BQ0EsTUFBTSxLQUFLeEIsV0FBTCxDQUFpQjtRQUFFZDtNQUFGLENBQWpCLENBQU47TUFDQSxNQUFNaUMsT0FBTyxHQUFHakMsS0FBSyxDQUFDa0MsR0FBTixDQUFVN0MsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLE1BQWpCLENBQWhCOztNQUNBLElBQUkyQyxPQUFPLENBQUMzQixNQUFSLEdBQWlCLENBQXJCLEVBQXdCO1FBQ3BCLE1BQU0zQixzQkFBQSxDQUFjSSxRQUFkLENBQXVCLGtCQUF2QixFQUEyQyxJQUEzQyxFQUFpREMsMEJBQUEsQ0FBYUMsT0FBOUQsRUFBdUVnRCxPQUF2RSxDQUFOO01BQ0g7SUFDSjtFQUNKOztBQXRKOEQ7Ozs4QkFBdEQ1RCxnQixzQkFDa0MsQ0FBQyxNQUFNO0VBQzlDLE1BQU15QixRQUFRLEdBQUcsSUFBSXpCLGdCQUFKLEVBQWpCO0VBQ0F5QixRQUFRLENBQUNnRCxLQUFUO0VBQ0EsT0FBT2hELFFBQVA7QUFDSCxDQUowQyxHIn0=